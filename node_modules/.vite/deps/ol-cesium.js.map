{
  "version": 3,
  "sources": ["../../ol/renderer/canvas/ImageLayer.js", "../../ol/layer/BaseImage.js", "../../ol/layer/Image.js", "../../ol/resolution.js", "../../ol/reproj/Image.js", "../../ol/source/common.js", "../../ol/source/Image.js", "../../ol/source/static.js", "../../ol/source/ImageStatic.js", "../../ol/source/wms.js", "../../ol/source/ImageWMS.js", "../../ol/source/TileWMS.js", "../../ol/source/VectorTile.js", "../../ol/source/BingMaps.js", "../../ol/source/CartoDB.js", "../../ol/source/Cluster.js", "../../ol/vec/mat4.js", "../../ol/webgl/Canvas.js", "../../ol/reproj/glreproj.js", "../../ol/reproj/DataTile.js", "../../ol/source/DataTile.js", "../../@petamoriken/float16/src/_util/messages.mjs", "../../@petamoriken/float16/src/_util/primordials.mjs", "../../@petamoriken/float16/src/_util/arrayIterator.mjs", "../../@petamoriken/float16/src/_util/is.mjs", "../../@petamoriken/float16/src/_util/brand.mjs", "../../@petamoriken/float16/src/_util/converter.mjs", "../../@petamoriken/float16/src/_util/spec.mjs", "../../@petamoriken/float16/src/Float16Array.mjs", "../../@petamoriken/float16/src/isTypedArray.mjs", "../../@petamoriken/float16/src/DataView.mjs", "../../@petamoriken/float16/src/f16round.mjs", "../../@petamoriken/float16/src/index.mjs", "../../xml-utils/get-attribute.js", "../../xml-utils/index-of-match.js", "../../xml-utils/index-of-match-end.js", "../../xml-utils/count-substring.js", "../../xml-utils/find-tag-by-name.js", "../../xml-utils/find-tags-by-name.js", "../../geotiff/dist-module/rgb.js", "../../geotiff/dist-module/compression/index.js", "../../geotiff/dist-module/resample.js", "../../geotiff/dist-module/geotiffimage.js", "../../geotiff/dist-module/dataview64.js", "../../geotiff/dist-module/dataslice.js", "../../geotiff/dist-module/pool.js", "../../geotiff/dist-module/source/httputils.js", "../../geotiff/dist-module/source/basesource.js", "../../quick-lru/index.js", "../../geotiff/dist-module/utils.js", "../../geotiff/dist-module/source/blockedsource.js", "../../geotiff/dist-module/source/client/base.js", "../../geotiff/dist-module/source/client/fetch.js", "../../geotiff/dist-module/source/client/xhr.js", "browser-external:http", "browser-external:https", "browser-external:url", "../../geotiff/dist-module/source/client/http.js", "../../geotiff/dist-module/source/remote.js", "../../geotiff/dist-module/source/arraybuffer.js", "../../geotiff/dist-module/source/filereader.js", "browser-external:fs", "../../geotiff/dist-module/source/file.js", "../../geotiff/dist-module/geotiffwriter.js", "../../geotiff/dist-module/logging.js", "../../geotiff/dist-module/geotiff.js", "../../ol/source/GeoTIFF.js", "../../ol/source/Google.js", "../../ol/format/IIIFInfo.js", "../../ol/source/Zoomify.js", "../../ol/source/IIIF.js", "../../ol/source/arcgisRest.js", "../../ol/source/ImageArcGISRest.js", "../../ol/source/ImageCanvas.js", "../../ol/source/mapguide.js", "../../ol/source/ImageMapGuide.js", "../../ol/source/ImageTile.js", "../../ol/net.js", "../../ol/source/ogcTileUtil.js", "../../ol/source/OGCMapTile.js", "../../ol/source/OGCVectorTile.js", "../../ol/source/Raster.js", "../../ol/source/StadiaMaps.js", "../../ol/source/TileArcGISRest.js", "../../ol/source/TileDebug.js", "../../ol/source/TileJSON.js", "../../ol/source/UTFGrid.js", "../../ol/source/WMTS.js", "../../ol/source.js", "../../pbf/index.js", "../../ol/format/Feature.js", "../../ol/format/MVT.js", "../../ol/renderer/canvas/VectorTileLayer.js", "../../ol/layer/VectorTile.js", "webpack://olcs/webpack/universalModuleDefinition", "webpack://olcs/external%20umd%20%22ol/Observable.js%22", "webpack://olcs/external%20umd%20%22ol/Overlay.js%22", "webpack://olcs/external%20umd%20%22ol/easing.js%22", "webpack://olcs/external%20umd%20%22ol/extent.js%22", "webpack://olcs/external%20umd%20%22ol/format/MVT.js%22", "webpack://olcs/external%20umd%20%22ol/geom.js%22", "webpack://olcs/external%20umd%20%22ol/geom/Point.js%22", "webpack://olcs/external%20umd%20%22ol/geom/Polygon.js%22", "webpack://olcs/external%20umd%20%22ol/geom/SimpleGeometry.js%22", "webpack://olcs/external%20umd%20%22ol/layer/BaseVector.js%22", "webpack://olcs/external%20umd%20%22ol/layer/Group.js%22", "webpack://olcs/external%20umd%20%22ol/layer/Image.js%22", "webpack://olcs/external%20umd%20%22ol/layer/Layer.js%22", "webpack://olcs/external%20umd%20%22ol/layer/Tile.js%22", "webpack://olcs/external%20umd%20%22ol/layer/Vector.js%22", "webpack://olcs/external%20umd%20%22ol/layer/VectorTile.js%22", "webpack://olcs/external%20umd%20%22ol/proj.js%22", "webpack://olcs/external%20umd%20%22ol/render.js%22", "webpack://olcs/external%20umd%20%22ol/render/Feature.js%22", "webpack://olcs/external%20umd%20%22ol/source.js%22", "webpack://olcs/external%20umd%20%22ol/source/Cluster.js%22", "webpack://olcs/external%20umd%20%22ol/source/Image.js%22", "webpack://olcs/external%20umd%20%22ol/source/ImageStatic.js%22", "webpack://olcs/external%20umd%20%22ol/source/ImageWMS.js%22", "webpack://olcs/external%20umd%20%22ol/source/TileImage.js%22", "webpack://olcs/external%20umd%20%22ol/source/TileWMS.js%22", "webpack://olcs/external%20umd%20%22ol/source/Vector.js%22", "webpack://olcs/external%20umd%20%22ol/source/VectorTile.js%22", "webpack://olcs/external%20umd%20%22ol/structs/LRUCache.js%22", "webpack://olcs/external%20umd%20%22ol/style/Icon.js%22", "webpack://olcs/external%20umd%20%22ol/style/Stroke.js%22", "webpack://olcs/external%20umd%20%22ol/style/Style.js%22", "webpack://olcs/external%20umd%20%22ol/tilegrid.js%22", "webpack://olcs/external%20umd%20%22ol/tileurlfunction.js%22", "webpack://olcs/external%20umd%20%22ol/util.js%22", "webpack://olcs/webpack/bootstrap", "webpack://olcs/webpack/runtime/compat%20get%20default%20export", "webpack://olcs/webpack/runtime/define%20property%20getters", "webpack://olcs/webpack/runtime/hasOwnProperty%20shorthand", "webpack://olcs/webpack/runtime/make%20namespace%20object", "webpack://olcs/src/olcs/util.ts", "webpack://olcs/src/olcs/core/OLImageryProvider.ts", "webpack://olcs/src/olcs/MVTImageryProvider.ts", "webpack://olcs/src/olcs/core.ts", "webpack://olcs/src/olcs/AutoRenderLoop.ts", "webpack://olcs/src/olcs/math.ts", "webpack://olcs/src/olcs/Camera.ts", "webpack://olcs/src/olcs/AbstractSynchronizer.ts", "webpack://olcs/src/olcs/RasterSynchronizer.ts", "webpack://olcs/src/olcs/core/VectorLayerCounterpart.ts", "webpack://olcs/src/olcs/FeatureConverter.ts", "webpack://olcs/src/olcs/VectorSynchronizer.ts", "webpack://olcs/src/olcs/SynchronizedOverlay.ts", "webpack://olcs/src/olcs/OverlaySynchronizer.ts", "webpack://olcs/src/olcs/OLCesium.ts", "webpack://olcs/src/olcs/print/computeRectangle.ts", "webpack://olcs/src/olcs/print/drawCesiumMask.ts", "webpack://olcs/src/olcs/print/takeCesiumScreenshot.ts", "webpack://olcs/src/olcs/contrib/LazyLoader.ts", "webpack://olcs/src/olcs/contrib/Manager.ts", "webpack://olcs/src/olcs.ts"],
  "sourcesContent": ["/**\n * @module ol/renderer/canvas/ImageLayer\n */\nimport ImageState from '../../ImageState.js';\nimport ViewHint from '../../ViewHint.js';\nimport {\n  containsCoordinate,\n  containsExtent,\n  getHeight,\n  getIntersection,\n  getWidth,\n  intersects as intersectsExtent,\n  isEmpty,\n} from '../../extent.js';\nimport {fromUserExtent} from '../../proj.js';\nimport {\n  apply as applyTransform,\n  compose as composeTransform,\n} from '../../transform.js';\nimport CanvasLayerRenderer from './Layer.js';\n\n/**\n * @classdesc\n * Canvas renderer for image layers.\n * @api\n */\nclass CanvasImageLayerRenderer extends CanvasLayerRenderer {\n  /**\n   * @param {import(\"../../layer/Image.js\").default} imageLayer Image layer.\n   */\n  constructor(imageLayer) {\n    super(imageLayer);\n\n    /**\n     * @protected\n     * @type {?import(\"../../Image.js\").default}\n     */\n    this.image = null;\n  }\n\n  /**\n   * @return {import('../../DataTile.js').ImageLike} Image.\n   */\n  getImage() {\n    return !this.image ? null : this.image.getImage();\n  }\n\n  /**\n   * Determine whether render should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @override\n   */\n  prepareFrame(frameState) {\n    const layerState = frameState.layerStatesArray[frameState.layerIndex];\n    const pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const viewResolution = viewState.resolution;\n\n    const imageSource = this.getLayer().getSource();\n\n    const hints = frameState.viewHints;\n\n    let renderedExtent = frameState.extent;\n    if (layerState.extent !== undefined) {\n      renderedExtent = getIntersection(\n        renderedExtent,\n        fromUserExtent(layerState.extent, viewState.projection),\n      );\n    }\n\n    if (\n      !hints[ViewHint.ANIMATING] &&\n      !hints[ViewHint.INTERACTING] &&\n      !isEmpty(renderedExtent)\n    ) {\n      if (imageSource) {\n        const projection = viewState.projection;\n        const image = imageSource.getImage(\n          renderedExtent,\n          viewResolution,\n          pixelRatio,\n          projection,\n        );\n        if (image) {\n          if (this.loadImage(image)) {\n            this.image = image;\n          } else if (image.getState() === ImageState.EMPTY) {\n            this.image = null;\n          }\n        }\n      } else {\n        this.image = null;\n      }\n    }\n\n    return !!this.image;\n  }\n\n  /**\n   * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n   * @return {Uint8ClampedArray} Data at the pixel location.\n   * @override\n   */\n  getData(pixel) {\n    const frameState = this.frameState;\n    if (!frameState) {\n      return null;\n    }\n\n    const layer = this.getLayer();\n    const coordinate = applyTransform(\n      frameState.pixelToCoordinateTransform,\n      pixel.slice(),\n    );\n\n    const layerExtent = layer.getExtent();\n    if (layerExtent) {\n      if (!containsCoordinate(layerExtent, coordinate)) {\n        return null;\n      }\n    }\n\n    const imageExtent = this.image.getExtent();\n    const img = this.image.getImage();\n\n    const imageMapWidth = getWidth(imageExtent);\n    const col = Math.floor(\n      img.width * ((coordinate[0] - imageExtent[0]) / imageMapWidth),\n    );\n    if (col < 0 || col >= img.width) {\n      return null;\n    }\n\n    const imageMapHeight = getHeight(imageExtent);\n    const row = Math.floor(\n      img.height * ((imageExtent[3] - coordinate[1]) / imageMapHeight),\n    );\n    if (row < 0 || row >= img.height) {\n      return null;\n    }\n\n    return this.getImageData(img, col, row);\n  }\n\n  /**\n   * Render the layer.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {HTMLElement} target Target that may be used to render content to.\n   * @return {HTMLElement} The rendered element.\n   * @override\n   */\n  renderFrame(frameState, target) {\n    const image = this.image;\n    const imageExtent = image.getExtent();\n    const imageResolution = image.getResolution();\n    const [imageResolutionX, imageResolutionY] = Array.isArray(imageResolution)\n      ? imageResolution\n      : [imageResolution, imageResolution];\n    const imagePixelRatio = image.getPixelRatio();\n    const layerState = frameState.layerStatesArray[frameState.layerIndex];\n    const pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const viewCenter = viewState.center;\n    const viewResolution = viewState.resolution;\n    const scaleX =\n      (pixelRatio * imageResolutionX) / (viewResolution * imagePixelRatio);\n    const scaleY =\n      (pixelRatio * imageResolutionY) / (viewResolution * imagePixelRatio);\n\n    this.prepareContainer(frameState, target);\n\n    // desired dimensions of the canvas in pixels\n    const width = this.context.canvas.width;\n    const height = this.context.canvas.height;\n\n    const context = this.getRenderContext(frameState);\n\n    // clipped rendering if layer extent is set\n    let clipped = false;\n    let render = true;\n    if (layerState.extent) {\n      const layerExtent = fromUserExtent(\n        layerState.extent,\n        viewState.projection,\n      );\n      render = intersectsExtent(layerExtent, frameState.extent);\n      clipped = render && !containsExtent(layerExtent, frameState.extent);\n      if (clipped) {\n        this.clipUnrotated(context, frameState, layerExtent);\n      }\n    }\n\n    const img = image.getImage();\n\n    const transform = composeTransform(\n      this.tempTransform,\n      width / 2,\n      height / 2,\n      scaleX,\n      scaleY,\n      0,\n      (imagePixelRatio * (imageExtent[0] - viewCenter[0])) / imageResolutionX,\n      (imagePixelRatio * (viewCenter[1] - imageExtent[3])) / imageResolutionY,\n    );\n\n    this.renderedResolution = (imageResolutionY * pixelRatio) / imagePixelRatio;\n\n    const dw = img.width * transform[0];\n    const dh = img.height * transform[3];\n\n    if (!this.getLayer().getSource().getInterpolate()) {\n      context.imageSmoothingEnabled = false;\n    }\n\n    this.preRender(context, frameState);\n    if (render && dw >= 0.5 && dh >= 0.5) {\n      const dx = transform[4];\n      const dy = transform[5];\n      const opacity = layerState.opacity;\n      if (opacity !== 1) {\n        context.save();\n        context.globalAlpha = opacity;\n      }\n      context.drawImage(img, 0, 0, +img.width, +img.height, dx, dy, dw, dh);\n      if (opacity !== 1) {\n        context.restore();\n      }\n    }\n    this.postRender(this.context, frameState);\n\n    if (clipped) {\n      context.restore();\n    }\n    context.imageSmoothingEnabled = true;\n\n    return this.container;\n  }\n}\n\nexport default CanvasImageLayerRenderer;\n", "/**\n * @module ol/layer/BaseImage\n */\nimport Layer from './Layer.js';\n\n/**\n * @template {import(\"../source/Image.js\").default} ImageSourceType\n * @typedef {Object} Options\n * @property {string} [className='ol-layer'] A CSS class name to set to the layer element.\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {import(\"../extent.js\").Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position. When `undefined`, a `zIndex` of 0 is assumed\n * for layers that are added to the map's `layers` collection, or `Infinity` when the layer's `setMap()`\n * method was used.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [minZoom] The minimum view zoom level (exclusive) above which this layer will be\n * visible.\n * @property {number} [maxZoom] The maximum view zoom level (inclusive) at which this layer will\n * be visible.\n * @property {import(\"../Map.js\").default} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use {@link import(\"../Map.js\").default#addLayer map.addLayer()}.\n * @property {ImageSourceType} [source] Source for this layer.\n * @property {Object<string, *>} [properties] Arbitrary observable properties. Can be accessed with `#get()` and `#set()`.\n */\n\n/**\n * @classdesc\n * Server-rendered images that are available for arbitrary extents and\n * resolutions.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/Image.js\").default} ImageSourceType\n * @template {import(\"../renderer/Layer.js\").default} RendererType\n * @extends {Layer<ImageSourceType, RendererType>}\n * @api\n */\nclass BaseImageLayer extends Layer {\n  /**\n   * @param {Options<ImageSourceType>} [options] Layer options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n    super(options);\n  }\n}\n\nexport default BaseImageLayer;\n", "/**\n * @module ol/layer/Image\n */\nimport CanvasImageLayerRenderer from '../renderer/canvas/ImageLayer.js';\nimport BaseImageLayer from './BaseImage.js';\n\n/**\n * @classdesc\n * Server-rendered images that are available for arbitrary extents and\n * resolutions.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/Image.js\").default} ImageSourceType\n * @extends {BaseImageLayer<ImageSourceType, CanvasImageLayerRenderer>}\n * @api\n */\nclass ImageLayer extends BaseImageLayer {\n  /**\n   * @param {import(\"./BaseImage.js\").Options<ImageSourceType>} [options] Layer options.\n   */\n  constructor(options) {\n    super(options);\n  }\n\n  /**\n   * @override\n   */\n  createRenderer() {\n    return new CanvasImageLayerRenderer(this);\n  }\n\n  /**\n   * Get data for a pixel location.  A four element RGBA array will be returned.  For requests outside the\n   * layer extent, `null` will be returned.  Data for an image can only be retrieved if the\n   * source's `crossOrigin` property is set.\n   *\n   * ```js\n   * // display layer data on every pointer move\n   * map.on('pointermove', (event) => {\n   *   console.log(layer.getData(event.pixel));\n   * });\n   * ```\n   * @param {import(\"../pixel\").Pixel} pixel Pixel.\n   * @return {Uint8ClampedArray|Uint8Array|Float32Array|DataView|null} Pixel data.\n   * @api\n   * @override\n   */\n  getData(pixel) {\n    return super.getData(pixel);\n  }\n}\n\nexport default ImageLayer;\n", "/**\n * @module ol/resolution\n */\n\n/**\n * @typedef {number|Array<number>} ResolutionLike\n */\n\n/**\n * @param {ResolutionLike} resolution Resolution.\n * @return {number} Resolution.\n */\nexport function fromResolutionLike(resolution) {\n  if (Array.isArray(resolution)) {\n    return Math.min(...resolution);\n  }\n  return resolution;\n}\n", "/**\n * @module ol/reproj/Image\n */\n\nimport ImageWrapper from '../Image.js';\nimport ImageState from '../ImageState.js';\nimport EventType from '../events/EventType.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {\n  getCenter,\n  getHeight,\n  getIntersection,\n  getWidth,\n  isEmpty,\n} from '../extent.js';\nimport {\n  calculateSourceResolution,\n  render as renderReprojected,\n} from '../reproj.js';\nimport {fromResolutionLike} from '../resolution.js';\nimport Triangulation from './Triangulation.js';\nimport {ERROR_THRESHOLD} from './common.js';\n\n/**\n * @typedef {function(import(\"../extent.js\").Extent, number, number) : import(\"../Image.js\").default} FunctionType\n */\n\n/**\n * @classdesc\n * Class encapsulating single reprojected image.\n * See {@link module:ol/source/Image~ImageSource}.\n */\nclass ReprojImage extends ImageWrapper {\n  /**\n   * @param {import(\"../proj/Projection.js\").default} sourceProj Source projection (of the data).\n   * @param {import(\"../proj/Projection.js\").default} targetProj Target projection.\n   * @param {import(\"../extent.js\").Extent} targetExtent Target extent.\n   * @param {number} targetResolution Target resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {FunctionType} getImageFunction\n   *     Function returning source images (extent, resolution, pixelRatio).\n   * @param {boolean} interpolate Use linear interpolation when resampling.\n   */\n  constructor(\n    sourceProj,\n    targetProj,\n    targetExtent,\n    targetResolution,\n    pixelRatio,\n    getImageFunction,\n    interpolate,\n  ) {\n    let maxSourceExtent = sourceProj.getExtent();\n    if (maxSourceExtent && sourceProj.canWrapX()) {\n      maxSourceExtent = maxSourceExtent.slice();\n      maxSourceExtent[0] = -Infinity;\n      maxSourceExtent[2] = Infinity;\n    }\n    let maxTargetExtent = targetProj.getExtent();\n    if (maxTargetExtent && targetProj.canWrapX()) {\n      maxTargetExtent = maxTargetExtent.slice();\n      maxTargetExtent[0] = -Infinity;\n      maxTargetExtent[2] = Infinity;\n    }\n\n    const limitedTargetExtent = maxTargetExtent\n      ? getIntersection(targetExtent, maxTargetExtent)\n      : targetExtent;\n\n    const targetCenter = getCenter(limitedTargetExtent);\n    const sourceResolution = calculateSourceResolution(\n      sourceProj,\n      targetProj,\n      targetCenter,\n      targetResolution,\n    );\n\n    const errorThresholdInPixels = ERROR_THRESHOLD;\n\n    const triangulation = new Triangulation(\n      sourceProj,\n      targetProj,\n      limitedTargetExtent,\n      maxSourceExtent,\n      sourceResolution * errorThresholdInPixels,\n      targetResolution,\n    );\n\n    const sourceExtent = triangulation.calculateSourceExtent();\n    const sourceImage = isEmpty(sourceExtent)\n      ? null\n      : getImageFunction(sourceExtent, sourceResolution, pixelRatio);\n    const state = sourceImage ? ImageState.IDLE : ImageState.EMPTY;\n    const sourcePixelRatio = sourceImage ? sourceImage.getPixelRatio() : 1;\n\n    super(targetExtent, targetResolution, sourcePixelRatio, state);\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.targetProj_ = targetProj;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.maxSourceExtent_ = maxSourceExtent;\n\n    /**\n     * @private\n     * @type {!import(\"./Triangulation.js\").default}\n     */\n    this.triangulation_ = triangulation;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.targetResolution_ = targetResolution;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.targetExtent_ = targetExtent;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").default}\n     */\n    this.sourceImage_ = sourceImage;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.sourcePixelRatio_ = sourcePixelRatio;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.interpolate_ = interpolate;\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    this.canvas_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"../events.js\").EventsKey}\n     */\n    this.sourceListenerKey_ = null;\n  }\n\n  /**\n   * Clean up.\n   * @override\n   */\n  disposeInternal() {\n    if (this.state == ImageState.LOADING) {\n      this.unlistenSource_();\n    }\n    super.disposeInternal();\n  }\n\n  /**\n   * @return {HTMLCanvasElement} Image.\n   * @override\n   */\n  getImage() {\n    return this.canvas_;\n  }\n\n  /**\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   */\n  getProjection() {\n    return this.targetProj_;\n  }\n\n  /**\n   * @private\n   */\n  reproject_() {\n    const sourceState = this.sourceImage_.getState();\n    if (sourceState == ImageState.LOADED) {\n      const width = getWidth(this.targetExtent_) / this.targetResolution_;\n      const height = getHeight(this.targetExtent_) / this.targetResolution_;\n      this.canvas_ = renderReprojected(\n        width,\n        height,\n        this.sourcePixelRatio_,\n        fromResolutionLike(this.sourceImage_.getResolution()),\n        this.maxSourceExtent_,\n        this.targetResolution_,\n        this.targetExtent_,\n        this.triangulation_,\n        [\n          {\n            extent: this.sourceImage_.getExtent(),\n            image: this.sourceImage_.getImage(),\n          },\n        ],\n        0,\n        undefined,\n        this.interpolate_,\n        true,\n      );\n    }\n    this.state = sourceState;\n    this.changed();\n  }\n\n  /**\n   * Load not yet loaded URI.\n   * @override\n   */\n  load() {\n    if (this.state == ImageState.IDLE) {\n      this.state = ImageState.LOADING;\n      this.changed();\n\n      const sourceState = this.sourceImage_.getState();\n      if (sourceState == ImageState.LOADED || sourceState == ImageState.ERROR) {\n        this.reproject_();\n      } else {\n        this.sourceListenerKey_ = listen(\n          this.sourceImage_,\n          EventType.CHANGE,\n          (e) => {\n            const sourceState = this.sourceImage_.getState();\n            if (\n              sourceState == ImageState.LOADED ||\n              sourceState == ImageState.ERROR\n            ) {\n              this.unlistenSource_();\n              this.reproject_();\n            }\n          },\n        );\n        this.sourceImage_.load();\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  unlistenSource_() {\n    unlistenByKey(\n      /** @type {!import(\"../events.js\").EventsKey} */ (\n        this.sourceListenerKey_\n      ),\n    );\n    this.sourceListenerKey_ = null;\n  }\n}\n\nexport default ReprojImage;\n", "/**\n * @module ol/source/common\n */\n\n/**\n * Default WMS version.\n * @type {string}\n */\nexport const DEFAULT_WMS_VERSION = '1.3.0';\n\n/**\n * Number of decimal digits to consider in integer values when rounding.\n * @type {number}\n */\nexport const DECIMALS = 4;\n", "/**\n * @module ol/source/Image\n */\nimport ImageWrapper from '../Image.js';\nimport ImageState from '../ImageState.js';\nimport {linearFindNearest} from '../array.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {\n  containsExtent,\n  equals,\n  getCenter,\n  getForViewAndSize,\n  getHeight,\n  getWidth,\n} from '../extent.js';\nimport {ceil} from '../math.js';\nimport {equivalent} from '../proj.js';\nimport ReprojImage from '../reproj/Image.js';\nimport {fromResolutionLike} from '../resolution.js';\nimport Source from './Source.js';\nimport {DECIMALS} from './common.js';\n\n/**\n * @enum {string}\n */\nexport const ImageSourceEventType = {\n  /**\n   * Triggered when an image starts loading.\n   * @event module:ol/source/Image.ImageSourceEvent#imageloadstart\n   * @api\n   */\n  IMAGELOADSTART: 'imageloadstart',\n\n  /**\n   * Triggered when an image finishes loading.\n   * @event module:ol/source/Image.ImageSourceEvent#imageloadend\n   * @api\n   */\n  IMAGELOADEND: 'imageloadend',\n\n  /**\n   * Triggered if image loading results in an error.\n   * @event module:ol/source/Image.ImageSourceEvent#imageloaderror\n   * @api\n   */\n  IMAGELOADERROR: 'imageloaderror',\n};\n\n/**\n * @typedef {'imageloadend'|'imageloaderror'|'imageloadstart'} ImageSourceEventTypes\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Image~ImageSource} instances are instances of this\n * type.\n */\nexport class ImageSourceEvent extends Event {\n  /**\n   * @param {string} type Type.\n   * @param {import(\"../Image.js\").default} image The image.\n   */\n  constructor(type, image) {\n    super(type);\n\n    /**\n     * The image related to the event.\n     * @type {import(\"../Image.js\").default}\n     * @api\n     */\n    this.image = image;\n  }\n}\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types, import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<ImageSourceEventTypes, ImageSourceEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types\n *     |ImageSourceEventTypes, Return>} ImageSourceOnSignature\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../Image.js\").Loader} [loader] Loader. Can either be a custom loader, or one of the\n * loaders created with a `createLoader()` function ({@link module:ol/source/wms.createLoader wms},\n * {@link module:ol/source/arcgisRest.createLoader arcgisRest}, {@link module:ol/source/mapguide.createLoader mapguide},\n * {@link module:ol/source/static.createLoader static}).\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection.\n * @property {Array<number>} [resolutions] Resolutions.\n * @property {import(\"./Source.js\").State} [state] State.\n */\n\n/**\n * @classdesc\n * Base class for sources providing a single image.\n * @fires module:ol/source/Image.ImageSourceEvent\n * @api\n */\nclass ImageSource extends Source {\n  /**\n   * @param {Options} options Single image source options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      projection: options.projection,\n      state: options.state,\n      interpolate:\n        options.interpolate !== undefined ? options.interpolate : true,\n    });\n\n    /***\n     * @type {ImageSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {ImageSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {ImageSourceOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @protected\n     * @type {import(\"../Image.js\").Loader}\n     */\n    this.loader = options.loader || null;\n\n    /**\n     * @private\n     * @type {Array<number>|null}\n     */\n    this.resolutions_ =\n      options.resolutions !== undefined ? options.resolutions : null;\n\n    /**\n     * @private\n     * @type {import(\"../reproj/Image.js\").default}\n     */\n    this.reprojectedImage_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.reprojectedRevision_ = 0;\n\n    /**\n     * @protected\n     * @type {import(\"../Image.js\").default}\n     */\n    this.image = null;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.wantedExtent_;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.wantedResolution_;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.static_ = options.loader ? options.loader.length === 0 : false;\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.wantedProjection_ = null;\n  }\n\n  /**\n   * @return {Array<number>|null} Resolutions.\n   * @override\n   */\n  getResolutions() {\n    return this.resolutions_;\n  }\n\n  /**\n   * @param {Array<number>|null} resolutions Resolutions.\n   */\n  setResolutions(resolutions) {\n    this.resolutions_ = resolutions;\n  }\n\n  /**\n   * @protected\n   * @param {number} resolution Resolution.\n   * @return {number} Resolution.\n   */\n  findNearestResolution(resolution) {\n    const resolutions = this.getResolutions();\n    if (resolutions) {\n      const idx = linearFindNearest(resolutions, resolution, 0);\n      resolution = resolutions[idx];\n    }\n    return resolution;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   */\n  getImage(extent, resolution, pixelRatio, projection) {\n    const sourceProjection = this.getProjection();\n    if (\n      !sourceProjection ||\n      !projection ||\n      equivalent(sourceProjection, projection)\n    ) {\n      if (sourceProjection) {\n        projection = sourceProjection;\n      }\n\n      return this.getImageInternal(extent, resolution, pixelRatio, projection);\n    }\n    if (this.reprojectedImage_) {\n      if (\n        this.reprojectedRevision_ == this.getRevision() &&\n        equivalent(this.reprojectedImage_.getProjection(), projection) &&\n        this.reprojectedImage_.getResolution() == resolution &&\n        equals(this.reprojectedImage_.getExtent(), extent)\n      ) {\n        return this.reprojectedImage_;\n      }\n      this.reprojectedImage_.dispose();\n      this.reprojectedImage_ = null;\n    }\n\n    this.reprojectedImage_ = new ReprojImage(\n      sourceProjection,\n      projection,\n      extent,\n      resolution,\n      pixelRatio,\n      (extent, resolution, pixelRatio) =>\n        this.getImageInternal(extent, resolution, pixelRatio, sourceProjection),\n      this.getInterpolate(),\n    );\n    this.reprojectedRevision_ = this.getRevision();\n\n    return this.reprojectedImage_;\n  }\n\n  /**\n   * @abstract\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   * @protected\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    if (this.loader) {\n      const requestExtent = getRequestExtent(extent, resolution, pixelRatio, 1);\n      const requestResolution = this.findNearestResolution(resolution);\n      if (\n        this.image &&\n        (this.static_ ||\n          (this.wantedProjection_ === projection &&\n            ((this.wantedExtent_ &&\n              containsExtent(this.wantedExtent_, requestExtent)) ||\n              containsExtent(this.image.getExtent(), requestExtent)) &&\n            ((this.wantedResolution_ &&\n              fromResolutionLike(this.wantedResolution_) ===\n                requestResolution) ||\n              fromResolutionLike(this.image.getResolution()) ===\n                requestResolution)))\n      ) {\n        return this.image;\n      }\n      this.wantedProjection_ = projection;\n      this.wantedExtent_ = requestExtent;\n      this.wantedResolution_ = requestResolution;\n      this.image = new ImageWrapper(\n        requestExtent,\n        requestResolution,\n        pixelRatio,\n        this.loader,\n      );\n      this.image.addEventListener(\n        EventType.CHANGE,\n        this.handleImageChange.bind(this),\n      );\n    }\n    return this.image;\n  }\n\n  /**\n   * Handle image change events.\n   * @param {import(\"../events/Event.js\").default} event Event.\n   * @protected\n   */\n  handleImageChange(event) {\n    const image = /** @type {import(\"../Image.js\").default} */ (event.target);\n    let type;\n    switch (image.getState()) {\n      case ImageState.LOADING:\n        this.loading = true;\n        type = ImageSourceEventType.IMAGELOADSTART;\n        break;\n      case ImageState.LOADED:\n        this.loading = false;\n        type = ImageSourceEventType.IMAGELOADEND;\n        break;\n      case ImageState.ERROR:\n        this.loading = false;\n        type = ImageSourceEventType.IMAGELOADERROR;\n        break;\n      default:\n        return;\n    }\n    if (this.hasListener(type)) {\n      this.dispatchEvent(new ImageSourceEvent(type, image));\n    }\n  }\n}\n\n/**\n * Default image load function for image sources that use import(\"../Image.js\").Image image\n * instances.\n * @param {import(\"../Image.js\").default} image Image.\n * @param {string} src Source.\n */\nexport function defaultImageLoadFunction(image, src) {\n  /** @type {HTMLImageElement|HTMLVideoElement} */ (image.getImage()).src = src;\n}\n\n/**\n * Adjusts the extent so it aligns with pixel boundaries.\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {number} resolution Reolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} ratio Ratio between request size and view size.\n * @return {import(\"../extent.js\").Extent} Request extent.\n */\nexport function getRequestExtent(extent, resolution, pixelRatio, ratio) {\n  const imageResolution = resolution / pixelRatio;\n  const center = getCenter(extent);\n  const viewWidth = ceil(getWidth(extent) / imageResolution, DECIMALS);\n  const viewHeight = ceil(getHeight(extent) / imageResolution, DECIMALS);\n  const marginWidth = ceil(((ratio - 1) * viewWidth) / 2, DECIMALS);\n  const requestWidth = viewWidth + 2 * marginWidth;\n  const marginHeight = ceil(((ratio - 1) * viewHeight) / 2, DECIMALS);\n  const requestHeight = viewHeight + 2 * marginHeight;\n  return getForViewAndSize(center, imageResolution, 0, [\n    requestWidth,\n    requestHeight,\n  ]);\n}\n\nexport default ImageSource;\n", "/**\n * @module ol/source/static\n */\n\nimport {decode} from '../Image.js';\nimport {getHeight, getWidth} from '../extent.js';\n\n/**\n * @typedef {Object} LoaderOptions\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {import(\"../extent.js\").Extent} imageExtent Extent of the image in map coordinates.\n * This is the [left, bottom, right, top] map coordinates of your image. When using this loader with an\n * `ol/source/Image`, the same extent must be set as `extent` of the `ol/layer/Image`.\n * @property {string} url Image URL.\n * @property {function(HTMLImageElement, string): Promise<import('../DataTile.js').ImageLike>} [load] Function\n * to perform loading of the image. Receives the created `HTMLImageElement` and the desired `src` as argument and\n * returns a promise resolving to the loaded or decoded image. Default is {@link module:ol/Image.decode}.\n */\n\n/**\n * Creates a loader for static images.\n * @param {LoaderOptions} options Loader options.\n * @return {import(\"../Image.js\").ImageObjectPromiseLoader} Loader.\n * @api\n */\nexport function createLoader(options) {\n  const load = options.load || decode;\n  const extent = options.imageExtent;\n  const crossOrigin = options.crossOrigin ?? null;\n\n  return () => {\n    const image = new Image();\n    image.crossOrigin = crossOrigin;\n    return load(image, options.url).then((image) => {\n      const resolutionX = getWidth(extent) / image.width;\n      const resolutionY = getHeight(extent) / image.height;\n      const resolution =\n        resolutionX !== resolutionY ? [resolutionX, resolutionY] : resolutionY;\n      return {image, extent, resolution, pixelRatio: 1};\n    });\n  };\n}\n", "/**\n * @module ol/source/ImageStatic\n */\n\nimport ImageWrapper, {decode} from '../Image.js';\nimport EventType from '../events/EventType.js';\nimport {intersects} from '../extent.js';\nimport {get as getProjection} from '../proj.js';\nimport ImageSource, {defaultImageLoadFunction} from './Image.js';\nimport {createLoader} from './static.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {import(\"../extent.js\").Extent} imageExtent Extent of the image in map coordinates.\n * This is the [left, bottom, right, top] map coordinates of your image.\n * @property {import(\"../Image.js\").LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {string} url Image URL.\n */\n\n/**\n * @classdesc\n * A layer source for displaying a single, static image.\n * @api\n */\nclass Static extends ImageSource {\n  /**\n   * @param {Options} options ImageStatic options.\n   */\n  constructor(options) {\n    const crossOrigin =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n    const /** @type {import(\"../Image.js\").LoadFunction} */ imageLoadFunction =\n        options.imageLoadFunction !== undefined\n          ? options.imageLoadFunction\n          : defaultImageLoadFunction;\n\n    super({\n      attributions: options.attributions,\n      interpolate: options.interpolate,\n      projection: getProjection(options.projection),\n    });\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.url_ = options.url;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.imageExtent_ = options.imageExtent;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").default}\n     */\n    this.image = null;\n\n    this.image = new ImageWrapper(\n      this.imageExtent_,\n      undefined,\n      1,\n      createLoader({\n        url: options.url,\n        imageExtent: options.imageExtent,\n        crossOrigin,\n        load: (image, src) => {\n          this.image.setImage(image);\n          imageLoadFunction(this.image, src);\n          return decode(image);\n        },\n      }),\n    );\n\n    this.image.addEventListener(\n      EventType.CHANGE,\n      this.handleImageChange.bind(this),\n    );\n  }\n\n  /**\n   * Returns the image extent\n   * @return {import(\"../extent.js\").Extent} image extent.\n   * @api\n   */\n  getImageExtent() {\n    return this.imageExtent_;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   * @override\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    if (intersects(extent, this.image.getExtent())) {\n      return this.image;\n    }\n    return null;\n  }\n\n  /**\n   * Return the URL used for this image source.\n   * @return {string} URL.\n   * @api\n   */\n  getUrl() {\n    return this.url_;\n  }\n}\n\nexport default Static;\n", "/**\n * @module ol/source/wms\n */\n\nimport {decode} from '../Image.js';\nimport {getForViewAndSize, getHeight, getWidth} from '../extent.js';\nimport {floor, round} from '../math.js';\nimport {get as getProjection} from '../proj.js';\nimport {compareVersions} from '../string.js';\nimport {appendParams} from '../uri.js';\nimport {getRequestExtent} from './Image.js';\nimport {DECIMALS} from './common.js';\n\n/**\n * Default WMS version.\n * @type {string}\n */\nexport const DEFAULT_VERSION = '1.3.0';\n\n/**\n * @const\n * @type {import(\"../size.js\").Size}\n */\nconst GETFEATUREINFO_IMAGE_SIZE = [101, 101];\n\n/**\n * @api\n * @typedef {'carmentaserver' | 'geoserver' | 'mapserver' | 'qgis'} ServerType\n * Set the server type to use implementation-specific parameters beyond the WMS specification.\n *  - `'carmentaserver'`: HiDPI support for [Carmenta Server](https://www.carmenta.com/en/products/carmenta-server)\n *  - `'geoserver'`: HiDPI support for [GeoServer](https://geoserver.org/)\n *  - `'mapserver'`: HiDPI support for [MapServer](https://mapserver.org/)\n *  - `'qgis'`: HiDPI support for [QGIS](https://qgis.org/)\n */\n\n/**\n * @param {string} baseUrl Base URL.\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {import(\"../size.js\").Size} size Size.\n * @param {import(\"../proj/Projection.js\").default} projection Projection.\n * @param {Object} params WMS params. Will be modified in place.\n * @return {string} Request URL.\n */\nexport function getRequestUrl(baseUrl, extent, size, projection, params) {\n  params['WIDTH'] = size[0];\n  params['HEIGHT'] = size[1];\n\n  const axisOrientation = projection.getAxisOrientation();\n  const v13 = compareVersions(params['VERSION'], '1.3') >= 0;\n  params[v13 ? 'CRS' : 'SRS'] = projection.getCode();\n  const bbox =\n    v13 && axisOrientation.startsWith('ne')\n      ? [extent[1], extent[0], extent[3], extent[2]]\n      : extent;\n  params['BBOX'] = bbox.join(',');\n\n  return appendParams(baseUrl, params);\n}\n\n/**\n * @param {import(\"../extent\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio pixel ratio.\n * @param {import(\"../proj.js\").Projection} projection Projection.\n * @param {string} url WMS service url.\n * @param {Object} params WMS params.\n * @param {import(\"./wms.js\").ServerType} serverType The type of the remote WMS server.\n * @return {string} Image src.\n */\nexport function getImageSrc(\n  extent,\n  resolution,\n  pixelRatio,\n  projection,\n  url,\n  params,\n  serverType,\n) {\n  params = Object.assign({REQUEST: 'GetMap'}, params);\n\n  const imageResolution = resolution / pixelRatio;\n\n  const imageSize = [\n    round(getWidth(extent) / imageResolution, DECIMALS),\n    round(getHeight(extent) / imageResolution, DECIMALS),\n  ];\n\n  if (pixelRatio != 1) {\n    switch (serverType) {\n      case 'geoserver':\n        const dpi = (90 * pixelRatio + 0.5) | 0;\n        if ('FORMAT_OPTIONS' in params) {\n          params['FORMAT_OPTIONS'] += ';dpi:' + dpi;\n        } else {\n          params['FORMAT_OPTIONS'] = 'dpi:' + dpi;\n        }\n        break;\n      case 'mapserver':\n        params['MAP_RESOLUTION'] = 90 * pixelRatio;\n        break;\n      case 'carmentaserver':\n      case 'qgis':\n        params['DPI'] = 90 * pixelRatio;\n        break;\n      default:\n        throw new Error('Unknown `serverType` configured');\n    }\n  }\n\n  const src = getRequestUrl(url, extent, imageSize, projection, params);\n  return src;\n}\n\n/**\n * @param {Object} params WMS params.\n * @param {string} request WMS `REQUEST`.\n * @return {Object} WMS params with required properties set.\n */\nexport function getRequestParams(params, request) {\n  return Object.assign(\n    {\n      'REQUEST': request,\n      'SERVICE': 'WMS',\n      'VERSION': DEFAULT_VERSION,\n      'FORMAT': 'image/png',\n      'STYLES': '',\n      'TRANSPARENT': 'TRUE',\n    },\n    params,\n  );\n}\n\n/**\n * @typedef {Object} LoaderOptions\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {Object<string,*>} [params] WMS request parameters.\n * At least a `LAYERS` param is required. `STYLES` is\n * `''` by default. `VERSION` is `1.3.0` by default. `WIDTH`, `HEIGHT` and `BBOX` will be set\n * dynamically. `CRS` (`SRS` for WMS version < 1.3.0) will is derived from the `proection` config.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is 'EPSG:3857'.\n * @property {number} [ratio=1.5] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {import(\"./wms.js\").ServerType} [serverType] The type of\n * the remote WMS server: `mapserver`, `geoserver`, `carmentaserver`, or `qgis`.\n * Only needed if `hidpi` is `true`.\n * @property {string} url WMS service URL.\n * @property {function(HTMLImageElement, string): Promise<import('../DataTile.js').ImageLike>} [load] Function\n * to perform loading of the image. Receives the created `HTMLImageElement` and the desired `src` as argument and\n * returns a promise resolving to the loaded or decoded image. Default is {@link module:ol/Image.decode}.\n */\n\n/**\n * Creates a loader for WMS images.\n * @param {LoaderOptions} options Loader options.\n * @return {import(\"../Image.js\").ImageObjectPromiseLoader} Loader.\n * @api\n */\nexport function createLoader(options) {\n  const hidpi = options.hidpi === undefined ? true : options.hidpi;\n  const projection = getProjection(options.projection || 'EPSG:3857');\n  const ratio = options.ratio || 1.5;\n  const load = options.load || decode;\n  const crossOrigin = options.crossOrigin ?? null;\n\n  return (extent, resolution, pixelRatio) => {\n    extent = getRequestExtent(extent, resolution, pixelRatio, ratio);\n    if (pixelRatio != 1 && (!hidpi || options.serverType === undefined)) {\n      pixelRatio = 1;\n    }\n    const src = getImageSrc(\n      extent,\n      resolution,\n      pixelRatio,\n      projection,\n      options.url,\n      getRequestParams(options.params, 'GetMap'),\n      options.serverType,\n    );\n    const image = new Image();\n    image.crossOrigin = crossOrigin;\n    return load(image, src).then((image) => ({image, extent, pixelRatio}));\n  };\n}\n\n/**\n * Get the GetFeatureInfo URL for the passed coordinate and resolution. Returns `undefined` if the\n * GetFeatureInfo URL cannot be constructed.\n * @param {LoaderOptions} options Options passed the `createWMSLoader()` function. In addition to\n * the params required by the loader, `INFO_FORMAT` should be specified, it defaults to\n * `application/json`. If `QUERY_LAYERS` is not provided, then the layers specified in the `LAYERS`\n * parameter will be used.\n * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n * @param {number} resolution Resolution.\n * @return {string|undefined} GetFeatureInfo URL.\n * @api\n */\nexport function getFeatureInfoUrl(options, coordinate, resolution) {\n  if (options.url === undefined) {\n    return undefined;\n  }\n\n  const projectionObj = getProjection(options.projection || 'EPSG:3857');\n\n  const extent = getForViewAndSize(\n    coordinate,\n    resolution,\n    0,\n    GETFEATUREINFO_IMAGE_SIZE,\n  );\n\n  const baseParams = {\n    'QUERY_LAYERS': options.params['LAYERS'],\n    'INFO_FORMAT': 'application/json',\n  };\n  Object.assign(\n    baseParams,\n    getRequestParams(options.params, 'GetFeatureInfo'),\n    options.params,\n  );\n\n  const x = floor((coordinate[0] - extent[0]) / resolution, DECIMALS);\n  const y = floor((extent[3] - coordinate[1]) / resolution, DECIMALS);\n  const v13 = compareVersions(baseParams['VERSION'], '1.3') >= 0;\n  baseParams[v13 ? 'I' : 'X'] = x;\n  baseParams[v13 ? 'J' : 'Y'] = y;\n\n  return getRequestUrl(\n    options.url,\n    extent,\n    GETFEATUREINFO_IMAGE_SIZE,\n    projectionObj,\n    baseParams,\n  );\n}\n\n/**\n * Get the GetLegendGraphic URL, optionally optimized for the passed resolution and possibly\n * including any passed specific parameters. Returns `undefined` if the GetLegendGraphic URL\n * cannot be constructed.\n *\n * @param {LoaderOptions} options Options passed the `createWMSLoader()` function.\n * @param {number} [resolution] Resolution. If not provided, `SCALE` will not be calculated and\n * included in URL.\n * @return {string|undefined} GetLegendGraphic URL.\n * @api\n */\nexport function getLegendUrl(options, resolution) {\n  if (options.url === undefined) {\n    return undefined;\n  }\n\n  const baseParams = {\n    'SERVICE': 'WMS',\n    'VERSION': DEFAULT_VERSION,\n    'REQUEST': 'GetLegendGraphic',\n    'FORMAT': 'image/png',\n  };\n\n  if (resolution !== undefined) {\n    const mpu =\n      getProjection(options.projection || 'EPSG:3857').getMetersPerUnit() || 1;\n    const pixelSize = 0.00028;\n    baseParams['SCALE'] = (resolution * mpu) / pixelSize;\n  }\n\n  Object.assign(baseParams, options.params);\n\n  if (options.params !== undefined && baseParams['LAYER'] === undefined) {\n    const layers = baseParams['LAYERS'];\n    const isSingleLayer = !Array.isArray(layers) || layers.length !== 1;\n    if (!isSingleLayer) {\n      return undefined;\n    }\n    baseParams['LAYER'] = layers;\n  }\n\n  return appendParams(options.url, baseParams);\n}\n", "/**\n * @module ol/source/ImageWMS\n */\n\nimport {decode} from '../Image.js';\nimport {get as getProjection, transform} from '../proj.js';\nimport {calculateSourceResolution} from '../reproj.js';\nimport ImageSource, {defaultImageLoadFunction} from './Image.js';\nimport {createLoader, getFeatureInfoUrl, getLegendUrl} from './wms.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {import(\"./wms.js\").ServerType} [serverType] The type of\n * the remote WMS server: `mapserver`, `geoserver`, `carmentaserver`, or `qgis`.\n * Only needed if `hidpi` is `true`.\n * @property {import(\"../Image.js\").LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {Object<string,*>} [params] WMS request parameters.\n * At least a `LAYERS` param is required. `STYLES` is\n * `''` by default. `VERSION` is `1.3.0` by default. `WIDTH`, `HEIGHT`, `BBOX`\n * and `CRS` (`SRS` for WMS version < 1.3.0) will be set dynamically.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {number} [ratio=1.5] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {Array<number>} [resolutions] Resolutions.\n * If specified, requests will be made for these resolutions only.\n * @property {string} [url] WMS service URL.\n */\n\n/**\n * @classdesc\n * Source for WMS servers providing single, untiled images.\n *\n * @fires module:ol/source/Image.ImageSourceEvent\n * @api\n */\nclass ImageWMS extends ImageSource {\n  /**\n   * @param {Options} [options] ImageWMS options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    super({\n      attributions: options.attributions,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      resolutions: options.resolutions,\n    });\n\n    /**\n     * @private\n     * @type {?string}\n     */\n    this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.url_ = options.url;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").LoadFunction}\n     */\n    this.imageLoadFunction_ =\n      options.imageLoadFunction !== undefined\n        ? options.imageLoadFunction\n        : defaultImageLoadFunction;\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.params_ = Object.assign({}, options.params);\n\n    /**\n     * @private\n     * @type {import(\"./wms.js\").ServerType}\n     */\n    this.serverType_ = options.serverType;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRevision_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.ratio_ = options.ratio !== undefined ? options.ratio : 1.5;\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.loaderProjection_ = null;\n  }\n\n  /**\n   * Return the GetFeatureInfo URL for the passed coordinate, resolution, and\n   * projection. Return `undefined` if the GetFeatureInfo URL cannot be\n   * constructed.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../proj.js\").ProjectionLike} projection Projection.\n   * @param {!Object} params GetFeatureInfo params. `INFO_FORMAT` at least should\n   *     be provided. If `QUERY_LAYERS` is not provided then the layers specified\n   *     in the `LAYERS` parameter will be used. `VERSION` should not be\n   *     specified here.\n   * @return {string|undefined} GetFeatureInfo URL.\n   * @api\n   */\n  getFeatureInfoUrl(coordinate, resolution, projection, params) {\n    const projectionObj = getProjection(projection);\n    const sourceProjectionObj = this.getProjection();\n\n    if (sourceProjectionObj && sourceProjectionObj !== projectionObj) {\n      resolution = calculateSourceResolution(\n        sourceProjectionObj,\n        projectionObj,\n        coordinate,\n        resolution,\n      );\n      coordinate = transform(coordinate, projectionObj, sourceProjectionObj);\n    }\n\n    const options = {\n      url: this.url_,\n      params: {\n        ...this.params_,\n        ...params,\n      },\n      projection: sourceProjectionObj || projectionObj,\n    };\n    return getFeatureInfoUrl(options, coordinate, resolution);\n  }\n\n  /**\n   * Return the GetLegendGraphic URL, optionally optimized for the passed\n   * resolution and possibly including any passed specific parameters. Returns\n   * `undefined` if the GetLegendGraphic URL cannot be constructed.\n   *\n   * @param {number} [resolution] Resolution. If set to undefined, `SCALE`\n   *     will not be calculated and included in URL.\n   * @param {Object} [params] GetLegendGraphic params. If `LAYER` is set, the\n   *     request is generated for this wms layer, else it will try to use the\n   *     configured wms layer. Default `FORMAT` is `image/png`.\n   *     `VERSION` should not be specified here.\n   * @return {string|undefined} GetLegendGraphic URL.\n   * @api\n   */\n  getLegendUrl(resolution, params) {\n    return getLegendUrl(\n      {\n        url: this.url_,\n        params: {\n          ...this.params_,\n          ...params,\n        },\n      },\n      resolution,\n    );\n  }\n\n  /**\n   * Get the user-provided params, i.e. those passed to the constructor through\n   * the \"params\" option, and possibly updated using the updateParams method.\n   * @return {Object} Params.\n   * @api\n   */\n  getParams() {\n    return this.params_;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   * @override\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    if (this.url_ === undefined) {\n      return null;\n    }\n    if (!this.loader || this.loaderProjection_ !== projection) {\n      // Lazily create loader to pick up the view projection and to allow `params` updates\n      this.loaderProjection_ = projection;\n      this.loader = createLoader({\n        crossOrigin: this.crossOrigin_,\n        params: this.params_,\n        projection: projection,\n        serverType: this.serverType_,\n        hidpi: this.hidpi_,\n        url: this.url_,\n        ratio: this.ratio_,\n        load: (image, src) => {\n          this.image.setImage(image);\n          this.imageLoadFunction_(this.image, src);\n          return decode(image);\n        },\n      });\n    }\n\n    return super.getImageInternal(extent, resolution, pixelRatio, projection);\n  }\n\n  /**\n   * Return the image load function of the source.\n   * @return {import(\"../Image.js\").LoadFunction} The image load function.\n   * @api\n   */\n  getImageLoadFunction() {\n    return this.imageLoadFunction_;\n  }\n\n  /**\n   * Return the URL used for this WMS source.\n   * @return {string|undefined} URL.\n   * @api\n   */\n  getUrl() {\n    return this.url_;\n  }\n\n  /**\n   * Set the image load function of the source.\n   * @param {import(\"../Image.js\").LoadFunction} imageLoadFunction Image load function.\n   * @api\n   */\n  setImageLoadFunction(imageLoadFunction) {\n    this.imageLoadFunction_ = imageLoadFunction;\n    this.changed();\n  }\n\n  /**\n   * Set the URL to use for requests.\n   * @param {string|undefined} url URL.\n   * @api\n   */\n  setUrl(url) {\n    if (url != this.url_) {\n      this.url_ = url;\n      this.loader = null;\n      this.changed();\n    }\n  }\n\n  /**\n   * Set the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  setParams(params) {\n    this.params_ = Object.assign({}, params);\n    this.changed();\n  }\n\n  /**\n   * Update the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  updateParams(params) {\n    Object.assign(this.params_, params);\n    this.changed();\n  }\n\n  /**\n   * @override\n   */\n  changed() {\n    this.image = null;\n    super.changed();\n  }\n}\n\nexport default ImageWMS;\n", "/**\n * @module ol/source/TileWMS\n */\n\nimport {buffer, createEmpty} from '../extent.js';\nimport {modulo} from '../math.js';\nimport {get as getProjection, transform} from '../proj.js';\nimport {calculateSourceResolution} from '../reproj.js';\nimport {compareVersions} from '../string.js';\nimport {hash as tileCoordHash} from '../tilecoord.js';\nimport {appendParams} from '../uri.js';\nimport TileImage from './TileImage.js';\nimport {DEFAULT_VERSION, getImageSrc, getRequestParams} from './wms.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {Object<string,*>} params WMS request parameters.\n * At least a `LAYERS` param is required. `STYLES` is\n * `''` by default. `VERSION` is `1.3.0` by default. `WIDTH`, `HEIGHT`, `BBOX`\n * and `CRS` (`SRS` for WMS version < 1.3.0) will be set dynamically.\n * @property {number} [gutter=0]\n * The size in pixels of the gutter around image tiles to ignore. By setting\n * this property to a non-zero value, images will be requested that are wider\n * and taller than the tile size by a value of `2 x gutter`.\n * Using a non-zero value allows artifacts of rendering at tile edges to be\n * ignored. If you control the WMS service it is recommended to address\n * \"artifacts at tile edges\" issues by properly configuring the WMS service. For\n * example, MapServer has a `tile_map_edge_buffer` configuration parameter for\n * this. See https://mapserver.org/output/tile_mode.html.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {typeof import(\"../ImageTile.js\").default} [tileClass] Class used to instantiate image tiles.\n * Default is {@link module:ol/ImageTile~ImageTile}.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid. Base this on the resolutions,\n * tilesize and extent supported by the server.\n * If this is not defined, a default grid will be used: if there is a projection\n * extent, the grid will be based on that; if not, a grid based on a global\n * extent with origin at 0,0 will be used.\n * @property {import(\"./wms.js\").ServerType} [serverType] The type of\n * the remote WMS server: `mapserver`, `geoserver`, `carmentaserver`, or `qgis`.\n * Only needed if `hidpi` is `true`.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {string} [url] WMS service URL.\n * @property {Array<string>} [urls] WMS service urls.\n * Use this instead of `url` when the WMS supports multiple urls for GetMap requests.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * When set to `false`, only one world\n * will be rendered. When `true`, tiles will be requested for one world only,\n * but they will be wrapped horizontally to render multiple worlds.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for tile data from WMS servers.\n * @api\n */\nclass TileWMS extends TileImage {\n  /**\n   * @param {Options} [options] Tile WMS options.\n   */\n  constructor(options) {\n    options = options ? options : /** @type {Options} */ ({});\n\n    const params = Object.assign({}, options.params);\n\n    super({\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileClass: options.tileClass,\n      tileGrid: options.tileGrid,\n      tileLoadFunction: options.tileLoadFunction,\n      url: options.url,\n      urls: options.urls,\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      transition: options.transition,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.gutter_ = options.gutter !== undefined ? options.gutter : 0;\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.params_ = params;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.v13_ = true;\n\n    /**\n     * @private\n     * @type {import(\"./wms.js\").ServerType}\n     */\n    this.serverType_ = options.serverType;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.tmpExtent_ = createEmpty();\n\n    this.updateV13_();\n    this.setKey(this.getKeyForParams_());\n  }\n\n  /**\n   * Return the GetFeatureInfo URL for the passed coordinate, resolution, and\n   * projection. Return `undefined` if the GetFeatureInfo URL cannot be\n   * constructed.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../proj.js\").ProjectionLike} projection Projection.\n   * @param {!Object} params GetFeatureInfo params. `INFO_FORMAT` at least should\n   *     be provided. If `QUERY_LAYERS` is not provided then the layers specified\n   *     in the `LAYERS` parameter will be used. `VERSION` should not be\n   *     specified here.\n   * @return {string|undefined} GetFeatureInfo URL.\n   * @api\n   */\n  getFeatureInfoUrl(coordinate, resolution, projection, params) {\n    const projectionObj = getProjection(projection);\n    const sourceProjectionObj = this.getProjection() || projectionObj;\n\n    let tileGrid = this.getTileGrid();\n    if (!tileGrid) {\n      tileGrid = this.getTileGridForProjection(sourceProjectionObj);\n    }\n\n    const sourceProjCoord = transform(\n      coordinate,\n      projectionObj,\n      sourceProjectionObj,\n    );\n    const sourceResolution = calculateSourceResolution(\n      sourceProjectionObj,\n      projectionObj,\n      coordinate,\n      resolution,\n    );\n\n    const z = tileGrid.getZForResolution(sourceResolution, this.zDirection);\n    const tileResolution = tileGrid.getResolution(z);\n    const tileCoord = tileGrid.getTileCoordForCoordAndZ(sourceProjCoord, z);\n\n    if (tileGrid.getResolutions().length <= tileCoord[0]) {\n      return undefined;\n    }\n\n    let tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent_);\n\n    const gutter = this.gutter_;\n    if (gutter !== 0) {\n      tileExtent = buffer(tileExtent, tileResolution * gutter, tileExtent);\n    }\n\n    const baseParams = {\n      'QUERY_LAYERS': this.params_['LAYERS'],\n    };\n    Object.assign(\n      baseParams,\n      getRequestParams(this.params_, 'GetFeatureInfo'),\n      params,\n    );\n\n    const x = Math.floor((sourceProjCoord[0] - tileExtent[0]) / tileResolution);\n    const y = Math.floor((tileExtent[3] - sourceProjCoord[1]) / tileResolution);\n\n    baseParams[this.v13_ ? 'I' : 'X'] = x;\n    baseParams[this.v13_ ? 'J' : 'Y'] = y;\n\n    return this.getRequestUrl_(\n      tileCoord,\n      tileExtent,\n      1,\n      sourceProjectionObj || projectionObj,\n      baseParams,\n    );\n  }\n\n  /**\n   * Return the GetLegendGraphic URL, optionally optimized for the passed\n   * resolution and possibly including any passed specific parameters. Returns\n   * `undefined` if the GetLegendGraphic URL cannot be constructed.\n   *\n   * @param {number} [resolution] Resolution. If set to undefined, `SCALE`\n   *     will not be calculated and included in URL.\n   * @param {Object} [params] GetLegendGraphic params. If `LAYER` is set, the\n   *     request is generated for this wms layer, else it will try to use the\n   *     configured wms layer. Default `FORMAT` is `image/png`.\n   *     `VERSION` should not be specified here.\n   * @return {string|undefined} GetLegendGraphic URL.\n   * @api\n   */\n  getLegendUrl(resolution, params) {\n    if (this.urls[0] === undefined) {\n      return undefined;\n    }\n\n    const baseParams = {\n      'SERVICE': 'WMS',\n      'VERSION': DEFAULT_VERSION,\n      'REQUEST': 'GetLegendGraphic',\n      'FORMAT': 'image/png',\n    };\n\n    if (params === undefined || params['LAYER'] === undefined) {\n      const layers = this.params_.LAYERS;\n      const isSingleLayer = !Array.isArray(layers) || layers.length === 1;\n      if (!isSingleLayer) {\n        return undefined;\n      }\n      baseParams['LAYER'] = layers;\n    }\n\n    if (resolution !== undefined) {\n      const mpu = this.getProjection()\n        ? this.getProjection().getMetersPerUnit()\n        : 1;\n      const pixelSize = 0.00028;\n      baseParams['SCALE'] = (resolution * mpu) / pixelSize;\n    }\n\n    Object.assign(baseParams, params);\n\n    return appendParams(/** @type {string} */ (this.urls[0]), baseParams);\n  }\n\n  /**\n   * @return {number} Gutter.\n   * @override\n   */\n  getGutter() {\n    return this.gutter_;\n  }\n\n  /**\n   * Get the user-provided params, i.e. those passed to the constructor through\n   * the \"params\" option, and possibly updated using the updateParams method.\n   * @return {Object} Params.\n   * @api\n   */\n  getParams() {\n    return this.params_;\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"../extent.js\").Extent} tileExtent Tile extent.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @param {Object} params Params.\n   * @return {string|undefined} Request URL.\n   * @private\n   */\n  getRequestUrl_(tileCoord, tileExtent, pixelRatio, projection, params) {\n    const urls = this.urls;\n    if (!urls) {\n      return undefined;\n    }\n    let url;\n    if (urls.length == 1) {\n      url = urls[0];\n    } else {\n      const index = modulo(tileCoordHash(tileCoord), urls.length);\n      url = urls[index];\n    }\n\n    return getImageSrc(\n      tileExtent,\n      (\n        this.tileGrid || this.getTileGridForProjection(projection)\n      ).getResolution(tileCoord[0]),\n      pixelRatio,\n      projection,\n      url,\n      params,\n      this.serverType_,\n    );\n  }\n\n  /**\n   * Get the tile pixel ratio for this source.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Tile pixel ratio.\n   * @override\n   */\n  getTilePixelRatio(pixelRatio) {\n    return !this.hidpi_ || this.serverType_ === undefined ? 1 : pixelRatio;\n  }\n\n  /**\n   * @private\n   * @return {string} The key for the current params.\n   */\n  getKeyForParams_() {\n    let i = 0;\n    const res = [];\n    for (const key in this.params_) {\n      res[i++] = key + '-' + this.params_[key];\n    }\n    return res.join('/');\n  }\n\n  /**\n   * @param {Object} params New URL paremeters.\n   * @private\n   */\n  setParams_(params) {\n    this.params_ = params;\n    this.updateV13_();\n    this.setKey(this.getKeyForParams_());\n  }\n\n  /**\n   * Set the URL parameters passed to the WMS source.\n   * @param {Object} params New URL paremeters.\n   * @api\n   */\n  setParams(params) {\n    this.setParams_(Object.assign({}, params));\n  }\n\n  /**\n   * Update the URL parameters. This method can be used to update a subset of the WMS\n   * parameters. Call `setParams` to set all of the parameters.\n   * @param {Object} params Updated URL parameters.\n   * @api\n   */\n  updateParams(params) {\n    this.setParams_(Object.assign(this.params_, params));\n  }\n\n  /**\n   * @private\n   */\n  updateV13_() {\n    const version = this.params_['VERSION'] || DEFAULT_VERSION;\n    this.v13_ = compareVersions(version, '1.3') >= 0;\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord The tile coordinate\n   * @param {number} pixelRatio The pixel ratio\n   * @param {import(\"../proj/Projection.js\").default} projection The projection\n   * @return {string|undefined} The tile URL\n   * @override\n   */\n  tileUrlFunction(tileCoord, pixelRatio, projection) {\n    let tileGrid = this.getTileGrid();\n    if (!tileGrid) {\n      tileGrid = this.getTileGridForProjection(projection);\n    }\n\n    if (tileGrid.getResolutions().length <= tileCoord[0]) {\n      return undefined;\n    }\n\n    if (pixelRatio != 1 && (!this.hidpi_ || this.serverType_ === undefined)) {\n      pixelRatio = 1;\n    }\n\n    const tileResolution = tileGrid.getResolution(tileCoord[0]);\n    let tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent_);\n\n    const gutter = this.gutter_;\n    if (gutter !== 0) {\n      tileExtent = buffer(tileExtent, tileResolution * gutter, tileExtent);\n    }\n\n    const baseParams = Object.assign(\n      {},\n      getRequestParams(this.params_, 'GetMap'),\n    );\n\n    return this.getRequestUrl_(\n      tileCoord,\n      tileExtent,\n      pixelRatio,\n      projection,\n      baseParams,\n    );\n  }\n}\n\nexport default TileWMS;\n", "/**\n * @module ol/source/VectorTile\n */\n\nimport TileState from '../TileState.js';\nimport VectorRenderTile from '../VectorRenderTile.js';\nimport Tile from '../VectorTile.js';\nimport {assert} from '../asserts.js';\nimport EventType from '../events/EventType.js';\nimport {\n  buffer as bufferExtent,\n  getIntersection,\n  intersects,\n} from '../extent.js';\nimport {loadFeaturesXhr} from '../featureloader.js';\nimport {isEmpty} from '../obj.js';\nimport {equivalent} from '../proj.js';\nimport {toSize} from '../size.js';\nimport TileGrid from '../tilegrid/TileGrid.js';\nimport {DEFAULT_MAX_ZOOM} from '../tilegrid/common.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\nimport UrlTile from './UrlTile.js';\n\n/**\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../render/Feature.js\").default]\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Initial tile cache size. Will auto-grow to hold at least twice the number of tiles in the viewport.\n * @property {import(\"../extent.js\").Extent} [extent] Extent.\n * @property {import(\"../format/Feature.js\").default<FeatureType>} [format] Feature format for tiles. Used and required by the default.\n * @property {boolean} [overlaps=true] This source may have overlapping geometries. Setting this\n * to `false` (e.g. for sources with polygons that represent administrative\n * boundaries or TopoJSON sources) allows the renderer to optimise fill and\n * stroke operations.\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Projection of the tile grid.\n * @property {import(\"./Source.js\").State} [state] Source state.\n * @property {typeof import(\"../VectorTile.js\").default} [tileClass] Class used to instantiate tiles.\n * Default is {@link module:ol/VectorTile~VectorTile}.\n * @property {number} [maxZoom=22] Optional max zoom level. Not used if `tileGrid` is provided.\n * @property {number} [minZoom] Optional min zoom level. Not used if `tileGrid` is provided.\n * @property {number|import(\"../size.js\").Size} [tileSize=512] Optional tile size. Not used if `tileGrid` is provided.\n * @property {number} [maxResolution] Optional tile grid resolution at level zero. Not used if `tileGrid` is provided.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction]\n * Optional function to load a tile given a URL. Could look like this for pbf tiles:\n * ```js\n * function(tile, url) {\n *   tile.setLoader(function(extent, resolution, projection) {\n *     fetch(url).then(function(response) {\n *       response.arrayBuffer().then(function(data) {\n *         const format = tile.getFormat() // ol/format/MVT configured as source format\n *         const features = format.readFeatures(data, {\n *           extent: extent,\n *           featureProjection: projection\n *         });\n *         tile.setFeatures(features);\n *       });\n *     });\n *   });\n * }\n * ```\n * If you do not need extent, resolution and projection to get the features for a tile (e.g.\n * for GeoJSON tiles), your `tileLoadFunction` does not need a `setLoader()` call. Only make sure\n * to call `setFeatures()` on the tile:\n * ```js\n * const format = new GeoJSON({featureProjection: map.getView().getProjection()});\n * async function tileLoadFunction(tile, url) {\n *   const response = await fetch(url);\n *   const data = await response.json();\n *   tile.setFeatures(format.readFeatures(data));\n * }\n * ```\n * @property {import(\"../Tile.js\").UrlFunction} [tileUrlFunction] Optional function to get tile URL given a tile coordinate and the projection.\n * @property {string} [url] URL template. Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * A `{?-?}` template pattern, for example `subdomain{a-f}.domain.com`, may be\n * used instead of defining each one separately in the `urls` option.\n * @property {number} [transition] A duration for tile opacity\n * transitions in milliseconds. A duration of 0 disables the opacity transition.\n * @property {Array<string>} [urls] An array of URL templates.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * When set to `false`, only one world\n * will be rendered. When set to `true`, tiles will be wrapped horizontally to\n * render multiple worlds.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=1]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Class for layer sources providing vector data divided into a tile grid, to be\n * used with {@link module:ol/layer/VectorTile~VectorTileLayer}. Although this source receives tiles\n * with vector features from the server, it is not meant for feature editing.\n * Features are optimized for rendering, their geometries are clipped at or near\n * tile boundaries and simplified for a view resolution. See\n * {@link module:ol/source/Vector~VectorSource} for vector sources that are suitable for feature\n * editing.\n *\n * @fires import(\"./Tile.js\").TileSourceEvent\n * @api\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../render/Feature.js\").default]\n */\nclass VectorTile extends UrlTile {\n  /**\n   * @param {!Options<FeatureType>} options Vector tile options.\n   */\n  constructor(options) {\n    const projection = options.projection || 'EPSG:3857';\n\n    const extent = options.extent || extentFromProjection(projection);\n\n    const tileGrid =\n      options.tileGrid ||\n      createXYZ({\n        extent: extent,\n        maxResolution: options.maxResolution,\n        maxZoom: options.maxZoom !== undefined ? options.maxZoom : 22,\n        minZoom: options.minZoom,\n        tileSize: options.tileSize || 512,\n      });\n\n    super({\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      cacheSize: options.cacheSize,\n      interpolate: true,\n      projection: projection,\n      state: options.state,\n      tileGrid: tileGrid,\n      tileLoadFunction: options.tileLoadFunction\n        ? options.tileLoadFunction\n        : defaultLoadFunction,\n      tileUrlFunction: options.tileUrlFunction,\n      url: options.url,\n      urls: options.urls,\n      wrapX: options.wrapX === undefined ? true : options.wrapX,\n      transition: options.transition,\n      zDirection: options.zDirection === undefined ? 1 : options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {import(\"../format/Feature.js\").default<FeatureType>|null}\n     */\n    this.format_ = options.format ? options.format : null;\n\n    /**\n     * @type {Object<string, Array<string>>}\n     * @private\n     */\n    this.tileKeysBySourceTileUrl_ = {};\n\n    /**\n     @type {Object<string, Tile<FeatureType>>}\n     */\n    this.sourceTiles_ = {};\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.overlaps_ = options.overlaps == undefined ? true : options.overlaps;\n\n    /**\n     * @protected\n     * @type {typeof import(\"../VectorTile.js\").default}\n     */\n    this.tileClass = options.tileClass ? options.tileClass : Tile;\n\n    /**\n     * @private\n     * @type {Object<string, import(\"../tilegrid/TileGrid.js\").default>}\n     */\n    this.tileGrids_ = {};\n  }\n\n  /**\n   * @return {boolean} The source can have overlapping geometries.\n   */\n  getOverlaps() {\n    return this.overlaps_;\n  }\n\n  /**\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection\").default} projection Projection.\n   * @param {VectorRenderTile} tile Vector render tile.\n   * @return {Array<import(\"../VectorTile\").default>} Tile keys.\n   */\n  getSourceTiles(pixelRatio, projection, tile) {\n    if (tile.getState() === TileState.IDLE) {\n      tile.setState(TileState.LOADING);\n      const urlTileCoord = tile.wrappedTileCoord;\n      const tileGrid = this.getTileGridForProjection(projection);\n      const extent = tileGrid.getTileCoordExtent(urlTileCoord);\n      const z = urlTileCoord[0];\n      const resolution = tileGrid.getResolution(z);\n      // make extent 1 pixel smaller so we don't load tiles for < 0.5 pixel render space\n      bufferExtent(extent, -resolution, extent);\n      const sourceTileGrid = this.tileGrid;\n      const sourceExtent = sourceTileGrid.getExtent();\n      if (sourceExtent) {\n        getIntersection(extent, sourceExtent, extent);\n      }\n      const sourceZ = sourceTileGrid.getZForResolution(\n        resolution,\n        this.zDirection,\n      );\n\n      sourceTileGrid.forEachTileCoord(extent, sourceZ, (sourceTileCoord) => {\n        const tileUrl = this.tileUrlFunction(\n          sourceTileCoord,\n          pixelRatio,\n          projection,\n        );\n        if (!this.sourceTiles_[tileUrl]) {\n          this.sourceTiles_[tileUrl] = new this.tileClass(\n            sourceTileCoord,\n            tileUrl ? TileState.IDLE : TileState.EMPTY,\n            tileUrl,\n            this.format_,\n            this.tileLoadFunction,\n          );\n        }\n        const sourceTile = this.sourceTiles_[tileUrl];\n        tile.sourceTiles.push(sourceTile);\n        if (!this.tileKeysBySourceTileUrl_[tileUrl]) {\n          this.tileKeysBySourceTileUrl_[tileUrl] = [];\n        }\n        this.tileKeysBySourceTileUrl_[tileUrl].push(tile.getKey());\n        const sourceTileState = sourceTile.getState();\n        if (sourceTileState < TileState.LOADED) {\n          const listenChange = (event) => {\n            this.handleTileChange(event);\n            const state = sourceTile.getState();\n            if (state === TileState.LOADED || state === TileState.ERROR) {\n              const sourceTileKey = sourceTile.getKey();\n              if (sourceTileKey in tile.errorTileKeys) {\n                if (sourceTile.getState() === TileState.LOADED) {\n                  delete tile.errorTileKeys[sourceTileKey];\n                }\n              } else {\n                tile.loadingSourceTiles--;\n              }\n              if (state === TileState.ERROR) {\n                tile.errorTileKeys[sourceTileKey] = true;\n              } else {\n                sourceTile.removeEventListener(EventType.CHANGE, listenChange);\n              }\n              if (tile.loadingSourceTiles === 0) {\n                tile.setState(\n                  isEmpty(tile.errorTileKeys)\n                    ? TileState.LOADED\n                    : TileState.ERROR,\n                );\n              }\n            }\n          };\n          sourceTile.addEventListener(EventType.CHANGE, listenChange);\n          tile.loadingSourceTiles++;\n        }\n        if (sourceTileState === TileState.IDLE) {\n          sourceTile.extent =\n            sourceTileGrid.getTileCoordExtent(sourceTileCoord);\n          sourceTile.projection = projection;\n          sourceTile.resolution = sourceTileGrid.getResolution(\n            sourceTileCoord[0],\n          );\n          sourceTile.load();\n        }\n      });\n      if (!tile.loadingSourceTiles) {\n        tile.setState(\n          tile.sourceTiles.some(\n            (sourceTile) => sourceTile.getState() === TileState.ERROR,\n          )\n            ? TileState.ERROR\n            : TileState.LOADED,\n        );\n      }\n    }\n\n    return tile.sourceTiles;\n  }\n\n  /**\n   * @param {VectorRenderTile} tile Vector render tile.\n   */\n  removeSourceTiles(tile) {\n    const tileKey = tile.getKey();\n    const sourceTiles = tile.sourceTiles;\n    for (let i = 0, ii = sourceTiles.length; i < ii; ++i) {\n      const sourceTileUrl = sourceTiles[i].getTileUrl();\n      if (!this.tileKeysBySourceTileUrl_[sourceTileUrl]) {\n        return;\n      }\n      const index =\n        this.tileKeysBySourceTileUrl_[sourceTileUrl].indexOf(tileKey);\n      if (index === -1) {\n        continue;\n      }\n      this.tileKeysBySourceTileUrl_[sourceTileUrl].splice(index, 1);\n      if (this.tileKeysBySourceTileUrl_[sourceTileUrl].length === 0) {\n        delete this.tileKeysBySourceTileUrl_[sourceTileUrl];\n        delete this.sourceTiles_[sourceTileUrl];\n      }\n    }\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!VectorRenderTile} Tile.\n   * @override\n   */\n  getTile(z, x, y, pixelRatio, projection) {\n    const tileCoord = [z, x, y];\n    let urlTileCoord = this.getTileCoordForTileUrlFunction(\n      tileCoord,\n      projection,\n    );\n    const sourceExtent = this.getTileGrid().getExtent();\n    const tileGrid = this.getTileGridForProjection(projection);\n    if (urlTileCoord && sourceExtent) {\n      const tileExtent = tileGrid.getTileCoordExtent(urlTileCoord);\n      // make extent 1 pixel smaller so we don't load tiles for < 0.5 pixel render space\n      bufferExtent(tileExtent, -tileGrid.getResolution(z), tileExtent);\n      if (!intersects(sourceExtent, tileExtent)) {\n        urlTileCoord = null;\n      }\n    }\n    let empty = true;\n    if (urlTileCoord !== null) {\n      const sourceTileGrid = this.tileGrid;\n      const resolution = tileGrid.getResolution(z);\n      const sourceZ = sourceTileGrid.getZForResolution(resolution, 1);\n      // make extent 1 pixel smaller so we don't load tiles for < 0.5 pixel render space\n      const extent = tileGrid.getTileCoordExtent(urlTileCoord);\n      bufferExtent(extent, -resolution, extent);\n      sourceTileGrid.forEachTileCoord(extent, sourceZ, (sourceTileCoord) => {\n        empty =\n          empty &&\n          !this.tileUrlFunction(sourceTileCoord, pixelRatio, projection);\n      });\n    }\n    const newTile = new VectorRenderTile(\n      tileCoord,\n      empty ? TileState.EMPTY : TileState.IDLE,\n      urlTileCoord,\n      this.getSourceTiles.bind(this, pixelRatio, projection),\n      this.removeSourceTiles.bind(this),\n    );\n    newTile.key = this.getKey();\n    return newTile;\n  }\n\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!import(\"../tilegrid/TileGrid.js\").default} Tile grid.\n   * @override\n   */\n  getTileGridForProjection(projection) {\n    const code = projection.getCode();\n    let tileGrid = this.tileGrids_[code];\n    if (!tileGrid) {\n      const sourceProjection = this.getProjection();\n      assert(\n        sourceProjection === null || equivalent(sourceProjection, projection),\n        'A VectorTile source can only be rendered if it has a projection compatible with the view projection.',\n      );\n\n      // A tile grid that matches the tile size of the source tile grid is more\n      // likely to have 1:1 relationships between source tiles and rendered tiles.\n      const sourceTileGrid = this.tileGrid;\n      const resolutions = sourceTileGrid.getResolutions().slice();\n      const origins = resolutions.map(function (resolution, z) {\n        return sourceTileGrid.getOrigin(z);\n      });\n      const tileSizes = resolutions.map(function (resolution, z) {\n        return sourceTileGrid.getTileSize(z);\n      });\n      const length = DEFAULT_MAX_ZOOM + 1;\n      for (let z = resolutions.length; z < length; ++z) {\n        resolutions.push(resolutions[z - 1] / 2);\n        origins.push(origins[z - 1]);\n        tileSizes.push(tileSizes[z - 1]);\n      }\n      tileGrid = new TileGrid({\n        extent: sourceTileGrid.getExtent(),\n        origins: origins,\n        resolutions: resolutions,\n        tileSizes: tileSizes,\n      });\n      this.tileGrids_[code] = tileGrid;\n    }\n    return tileGrid;\n  }\n\n  /**\n   * Get the tile pixel ratio for this source.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Tile pixel ratio.\n   * @override\n   */\n  getTilePixelRatio(pixelRatio) {\n    return pixelRatio;\n  }\n\n  /**\n   * @param {number} z Z.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../size.js\").Size} Tile size.\n   * @override\n   */\n  getTilePixelSize(z, pixelRatio, projection) {\n    const tileGrid = this.getTileGridForProjection(projection);\n    const tileSize = toSize(tileGrid.getTileSize(z), this.tmpSize);\n    return [\n      Math.round(tileSize[0] * pixelRatio),\n      Math.round(tileSize[1] * pixelRatio),\n    ];\n  }\n\n  /**\n   * @param {boolean} overlaps The source has overlapping geometries.\n   */\n  setOverlaps(overlaps) {\n    this.overlaps_ = overlaps;\n    this.changed();\n  }\n}\n\nexport default VectorTile;\n\n/**\n * Sets the loader for a tile.\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../render/Feature.js\").default]\n * @param {import(\"../VectorTile.js\").default<FeatureType>} tile Vector tile.\n * @param {string} url URL.\n */\nexport function defaultLoadFunction(tile, url) {\n  tile.setLoader(\n    /**\n     * @param {import(\"../extent.js\").Extent} extent Extent.\n     * @param {number} resolution Resolution.\n     * @param {import(\"../proj/Projection.js\").default} projection Projection.\n     */\n    function (extent, resolution, projection) {\n      loadFeaturesXhr(\n        url,\n        tile.getFormat(),\n        extent,\n        resolution,\n        projection,\n        tile.onLoad.bind(tile),\n        tile.onError.bind(tile),\n      );\n    },\n  );\n}\n", "/**\n * @module ol/source/BingMaps\n */\n\nimport {applyTransform, intersects} from '../extent.js';\nimport {get as getProjection, getTransformFromProjections} from '../proj.js';\nimport {createOrUpdate} from '../tilecoord.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\nimport {createFromTileUrlFunctions} from '../tileurlfunction.js';\nimport TileImage from './TileImage.js';\n\n/**\n * @param {import('../tilecoord.js').TileCoord} tileCoord Tile coord.\n * @return {string} Quad key.\n */\nexport function quadKey(tileCoord) {\n  const z = tileCoord[0];\n  const digits = new Array(z);\n  let mask = 1 << (z - 1);\n  let i, charCode;\n  for (i = 0; i < z; ++i) {\n    // 48 is charCode for 0 - '0'.charCodeAt(0)\n    charCode = 48;\n    if (tileCoord[1] & mask) {\n      charCode += 1;\n    }\n    if (tileCoord[2] & mask) {\n      charCode += 2;\n    }\n    digits[i] = String.fromCharCode(charCode);\n    mask >>= 1;\n  }\n  return digits.join('');\n}\n\n/**\n * The attribution containing a link to the Microsoft Bing Maps Platform APIs\n * Terms Of Use.\n * @const\n * @type {string}\n */\nconst TOS_ATTRIBUTION =\n  '<a class=\"ol-attribution-bing-tos\" ' +\n  'href=\"https://www.microsoft.com/maps/product/terms.html\" target=\"_blank\">' +\n  'Terms of Use</a>';\n\n/**\n * @typedef {Object} Options\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {boolean} [hidpi=false] If `true` hidpi tiles will be requested.\n * @property {string} [culture='en-us'] Culture code.\n * @property {string} key Bing Maps API key. Get yours at https://www.bingmapsportal.com/.\n * @property {string} imagerySet Type of imagery.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {number} [maxZoom=21] Max zoom. Default is what's advertized by the BingMaps service.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n * @property {boolean} [placeholderTiles] Whether to show BingMaps placeholder tiles when zoomed past the maximum level provided in an area. When `false`, requests beyond\n * the maximum zoom level will return no tile. When `true`, the placeholder tile will be returned. When not set, the default behaviour of the imagery set takes place,\n * which is unique for each imagery set in BingMaps.\n */\n\n/**\n * @typedef {Object} BingMapsImageryMetadataResponse\n * @property {number} statusCode The response status code\n * @property {string} statusDescription The response status description\n * @property {string} authenticationResultCode The authentication result code\n * @property {Array<ResourceSet>} resourceSets The array of resource sets\n */\n\n/**\n * @typedef {Object} ResourceSet\n * @property {Array<Resource>} resources Resources.\n */\n\n/**\n * @typedef {Object} Resource\n * @property {number} imageHeight The image height\n * @property {number} imageWidth The image width\n * @property {number} zoomMin The minimum zoom level\n * @property {number} zoomMax The maximum zoom level\n * @property {string} imageUrl The image URL\n * @property {Array<string>} imageUrlSubdomains The image URL subdomains for rotation\n * @property {Array<ImageryProvider>} [imageryProviders] The array of ImageryProviders\n */\n\n/**\n * @typedef {Object} ImageryProvider\n * @property {Array<CoverageArea>} coverageAreas The coverage areas\n * @property {string} [attribution] The attribution\n */\n\n/**\n * @typedef {Object} CoverageArea\n * @property {number} zoomMin The minimum zoom\n * @property {number} zoomMax The maximum zoom\n * @property {Array<number>} bbox The coverage bounding box\n */\n\n/**\n * @classdesc\n * Layer source for Bing Maps tile data.\n * @api\n */\nclass BingMaps extends TileImage {\n  /**\n   * @param {Options} options Bing Maps options.\n   */\n  constructor(options) {\n    const hidpi = options.hidpi !== undefined ? options.hidpi : false;\n\n    super({\n      cacheSize: options.cacheSize,\n      crossOrigin: 'anonymous',\n      interpolate: options.interpolate,\n      projection: getProjection('EPSG:3857'),\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      state: 'loading',\n      tileLoadFunction: options.tileLoadFunction,\n      tilePixelRatio: hidpi ? 2 : 1,\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      transition: options.transition,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.hidpi_ = hidpi;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.culture_ = options.culture !== undefined ? options.culture : 'en-us';\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxZoom_ = options.maxZoom !== undefined ? options.maxZoom : -1;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.apiKey_ = options.key;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.imagerySet_ = options.imagerySet;\n\n    /**\n     * @private\n     * @type {boolean|undefined}\n     */\n    this.placeholderTiles_ = options.placeholderTiles;\n\n    const url =\n      'https://dev.virtualearth.net/REST/v1/Imagery/Metadata/' +\n      this.imagerySet_ +\n      '?uriScheme=https&include=ImageryProviders&key=' +\n      this.apiKey_ +\n      '&c=' +\n      this.culture_;\n\n    fetch(url)\n      .then((response) => response.json())\n      .then((json) => this.handleImageryMetadataResponse(json));\n  }\n\n  /**\n   * Get the api key used for this source.\n   *\n   * @return {string} The api key.\n   * @api\n   */\n  getApiKey() {\n    return this.apiKey_;\n  }\n\n  /**\n   * Get the imagery set associated with this source.\n   *\n   * @return {string} The imagery set.\n   * @api\n   */\n  getImagerySet() {\n    return this.imagerySet_;\n  }\n\n  /**\n   * @param {BingMapsImageryMetadataResponse} response Response.\n   */\n  handleImageryMetadataResponse(response) {\n    if (\n      response.statusCode != 200 ||\n      response.statusDescription != 'OK' ||\n      response.authenticationResultCode != 'ValidCredentials' ||\n      response.resourceSets.length != 1 ||\n      response.resourceSets[0].resources.length != 1\n    ) {\n      this.setState('error');\n      return;\n    }\n\n    const resource = response.resourceSets[0].resources[0];\n    const maxZoom = this.maxZoom_ == -1 ? resource.zoomMax : this.maxZoom_;\n\n    const sourceProjection = this.getProjection();\n    const extent = extentFromProjection(sourceProjection);\n    const scale = this.hidpi_ ? 2 : 1;\n    const tileSize =\n      resource.imageWidth == resource.imageHeight\n        ? resource.imageWidth / scale\n        : [resource.imageWidth / scale, resource.imageHeight / scale];\n\n    const tileGrid = createXYZ({\n      extent: extent,\n      minZoom: resource.zoomMin,\n      maxZoom: maxZoom,\n      tileSize: tileSize,\n    });\n    this.tileGrid = tileGrid;\n\n    const culture = this.culture_;\n    const hidpi = this.hidpi_;\n    const placeholderTiles = this.placeholderTiles_;\n    this.tileUrlFunction = createFromTileUrlFunctions(\n      resource.imageUrlSubdomains.map(function (subdomain) {\n        /** @type {import('../tilecoord.js').TileCoord} */\n        const quadKeyTileCoord = [0, 0, 0];\n        const imageUrl = resource.imageUrl\n          .replace('{subdomain}', subdomain)\n          .replace('{culture}', culture);\n        return (\n          /**\n           * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n           * @param {number} pixelRatio Pixel ratio.\n           * @param {import(\"../proj/Projection.js\").default} projection Projection.\n           * @return {string|undefined} Tile URL.\n           */\n          function (tileCoord, pixelRatio, projection) {\n            if (!tileCoord) {\n              return undefined;\n            }\n            createOrUpdate(\n              tileCoord[0],\n              tileCoord[1],\n              tileCoord[2],\n              quadKeyTileCoord,\n            );\n            const url = new URL(\n              imageUrl.replace('{quadkey}', quadKey(quadKeyTileCoord)),\n            );\n            const params = url.searchParams;\n            if (hidpi) {\n              params.set('dpi', 'd1');\n              params.set('device', 'mobile');\n            }\n            if (placeholderTiles === true) {\n              params.delete('n');\n            } else if (placeholderTiles === false) {\n              params.set('n', 'z');\n            }\n            return url.toString();\n          }\n        );\n      }),\n    );\n\n    if (resource.imageryProviders) {\n      const transform = getTransformFromProjections(\n        getProjection('EPSG:4326'),\n        this.getProjection(),\n      );\n\n      this.setAttributions((frameState) => {\n        const attributions = [];\n        const viewState = frameState.viewState;\n        const tileGrid = this.getTileGrid();\n        const z = tileGrid.getZForResolution(\n          viewState.resolution,\n          this.zDirection,\n        );\n        const tileCoord = tileGrid.getTileCoordForCoordAndZ(\n          viewState.center,\n          z,\n        );\n        const zoom = tileCoord[0];\n        resource.imageryProviders.map(function (imageryProvider) {\n          let intersecting = false;\n          const coverageAreas = imageryProvider.coverageAreas;\n          for (let i = 0, ii = coverageAreas.length; i < ii; ++i) {\n            const coverageArea = coverageAreas[i];\n            if (zoom >= coverageArea.zoomMin && zoom <= coverageArea.zoomMax) {\n              const bbox = coverageArea.bbox;\n              const epsg4326Extent = [bbox[1], bbox[0], bbox[3], bbox[2]];\n              const extent = applyTransform(epsg4326Extent, transform);\n              if (intersects(extent, frameState.extent)) {\n                intersecting = true;\n                break;\n              }\n            }\n          }\n          if (intersecting) {\n            attributions.push(imageryProvider.attribution);\n          }\n        });\n\n        attributions.push(TOS_ATTRIBUTION);\n        return attributions;\n      });\n    }\n\n    this.setState('ready');\n  }\n}\n\nexport default BingMaps;\n", "/**\n * @module ol/source/CartoDB\n */\n\nimport XYZ from './XYZ.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Projection.\n * @property {number} [maxZoom=18] Max zoom.\n * @property {number} [minZoom] Minimum zoom.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {Object} [config] If using anonymous maps, the CartoDB config to use. See\n * https://carto.com/developers/maps-api/guides/anonymous-maps/\n * for more detail.\n * If using named maps, a key-value lookup with the template parameters.\n * See https://carto.com/developers/maps-api/guides/named-maps/\n * for more detail.\n * @property {string} [map] If using named maps, this will be the name of the template to load.\n * See https://carto.com/developers/maps-api/guides/named-maps/\n * for more detail.\n * @property {string} [account] Username as used to access public Carto dashboard at https://{username}.carto.com/.\n * @property {number} [transition=250] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @typedef {Object} CartoDBLayerInfo\n * @property {string} layergroupid The layer group ID\n * @property {{https: string}} cdn_url The CDN URL\n */\n\n/**\n * @classdesc\n * Layer source for the CartoDB Maps API.\n * @api\n */\nclass CartoDB extends XYZ {\n  /**\n   * @param {Options} options CartoDB options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      maxZoom: options.maxZoom !== undefined ? options.maxZoom : 18,\n      minZoom: options.minZoom,\n      projection: options.projection,\n      transition: options.transition,\n      wrapX: options.wrapX,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.account_ = options.account;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.mapId_ = options.map || '';\n\n    /**\n     * @type {!Object}\n     * @private\n     */\n    this.config_ = options.config || {};\n\n    /**\n     * @type {!Object<string, CartoDBLayerInfo>}\n     * @private\n     */\n    this.templateCache_ = {};\n\n    this.initializeMap_();\n  }\n\n  /**\n   * Returns the current config.\n   * @return {!Object} The current configuration.\n   * @api\n   */\n  getConfig() {\n    return this.config_;\n  }\n\n  /**\n   * Updates the carto db config.\n   * @param {Object} config a key-value lookup. Values will replace current values\n   *     in the config.\n   * @api\n   */\n  updateConfig(config) {\n    Object.assign(this.config_, config);\n    this.initializeMap_();\n  }\n\n  /**\n   * Sets the CartoDB config\n   * @param {Object} config In the case of anonymous maps, a CartoDB configuration\n   *     object.\n   * If using named maps, a key-value lookup with the template parameters.\n   * @api\n   */\n  setConfig(config) {\n    this.config_ = config || {};\n    this.initializeMap_();\n  }\n\n  /**\n   * Issue a request to initialize the CartoDB map.\n   * @private\n   */\n  initializeMap_() {\n    const paramHash = JSON.stringify(this.config_);\n    if (this.templateCache_[paramHash]) {\n      this.applyTemplate_(this.templateCache_[paramHash]);\n      return;\n    }\n    let mapUrl = 'https://' + this.account_ + '.carto.com/api/v1/map';\n\n    if (this.mapId_) {\n      mapUrl += '/named/' + this.mapId_;\n    }\n\n    const client = new XMLHttpRequest();\n    client.addEventListener(\n      'load',\n      this.handleInitResponse_.bind(this, paramHash),\n    );\n    client.addEventListener('error', this.handleInitError_.bind(this));\n    client.open('POST', mapUrl);\n    client.setRequestHeader('Content-type', 'application/json');\n    client.send(JSON.stringify(this.config_));\n  }\n\n  /**\n   * Handle map initialization response.\n   * @param {string} paramHash a hash representing the parameter set that was used\n   *     for the request\n   * @param {Event} event Event.\n   * @private\n   */\n  handleInitResponse_(paramHash, event) {\n    const client = /** @type {XMLHttpRequest} */ (event.target);\n    // status will be 0 for file:// urls\n    if (!client.status || (client.status >= 200 && client.status < 300)) {\n      let response;\n      try {\n        response = /** @type {CartoDBLayerInfo} */ (\n          JSON.parse(client.responseText)\n        );\n      } catch {\n        this.setState('error');\n        return;\n      }\n      this.applyTemplate_(response);\n      this.templateCache_[paramHash] = response;\n      this.setState('ready');\n    } else {\n      this.setState('error');\n    }\n  }\n\n  /**\n   * @private\n   * @param {Event} event Event.\n   */\n  handleInitError_(event) {\n    this.setState('error');\n  }\n\n  /**\n   * Apply the new tile urls returned by carto db\n   * @param {CartoDBLayerInfo} data Result of carto db call.\n   * @private\n   */\n  applyTemplate_(data) {\n    const tilesUrl =\n      'https://' +\n      data.cdn_url.https +\n      '/' +\n      this.account_ +\n      '/api/v1/map/' +\n      data.layergroupid +\n      '/{z}/{x}/{y}.png';\n    this.setUrl(tilesUrl);\n  }\n}\n\nexport default CartoDB;\n", "/**\n * @module ol/source/Cluster\n */\n\nimport Feature from '../Feature.js';\nimport {assert} from '../asserts.js';\nimport {add as addCoordinate, scale as scaleCoordinate} from '../coordinate.js';\nimport EventType from '../events/EventType.js';\nimport {\n  buffer,\n  createEmpty,\n  createOrUpdateFromCoordinate,\n  getCenter,\n} from '../extent.js';\nimport Point from '../geom/Point.js';\nimport {getUid} from '../util.js';\nimport VectorSource from './Vector.js';\n\n/**\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../Feature.js\").FeatureLike]\n * @typedef {(feature: FeatureType) => (Point|null)} GeometryFunction\n */\n\n/**\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../Feature.js\").default]\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [distance=20] Distance in pixels within which features will\n * be clustered together.\n * @property {number} [minDistance=0] Minimum distance in pixels between clusters.\n * Will be capped at the configured distance.\n * By default no minimum distance is guaranteed. This config can be used to avoid\n * overlapping icons. As a tradoff, the cluster feature's position will no longer be\n * the center of all its features.\n * @property {GeometryFunction<FeatureType>} [geometryFunction]\n * Function that takes a {@link module:ol/Feature~Feature} as argument and returns a\n * {@link module:ol/geom/Point~Point} as cluster calculation point for the feature. When a\n * feature should not be considered for clustering, the function should return\n * `null`. The default, which works when the underlying source contains point\n * features only, is\n * ```js\n * function(feature) {\n *   return feature.getGeometry();\n * }\n * ```\n * See {@link module:ol/geom/Polygon~Polygon#getInteriorPoint} for a way to get a cluster\n * calculation point for polygons.\n * @property {function(Point, Array<FeatureType>):Feature} [createCluster]\n * Function that takes the cluster's center {@link module:ol/geom/Point~Point} and an array\n * of {@link module:ol/Feature~Feature} included in this cluster. Must return a\n * {@link module:ol/Feature~Feature} that will be used to render. Default implementation is:\n * ```js\n * function(point, features) {\n *   return new Feature({\n *     geometry: point,\n *     features: features\n *   });\n * }\n * ```\n * @property {VectorSource<FeatureType>} [source=null] Source.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n */\n\n/**\n * @classdesc\n * Layer source to cluster vector data. Works out of the box with point\n * geometries. For other geometry types, or if not all geometries should be\n * considered for clustering, a custom `geometryFunction` can be defined.\n *\n * If the instance is disposed without also disposing the underlying\n * source `setSource(null)` has to be called to remove the listener reference\n * from the wrapped source.\n * @api\n * @template {import('../Feature.js').FeatureLike} [FeatureType=import('../Feature.js').default]\n * @extends {VectorSource<Feature<import(\"../geom/Geometry.js\").default>>}\n */\nclass Cluster extends VectorSource {\n  /**\n   * @param {Options<FeatureType>} [options] Cluster options.\n   */\n  constructor(options) {\n    options = options || {};\n    super({\n      attributions: options.attributions,\n      wrapX: options.wrapX,\n    });\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.resolution = undefined;\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.distance = options.distance !== undefined ? options.distance : 20;\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.minDistance = options.minDistance || 0;\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.interpolationRatio = 0;\n\n    /**\n     * @type {Array<Feature>}\n     * @protected\n     */\n    this.features = [];\n\n    /**\n     * @type {GeometryFunction<import(\"../Feature.js\").FeatureLike>}\n     * @protected\n     */\n    this.geometryFunction =\n      options.geometryFunction ||\n      function (feature) {\n        const geometry = /** @type {Point} */ (feature.getGeometry());\n        assert(\n          !geometry || geometry.getType() === 'Point',\n          'The default `geometryFunction` can only handle `Point` or null geometries',\n        );\n        return geometry;\n      };\n\n    /**\n     * @type {function(Point, Array<FeatureType>):Feature}\n     * @private\n     */\n    this.createCustomCluster_ = options.createCluster;\n\n    /**\n     * @type {VectorSource<FeatureType>|null}\n     * @protected\n     */\n    this.source = null;\n\n    /**\n     * @private\n     */\n    this.boundRefresh_ = this.refresh.bind(this);\n\n    this.updateDistance(this.distance, this.minDistance);\n    this.setSource(options.source || null);\n  }\n\n  /**\n   * Remove all features from the source.\n   * @param {boolean} [fast] Skip dispatching of {@link module:ol/source/VectorEventType~VectorEventType#removefeature} events.\n   * @api\n   * @override\n   */\n  clear(fast) {\n    this.features.length = 0;\n    super.clear(fast);\n  }\n\n  /**\n   * Get the distance in pixels between clusters.\n   * @return {number} Distance.\n   * @api\n   */\n  getDistance() {\n    return this.distance;\n  }\n\n  /**\n   * Get a reference to the wrapped source.\n   * @return {VectorSource<FeatureType>|null} Source.\n   * @api\n   */\n  getSource() {\n    return this.source;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @override\n   */\n  loadFeatures(extent, resolution, projection) {\n    this.source?.loadFeatures(extent, resolution, projection);\n    if (resolution !== this.resolution) {\n      this.resolution = resolution;\n      this.refresh();\n    }\n  }\n\n  /**\n   * Set the distance within which features will be clusterd together.\n   * @param {number} distance The distance in pixels.\n   * @api\n   */\n  setDistance(distance) {\n    this.updateDistance(distance, this.minDistance);\n  }\n\n  /**\n   * Set the minimum distance between clusters. Will be capped at the\n   * configured distance.\n   * @param {number} minDistance The minimum distance in pixels.\n   * @api\n   */\n  setMinDistance(minDistance) {\n    this.updateDistance(this.distance, minDistance);\n  }\n\n  /**\n   * The configured minimum distance between clusters.\n   * @return {number} The minimum distance in pixels.\n   * @api\n   */\n  getMinDistance() {\n    return this.minDistance;\n  }\n\n  /**\n   * Replace the wrapped source.\n   * @param {VectorSource<FeatureType>|null} source The new source for this instance.\n   * @api\n   */\n  setSource(source) {\n    if (this.source) {\n      this.source.removeEventListener(EventType.CHANGE, this.boundRefresh_);\n    }\n    this.source = source;\n    if (source) {\n      source.addEventListener(EventType.CHANGE, this.boundRefresh_);\n    }\n    this.refresh();\n  }\n\n  /**\n   * Handle the source changing.\n   * @override\n   */\n  refresh() {\n    this.clear();\n    this.cluster();\n    this.addFeatures(this.features);\n  }\n\n  /**\n   * Update the distances and refresh the source if necessary.\n   * @param {number} distance The new distance.\n   * @param {number} minDistance The new minimum distance.\n   */\n  updateDistance(distance, minDistance) {\n    const ratio =\n      distance === 0 ? 0 : Math.min(minDistance, distance) / distance;\n    const changed =\n      distance !== this.distance || this.interpolationRatio !== ratio;\n    this.distance = distance;\n    this.minDistance = minDistance;\n    this.interpolationRatio = ratio;\n    if (changed) {\n      this.refresh();\n    }\n  }\n\n  /**\n   * @protected\n   */\n  cluster() {\n    if (this.resolution === undefined || !this.source) {\n      return;\n    }\n    const extent = createEmpty();\n    const mapDistance = this.distance * this.resolution;\n    const features = this.source.getFeatures();\n\n    /** @type {Object<string, true>} */\n    const clustered = {};\n\n    for (let i = 0, ii = features.length; i < ii; i++) {\n      const feature = features[i];\n      if (!(getUid(feature) in clustered)) {\n        const geometry = this.geometryFunction(feature);\n        if (geometry) {\n          const coordinates = geometry.getCoordinates();\n          createOrUpdateFromCoordinate(coordinates, extent);\n          buffer(extent, mapDistance, extent);\n\n          const neighbors = this.source\n            .getFeaturesInExtent(extent)\n            .filter(function (neighbor) {\n              const uid = getUid(neighbor);\n              if (uid in clustered) {\n                return false;\n              }\n              clustered[uid] = true;\n              return true;\n            });\n          this.features.push(this.createCluster(neighbors, extent));\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {Array<FeatureType>} features Features\n   * @param {import(\"../extent.js\").Extent} extent The searched extent for these features.\n   * @return {Feature} The cluster feature.\n   * @protected\n   */\n  createCluster(features, extent) {\n    const centroid = [0, 0];\n    for (let i = features.length - 1; i >= 0; --i) {\n      const geometry = this.geometryFunction(features[i]);\n      if (geometry) {\n        addCoordinate(centroid, geometry.getCoordinates());\n      } else {\n        features.splice(i, 1);\n      }\n    }\n    scaleCoordinate(centroid, 1 / features.length);\n    const searchCenter = getCenter(extent);\n    const ratio = this.interpolationRatio;\n    const geometry = new Point([\n      centroid[0] * (1 - ratio) + searchCenter[0] * ratio,\n      centroid[1] * (1 - ratio) + searchCenter[1] * ratio,\n    ]);\n    if (this.createCustomCluster_) {\n      return this.createCustomCluster_(geometry, features);\n    }\n    return new Feature({\n      geometry,\n      features,\n    });\n  }\n}\n\nexport default Cluster;\n", "/**\n * @module ol/vec/mat4\n */\n\n/** @typedef {Array<number>} Mat4 */\n\n/**\n * @return {Mat4} \"4x4 matrix representing a 3D identity transform.\"\n */\nexport function create() {\n  return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n}\n\n/**\n * @param {Mat4} mat4 Flattened 4x4 matrix receiving the result.\n * @param {import(\"../transform.js\").Transform} transform Transformation matrix.\n * @return {Mat4} \"2D transformation matrix as flattened 4x4 matrix.\"\n */\nexport function fromTransform(mat4, transform) {\n  mat4[0] = transform[0];\n  mat4[1] = transform[1];\n  mat4[4] = transform[2];\n  mat4[5] = transform[3];\n  mat4[12] = transform[4];\n  mat4[13] = transform[5];\n  return mat4;\n}\n\n/**\n * Generates a orthogonal projection matrix with the given bounds\n *\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @param {Mat4} [out] mat4 frustum matrix will be written into\n * @return {Mat4} out\n */\nexport function orthographic(left, right, bottom, top, near, far, out) {\n  out = out ?? create();\n  const lr = 1 / (left - right),\n    bt = 1 / (bottom - top),\n    nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Scales the mat4 by the dimensions in the given vec3\n *\n * @param {Mat4} m The matrix to scale.\n * @param {number} x How much to scale in the x direction.\n * @param {number} y How much to scale in the y direction.\n * @param {number} z How much to scale in the z direction.\n * @param {Mat4} [out] The matrix to write to.\n * @return {Mat4} out\n */\nexport function scale(m, x, y, z, out) {\n  out = out ?? create();\n  out[0] = m[0] * x;\n  out[1] = m[1] * x;\n  out[2] = m[2] * x;\n  out[3] = m[3] * x;\n  out[4] = m[4] * y;\n  out[5] = m[5] * y;\n  out[6] = m[6] * y;\n  out[7] = m[7] * y;\n  out[8] = m[8] * z;\n  out[9] = m[9] * z;\n  out[10] = m[10] * z;\n  out[11] = m[11] * z;\n  out[12] = m[12];\n  out[13] = m[13];\n  out[14] = m[14];\n  out[15] = m[15];\n  return out;\n}\n\n/**\n * Translate a matrix.\n *\n * @param {Mat4} m the matrix to translate\n * @param {number} x How much to translate in the x direction.\n * @param {number} y How much to translate in the y direction.\n * @param {number} z How much to translate in the z direction.\n * @param {Mat4} [out] the receiving matrix\n * @return {Mat4} out\n */\nexport function translate(m, x, y, z, out) {\n  out = out ?? create();\n  let a00, a01, a02, a03, a10, a11, a12, a13, a20, a21, a22, a23;\n\n  if (m === out) {\n    out[12] = m[0] * x + m[4] * y + m[8] * z + m[12];\n    out[13] = m[1] * x + m[5] * y + m[9] * z + m[13];\n    out[14] = m[2] * x + m[6] * y + m[10] * z + m[14];\n    out[15] = m[3] * x + m[7] * y + m[11] * z + m[15];\n  } else {\n    a00 = m[0];\n    a01 = m[1];\n    a02 = m[2];\n    a03 = m[3];\n    a10 = m[4];\n    a11 = m[5];\n    a12 = m[6];\n    a13 = m[7];\n    a20 = m[8];\n    a21 = m[9];\n    a22 = m[10];\n    a23 = m[11];\n\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n\n    out[12] = a00 * x + a10 * y + a20 * z + m[12];\n    out[13] = a01 * x + a11 * y + a21 * z + m[13];\n    out[14] = a02 * x + a12 * y + a22 * z + m[14];\n    out[15] = a03 * x + a13 * y + a23 * z + m[15];\n  }\n\n  return out;\n}\n\n/**\n * @param {number} x x translation.\n * @param {number} y y translation.\n * @param {number} z z translation.\n * @param {Mat4} [out] optional matrix to store result\n * @return {Mat4} out\n */\nexport function translation(x, y, z, out) {\n  out = out ?? create();\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = x;\n  out[13] = y;\n  out[14] = z;\n  out[15] = 1;\n\n  return out;\n}\n", "import * as mat4 from '../vec/mat4.js';\n\n/**\n * @module ol/webgl/Canvas\n */\n\nconst VERTEX_SHADER = `\n  attribute vec4 a_position;\n  attribute vec4 a_texcoord;\n\n  uniform mat4 u_matrix;\n  uniform mat4 u_textureMatrix;\n\n  varying vec2 v_texcoord;\n\n  void main() {\n    gl_Position = u_matrix * a_position;\n    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;\n    v_texcoord = texcoord;\n  }\n`;\n\nconst FRAGMENT_SHADER = `\n  precision mediump float;\n\n  varying vec2 v_texcoord;\n\n  uniform sampler2D u_texture;\n\n  void main() {\n    if (\n      v_texcoord.x < 0.0 ||\n      v_texcoord.y < 0.0 ||\n      v_texcoord.x > 1.0 ||\n      v_texcoord.y > 1.0\n    ) {\n      discard;\n    }\n    gl_FragColor = texture2D(u_texture, v_texcoord);\n  }\n`;\n\n/** @typedef {import(\"../transform.js\").Transform} Matrix */\n\n/**\n * Canvas-like operations implemented in webgl.\n */\nexport class Canvas {\n  /**\n   * @param {WebGLRenderingContext} gl Context to render in.\n   */\n  constructor(gl) {\n    /**\n     * @private\n     * @type {WebGLRenderingContext}\n     */\n    this.gl_ = gl;\n\n    /**\n     * @private\n     * @type {WebGLProgram}\n     */\n    this.program_ = createProgram(gl, FRAGMENT_SHADER, VERTEX_SHADER);\n\n    this.positionLocation = gl.getAttribLocation(this.program_, 'a_position');\n    this.texcoordLocation = gl.getAttribLocation(this.program_, 'a_texcoord');\n\n    this.matrixLocation = gl.getUniformLocation(this.program_, 'u_matrix');\n    this.textureMatrixLocation = gl.getUniformLocation(\n      this.program_,\n      'u_textureMatrix',\n    );\n    this.textureLocation = gl.getUniformLocation(this.program_, 'u_texture');\n\n    this.positionBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n\n    this.positions = [0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1];\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array(this.positions),\n      gl.STATIC_DRAW,\n    );\n\n    this.texcoordBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.texcoordBuffer);\n\n    this.texcoords = [0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1];\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array(this.texcoords),\n      gl.STATIC_DRAW,\n    );\n  }\n\n  /**\n   * 2dContext drawImage call implemented in webgl.\n   * Unlike images, textures do not have a width and height associated\n   * with them so we'll pass in the width and height of the texture.\n   *\n   * @param {WebGLTexture} tex Image to draw.\n   * @param {number} texWidth Image width.\n   * @param {number} texHeight Image height.\n   * @param {number} srcX Top-left x-point to read src image.\n   * @param {number} srcY Top-left y-point to read src image.\n   * @param {number} [srcWidth] Width of source to read.\n   * @param {number} [srcHeight] Height of source to read.\n   * @param {number} [dstX] Top-left x-point of destination.\n   * @param {number} [dstY] Top-left y-point of destination.\n   * @param {number} [dstWidth] Width of written image in destination.\n   * @param {number} [dstHeight] Height of written image in destination.\n   * @param {number} [width] Width of canvas.\n   * @param {number} [height] Height of canvas.\n   */\n  drawImage(\n    tex,\n    texWidth,\n    texHeight,\n    srcX,\n    srcY,\n    srcWidth,\n    srcHeight,\n    dstX,\n    dstY,\n    dstWidth,\n    dstHeight,\n    width,\n    height,\n  ) {\n    const gl = this.gl_;\n\n    if (dstX === undefined) {\n      dstX = srcX;\n    }\n    if (dstY === undefined) {\n      dstY = srcY;\n    }\n    if (srcWidth === undefined) {\n      srcWidth = texWidth;\n    }\n    if (srcHeight === undefined) {\n      srcHeight = texHeight;\n    }\n    if (dstWidth === undefined) {\n      dstWidth = srcWidth;\n    }\n    if (dstHeight === undefined) {\n      dstHeight = srcHeight;\n    }\n    if (width === undefined) {\n      width = gl.canvas.width;\n    }\n    if (height === undefined) {\n      height = gl.canvas.height;\n    }\n\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n\n    gl.useProgram(this.program_);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.enableVertexAttribArray(this.positionLocation);\n    gl.vertexAttribPointer(this.positionLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.texcoordBuffer);\n    gl.enableVertexAttribArray(this.texcoordLocation);\n    gl.vertexAttribPointer(this.texcoordLocation, 2, gl.FLOAT, false, 0, 0);\n\n    // matrix for converting pixels to clip space\n    let matrix = mat4.orthographic(0, width, 0, height, -1, 1);\n    matrix = mat4.translate(matrix, dstX, dstY, 0);\n    matrix = mat4.scale(matrix, dstWidth, dstHeight, 1);\n    gl.uniformMatrix4fv(this.matrixLocation, false, matrix);\n\n    let texMatrix = mat4.translation(srcX / texWidth, srcY / texHeight, 0);\n    texMatrix = mat4.scale(\n      texMatrix,\n      srcWidth / texWidth,\n      srcHeight / texHeight,\n      1,\n    );\n\n    gl.uniformMatrix4fv(this.textureMatrixLocation, false, texMatrix);\n    gl.uniform1i(this.textureLocation, 0);\n    gl.drawArrays(gl.TRIANGLES, 0, this.positions.length / 2);\n  }\n}\n\n/**\n * @param {WebGLRenderingContext} gl Rendering Context.\n * @param {GLenum} type Type of shader.\n * @param {string} source source of shader.\n * @return {WebGLShader} [progam] The program.\n */\nfunction createShader(gl, type, source) {\n  const shader = gl.createShader(type);\n\n  if (shader === null) {\n    throw new Error('Shader compilation failed');\n  }\n\n  gl.shaderSource(shader, source);\n\n  gl.compileShader(shader);\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    const log = gl.getShaderInfoLog(shader);\n    if (log === null) {\n      throw new Error('Shader info log creation failed');\n    }\n    throw new Error(log);\n  }\n\n  return shader;\n}\n\n/**\n * @param {WebGLRenderingContext} gl Rendering Context.\n * @param {string} fragmentSource Fragment shader source.\n * @param {string} vertexSource Vertex shader source.\n * @return {WebGLProgram} [progam] The program.\n */\nexport function createProgram(gl, fragmentSource, vertexSource) {\n  const program = gl.createProgram();\n\n  const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexSource);\n  const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\n  if (program === null) {\n    throw new Error('Program creation failed');\n  }\n\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  gl.linkProgram(program);\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    const log = gl.getProgramInfoLog(program);\n    if (log === null) {\n      throw new Error('Program info log creation failed');\n    }\n    throw new Error();\n  }\n  return program;\n}\n", "/**\n * @module ol/reproj/glreproj\n */\nimport {\n  createEmpty,\n  extend,\n  getHeight,\n  getTopLeft,\n  getWidth,\n} from '../extent.js';\nimport {WORKER_OFFSCREEN_CANVAS} from '../has.js';\nimport * as mat4 from '../vec/mat4.js';\nimport {Canvas as WebGLCanvas, createProgram} from '../webgl/Canvas.js';\n\nconst EDGE_VERTEX_SHADER = `\n  attribute vec4 a_position;\n\n  uniform mat4 u_matrix;\n\n  void main() {\n     gl_Position = u_matrix * a_position;\n  }\n`;\nconst EDGE_FRAGMENT_SHADER = `\n  precision mediump float;\n\n  uniform vec4 u_val;\n  void main() {\n     gl_FragColor = u_val;\n  }\n`;\n\nconst TRIANGLE_VERTEX_SHADER = `\n  attribute vec4 a_position;\n  attribute vec2 a_texcoord;\n\n  varying vec2 v_texcoord;\n\n  uniform mat4 u_matrix;\n\n  void main() {\n     gl_Position = u_matrix * a_position;\n     v_texcoord = a_texcoord;\n  }\n`;\nconst TRIANGLE_FRAGMENT_SHADER = `\n  precision mediump float;\n\n  varying vec2 v_texcoord;\n\n  uniform sampler2D u_texture;\n\n  void main() {\n    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {\n      discard;\n    }\n    gl_FragColor = texture2D(u_texture, v_texcoord);\n  }\n`;\n\n/**\n * Create an html canvas element and returns its webgl context.\n * @param {number} [width] Canvas width.\n * @param {number} [height] Canvas height.\n * @param {Array<HTMLCanvasElement | OffscreenCanvas>} [canvasPool] Canvas pool to take existing canvas from.\n * @param {WebGLContextAttributes} [settings] CanvasRenderingContext2DSettings\n * @return {WebGLRenderingContext} The context.\n */\nexport function createCanvasContextWebGL(width, height, canvasPool, settings) {\n  /** @type {HTMLCanvasElement|OffscreenCanvas} */\n  let canvas;\n  if (canvasPool && canvasPool.length) {\n    canvas = /** @type {HTMLCanvasElement} */ (canvasPool.shift());\n  } else if (WORKER_OFFSCREEN_CANVAS) {\n    canvas = new OffscreenCanvas(width || 300, height || 300);\n  } else {\n    canvas = document.createElement('canvas');\n  }\n  if (width) {\n    canvas.width = width;\n  }\n  if (height) {\n    canvas.height = height;\n  }\n  //FIXME Allow OffscreenCanvasRenderingContext2D as return type\n  return /** @type {WebGLRenderingContext} */ (\n    canvas.getContext('webgl', settings)\n  );\n}\n\n/**\n * Releases canvas memory to avoid exceeding memory limits in Safari.\n * See https://pqina.nl/blog/total-canvas-memory-use-exceeds-the-maximum-limit/\n * @param {WebGLRenderingContext} gl Context.\n */\nexport function releaseGLCanvas(gl) {\n  const canvas = gl.canvas;\n  canvas.width = 1;\n  canvas.height = 1;\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\n}\n\n/**\n * @type {Array<HTMLCanvasElement | OffscreenCanvas>}\n */\nexport const canvasGLPool = [];\n\n/**\n * @typedef {Object} ImageExtent\n * @property {import(\"../extent.js\").Extent} extent Extent.\n * @property {import(\"../extent.js\").Extent} [clipExtent] Clip extent.\n * @property {WebGLTexture} texture Texture.\n * @property {number} width Width of texture.\n * @property {number} height Height of texture.\n */\n\n/**\n * Renders the source data into new canvas based on the triangulation.\n *\n * @param {WebGLRenderingContext} gl the context to render in.\n * @param {number} width_ Width of the canvas.\n * @param {number} height_ Height of the canvas.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} sourceResolution Source resolution.\n * @param {number} targetResolution Target resolution.\n * @param {import(\"../extent.js\").Extent} targetExtent Target extent (tile).\n * @param {import(\"../reproj/Triangulation.js\").default} triangulation Calculated triangulation.\n * @param {Array<ImageExtent>} sources Array of sources.\n * @param {number} gutter Gutter of the sources.\n * @param {number} dataType What kind of data is the textures, must be gl.FLOAT or gl.UNSIGNED_BYTE\n * TODO: Allow setting renderEdges value in the data as this is done in \"data-space\".\n * @param {boolean | Array<number>} [renderEdges] Render reprojection edges.\n * @param {boolean} [interpolate] Use linear interpolation when resampling.\n * @param {boolean} [drawSingle] Draw single source images directly without stitchTexture.\n * @return {{framebuffer: WebGLFramebuffer, width: number, height: number, texture: WebGLTexture}} Canvas with reprojected data.\n */\nexport function render(\n  gl,\n  width_,\n  height_,\n  pixelRatio,\n  sourceResolution,\n  targetResolution,\n  targetExtent,\n  triangulation,\n  sources,\n  gutter,\n  dataType,\n  renderEdges,\n  interpolate,\n  drawSingle,\n) {\n  const width = Math.round(pixelRatio * width_);\n  const height = Math.round(pixelRatio * height_);\n  gl.canvas.width = width;\n  gl.canvas.height = height;\n\n  /** @type {WebGLFramebuffer | null} */\n  let resultFrameBuffer;\n  /** @type {WebGLTexture | null} */\n  let resultTexture;\n  {\n    resultTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, resultTexture);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    if (interpolate) {\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    } else {\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    }\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      width,\n      height,\n      0,\n      gl.RGBA,\n      dataType,\n      null,\n    );\n\n    resultFrameBuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, resultFrameBuffer);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      resultTexture,\n      0,\n    );\n  }\n\n  if (resultFrameBuffer === null) {\n    throw new Error('Could not create framebuffer');\n  }\n  if (resultTexture === null) {\n    throw new Error('Could not create texture');\n  }\n\n  if (sources.length === 0) {\n    return {\n      width,\n      height,\n      framebuffer: resultFrameBuffer,\n      texture: resultTexture,\n    };\n  }\n\n  const sourceDataExtent = createEmpty();\n  sources.forEach(function (src, i, arr) {\n    extend(sourceDataExtent, src.extent);\n  });\n\n  /** @type {WebGLTexture | null} */\n  let stitchTexture;\n  /** @type {number} */\n  let stitchWidth;\n  /** @type {number} */\n  let stitchHeight;\n  const stitchScale = 1 / sourceResolution;\n\n  if (!drawSingle || sources.length !== 1 || gutter !== 0) {\n    stitchTexture = gl.createTexture();\n    if (resultTexture === null) {\n      throw new Error('Could not create texture');\n    }\n    stitchWidth = Math.round(getWidth(sourceDataExtent) * stitchScale);\n    stitchHeight = Math.round(getHeight(sourceDataExtent) * stitchScale);\n\n    // Make sure we do not exceed the max texture size by lowering the resolution for this image.\n    // https://github.com/openlayers/openlayers/pull/15860#issuecomment-2254123580\n    const maxTexSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n    const largeSide = Math.max(stitchWidth, stitchHeight);\n    const scaleFactor = largeSide > maxTexSize ? maxTexSize / largeSide : 1;\n    const stitchWidthFixed = Math.round(stitchWidth * scaleFactor);\n    const stitchHeightFixed = Math.round(stitchHeight * scaleFactor);\n\n    gl.bindTexture(gl.TEXTURE_2D, stitchTexture);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    if (interpolate) {\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    } else {\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    }\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      stitchWidthFixed,\n      stitchHeightFixed,\n      0,\n      gl.RGBA,\n      dataType,\n      null,\n    );\n\n    const fb = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      stitchTexture,\n      0,\n    );\n    const webGLCanvas = new WebGLCanvas(gl);\n\n    sources.forEach(function (src, i, arr) {\n      const xPos =\n        (src.extent[0] - sourceDataExtent[0]) * stitchScale * scaleFactor;\n      const yPos =\n        -(src.extent[3] - sourceDataExtent[3]) * stitchScale * scaleFactor;\n      const srcWidth = getWidth(src.extent) * stitchScale * scaleFactor;\n      const srcHeight = getHeight(src.extent) * stitchScale * scaleFactor;\n      gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n      gl.viewport(0, 0, stitchWidthFixed, stitchHeightFixed);\n\n      if (src.clipExtent) {\n        const xPos =\n          (src.clipExtent[0] - sourceDataExtent[0]) * stitchScale * scaleFactor;\n        const yPos =\n          -(src.clipExtent[3] - sourceDataExtent[3]) *\n          stitchScale *\n          scaleFactor;\n        const width = getWidth(src.clipExtent) * stitchScale * scaleFactor;\n        const height = getHeight(src.clipExtent) * stitchScale * scaleFactor;\n        gl.enable(gl.SCISSOR_TEST);\n        gl.scissor(\n          interpolate ? xPos : Math.round(xPos),\n          interpolate ? yPos : Math.round(yPos),\n          interpolate ? width : Math.round(xPos + width) - Math.round(xPos),\n          interpolate ? height : Math.round(yPos + height) - Math.round(yPos),\n        );\n      }\n\n      webGLCanvas.drawImage(\n        src.texture,\n        src.width,\n        src.height,\n        gutter,\n        gutter,\n        src.width - 2 * gutter,\n        src.height - 2 * gutter,\n        interpolate ? xPos : Math.round(xPos),\n        interpolate ? yPos : Math.round(yPos),\n        interpolate ? srcWidth : Math.round(xPos + srcWidth) - Math.round(xPos),\n        interpolate\n          ? srcHeight\n          : Math.round(yPos + srcHeight) - Math.round(yPos),\n        stitchWidthFixed,\n        stitchHeightFixed,\n      );\n\n      gl.disable(gl.SCISSOR_TEST);\n    });\n    gl.deleteFramebuffer(fb);\n  } else {\n    stitchTexture = sources[0].texture;\n    stitchWidth = sources[0].width;\n    stitchHeight = sources[0].width;\n  }\n\n  const targetTopLeft = getTopLeft(targetExtent);\n  const sourceTopLeft = getTopLeft(sourceDataExtent);\n\n  const getUVs = (\n    /** @type {Array<import(\"../coordinate.js\").Coordinate>} */ target,\n  ) => {\n    const u0 =\n      ((target[0][0] - targetTopLeft[0]) / targetResolution) * pixelRatio;\n    const v0 =\n      (-(target[0][1] - targetTopLeft[1]) / targetResolution) * pixelRatio;\n    const u1 =\n      ((target[1][0] - targetTopLeft[0]) / targetResolution) * pixelRatio;\n    const v1 =\n      (-(target[1][1] - targetTopLeft[1]) / targetResolution) * pixelRatio;\n    const u2 =\n      ((target[2][0] - targetTopLeft[0]) / targetResolution) * pixelRatio;\n    const v2 =\n      (-(target[2][1] - targetTopLeft[1]) / targetResolution) * pixelRatio;\n    return {u1, v1, u0, v0, u2, v2};\n  };\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, resultFrameBuffer);\n  gl.viewport(0, 0, width, height);\n\n  // Draw source to reprojtile\n  {\n    /** @type {Array<number>} */\n    const vertices = [];\n    /** @type {Array<number>} */\n    const texcoords = [];\n\n    const triProgram = createProgram(\n      gl,\n      TRIANGLE_FRAGMENT_SHADER,\n      TRIANGLE_VERTEX_SHADER,\n    );\n    gl.useProgram(triProgram);\n\n    // Bind image\n    const textureLocation = gl.getUniformLocation(triProgram, 'u_texture');\n    gl.bindTexture(gl.TEXTURE_2D, stitchTexture);\n\n    // Tell the shader to get the texture from texture unit 0\n    gl.uniform1i(textureLocation, 0);\n\n    // Calculate vert and tex coordinates.\n    triangulation.getTriangles().forEach(function (triangle, i, arr) {\n      const source = triangle.source;\n      const target = triangle.target;\n      // Make sure that everything is on pixel boundaries\n      const {u1, v1, u0, v0, u2, v2} = getUVs(target);\n\n      const su0 =\n        (source[0][0] - sourceTopLeft[0]) / sourceResolution / stitchWidth;\n      const sv0 =\n        -(source[0][1] - sourceTopLeft[1]) / sourceResolution / stitchHeight;\n      const su1 =\n        (source[1][0] - sourceTopLeft[0]) / sourceResolution / stitchWidth;\n      const sv1 =\n        -(source[1][1] - sourceTopLeft[1]) / sourceResolution / stitchHeight;\n      const su2 =\n        (source[2][0] - sourceTopLeft[0]) / sourceResolution / stitchWidth;\n      const sv2 =\n        -(source[2][1] - sourceTopLeft[1]) / sourceResolution / stitchHeight;\n\n      vertices.push(u1, v1, u0, v0, u2, v2);\n      texcoords.push(su1, sv1, su0, sv0, su2, sv2);\n    });\n\n    // Convert pixel space to clip space.\n    const matrix = mat4.orthographic(0, width, height, 0, -1, 1);\n    const matrixLocation = gl.getUniformLocation(triProgram, 'u_matrix');\n    gl.uniformMatrix4fv(matrixLocation, false, matrix);\n\n    const positionLocation = gl.getAttribLocation(triProgram, 'a_position');\n    const positionBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);\n    gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(positionLocation);\n\n    const texcoordLocation = gl.getAttribLocation(triProgram, 'a_texcoord');\n    const texcoordBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, texcoordBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(texcoords), gl.STATIC_DRAW);\n    gl.vertexAttribPointer(texcoordLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(texcoordLocation);\n\n    gl.drawArrays(gl.TRIANGLES, 0, vertices.length / 2);\n  }\n\n  if (renderEdges) {\n    const edgeProgram = createProgram(\n      gl,\n      EDGE_FRAGMENT_SHADER,\n      EDGE_VERTEX_SHADER,\n    );\n    gl.useProgram(edgeProgram);\n    const matrix = mat4.orthographic(0, width, height, 0, -1, 1);\n    const matrixLocation = gl.getUniformLocation(edgeProgram, 'u_matrix');\n    gl.uniformMatrix4fv(matrixLocation, false, matrix);\n\n    const burnval = Array.isArray(renderEdges) ? renderEdges : [0, 0, 0, 255];\n    const burnvalLocation = gl.getUniformLocation(edgeProgram, 'u_val');\n    const isFloat = true;\n    if (isFloat) {\n      gl.uniform4fv(burnvalLocation, burnval);\n    } else {\n      gl.uniform4iv(burnvalLocation, burnval);\n    }\n\n    const positionLocation = gl.getAttribLocation(edgeProgram, 'a_position');\n    const positionBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n    gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(positionLocation);\n\n    /** @type {Array<number>} */\n    const lines = triangulation.getTriangles().reduce(function (\n      /** @type {Array<number>} */ lines,\n      triangle,\n    ) {\n      const target = triangle.target;\n      const {u1, v1, u0, v0, u2, v2} = getUVs(target);\n\n      return lines.concat([u1, v1, u0, v0, u0, v0, u2, v2, u2, v2, u1, v1]);\n    }, []);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(lines), gl.STATIC_DRAW);\n    gl.drawArrays(gl.LINES, 0, lines.length / 2);\n  }\n\n  return {\n    width,\n    height,\n    framebuffer: resultFrameBuffer,\n    texture: resultTexture,\n  };\n}\n", "/**\n * @module ol/reproj/DataTile\n */\n\nimport DataTile, {asArrayLike, asImageLike, toArray} from '../DataTile.js';\nimport TileState from '../TileState.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport EventType from '../events/EventType.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {getArea, getIntersection, getWidth, wrapAndSliceX} from '../extent.js';\nimport {clamp} from '../math.js';\nimport {calculateSourceExtentResolution} from '../reproj.js';\nimport Triangulation from './Triangulation.js';\nimport {ERROR_THRESHOLD} from './common.js';\nimport {\n  canvasGLPool,\n  createCanvasContextWebGL,\n  releaseGLCanvas,\n  render as renderReprojected,\n} from './glreproj.js';\n\n/**\n * @typedef {function(number, number, number, number) : import(\"../DataTile.js\").default} TileGetter\n */\n\n/**\n * @typedef {Object} TileOffset\n * @property {DataTile} tile Tile.\n * @property {number} offset Offset.\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../proj/Projection.js\").default} sourceProj Source projection.\n * @property {import(\"../tilegrid/TileGrid.js\").default} sourceTileGrid Source tile grid.\n * @property {import(\"../proj/Projection.js\").default} targetProj Target projection.\n * @property {import(\"../tilegrid/TileGrid.js\").default} targetTileGrid Target tile grid.\n * @property {import(\"../tilecoord.js\").TileCoord} tileCoord Coordinate of the tile.\n * @property {import(\"../tilecoord.js\").TileCoord} [wrappedTileCoord] Coordinate of the tile wrapped in X.\n * @property {number} pixelRatio Pixel ratio.\n * @property {number} gutter Gutter of the source tiles.\n * @property {TileGetter} getTileFunction Function returning source tiles (z, x, y, pixelRatio).\n * @property {boolean} [interpolate=false] Use interpolated values when resampling.  By default,\n * the nearest neighbor is used when resampling.\n * @property {number} [errorThreshold] Acceptable reprojection error (in px).\n * @property {number} [transition=250] A duration for tile opacity\n * transitions in milliseconds. A duration of 0 disables the opacity transition.\n * @property {import(\"../transform.js\").Transform} [transformMatrix] Source transform matrix.\n * @property {boolean} [renderEdges] Render reprojection edges.\n */\n\n/**\n * @classdesc\n * Class encapsulating single reprojected data tile.\n * See {@link module:ol/source/DataTile~DataTileSource}.\n *\n */\nclass ReprojDataTile extends DataTile {\n  /**\n   * @param {Options} options Tile options.\n   */\n  constructor(options) {\n    super({\n      tileCoord: options.tileCoord,\n      loader: () => Promise.resolve(new Uint8ClampedArray(4)),\n      interpolate: options.interpolate,\n      transition: options.transition,\n    });\n\n    /**\n     * @private\n     * @type {boolean | Array<number>}\n     */\n    this.renderEdges_ =\n      options.renderEdges !== undefined ? options.renderEdges : false;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.pixelRatio_ = options.pixelRatio;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.gutter_ = options.gutter;\n\n    /**\n     * @type {import(\"../DataTile.js\").Data}\n     * @private\n     */\n    this.reprojData_ = null;\n\n    /**\n     * @type {Error}\n     * @private\n     */\n    this.reprojError_ = null;\n\n    /**\n     * @type {import('../size.js').Size}\n     * @private\n     */\n    this.reprojSize_ = undefined;\n\n    /**\n     * @private\n     * @type {import(\"../tilegrid/TileGrid.js\").default}\n     */\n    this.sourceTileGrid_ = options.sourceTileGrid;\n\n    /**\n     * @private\n     * @type {import(\"../tilegrid/TileGrid.js\").default}\n     */\n    this.targetTileGrid_ = options.targetTileGrid;\n\n    /**\n     * @private\n     * @type {import(\"../tilecoord.js\").TileCoord}\n     */\n    this.wrappedTileCoord_ = options.wrappedTileCoord || options.tileCoord;\n\n    /**\n     * @private\n     * @type {!Array<TileOffset>}\n     */\n    this.sourceTiles_ = [];\n\n    /**\n     * @private\n     * @type {?Array<import(\"../events.js\").EventsKey>}\n     */\n    this.sourcesListenerKeys_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.sourceZ_ = 0;\n\n    const sourceProj = options.sourceProj;\n    const sourceProjExtent = sourceProj.getExtent();\n    const sourceTileGridExtent = options.sourceTileGrid.getExtent();\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.clipExtent_ = sourceProj.canWrapX()\n      ? sourceTileGridExtent\n        ? getIntersection(sourceProjExtent, sourceTileGridExtent)\n        : sourceProjExtent\n      : sourceTileGridExtent;\n\n    const targetExtent = this.targetTileGrid_.getTileCoordExtent(\n      this.wrappedTileCoord_,\n    );\n    const maxTargetExtent = this.targetTileGrid_.getExtent();\n    let maxSourceExtent = this.sourceTileGrid_.getExtent();\n\n    const limitedTargetExtent = maxTargetExtent\n      ? getIntersection(targetExtent, maxTargetExtent)\n      : targetExtent;\n\n    if (getArea(limitedTargetExtent) === 0) {\n      // Tile is completely outside range -> EMPTY\n      // TODO: is it actually correct that the source even creates the tile ?\n      this.state = TileState.EMPTY;\n      return;\n    }\n\n    if (sourceProjExtent) {\n      if (!maxSourceExtent) {\n        maxSourceExtent = sourceProjExtent;\n      } else {\n        maxSourceExtent = getIntersection(maxSourceExtent, sourceProjExtent);\n      }\n    }\n\n    const targetResolution = this.targetTileGrid_.getResolution(\n      this.wrappedTileCoord_[0],\n    );\n\n    const targetProj = options.targetProj;\n    const sourceResolution = calculateSourceExtentResolution(\n      sourceProj,\n      targetProj,\n      limitedTargetExtent,\n      targetResolution,\n    );\n\n    if (!isFinite(sourceResolution) || sourceResolution <= 0) {\n      // invalid sourceResolution -> EMPTY\n      // probably edges of the projections when no extent is defined\n      this.state = TileState.EMPTY;\n      return;\n    }\n\n    const errorThresholdInPixels =\n      options.errorThreshold !== undefined\n        ? options.errorThreshold\n        : ERROR_THRESHOLD;\n\n    /**\n     * @private\n     * @type {!import(\"./Triangulation.js\").default}\n     */\n    this.triangulation_ = new Triangulation(\n      sourceProj,\n      targetProj,\n      limitedTargetExtent,\n      maxSourceExtent,\n      sourceResolution * errorThresholdInPixels,\n      targetResolution,\n      options.transformMatrix,\n    );\n\n    if (this.triangulation_.getTriangles().length === 0) {\n      // no valid triangles -> EMPTY\n      this.state = TileState.EMPTY;\n      return;\n    }\n\n    this.sourceZ_ = this.sourceTileGrid_.getZForResolution(sourceResolution);\n    let sourceExtent = this.triangulation_.calculateSourceExtent();\n\n    if (maxSourceExtent) {\n      if (sourceProj.canWrapX()) {\n        sourceExtent[1] = clamp(\n          sourceExtent[1],\n          maxSourceExtent[1],\n          maxSourceExtent[3],\n        );\n        sourceExtent[3] = clamp(\n          sourceExtent[3],\n          maxSourceExtent[1],\n          maxSourceExtent[3],\n        );\n      } else {\n        sourceExtent = getIntersection(sourceExtent, maxSourceExtent);\n      }\n    }\n\n    if (!getArea(sourceExtent)) {\n      this.state = TileState.EMPTY;\n    } else {\n      let worldWidth = 0;\n      let worldsAway = 0;\n      if (sourceProj.canWrapX()) {\n        worldWidth = getWidth(sourceProjExtent);\n        worldsAway = Math.floor(\n          (sourceExtent[0] - sourceProjExtent[0]) / worldWidth,\n        );\n      }\n\n      const sourceExtents = wrapAndSliceX(\n        sourceExtent.slice(),\n        sourceProj,\n        true,\n      );\n      sourceExtents.forEach((extent) => {\n        const sourceRange = this.sourceTileGrid_.getTileRangeForExtentAndZ(\n          extent,\n          this.sourceZ_,\n        );\n        const getTile = options.getTileFunction;\n        for (let srcX = sourceRange.minX; srcX <= sourceRange.maxX; srcX++) {\n          for (let srcY = sourceRange.minY; srcY <= sourceRange.maxY; srcY++) {\n            const tile = getTile(this.sourceZ_, srcX, srcY, this.pixelRatio_);\n            if (tile) {\n              const offset = worldsAway * worldWidth;\n              this.sourceTiles_.push({tile, offset});\n            }\n          }\n        }\n        ++worldsAway;\n      });\n\n      if (this.sourceTiles_.length === 0) {\n        this.state = TileState.EMPTY;\n      }\n    }\n  }\n\n  /**\n   * Get the tile size.\n   * @return {import('../size.js').Size} Tile size.\n   * @override\n   */\n  getSize() {\n    return this.reprojSize_;\n  }\n\n  /**\n   * Get the data for the tile.\n   * @return {import(\"../DataTile.js\").Data} Tile data.\n   * @override\n   */\n  getData() {\n    return this.reprojData_;\n  }\n\n  /**\n   * Get any loading error.\n   * @return {Error} Loading error.\n   * @override\n   */\n  getError() {\n    return this.reprojError_;\n  }\n\n  /**\n   * @private\n   */\n  reproject_() {\n    const dataSources = [];\n    let imageLike = false;\n    this.sourceTiles_.forEach((source) => {\n      const tile = source.tile;\n      if (!tile || tile.getState() !== TileState.LOADED) {\n        return;\n      }\n      const size = tile.getSize();\n      const gutter = this.gutter_;\n      /**\n       * @type {import(\"../DataTile.js\").ArrayLike}\n       */\n      let tileData;\n      const arrayData = asArrayLike(tile.getData());\n      if (arrayData) {\n        tileData = arrayData;\n      } else {\n        imageLike = true;\n        tileData = toArray(asImageLike(tile.getData()));\n      }\n      const pixelSize = [size[0] + 2 * gutter, size[1] + 2 * gutter];\n      const isFloat = tileData instanceof Float32Array;\n      const pixelCount = pixelSize[0] * pixelSize[1];\n      const DataType = isFloat ? Float32Array : Uint8ClampedArray;\n      const tileDataR = new DataType(tileData.buffer);\n      const bytesPerElement = DataType.BYTES_PER_ELEMENT;\n      const bytesPerPixel = (bytesPerElement * tileDataR.length) / pixelCount;\n      const bytesPerRow = tileDataR.byteLength / pixelSize[1];\n      const bandCount = Math.floor(\n        bytesPerRow / bytesPerElement / pixelSize[0],\n      );\n      const extent = this.sourceTileGrid_.getTileCoordExtent(tile.tileCoord);\n      extent[0] += source.offset;\n      extent[2] += source.offset;\n      const clipExtent = this.clipExtent_?.slice();\n      if (clipExtent) {\n        clipExtent[0] += source.offset;\n        clipExtent[2] += source.offset;\n      }\n      dataSources.push({\n        extent: extent,\n        clipExtent: clipExtent,\n        data: tileDataR,\n        dataType: DataType,\n        bytesPerPixel: bytesPerPixel,\n        pixelSize: pixelSize,\n        bandCount: bandCount,\n      });\n    });\n    this.sourceTiles_.length = 0;\n\n    if (dataSources.length === 0) {\n      this.state = TileState.ERROR;\n      this.changed();\n      return;\n    }\n\n    const z = this.wrappedTileCoord_[0];\n    const size = this.targetTileGrid_.getTileSize(z);\n    const targetWidth = typeof size === 'number' ? size : size[0];\n    const targetHeight = typeof size === 'number' ? size : size[1];\n    const outWidth = targetWidth * this.pixelRatio_;\n    const outHeight = targetHeight * this.pixelRatio_;\n    const targetResolution = this.targetTileGrid_.getResolution(z);\n    const sourceResolution = this.sourceTileGrid_.getResolution(this.sourceZ_);\n\n    const targetExtent = this.targetTileGrid_.getTileCoordExtent(\n      this.wrappedTileCoord_,\n    );\n\n    const bandCount = dataSources[0].bandCount;\n    const dataR = new dataSources[0].dataType(bandCount * outWidth * outHeight);\n\n    const gl = createCanvasContextWebGL(outWidth, outHeight, canvasGLPool, {\n      premultipliedAlpha: false,\n      antialias: false,\n    });\n\n    let willInterpolate;\n    const format = gl.RGBA;\n    let textureType;\n    if (dataSources[0].dataType == Float32Array) {\n      textureType = gl.FLOAT;\n      gl.getExtension('WEBGL_color_buffer_float');\n      gl.getExtension('OES_texture_float');\n      gl.getExtension('EXT_float_blend');\n      const extension = gl.getExtension('OES_texture_float_linear');\n      const canInterpolate = extension !== null;\n      willInterpolate = canInterpolate && this.interpolate;\n    } else {\n      textureType = gl.UNSIGNED_BYTE;\n      willInterpolate = this.interpolate;\n    }\n\n    const BANDS_PR_REPROJ = 4;\n    const reprojs = Math.ceil(bandCount / BANDS_PR_REPROJ);\n    for (let reproj = reprojs - 1; reproj >= 0; --reproj) {\n      const sources = [];\n      for (let i = 0, len = dataSources.length; i < len; ++i) {\n        const dataSource = dataSources[i];\n\n        const pixelSize = dataSource.pixelSize;\n        const width = pixelSize[0];\n        const height = pixelSize[1];\n\n        const data = new dataSource.dataType(BANDS_PR_REPROJ * width * height);\n        const dataS = dataSource.data;\n        let offset = reproj * BANDS_PR_REPROJ;\n        for (let j = 0, len = data.length; j < len; j += BANDS_PR_REPROJ) {\n          data[j] = dataS[offset];\n          data[j + 1] = dataS[offset + 1];\n          data[j + 2] = dataS[offset + 2];\n          data[j + 3] = dataS[offset + 3];\n          offset += bandCount;\n        }\n\n        const texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n\n        if (willInterpolate) {\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        } else {\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        }\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texImage2D(\n          gl.TEXTURE_2D,\n          0,\n          format,\n          width,\n          height,\n          0,\n          format,\n          textureType,\n          data,\n        );\n\n        sources.push({\n          extent: dataSource.extent,\n          clipExtent: dataSource.clipExtent,\n          texture: texture,\n          width: width,\n          height: height,\n        });\n      }\n\n      const {framebuffer, width, height} = renderReprojected(\n        gl,\n        targetWidth,\n        targetHeight,\n        this.pixelRatio_,\n        sourceResolution,\n        targetResolution,\n        targetExtent,\n        this.triangulation_,\n        sources,\n        this.gutter_,\n        textureType,\n        this.renderEdges_,\n        willInterpolate,\n      );\n\n      // The texture is always RGBA.\n      const rows = width;\n      const cols = height * BANDS_PR_REPROJ;\n      const data = new dataSources[0].dataType(rows * cols);\n      gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n      gl.readPixels(0, 0, width, height, gl.RGBA, textureType, data);\n\n      let offset = reproj * BANDS_PR_REPROJ;\n      for (let i = 0, len = data.length; i < len; i += BANDS_PR_REPROJ) {\n        // The data read by `readPixels` is flipped in the y-axis so flip it again.\n        const flipY = (rows - 1 - ((i / cols) | 0)) * cols + (i % cols);\n        dataR[offset] = data[flipY];\n        dataR[offset + 1] = data[flipY + 1];\n        dataR[offset + 2] = data[flipY + 2];\n        dataR[offset + 3] = data[flipY + 3];\n        offset += bandCount;\n      }\n    }\n\n    releaseGLCanvas(gl);\n    canvasGLPool.push(gl.canvas);\n\n    if (imageLike) {\n      const context = createCanvasContext2D(targetWidth, targetHeight);\n      const imageData = new ImageData(dataR, targetWidth);\n      context.putImageData(imageData, 0, 0);\n      this.reprojData_ = context.canvas;\n    } else {\n      this.reprojData_ = dataR;\n    }\n    this.reprojSize_ = [Math.round(outWidth), Math.round(outHeight)];\n    this.state = TileState.LOADED;\n    this.changed();\n  }\n\n  /**\n   * Load not yet loaded URI.\n   * @override\n   */\n  load() {\n    if (this.state !== TileState.IDLE && this.state !== TileState.ERROR) {\n      return;\n    }\n    this.state = TileState.LOADING;\n    this.changed();\n\n    let leftToLoad = 0;\n\n    this.sourcesListenerKeys_ = [];\n    this.sourceTiles_.forEach(({tile}) => {\n      const state = tile.getState();\n      if (state !== TileState.IDLE && state !== TileState.LOADING) {\n        return;\n      }\n      leftToLoad++;\n\n      const sourceListenKey = listen(tile, EventType.CHANGE, () => {\n        const state = tile.getState();\n        if (\n          state == TileState.LOADED ||\n          state == TileState.ERROR ||\n          state == TileState.EMPTY\n        ) {\n          unlistenByKey(sourceListenKey);\n          leftToLoad--;\n          if (leftToLoad === 0) {\n            this.unlistenSources_();\n            this.reproject_();\n          }\n        }\n      });\n      this.sourcesListenerKeys_.push(sourceListenKey);\n    });\n\n    if (leftToLoad === 0) {\n      setTimeout(this.reproject_.bind(this), 0);\n    } else {\n      this.sourceTiles_.forEach(function ({tile}) {\n        const state = tile.getState();\n        if (state == TileState.IDLE) {\n          tile.load();\n        }\n      });\n    }\n  }\n\n  /**\n   * @private\n   */\n  unlistenSources_() {\n    this.sourcesListenerKeys_.forEach(unlistenByKey);\n    this.sourcesListenerKeys_ = null;\n  }\n}\n\nexport default ReprojDataTile;\n", "/**\n * @module ol/source/DataTile\n */\nimport DataTile from '../DataTile.js';\nimport TileState from '../TileState.js';\nimport EventType from '../events/EventType.js';\nimport {toPromise} from '../functions.js';\nimport {equivalent, get as getProjection} from '../proj.js';\nimport ReprojDataTile from '../reproj/DataTile.js';\nimport {toSize} from '../size.js';\nimport {\n  createXYZ,\n  extentFromProjection,\n  getForProjection as getTileGridForProjection,\n} from '../tilegrid.js';\nimport {getUid} from '../util.js';\nimport TileSource, {TileSourceEvent} from './Tile.js';\nimport TileEventType from './TileEventType.js';\n\n/**\n * @typedef {'anonymous'|'use-credentials'} CrossOriginAttribute\n */\n\n/**\n * @typedef {Object} LoaderOptions\n * @property {AbortSignal} signal An abort controller signal.\n * @property {CrossOriginAttribute} [crossOrigin] The cross-origin attribute for images.\n * @property {number} [maxY] The maximum y coordinate at the given z level.  Will be undefined if the\n * underlying tile grid does not have a known extent.\n */\n\n/**\n * Data tile loading function.  The function is called with z, x, and y tile coordinates and\n * returns {@link import(\"../DataTile.js\").Data data} for a tile or a promise for the same.\n * @typedef {function(number, number, number, LoaderOptions) : (import(\"../DataTile.js\").Data|Promise<import(\"../DataTile.js\").Data>)} Loader\n */\n\n/**\n * @typedef {Object} Options\n * @property {Loader} [loader] Data loader.  Called with z, x, and y tile coordinates.\n * Returns {@link import(\"../DataTile.js\").Data data} for a tile or a promise for the same.\n * For loaders that generate images, the promise should not resolve until the image is loaded.\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [maxZoom=42] Optional max zoom level. Not used if `tileGrid` is provided.\n * @property {number} [minZoom=0] Optional min zoom level. Not used if `tileGrid` is provided.\n * @property {number|import(\"../size.js\").Size} [tileSize=[256, 256]] The pixel width and height of the source tiles.\n * This may be different than the rendered pixel size if a `tileGrid` is provided.\n * @property {number} [gutter=0] The size in pixels of the gutter around data tiles to ignore.\n * This allows artifacts of rendering at tile edges to be ignored.\n * Supported data should be wider and taller than the tile size by a value of `2 x gutter`.\n * @property {number} [maxResolution] Optional tile grid resolution at level zero. Not used if `tileGrid` is provided.\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Tile projection.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid.\n * @property {import(\"./Source.js\").State} [state] The source state.\n * @property {boolean} [wrapX=false] Render tiles beyond the antimeridian.\n * @property {number} [transition] Transition time when fading in new tiles (in milliseconds).\n * @property {number} [bandCount=4] Number of bands represented in the data.\n * @property {boolean} [interpolate=false] Use interpolated values when resampling.  By default,\n * the nearest neighbor is used when resampling.\n * @property {CrossOriginAttribute} [crossOrigin='anonymous'] The crossOrigin property to pass to loaders for image data.\n * @property {string} [key] Key for use in caching tiles.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * A source for typed array data tiles.\n *\n * @fires import(\"./Tile.js\").TileSourceEvent\n * @template {import(\"../Tile.js\").default} [TileType=DataTile]\n * @extends TileSource<TileType>\n * @api\n */\nclass DataTileSource extends TileSource {\n  /**\n   * @param {Options} options DataTile source options.\n   */\n  constructor(options) {\n    const projection =\n      options.projection === undefined ? 'EPSG:3857' : options.projection;\n\n    let tileGrid = options.tileGrid;\n    if (tileGrid === undefined && projection) {\n      tileGrid = createXYZ({\n        extent: extentFromProjection(projection),\n        maxResolution: options.maxResolution,\n        maxZoom: options.maxZoom,\n        minZoom: options.minZoom,\n        tileSize: options.tileSize,\n      });\n    }\n\n    super({\n      cacheSize: 0.1, // don't cache on the source\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      projection: projection,\n      tileGrid: tileGrid,\n      state: options.state,\n      wrapX: options.wrapX,\n      transition: options.transition,\n      interpolate: options.interpolate,\n      key: options.key,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.gutter_ = options.gutter !== undefined ? options.gutter : 0;\n\n    /**\n     * @private\n     * @type {import('../size.js').Size|null}\n     */\n    this.tileSize_ = options.tileSize ? toSize(options.tileSize) : null;\n\n    /**\n     * @private\n     * @type {Array<import('../size.js').Size>|null}\n     */\n    this.tileSizes_ = null;\n\n    /**\n     * @private\n     * @type {!Object<string, boolean>}\n     */\n    this.tileLoadingKeys_ = {};\n\n    /**\n     * @private\n     */\n    this.loader_ = options.loader;\n\n    /**\n     * @private\n     */\n    this.handleTileChange_ = this.handleTileChange_.bind(this);\n\n    /**\n     * @type {number}\n     */\n    this.bandCount = options.bandCount === undefined ? 4 : options.bandCount; // assume RGBA if undefined\n\n    /**\n     * @private\n     * @type {!Object<string, import(\"../tilegrid/TileGrid.js\").default>}\n     */\n    this.tileGridForProjection_ = {};\n\n    /**\n     * @private\n     * @type {CrossOriginAttribute}\n     */\n    this.crossOrigin_ = options.crossOrigin || 'anonymous';\n\n    /**\n     * @type {import(\"../transform.js\").Transform|null}\n     */\n    this.transformMatrix = null;\n  }\n\n  /**\n   * Set the source tile sizes.  The length of the array is expected to match the number of\n   * levels in the tile grid.\n   * @protected\n   * @param {Array<import('../size.js').Size>} tileSizes An array of tile sizes.\n   */\n  setTileSizes(tileSizes) {\n    this.tileSizes_ = tileSizes;\n  }\n\n  /**\n   * Get the source tile size at the given zoom level.  This may be different than the rendered tile\n   * size.\n   * @protected\n   * @param {number} z Tile zoom level.\n   * @return {import('../size.js').Size} The source tile size.\n   */\n  getTileSize(z) {\n    if (this.tileSizes_) {\n      return this.tileSizes_[z];\n    }\n    if (this.tileSize_) {\n      return this.tileSize_;\n    }\n    const tileGrid = this.getTileGrid();\n    return tileGrid ? toSize(tileGrid.getTileSize(z)) : [256, 256];\n  }\n\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {number} Gutter.\n   * @override\n   */\n  getGutterForProjection(projection) {\n    const thisProj = this.getProjection();\n    if (\n      (!thisProj || equivalent(thisProj, projection)) &&\n      !this.transformMatrix\n    ) {\n      return this.gutter_;\n    }\n\n    return 0;\n  }\n\n  /**\n   * @param {Loader} loader The data loader.\n   * @protected\n   */\n  setLoader(loader) {\n    this.loader_ = loader;\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {import(\"../proj/Projection.js\").default} targetProj The output projection.\n   * @param {import(\"../proj/Projection.js\").default} sourceProj The input projection.\n   * @return {!TileType} Tile.\n   */\n  getReprojTile_(z, x, y, targetProj, sourceProj) {\n    const sourceTileGrid =\n      this.tileGrid || this.getTileGridForProjection(sourceProj || targetProj);\n    const reprojTilePixelRatio = Math.max.apply(\n      null,\n      sourceTileGrid.getResolutions().map((r, z) => {\n        const tileSize = toSize(sourceTileGrid.getTileSize(z));\n        const textureSize = this.getTileSize(z);\n        return Math.max(\n          textureSize[0] / tileSize[0],\n          textureSize[1] / tileSize[1],\n        );\n      }),\n    );\n\n    const targetTileGrid = this.getTileGridForProjection(targetProj);\n    const tileCoord = [z, x, y];\n    const wrappedTileCoord = this.getTileCoordForTileUrlFunction(\n      tileCoord,\n      targetProj,\n    );\n\n    const options = Object.assign(\n      {\n        sourceProj: sourceProj || targetProj,\n        sourceTileGrid,\n        targetProj,\n        targetTileGrid,\n        tileCoord,\n        wrappedTileCoord,\n        pixelRatio: reprojTilePixelRatio,\n        gutter: this.gutter_,\n        getTileFunction: (z, x, y, pixelRatio) =>\n          this.getTile(z, x, y, pixelRatio),\n        transformMatrix: this.transformMatrix,\n      },\n      /** @type {import(\"../reproj/DataTile.js\").Options} */ (this.tileOptions),\n    );\n    const tile = /** @type {TileType} */ (\n      /** @type {*} */ (new ReprojDataTile(options))\n    );\n    tile.key = this.getKey();\n    return tile;\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} [projection] Projection.\n   * @return {TileType|null} Tile (or null if outside source extent).\n   * @override\n   */\n  getTile(z, x, y, pixelRatio, projection) {\n    const sourceProjection = this.getProjection();\n    if (\n      projection &&\n      ((sourceProjection && !equivalent(sourceProjection, projection)) ||\n        this.transformMatrix)\n    ) {\n      return this.getReprojTile_(z, x, y, projection, sourceProjection);\n    }\n\n    const size = this.getTileSize(z);\n\n    const sourceLoader = this.loader_;\n\n    const controller = new AbortController();\n\n    /**\n     * @type {LoaderOptions}\n     */\n    const loaderOptions = {\n      signal: controller.signal,\n      crossOrigin: this.crossOrigin_,\n    };\n\n    const tileCoord = this.getTileCoordForTileUrlFunction([z, x, y]);\n    if (!tileCoord) {\n      return null;\n    }\n\n    const requestZ = tileCoord[0];\n    const requestX = tileCoord[1];\n    const requestY = tileCoord[2];\n    const range = this.getTileGrid()?.getFullTileRange(requestZ);\n    if (range) {\n      loaderOptions.maxY = range.getHeight() - 1;\n    }\n    function loader() {\n      return toPromise(function () {\n        return sourceLoader(requestZ, requestX, requestY, loaderOptions);\n      });\n    }\n\n    /**\n     * @type {import(\"../DataTile.js\").Options}\n     */\n    const options = Object.assign(\n      {\n        tileCoord: [z, x, y],\n        loader: loader,\n        size: size,\n        controller: controller,\n      },\n      this.tileOptions,\n    );\n\n    const tile = /** @type {TileType} */ (\n      /** @type {*} */ (new DataTile(options))\n    );\n    tile.key = this.getKey();\n    tile.addEventListener(EventType.CHANGE, this.handleTileChange_);\n\n    return tile;\n  }\n\n  /**\n   * Handle tile change events.\n   * @param {import(\"../events/Event.js\").default} event Event.\n   */\n  handleTileChange_(event) {\n    const tile = /** @type {import(\"../Tile.js\").default} */ (event.target);\n    const uid = getUid(tile);\n    const tileState = tile.getState();\n    let type;\n    if (tileState == TileState.LOADING) {\n      this.tileLoadingKeys_[uid] = true;\n      type = TileEventType.TILELOADSTART;\n    } else if (uid in this.tileLoadingKeys_) {\n      delete this.tileLoadingKeys_[uid];\n      type =\n        tileState == TileState.ERROR\n          ? TileEventType.TILELOADERROR\n          : tileState == TileState.LOADED\n            ? TileEventType.TILELOADEND\n            : undefined;\n    }\n    if (type) {\n      this.dispatchEvent(new TileSourceEvent(type, tile));\n    }\n  }\n\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!import(\"../tilegrid/TileGrid.js\").default} Tile grid.\n   * @override\n   */\n  getTileGridForProjection(projection) {\n    const thisProj = this.getProjection();\n    if (\n      this.tileGrid &&\n      (!thisProj || equivalent(thisProj, projection)) &&\n      !this.transformMatrix\n    ) {\n      return this.tileGrid;\n    }\n\n    const projKey = getUid(projection);\n    if (!(projKey in this.tileGridForProjection_)) {\n      this.tileGridForProjection_[projKey] =\n        getTileGridForProjection(projection);\n    }\n    return this.tileGridForProjection_[projKey];\n  }\n\n  /**\n   * Sets the tile grid to use when reprojecting the tiles to the given\n   * projection instead of the default tile grid for the projection.\n   *\n   * This can be useful when the default tile grid cannot be created\n   * (e.g. projection has no extent defined) or\n   * for optimization reasons (custom tile size, resolutions, ...).\n   *\n   * @param {import(\"../proj.js\").ProjectionLike} projection Projection.\n   * @param {import(\"../tilegrid/TileGrid.js\").default} tilegrid Tile grid to use for the projection.\n   * @api\n   */\n  setTileGridForProjection(projection, tilegrid) {\n    const proj = getProjection(projection);\n    if (proj) {\n      const projKey = getUid(proj);\n      if (!(projKey in this.tileGridForProjection_)) {\n        this.tileGridForProjection_[projKey] = tilegrid;\n      }\n    }\n  }\n}\n\nexport default DataTileSource;\n", "export const THIS_IS_NOT_AN_OBJECT = \"This is not an object\";\nexport const THIS_IS_NOT_A_FLOAT16ARRAY_OBJECT = \"This is not a Float16Array object\";\nexport const THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY =\n  \"This constructor is not a subclass of Float16Array\";\nexport const THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT =\n  \"The constructor property value is not an object\";\nexport const SPECIES_CONSTRUCTOR_DIDNT_RETURN_TYPEDARRAY_OBJECT =\n  \"Species constructor didn't return TypedArray object\";\nexport const DERIVED_CONSTRUCTOR_CREATED_TYPEDARRAY_OBJECT_WHICH_WAS_TOO_SMALL_LENGTH =\n  \"Derived constructor created TypedArray object which was too small length\";\nexport const ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER =\n  \"Attempting to access detached ArrayBuffer\";\nexport const CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT =\n  \"Cannot convert undefined or null to object\";\nexport const CANNOT_MIX_BIGINT_AND_OTHER_TYPES =\n  \"Cannot mix BigInt and other types, use explicit conversions\";\nexport const ITERATOR_PROPERTY_IS_NOT_CALLABLE = \"@@iterator property is not callable\";\nexport const REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE =\n  \"Reduce of empty array with no initial value\";\nexport const THE_COMPARISON_FUNCTION_MUST_BE_EITHER_A_FUNCTION_OR_UNDEFINED =\n  \"The comparison function must be either a function or undefined\";\nexport const OFFSET_IS_OUT_OF_BOUNDS = \"Offset is out of bounds\";\n", "/* eslint-disable no-restricted-globals, no-restricted-syntax */\n/* global SharedArrayBuffer */\n\nimport { CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT } from \"./messages.mjs\";\n\n/** @type {<T extends (...args: any) => any>(target: T) => (thisArg: ThisType<T>, ...args: any[]) => any} */\nfunction uncurryThis(target) {\n  return (thisArg, ...args) => {\n    return ReflectApply(target, thisArg, args);\n  };\n}\n\n/** @type {(target: any, key: string | symbol) => (thisArg: any, ...args: any[]) => any} */\nfunction uncurryThisGetter(target, key) {\n  return uncurryThis(\n    ReflectGetOwnPropertyDescriptor(\n      target,\n      key\n    ).get\n  );\n}\n\n// Reflect\nexport const {\n  apply: ReflectApply,\n  construct: ReflectConstruct,\n  defineProperty: ReflectDefineProperty,\n  get: ReflectGet,\n  getOwnPropertyDescriptor: ReflectGetOwnPropertyDescriptor,\n  getPrototypeOf: ReflectGetPrototypeOf,\n  has: ReflectHas,\n  ownKeys: ReflectOwnKeys,\n  set: ReflectSet,\n  setPrototypeOf: ReflectSetPrototypeOf,\n} = Reflect;\n\n// Proxy\nexport const NativeProxy = Proxy;\n\n// Number\nexport const {\n  EPSILON,\n  MAX_SAFE_INTEGER,\n  isFinite: NumberIsFinite,\n  isNaN: NumberIsNaN,\n} = Number;\n\n// Symbol\nexport const {\n  iterator: SymbolIterator,\n  species: SymbolSpecies,\n  toStringTag: SymbolToStringTag,\n  for: SymbolFor,\n} = Symbol;\n\n// Object\nexport const NativeObject = Object;\nexport const {\n  create: ObjectCreate,\n  defineProperty: ObjectDefineProperty,\n  freeze: ObjectFreeze,\n  is: ObjectIs,\n} = NativeObject;\nconst ObjectPrototype = NativeObject.prototype;\n/** @type {(object: object, key: PropertyKey) => Function | undefined} */\nexport const ObjectPrototype__lookupGetter__ = /** @type {any} */ (ObjectPrototype).__lookupGetter__\n  ? uncurryThis(/** @type {any} */ (ObjectPrototype).__lookupGetter__)\n  : (object, key) => {\n    if (object == null) {\n      throw NativeTypeError(\n        CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT\n      );\n    }\n\n    let target = NativeObject(object);\n    do {\n      const descriptor = ReflectGetOwnPropertyDescriptor(target, key);\n      if (descriptor !== undefined) {\n        if (ObjectHasOwn(descriptor, \"get\")) {\n          return descriptor.get;\n        }\n\n        return;\n      }\n    } while ((target = ReflectGetPrototypeOf(target)) !== null);\n  };\n/** @type {(object: object, key: PropertyKey) => boolean} */\nexport const ObjectHasOwn = /** @type {any} */ (NativeObject).hasOwn ||\n  uncurryThis(ObjectPrototype.hasOwnProperty);\n\n// Array\nconst NativeArray = Array;\nexport const ArrayIsArray = NativeArray.isArray;\nconst ArrayPrototype = NativeArray.prototype;\n/** @type {(array: ArrayLike<unknown>, separator?: string) => string} */\nexport const ArrayPrototypeJoin = uncurryThis(ArrayPrototype.join);\n/** @type {<T>(array: T[], ...items: T[]) => number} */\nexport const ArrayPrototypePush = uncurryThis(ArrayPrototype.push);\n/** @type {(array: ArrayLike<unknown>, ...opts: any[]) => string} */\nexport const ArrayPrototypeToLocaleString = uncurryThis(\n  ArrayPrototype.toLocaleString\n);\nexport const NativeArrayPrototypeSymbolIterator = ArrayPrototype[SymbolIterator];\n/** @type {<T>(array: T[]) => IterableIterator<T>} */\nexport const ArrayPrototypeSymbolIterator = uncurryThis(NativeArrayPrototypeSymbolIterator);\n\n// Math\nexport const {\n  abs: MathAbs,\n  trunc: MathTrunc,\n} = Math;\n\n// ArrayBuffer\nexport const NativeArrayBuffer = ArrayBuffer;\nexport const ArrayBufferIsView = NativeArrayBuffer.isView;\nconst ArrayBufferPrototype = NativeArrayBuffer.prototype;\n/** @type {(buffer: ArrayBuffer, begin?: number, end?: number) => number} */\nexport const ArrayBufferPrototypeSlice = uncurryThis(ArrayBufferPrototype.slice);\n/** @type {(buffer: ArrayBuffer) => ArrayBuffer} */\nexport const ArrayBufferPrototypeGetByteLength = uncurryThisGetter(ArrayBufferPrototype, \"byteLength\");\n\n// SharedArrayBuffer\nexport const NativeSharedArrayBuffer = typeof SharedArrayBuffer !== \"undefined\" ? SharedArrayBuffer : null;\n/** @type {(buffer: SharedArrayBuffer) => SharedArrayBuffer} */\nexport const SharedArrayBufferPrototypeGetByteLength = NativeSharedArrayBuffer\n  && uncurryThisGetter(NativeSharedArrayBuffer.prototype, \"byteLength\");\n\n// TypedArray\n/** @typedef {Uint8Array|Uint8ClampedArray|Uint16Array|Uint32Array|Int8Array|Int16Array|Int32Array|Float32Array|Float64Array|BigUint64Array|BigInt64Array} TypedArray */\n/** @type {any} */\nexport const TypedArray = ReflectGetPrototypeOf(Uint8Array);\nconst TypedArrayFrom = TypedArray.from;\nexport const TypedArrayPrototype = TypedArray.prototype;\nexport const NativeTypedArrayPrototypeSymbolIterator = TypedArrayPrototype[SymbolIterator];\n/** @type {(typedArray: TypedArray) => IterableIterator<number>} */\nexport const TypedArrayPrototypeKeys = uncurryThis(TypedArrayPrototype.keys);\n/** @type {(typedArray: TypedArray) => IterableIterator<number>} */\nexport const TypedArrayPrototypeValues = uncurryThis(\n  TypedArrayPrototype.values\n);\n/** @type {(typedArray: TypedArray) => IterableIterator<[number, number]>} */\nexport const TypedArrayPrototypeEntries = uncurryThis(\n  TypedArrayPrototype.entries\n);\n/** @type {(typedArray: TypedArray, array: ArrayLike<number>, offset?: number) => void} */\nexport const TypedArrayPrototypeSet = uncurryThis(TypedArrayPrototype.set);\n/** @type {<T extends TypedArray>(typedArray: T) => T} */\nexport const TypedArrayPrototypeReverse = uncurryThis(\n  TypedArrayPrototype.reverse\n);\n/** @type {<T extends TypedArray>(typedArray: T, value: number, start?: number, end?: number) => T} */\nexport const TypedArrayPrototypeFill = uncurryThis(TypedArrayPrototype.fill);\n/** @type {<T extends TypedArray>(typedArray: T, target: number, start: number, end?: number) => T} */\nexport const TypedArrayPrototypeCopyWithin = uncurryThis(\n  TypedArrayPrototype.copyWithin\n);\n/** @type {<T extends TypedArray>(typedArray: T, compareFn?: (a: number, b: number) => number) => T} */\nexport const TypedArrayPrototypeSort = uncurryThis(TypedArrayPrototype.sort);\n/** @type {<T extends TypedArray>(typedArray: T, start?: number, end?: number) => T} */\nexport const TypedArrayPrototypeSlice = uncurryThis(TypedArrayPrototype.slice);\n/** @type {<T extends TypedArray>(typedArray: T, start?: number, end?: number) => T} */\nexport const TypedArrayPrototypeSubarray = uncurryThis(\n  TypedArrayPrototype.subarray\n);\n/** @type {((typedArray: TypedArray) => ArrayBuffer)} */\nexport const TypedArrayPrototypeGetBuffer = uncurryThisGetter(\n  TypedArrayPrototype,\n  \"buffer\"\n);\n/** @type {((typedArray: TypedArray) => number)} */\nexport const TypedArrayPrototypeGetByteOffset = uncurryThisGetter(\n  TypedArrayPrototype,\n  \"byteOffset\"\n);\n/** @type {((typedArray: TypedArray) => number)} */\nexport const TypedArrayPrototypeGetLength = uncurryThisGetter(\n  TypedArrayPrototype,\n  \"length\"\n);\n/** @type {(target: unknown) => string} */\nexport const TypedArrayPrototypeGetSymbolToStringTag = uncurryThisGetter(\n  TypedArrayPrototype,\n  SymbolToStringTag\n);\n\n// Uint8Array\nexport const NativeUint8Array = Uint8Array;\n\n// Uint16Array\nexport const NativeUint16Array = Uint16Array;\n/** @type {Uint16ArrayConstructor[\"from\"]} */\nexport const Uint16ArrayFrom = (...args) => {\n  return ReflectApply(TypedArrayFrom, NativeUint16Array, args);\n};\n\n// Uint32Array\nexport const NativeUint32Array = Uint32Array;\n\n// Float32Array\nexport const NativeFloat32Array = Float32Array;\n\n// ArrayIterator\n/** @type {any} */\nexport const ArrayIteratorPrototype = ReflectGetPrototypeOf([][SymbolIterator]());\n/** @type {<T>(arrayIterator: IterableIterator<T>) => IteratorResult<T>} */\nexport const ArrayIteratorPrototypeNext = uncurryThis(ArrayIteratorPrototype.next);\n\n// Generator\n/** @type {<T = unknown, TReturn = any, TNext = unknown>(generator: Generator<T, TReturn, TNext>, value?: TNext) => T} */\nexport const GeneratorPrototypeNext = uncurryThis((function* () {})().next);\n\n// Iterator\nexport const IteratorPrototype = ReflectGetPrototypeOf(ArrayIteratorPrototype);\n\n// DataView\nconst DataViewPrototype = DataView.prototype;\n/** @type {(dataView: DataView, byteOffset: number, littleEndian?: boolean) => number} */\nexport const DataViewPrototypeGetUint16 = uncurryThis(\n  DataViewPrototype.getUint16\n);\n/** @type {(dataView: DataView, byteOffset: number, value: number, littleEndian?: boolean) => void} */\nexport const DataViewPrototypeSetUint16 = uncurryThis(\n  DataViewPrototype.setUint16\n);\n\n// Error\nexport const NativeTypeError = TypeError;\nexport const NativeRangeError = RangeError;\n\n// WeakSet\n/**\n * Do not construct with arguments to avoid calling the \"add\" method\n * @type {{new <T extends {}>(): WeakSet<T>}}\n */\nexport const NativeWeakSet = WeakSet;\nconst WeakSetPrototype = NativeWeakSet.prototype;\n/** @type {<T extends {}>(set: WeakSet<T>, value: T) => Set<T>} */\nexport const WeakSetPrototypeAdd = uncurryThis(WeakSetPrototype.add);\n/** @type {<T extends {}>(set: WeakSet<T>, value: T) => boolean} */\nexport const WeakSetPrototypeHas = uncurryThis(WeakSetPrototype.has);\n\n// WeakMap\n/**\n * Do not construct with arguments to avoid calling the \"set\" method\n * @type {{new <K extends {}, V>(): WeakMap<K, V>}}\n */\nexport const NativeWeakMap = WeakMap;\nconst WeakMapPrototype = NativeWeakMap.prototype;\n/** @type {<K extends {}, V>(weakMap: WeakMap<K, V>, key: K) => V} */\nexport const WeakMapPrototypeGet = uncurryThis(WeakMapPrototype.get);\n/** @type {<K extends {}, V>(weakMap: WeakMap<K, V>, key: K) => boolean} */\nexport const WeakMapPrototypeHas = uncurryThis(WeakMapPrototype.has);\n/** @type {<K extends {}, V>(weakMap: WeakMap<K, V>, key: K, value: V) => WeakMap} */\nexport const WeakMapPrototypeSet = uncurryThis(WeakMapPrototype.set);\n", "import {\n  ArrayIteratorPrototype,\n  ArrayIteratorPrototypeNext,\n  ArrayPrototypeSymbolIterator,\n  GeneratorPrototypeNext,\n  IteratorPrototype,\n  NativeArrayPrototypeSymbolIterator,\n  NativeWeakMap,\n  ObjectCreate,\n  ObjectDefineProperty,\n  ReflectGetOwnPropertyDescriptor,\n  ReflectOwnKeys,\n  SymbolIterator,\n  WeakMapPrototypeGet,\n  WeakMapPrototypeSet,\n} from \"./primordials.mjs\";\n\n/** @type {WeakMap<{}, IterableIterator<any>>} */\nconst arrayIterators = new NativeWeakMap();\n\nconst SafeIteratorPrototype = ObjectCreate(null, {\n  next: {\n    value: function next() {\n      const arrayIterator = WeakMapPrototypeGet(arrayIterators, this);\n      return ArrayIteratorPrototypeNext(arrayIterator);\n    },\n  },\n\n  [SymbolIterator]: {\n    value: function values() {\n      return this;\n    },\n  },\n});\n\n/**\n * Wrap the Array around the SafeIterator If Array.prototype [@@iterator] has been modified\n * @type {<T>(array: T[]) => Iterable<T>}\n */\nexport function safeIfNeeded(array) {\n  if (\n    array[SymbolIterator] === NativeArrayPrototypeSymbolIterator &&\n    ArrayIteratorPrototype.next === ArrayIteratorPrototypeNext\n  ) {\n    return array;\n  }\n\n  const safe = ObjectCreate(SafeIteratorPrototype);\n  WeakMapPrototypeSet(arrayIterators, safe, ArrayPrototypeSymbolIterator(array));\n  return safe;\n}\n\n/** @type {WeakMap<{}, Generator<any>>} */\nconst generators = new NativeWeakMap();\n\n/** @see https://tc39.es/ecma262/#sec-%arrayiteratorprototype%-object */\nconst DummyArrayIteratorPrototype = ObjectCreate(IteratorPrototype, {\n  next: {\n    value: function next() {\n      const generator = WeakMapPrototypeGet(generators, this);\n      return GeneratorPrototypeNext(generator);\n    },\n    writable: true,\n    configurable: true,\n  },\n});\n\nfor (const key of ReflectOwnKeys(ArrayIteratorPrototype)) {\n  // next method has already defined\n  if (key === \"next\") {\n    continue;\n  }\n\n  // Copy ArrayIteratorPrototype descriptors to DummyArrayIteratorPrototype\n  ObjectDefineProperty(DummyArrayIteratorPrototype, key, ReflectGetOwnPropertyDescriptor(ArrayIteratorPrototype, key));\n}\n\n/**\n * Wrap the Generator around the dummy ArrayIterator\n * @type {<T>(generator: Generator<T>) => IterableIterator<T>}\n */\nexport function wrap(generator) {\n  const dummy = ObjectCreate(DummyArrayIteratorPrototype);\n  WeakMapPrototypeSet(generators, dummy, generator);\n  return dummy;\n}\n", "import {\n  ArrayBufferPrototypeGetByteLength,\n  ArrayIsArray,\n  ArrayIteratorPrototype,\n  ArrayIteratorPrototypeNext,\n  MathTrunc,\n  NativeArrayPrototypeSymbolIterator,\n  NativeSharedArrayBuffer,\n  NativeTypedArrayPrototypeSymbolIterator,\n  NumberIsFinite,\n  SharedArrayBufferPrototypeGetByteLength,\n  SymbolIterator,\n  TypedArrayPrototypeGetSymbolToStringTag,\n} from \"./primordials.mjs\";\n\n/**\n * @param {unknown} value\n * @returns {value is {}}\n */\nexport function isObject(value) {\n  return (\n    (value !== null && typeof value === \"object\") ||\n    typeof value === \"function\"\n  );\n}\n\n/**\n * @param {unknown} value\n * @returns {value is {}}\n */\nexport function isObjectLike(value) {\n  return value !== null && typeof value === \"object\";\n}\n\n// Inspired by util.types implementation of Node.js\n/** @typedef {Uint8Array|Uint8ClampedArray|Uint16Array|Uint32Array|Int8Array|Int16Array|Int32Array|Float32Array|Float64Array|BigUint64Array|BigInt64Array} TypedArray */\n\n/**\n * @param {unknown} value\n * @returns {value is TypedArray}\n */\nexport function isNativeTypedArray(value) {\n  return TypedArrayPrototypeGetSymbolToStringTag(value) !== undefined;\n}\n\n/**\n * @param {unknown} value\n * @returns {value is BigInt64Array|BigUint64Array}\n */\nexport function isNativeBigIntTypedArray(value) {\n  const typedArrayName = TypedArrayPrototypeGetSymbolToStringTag(value);\n  return (\n    typedArrayName === \"BigInt64Array\" ||\n    typedArrayName === \"BigUint64Array\"\n  );\n}\n\n/**\n * @param {unknown} value\n * @returns {value is ArrayBuffer}\n */\nfunction isArrayBuffer(value) {\n  try {\n    // ArrayBuffers are never arrays\n    if (ArrayIsArray(value)) {\n      return false;\n    }\n    ArrayBufferPrototypeGetByteLength(/** @type {any} */ (value));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * @param {unknown} value\n * @returns {value is SharedArrayBuffer}\n */\nexport function isSharedArrayBuffer(value) {\n  if (NativeSharedArrayBuffer === null) {\n    return false;\n  }\n\n  try {\n    SharedArrayBufferPrototypeGetByteLength(/** @type {any} */ (value));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * @param {unknown} value\n * @returns {value is ArrayBuffer|SharedArrayBuffer}\n */\nexport function isAnyArrayBuffer(value) {\n  return isArrayBuffer(value) || isSharedArrayBuffer(value);\n}\n\n/**\n * @param {unknown} value\n * @returns {value is unknown[]}\n */\nexport function isOrdinaryArray(value) {\n  if (!ArrayIsArray(value)) {\n    return false;\n  }\n\n  // Verify that there are no changes in ArrayIterator\n  return (\n    value[SymbolIterator] === NativeArrayPrototypeSymbolIterator &&\n    ArrayIteratorPrototype.next === ArrayIteratorPrototypeNext\n  );\n}\n\n/**\n * @param {unknown} value\n * @returns {value is TypedArray}\n */\nexport function isOrdinaryNativeTypedArray(value) {\n  if (!isNativeTypedArray(value)) {\n    return false;\n  }\n\n  // Verify that there are no changes in ArrayIterator\n  return (\n    value[SymbolIterator] === NativeTypedArrayPrototypeSymbolIterator &&\n    ArrayIteratorPrototype.next === ArrayIteratorPrototypeNext\n  );\n}\n\n/**\n * @param {unknown} value\n * @returns {value is string}\n */\nexport function isCanonicalIntegerIndexString(value) {\n  if (typeof value !== \"string\") {\n    return false;\n  }\n\n  const number = +value;\n  if (value !== number + \"\") {\n    return false;\n  }\n\n  if (!NumberIsFinite(number)) {\n    return false;\n  }\n\n  return number === MathTrunc(number);\n}\n", "import { isObject, isObjectLike } from \"./is.mjs\";\nimport { THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT } from \"./messages.mjs\";\nimport { NativeTypeError, ReflectGetPrototypeOf, ReflectHas, SymbolFor } from \"./primordials.mjs\";\n\nexport const brand = SymbolFor(\"__Float16Array__\");\n\n/**\n * @param {unknown} target\n * @throws {TypeError}\n * @returns {boolean}\n */\nexport function hasFloat16ArrayBrand(target) {\n  if (!isObjectLike(target)) {\n    return false;\n  }\n\n  const prototype = ReflectGetPrototypeOf(target);\n  if (!isObjectLike(prototype)) {\n    return false;\n  }\n\n  const constructor = prototype.constructor;\n  if (constructor === undefined) {\n    return false;\n  }\n  if (!isObject(constructor)) {\n    throw NativeTypeError(THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT);\n  }\n\n  return ReflectHas(constructor, brand);\n}\n", "import {\n  EPSILON,\n  MathAbs,\n  NativeArrayBuffer,\n  NativeFloat32Array,\n  NativeUint16Array,\n  NativeUint32Array,\n  NativeUint8Array,\n  NumberIsFinite,\n  NumberIsNaN,\n} from \"./primordials.mjs\";\n\nconst INVERSE_OF_EPSILON = 1 / EPSILON;\n\n/**\n * rounds to the nearest value;\n * if the number falls midway, it is rounded to the nearest value with an even least significant digit\n * @param {number} num\n * @returns {number}\n */\nfunction roundTiesToEven(num) {\n  return (num + INVERSE_OF_EPSILON) - INVERSE_OF_EPSILON;\n}\n\nconst FLOAT16_MIN_VALUE = 6.103515625e-05;\nconst FLOAT16_MAX_VALUE = 65504;\nconst FLOAT16_EPSILON = 0.0009765625;\n\nconst FLOAT16_EPSILON_MULTIPLIED_BY_FLOAT16_MIN_VALUE = FLOAT16_EPSILON * FLOAT16_MIN_VALUE;\nconst FLOAT16_EPSILON_DEVIDED_BY_EPSILON = FLOAT16_EPSILON * INVERSE_OF_EPSILON;\n\n/**\n * round a number to a half float number\n * @param {unknown} num - double float\n * @returns {number} half float number\n */\nexport function roundToFloat16(num) {\n  const number = +num;\n\n  // NaN, Infinity, -Infinity, 0, -0\n  if (!NumberIsFinite(number) || number === 0) {\n    return number;\n  }\n\n  // finite except 0, -0\n  const sign = number > 0 ? 1 : -1;\n  const absolute = MathAbs(number);\n\n  // small number\n  if (absolute < FLOAT16_MIN_VALUE) {\n    return sign * roundTiesToEven(absolute / FLOAT16_EPSILON_MULTIPLIED_BY_FLOAT16_MIN_VALUE) * FLOAT16_EPSILON_MULTIPLIED_BY_FLOAT16_MIN_VALUE;\n  }\n\n  const temp = (1 + FLOAT16_EPSILON_DEVIDED_BY_EPSILON) * absolute;\n  const result = temp - (temp - absolute);\n\n  // large number\n  if (result > FLOAT16_MAX_VALUE || NumberIsNaN(result)) {\n    return sign * Infinity;\n  }\n\n  return sign * result;\n}\n\n// base algorithm: http://fox-toolkit.org/ftp/fasthalffloatconversion.pdf\n\nconst buffer = new NativeArrayBuffer(4);\nconst floatView = new NativeFloat32Array(buffer);\nconst uint32View = new NativeUint32Array(buffer);\n\nconst baseTable = new NativeUint16Array(512);\nconst shiftTable = new NativeUint8Array(512);\n\nfor (let i = 0; i < 256; ++i) {\n  const e = i - 127;\n\n  // very small number (0, -0)\n  if (e < -24) {\n    baseTable[i]         = 0x0000;\n    baseTable[i | 0x100] = 0x8000;\n    shiftTable[i]         = 24;\n    shiftTable[i | 0x100] = 24;\n\n  // small number (denorm)\n  } else if (e < -14) {\n    baseTable[i]         =  0x0400 >> (-e - 14);\n    baseTable[i | 0x100] = (0x0400 >> (-e - 14)) | 0x8000;\n    shiftTable[i]         = -e - 1;\n    shiftTable[i | 0x100] = -e - 1;\n\n  // normal number\n  } else if (e <= 15) {\n    baseTable[i]         =  (e + 15) << 10;\n    baseTable[i | 0x100] = ((e + 15) << 10) | 0x8000;\n    shiftTable[i]         = 13;\n    shiftTable[i | 0x100] = 13;\n\n  // large number (Infinity, -Infinity)\n  } else if (e < 128) {\n    baseTable[i]         = 0x7c00;\n    baseTable[i | 0x100] = 0xfc00;\n    shiftTable[i]         = 24;\n    shiftTable[i | 0x100] = 24;\n\n  // stay (NaN, Infinity, -Infinity)\n  } else {\n    baseTable[i]         = 0x7c00;\n    baseTable[i | 0x100] = 0xfc00;\n    shiftTable[i]         = 13;\n    shiftTable[i | 0x100] = 13;\n  }\n}\n\n/**\n * round a number to a half float number bits\n * @param {unknown} num - double float\n * @returns {number} half float number bits\n */\nexport function roundToFloat16Bits(num) {\n  floatView[0] = roundToFloat16(num);\n  const f = uint32View[0];\n  const e = (f >> 23) & 0x1ff;\n  return baseTable[e] + ((f & 0x007fffff) >> shiftTable[e]);\n}\n\nconst mantissaTable = new NativeUint32Array(2048);\nfor (let i = 1; i < 1024; ++i) {\n  let m = i << 13; // zero pad mantissa bits\n  let e = 0; // zero exponent\n\n  // normalized\n  while ((m & 0x00800000) === 0) {\n    m <<= 1;\n    e -= 0x00800000; // decrement exponent\n  }\n\n  m &= ~0x00800000; // clear leading 1 bit\n  e += 0x38800000; // adjust bias\n\n  mantissaTable[i] = m | e;\n}\nfor (let i = 1024; i < 2048; ++i) {\n  mantissaTable[i] = 0x38000000 + ((i - 1024) << 13);\n}\n\nconst exponentTable = new NativeUint32Array(64);\nfor (let i = 1; i < 31; ++i) {\n  exponentTable[i] = i << 23;\n}\nexponentTable[31] = 0x47800000;\nexponentTable[32] = 0x80000000;\nfor (let i = 33; i < 63; ++i) {\n  exponentTable[i] = 0x80000000 + ((i - 32) << 23);\n}\nexponentTable[63] = 0xc7800000;\n\nconst offsetTable = new NativeUint16Array(64);\nfor (let i = 1; i < 64; ++i) {\n  if (i !== 32) {\n    offsetTable[i] = 1024;\n  }\n}\n\n/**\n * convert a half float number bits to a number\n * @param {number} float16bits - half float number bits\n * @returns {number} double float\n */\nexport function convertToNumber(float16bits) {\n  const i = float16bits >> 10;\n  uint32View[0] = mantissaTable[offsetTable[i] + (float16bits & 0x3ff)] + exponentTable[i];\n  return floatView[0];\n}\n", "import { isObject, isSharedArrayBuffer } from \"./is.mjs\";\nimport {\n  THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT,\n  THIS_IS_NOT_AN_OBJECT,\n} from \"./messages.mjs\";\nimport {\n  ArrayBufferPrototypeSlice,\n  MAX_SAFE_INTEGER,\n  MathTrunc,\n  NativeTypeError,\n  NumberIsNaN,\n  ObjectIs,\n  SymbolSpecies,\n} from \"./primordials.mjs\";\n\n/**\n * @see https://tc39.es/ecma262/#sec-tointegerorinfinity\n * @param {unknown} target\n * @returns {number}\n */\nexport function ToIntegerOrInfinity(target) {\n  const number = +target;\n\n  if (NumberIsNaN(number) || number === 0) {\n    return 0;\n  }\n\n  return MathTrunc(number);\n}\n\n/**\n * @see https://tc39.es/ecma262/#sec-tolength\n * @param {unknown} target\n * @returns {number}\n */\nexport function ToLength(target) {\n  const length = ToIntegerOrInfinity(target);\n  if (length < 0) {\n    return 0;\n  }\n\n  return length < MAX_SAFE_INTEGER\n    ? length\n    : MAX_SAFE_INTEGER;\n}\n\n/**\n * @see https://tc39.es/ecma262/#sec-speciesconstructor\n * @param {object} target\n * @param {{ new(...args: any[]): any; }} defaultConstructor\n * @returns {{ new(...args: any[]): any; }}\n */\nexport function SpeciesConstructor(target, defaultConstructor) {\n  if (!isObject(target)) {\n    throw NativeTypeError(THIS_IS_NOT_AN_OBJECT);\n  }\n\n  const constructor = target.constructor;\n  if (constructor === undefined) {\n    return defaultConstructor;\n  }\n  if (!isObject(constructor)) {\n    throw NativeTypeError(THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT);\n  }\n\n  const species = constructor[SymbolSpecies];\n  if (species == null) {\n    return defaultConstructor;\n  }\n\n  return species;\n}\n\n/**\n * @see https://tc39.es/ecma262/#sec-isdetachedbuffer\n * @param {ArrayBufferLike} buffer\n * @returns {boolean}\n */\nexport function IsDetachedBuffer(buffer) {\n  if (isSharedArrayBuffer(buffer)) {\n    return false;\n  }\n\n  try {\n    ArrayBufferPrototypeSlice(buffer, 0, 0);\n    return false;\n  } catch (e) {/* empty */}\n\n  return true;\n}\n\n/**\n * bigint comparisons are not supported\n * @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.sort\n * @param {number} x\n * @param {number} y\n * @returns {-1 | 0 | 1}\n */\nexport function defaultCompare(x, y) {\n  const isXNaN = NumberIsNaN(x);\n  const isYNaN = NumberIsNaN(y);\n\n  if (isXNaN && isYNaN) {\n    return 0;\n  }\n\n  if (isXNaN) {\n    return 1;\n  }\n\n  if (isYNaN) {\n    return -1;\n  }\n\n  if (x < y) {\n    return -1;\n  }\n\n  if (x > y) {\n    return 1;\n  }\n\n  if (x === 0 && y === 0) {\n    const isXPlusZero = ObjectIs(x, 0);\n    const isYPlusZero = ObjectIs(y, 0);\n\n    if (!isXPlusZero && isYPlusZero) {\n      return -1;\n    }\n\n    if (isXPlusZero && !isYPlusZero) {\n      return 1;\n    }\n  }\n\n  return 0;\n}\n", "import { safeIfNeeded, wrap } from \"./_util/arrayIterator.mjs\";\nimport { brand, hasFloat16ArrayBrand } from \"./_util/brand.mjs\";\nimport { convertToNumber, roundToFloat16Bits } from \"./_util/converter.mjs\";\nimport {\n  isAnyArrayBuffer,\n  isCanonicalIntegerIndexString,\n  isNativeBigIntTypedArray,\n  isNativeTypedArray,\n  isObject,\n  isOrdinaryArray,\n  isOrdinaryNativeTypedArray,\n} from \"./_util/is.mjs\";\nimport {\n  ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER,\n  CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT,\n  CANNOT_MIX_BIGINT_AND_OTHER_TYPES,\n  DERIVED_CONSTRUCTOR_CREATED_TYPEDARRAY_OBJECT_WHICH_WAS_TOO_SMALL_LENGTH,\n  ITERATOR_PROPERTY_IS_NOT_CALLABLE,\n  OFFSET_IS_OUT_OF_BOUNDS,\n  REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE,\n  SPECIES_CONSTRUCTOR_DIDNT_RETURN_TYPEDARRAY_OBJECT,\n  THE_COMPARISON_FUNCTION_MUST_BE_EITHER_A_FUNCTION_OR_UNDEFINED,\n  THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY,\n  THIS_IS_NOT_A_FLOAT16ARRAY_OBJECT,\n} from \"./_util/messages.mjs\";\nimport {\n  ArrayBufferIsView,\n  ArrayPrototypeJoin,\n  ArrayPrototypePush,\n  ArrayPrototypeToLocaleString,\n  NativeArrayBuffer,\n  NativeObject,\n  NativeProxy,\n  NativeRangeError,\n  NativeTypeError,\n  NativeUint16Array,\n  NativeWeakMap,\n  NativeWeakSet,\n  NumberIsNaN,\n  ObjectDefineProperty,\n  ObjectFreeze,\n  ObjectHasOwn,\n  ObjectPrototype__lookupGetter__,\n  ReflectApply,\n  ReflectConstruct,\n  ReflectDefineProperty,\n  ReflectGet,\n  ReflectGetOwnPropertyDescriptor,\n  ReflectHas,\n  ReflectOwnKeys,\n  ReflectSet,\n  ReflectSetPrototypeOf,\n  SymbolIterator,\n  SymbolToStringTag,\n  TypedArray,\n  TypedArrayPrototype,\n  TypedArrayPrototypeCopyWithin,\n  TypedArrayPrototypeEntries,\n  TypedArrayPrototypeFill,\n  TypedArrayPrototypeGetBuffer,\n  TypedArrayPrototypeGetByteOffset,\n  TypedArrayPrototypeGetLength,\n  TypedArrayPrototypeKeys,\n  TypedArrayPrototypeReverse,\n  TypedArrayPrototypeSet,\n  TypedArrayPrototypeSlice,\n  TypedArrayPrototypeSort,\n  TypedArrayPrototypeSubarray,\n  TypedArrayPrototypeValues,\n  Uint16ArrayFrom,\n  WeakMapPrototypeGet,\n  WeakMapPrototypeHas,\n  WeakMapPrototypeSet,\n  WeakSetPrototypeAdd,\n  WeakSetPrototypeHas,\n} from \"./_util/primordials.mjs\";\nimport {\n  IsDetachedBuffer,\n  SpeciesConstructor,\n  ToIntegerOrInfinity,\n  ToLength,\n  defaultCompare,\n} from \"./_util/spec.mjs\";\n\nconst BYTES_PER_ELEMENT = 2;\n\n/** @typedef {Uint16Array & { __float16bits: never }} Float16BitsArray */\n\n/** @type {WeakMap<Float16Array, Float16BitsArray>} */\nconst float16bitsArrays = new NativeWeakMap();\n\n/**\n * @param {unknown} target\n * @returns {target is Float16Array}\n */\nexport function isFloat16Array(target) {\n  return WeakMapPrototypeHas(float16bitsArrays, target) ||\n    (!ArrayBufferIsView(target) && hasFloat16ArrayBrand(target));\n}\n\n/**\n * @param {unknown} target\n * @throws {TypeError}\n * @returns {asserts target is Float16Array}\n */\nfunction assertFloat16Array(target) {\n  if (!isFloat16Array(target)) {\n    throw NativeTypeError(THIS_IS_NOT_A_FLOAT16ARRAY_OBJECT);\n  }\n}\n\n/**\n * @param {unknown} target\n * @param {number=} count\n * @throws {TypeError}\n * @returns {asserts target is Uint8Array|Uint8ClampedArray|Uint16Array|Uint32Array|Int8Array|Int16Array|Int32Array|Float16Array|Float32Array|Float64Array}\n */\nfunction assertSpeciesTypedArray(target, count) {\n  const isTargetFloat16Array = isFloat16Array(target);\n  const isTargetTypedArray = isNativeTypedArray(target);\n\n  if (!isTargetFloat16Array && !isTargetTypedArray) {\n    throw NativeTypeError(SPECIES_CONSTRUCTOR_DIDNT_RETURN_TYPEDARRAY_OBJECT);\n  }\n\n  if (typeof count === \"number\") {\n    let length;\n    if (isTargetFloat16Array) {\n      const float16bitsArray = getFloat16BitsArray(target);\n      length = TypedArrayPrototypeGetLength(float16bitsArray);\n    } else {\n      length = TypedArrayPrototypeGetLength(target);\n    }\n\n    if (length < count) {\n      throw NativeTypeError(\n        DERIVED_CONSTRUCTOR_CREATED_TYPEDARRAY_OBJECT_WHICH_WAS_TOO_SMALL_LENGTH\n      );\n    }\n  }\n\n  if (isNativeBigIntTypedArray(target)) {\n    throw NativeTypeError(CANNOT_MIX_BIGINT_AND_OTHER_TYPES);\n  }\n}\n\n/**\n * @param {Float16Array} float16\n * @throws {TypeError}\n * @returns {Float16BitsArray}\n */\nfunction getFloat16BitsArray(float16) {\n  const float16bitsArray = WeakMapPrototypeGet(float16bitsArrays, float16);\n  if (float16bitsArray !== undefined) {\n    const buffer = TypedArrayPrototypeGetBuffer(float16bitsArray);\n\n    if (IsDetachedBuffer(buffer)) {\n      throw NativeTypeError(ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);\n    }\n\n    return float16bitsArray;\n  }\n\n  // from another Float16Array instance (a different version?)\n  const buffer = /** @type {any} */ (float16).buffer;\n\n  if (IsDetachedBuffer(buffer)) {\n    throw NativeTypeError(ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);\n  }\n\n  const cloned = ReflectConstruct(Float16Array, [\n    buffer,\n    /** @type {any} */ (float16).byteOffset,\n    /** @type {any} */ (float16).length,\n  ], float16.constructor);\n  return WeakMapPrototypeGet(float16bitsArrays, cloned);\n}\n\n/**\n * @param {Float16BitsArray} float16bitsArray\n * @returns {number[]}\n */\nfunction copyToArray(float16bitsArray) {\n  const length = TypedArrayPrototypeGetLength(float16bitsArray);\n\n  const array = [];\n  for (let i = 0; i < length; ++i) {\n    array[i] = convertToNumber(float16bitsArray[i]);\n  }\n\n  return array;\n}\n\n/** @type {WeakSet<Function>} */\nconst TypedArrayPrototypeGetters = new NativeWeakSet();\nfor (const key of ReflectOwnKeys(TypedArrayPrototype)) {\n  // @@toStringTag getter property is defined in Float16Array.prototype\n  if (key === SymbolToStringTag) {\n    continue;\n  }\n\n  const descriptor = ReflectGetOwnPropertyDescriptor(TypedArrayPrototype, key);\n  if (ObjectHasOwn(descriptor, \"get\") && typeof descriptor.get === \"function\") {\n    WeakSetPrototypeAdd(TypedArrayPrototypeGetters, descriptor.get);\n  }\n}\n\nconst handler = ObjectFreeze(/** @type {ProxyHandler<Float16BitsArray>} */ ({\n  get(target, key, receiver) {\n    if (isCanonicalIntegerIndexString(key) && ObjectHasOwn(target, key)) {\n      return convertToNumber(ReflectGet(target, key));\n    }\n\n    // %TypedArray%.prototype getter properties cannot called by Proxy receiver\n    if (WeakSetPrototypeHas(TypedArrayPrototypeGetters, ObjectPrototype__lookupGetter__(target, key))) {\n      return ReflectGet(target, key);\n    }\n\n    return ReflectGet(target, key, receiver);\n  },\n\n  set(target, key, value, receiver) {\n    if (isCanonicalIntegerIndexString(key) && ObjectHasOwn(target, key)) {\n      return ReflectSet(target, key, roundToFloat16Bits(value));\n    }\n\n    return ReflectSet(target, key, value, receiver);\n  },\n\n  getOwnPropertyDescriptor(target, key) {\n    if (isCanonicalIntegerIndexString(key) && ObjectHasOwn(target, key)) {\n      const descriptor = ReflectGetOwnPropertyDescriptor(target, key);\n      descriptor.value = convertToNumber(descriptor.value);\n      return descriptor;\n    }\n\n    return ReflectGetOwnPropertyDescriptor(target, key);\n  },\n\n  defineProperty(target, key, descriptor) {\n    if (\n      isCanonicalIntegerIndexString(key) &&\n      ObjectHasOwn(target, key) &&\n      ObjectHasOwn(descriptor, \"value\")\n    ) {\n      descriptor.value = roundToFloat16Bits(descriptor.value);\n      return ReflectDefineProperty(target, key, descriptor);\n    }\n\n    return ReflectDefineProperty(target, key, descriptor);\n  },\n}));\n\nexport class Float16Array {\n  /** @see https://tc39.es/ecma262/#sec-typedarray */\n  constructor(input, _byteOffset, _length) {\n    /** @type {Float16BitsArray} */\n    let float16bitsArray;\n\n    if (isFloat16Array(input)) {\n      float16bitsArray = ReflectConstruct(NativeUint16Array, [getFloat16BitsArray(input)], new.target);\n    } else if (isObject(input) && !isAnyArrayBuffer(input)) { // object without ArrayBuffer, SharedArrayBuffer\n      /** @type {ArrayLike<unknown>} */\n      let list;\n      /** @type {number} */\n      let length;\n\n      if (isNativeTypedArray(input)) { // TypedArray\n        list = input;\n        length = TypedArrayPrototypeGetLength(input);\n\n        const buffer = TypedArrayPrototypeGetBuffer(input);\n\n        if (IsDetachedBuffer(buffer)) {\n          throw NativeTypeError(ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);\n        }\n\n        if (isNativeBigIntTypedArray(input)) {\n          throw NativeTypeError(CANNOT_MIX_BIGINT_AND_OTHER_TYPES);\n        }\n\n        const data = new NativeArrayBuffer(\n          length * BYTES_PER_ELEMENT\n        );\n        float16bitsArray = ReflectConstruct(NativeUint16Array, [data], new.target);\n      } else {\n        const iterator = input[SymbolIterator];\n        if (iterator != null && typeof iterator !== \"function\") {\n          throw NativeTypeError(ITERATOR_PROPERTY_IS_NOT_CALLABLE);\n        }\n\n        if (iterator != null) { // Iterable (Array)\n          // for optimization\n          if (isOrdinaryArray(input)) {\n            list = input;\n            length = input.length;\n          } else {\n            // eslint-disable-next-line no-restricted-syntax\n            list = [... /** @type {Iterable<unknown>} */ (input)];\n            length = list.length;\n          }\n        } else { // ArrayLike\n          list = /** @type {ArrayLike<unknown>} */ (input);\n          length = ToLength(list.length);\n        }\n        float16bitsArray = ReflectConstruct(NativeUint16Array, [length], new.target);\n      }\n\n      // set values\n      for (let i = 0; i < length; ++i) {\n        float16bitsArray[i] = roundToFloat16Bits(list[i]);\n      }\n    } else { // primitive, ArrayBuffer, SharedArrayBuffer\n      float16bitsArray = ReflectConstruct(NativeUint16Array, arguments, new.target);\n    }\n\n    /** @type {Float16Array} */\n    const proxy = /** @type {any} */ (new NativeProxy(float16bitsArray, handler));\n\n    // proxy private storage\n    WeakMapPrototypeSet(float16bitsArrays, proxy, float16bitsArray);\n\n    return proxy;\n  }\n\n  /**\n   * limitation: `Object.getOwnPropertyNames(Float16Array)` or `Reflect.ownKeys(Float16Array)` include this key\n   * @see https://tc39.es/ecma262/#sec-%typedarray%.from\n   */\n  static from(src, ...opts) {\n    const Constructor = this;\n\n    if (!ReflectHas(Constructor, brand)) {\n      throw NativeTypeError(\n        THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY\n      );\n    }\n\n    // for optimization\n    if (Constructor === Float16Array) {\n      if (isFloat16Array(src) && opts.length === 0) {\n        const float16bitsArray = getFloat16BitsArray(src);\n        const uint16 = new NativeUint16Array(\n          TypedArrayPrototypeGetBuffer(float16bitsArray),\n          TypedArrayPrototypeGetByteOffset(float16bitsArray),\n          TypedArrayPrototypeGetLength(float16bitsArray)\n        );\n        return new Float16Array(\n          TypedArrayPrototypeGetBuffer(TypedArrayPrototypeSlice(uint16))\n        );\n      }\n\n      if (opts.length === 0) {\n        return new Float16Array(\n          TypedArrayPrototypeGetBuffer(\n            Uint16ArrayFrom(src, roundToFloat16Bits)\n          )\n        );\n      }\n\n      const mapFunc = opts[0];\n      const thisArg = opts[1];\n\n      return new Float16Array(\n        TypedArrayPrototypeGetBuffer(\n          Uint16ArrayFrom(src, function (val, ...args) {\n            return roundToFloat16Bits(\n              ReflectApply(mapFunc, this, [val, ...safeIfNeeded(args)])\n            );\n          }, thisArg)\n        )\n      );\n    }\n\n    /** @type {ArrayLike<unknown>} */\n    let list;\n    /** @type {number} */\n    let length;\n\n    const iterator = src[SymbolIterator];\n    if (iterator != null && typeof iterator !== \"function\") {\n      throw NativeTypeError(ITERATOR_PROPERTY_IS_NOT_CALLABLE);\n    }\n\n    if (iterator != null) { // Iterable (TypedArray, Array)\n      // for optimization\n      if (isOrdinaryArray(src)) {\n        list = src;\n        length = src.length;\n      } else if (isOrdinaryNativeTypedArray(src)) {\n        list = src;\n        length = TypedArrayPrototypeGetLength(src);\n      } else {\n        // eslint-disable-next-line no-restricted-syntax\n        list = [...src];\n        length = list.length;\n      }\n    } else { // ArrayLike\n      if (src == null) {\n        throw NativeTypeError(\n          CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT\n        );\n      }\n      list = NativeObject(src);\n      length = ToLength(list.length);\n    }\n\n    const array = new Constructor(length);\n\n    if (opts.length === 0) {\n      for (let i = 0; i < length; ++i) {\n        array[i] = /** @type {number} */ (list[i]);\n      }\n    } else {\n      const mapFunc = opts[0];\n      const thisArg = opts[1];\n      for (let i = 0; i < length; ++i) {\n        array[i] = ReflectApply(mapFunc, thisArg, [list[i], i]);\n      }\n    }\n\n    return array;\n  }\n\n  /**\n   * limitation: `Object.getOwnPropertyNames(Float16Array)` or `Reflect.ownKeys(Float16Array)` include this key\n   * @see https://tc39.es/ecma262/#sec-%typedarray%.of\n   */\n  static of(...items) {\n    const Constructor = this;\n\n    if (!ReflectHas(Constructor, brand)) {\n      throw NativeTypeError(\n        THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY\n      );\n    }\n\n    const length = items.length;\n\n    // for optimization\n    if (Constructor === Float16Array) {\n      const proxy = new Float16Array(length);\n      const float16bitsArray = getFloat16BitsArray(proxy);\n\n      for (let i = 0; i < length; ++i) {\n        float16bitsArray[i] = roundToFloat16Bits(items[i]);\n      }\n\n      return proxy;\n    }\n\n    const array = new Constructor(length);\n\n    for (let i = 0; i < length; ++i) {\n      array[i] = items[i];\n    }\n\n    return array;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.keys */\n  keys() {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    return TypedArrayPrototypeKeys(float16bitsArray);\n  }\n\n  /**\n   * limitation: returns a object whose prototype is not `%ArrayIteratorPrototype%`\n   * @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.values\n   */\n  values() {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    return wrap((function* () {\n      // eslint-disable-next-line no-restricted-syntax\n      for (const val of TypedArrayPrototypeValues(float16bitsArray)) {\n        yield convertToNumber(val);\n      }\n    })());\n  }\n\n  /**\n   * limitation: returns a object whose prototype is not `%ArrayIteratorPrototype%`\n   * @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.entries\n   */\n  entries() {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    return wrap((function* () {\n      // eslint-disable-next-line no-restricted-syntax\n      for (const [i, val] of TypedArrayPrototypeEntries(float16bitsArray)) {\n        yield /** @type {[number, number]} */ ([i, convertToNumber(val)]);\n      }\n    })());\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.at */\n  at(index) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const relativeIndex = ToIntegerOrInfinity(index);\n    const k = relativeIndex >= 0 ? relativeIndex : length + relativeIndex;\n\n    if (k < 0 || k >= length) {\n      return;\n    }\n\n    return convertToNumber(float16bitsArray[k]);\n  }\n\n  /** @see https://tc39.es/proposal-change-array-by-copy/#sec-%typedarray%.prototype.with */\n  with(index, value) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const relativeIndex = ToIntegerOrInfinity(index);\n    const k = relativeIndex >= 0 ? relativeIndex : length + relativeIndex;\n\n    const number = +value;\n\n    if (k < 0 || k >= length) {\n      throw NativeRangeError(OFFSET_IS_OUT_OF_BOUNDS);\n    }\n\n    // don't use SpeciesConstructor\n    const uint16 = new NativeUint16Array(\n      TypedArrayPrototypeGetBuffer(float16bitsArray),\n      TypedArrayPrototypeGetByteOffset(float16bitsArray),\n      TypedArrayPrototypeGetLength(float16bitsArray)\n    );\n    const cloned = new Float16Array(\n      TypedArrayPrototypeGetBuffer(\n        TypedArrayPrototypeSlice(uint16)\n      )\n    );\n    const array = getFloat16BitsArray(cloned);\n\n    array[k] = roundToFloat16Bits(number);\n\n    return cloned;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.map */\n  map(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const thisArg = opts[0];\n\n    const Constructor = SpeciesConstructor(float16bitsArray, Float16Array);\n\n    // for optimization\n    if (Constructor === Float16Array) {\n      const proxy = new Float16Array(length);\n      const array = getFloat16BitsArray(proxy);\n\n      for (let i = 0; i < length; ++i) {\n        const val = convertToNumber(float16bitsArray[i]);\n        array[i] = roundToFloat16Bits(\n          ReflectApply(callback, thisArg, [val, i, this])\n        );\n      }\n\n      return proxy;\n    }\n\n    const array = new Constructor(length);\n    assertSpeciesTypedArray(array, length);\n\n    for (let i = 0; i < length; ++i) {\n      const val = convertToNumber(float16bitsArray[i]);\n      array[i] = ReflectApply(callback, thisArg, [val, i, this]);\n    }\n\n    return /** @type {any} */ (array);\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.filter */\n  filter(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const thisArg = opts[0];\n\n    const kept = [];\n    for (let i = 0; i < length; ++i) {\n      const val = convertToNumber(float16bitsArray[i]);\n      if (ReflectApply(callback, thisArg, [val, i, this])) {\n        ArrayPrototypePush(kept, val);\n      }\n    }\n\n    const Constructor = SpeciesConstructor(float16bitsArray, Float16Array);\n    const array = new Constructor(kept);\n    assertSpeciesTypedArray(array);\n\n    return /** @type {any} */ (array);\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.reduce */\n  reduce(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    if (length === 0 && opts.length === 0) {\n      throw NativeTypeError(REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE);\n    }\n\n    let accumulator, start;\n    if (opts.length === 0) {\n      accumulator = convertToNumber(float16bitsArray[0]);\n      start = 1;\n    } else {\n      accumulator = opts[0];\n      start = 0;\n    }\n\n    for (let i = start; i < length; ++i) {\n      accumulator = callback(\n        accumulator,\n        convertToNumber(float16bitsArray[i]),\n        i,\n        this\n      );\n    }\n\n    return accumulator;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.reduceright */\n  reduceRight(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    if (length === 0 && opts.length === 0) {\n      throw NativeTypeError(REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE);\n    }\n\n    let accumulator, start;\n    if (opts.length === 0) {\n      accumulator = convertToNumber(float16bitsArray[length - 1]);\n      start = length - 2;\n    } else {\n      accumulator = opts[0];\n      start = length - 1;\n    }\n\n    for (let i = start; i >= 0; --i) {\n      accumulator = callback(\n        accumulator,\n        convertToNumber(float16bitsArray[i]),\n        i,\n        this\n      );\n    }\n\n    return accumulator;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.foreach */\n  forEach(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const thisArg = opts[0];\n\n    for (let i = 0; i < length; ++i) {\n      ReflectApply(callback, thisArg, [\n        convertToNumber(float16bitsArray[i]),\n        i,\n        this,\n      ]);\n    }\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.find */\n  find(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const thisArg = opts[0];\n\n    for (let i = 0; i < length; ++i) {\n      const value = convertToNumber(float16bitsArray[i]);\n      if (ReflectApply(callback, thisArg, [value, i, this])) {\n        return value;\n      }\n    }\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.findindex */\n  findIndex(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const thisArg = opts[0];\n\n    for (let i = 0; i < length; ++i) {\n      const value = convertToNumber(float16bitsArray[i]);\n      if (ReflectApply(callback, thisArg, [value, i, this])) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  /** @see https://tc39.es/proposal-array-find-from-last/index.html#sec-%typedarray%.prototype.findlast */\n  findLast(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const thisArg = opts[0];\n\n    for (let i = length - 1; i >= 0; --i) {\n      const value = convertToNumber(float16bitsArray[i]);\n      if (ReflectApply(callback, thisArg, [value, i, this])) {\n        return value;\n      }\n    }\n  }\n\n  /** @see https://tc39.es/proposal-array-find-from-last/index.html#sec-%typedarray%.prototype.findlastindex */\n  findLastIndex(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const thisArg = opts[0];\n\n    for (let i = length - 1; i >= 0; --i) {\n      const value = convertToNumber(float16bitsArray[i]);\n      if (ReflectApply(callback, thisArg, [value, i, this])) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.every */\n  every(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const thisArg = opts[0];\n\n    for (let i = 0; i < length; ++i) {\n      if (\n        !ReflectApply(callback, thisArg, [\n          convertToNumber(float16bitsArray[i]),\n          i,\n          this,\n        ])\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.some */\n  some(callback, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const thisArg = opts[0];\n\n    for (let i = 0; i < length; ++i) {\n      if (\n        ReflectApply(callback, thisArg, [\n          convertToNumber(float16bitsArray[i]),\n          i,\n          this,\n        ])\n      ) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.set */\n  set(input, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const targetOffset = ToIntegerOrInfinity(opts[0]);\n    if (targetOffset < 0) {\n      throw NativeRangeError(OFFSET_IS_OUT_OF_BOUNDS);\n    }\n\n    if (input == null) {\n      throw NativeTypeError(\n        CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT\n      );\n    }\n\n    if (isNativeBigIntTypedArray(input)) {\n      throw NativeTypeError(\n        CANNOT_MIX_BIGINT_AND_OTHER_TYPES\n      );\n    }\n\n    // for optimization\n    if (isFloat16Array(input)) {\n      // peel off Proxy\n      return TypedArrayPrototypeSet(\n        getFloat16BitsArray(this),\n        getFloat16BitsArray(input),\n        targetOffset\n      );\n    }\n\n    if (isNativeTypedArray(input)) {\n      const buffer = TypedArrayPrototypeGetBuffer(input);\n      if (IsDetachedBuffer(buffer)) {\n        throw NativeTypeError(ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);\n      }\n    }\n\n    const targetLength = TypedArrayPrototypeGetLength(float16bitsArray);\n\n    const src = NativeObject(input);\n    const srcLength = ToLength(src.length);\n\n    if (targetOffset === Infinity || srcLength + targetOffset > targetLength) {\n      throw NativeRangeError(OFFSET_IS_OUT_OF_BOUNDS);\n    }\n\n    for (let i = 0; i < srcLength; ++i) {\n      float16bitsArray[i + targetOffset] = roundToFloat16Bits(src[i]);\n    }\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.reverse */\n  reverse() {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    TypedArrayPrototypeReverse(float16bitsArray);\n\n    return this;\n  }\n\n  /** @see https://tc39.es/proposal-change-array-by-copy/#sec-%typedarray%.prototype.toReversed */\n  toReversed() {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    // don't use SpeciesConstructor\n    const uint16 = new NativeUint16Array(\n      TypedArrayPrototypeGetBuffer(float16bitsArray),\n      TypedArrayPrototypeGetByteOffset(float16bitsArray),\n      TypedArrayPrototypeGetLength(float16bitsArray)\n    );\n    const cloned = new Float16Array(\n      TypedArrayPrototypeGetBuffer(\n        TypedArrayPrototypeSlice(uint16)\n      )\n    );\n\n    const clonedFloat16bitsArray = getFloat16BitsArray(cloned);\n    TypedArrayPrototypeReverse(clonedFloat16bitsArray);\n\n    return cloned;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.fill */\n  fill(value, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    TypedArrayPrototypeFill(\n      float16bitsArray,\n      roundToFloat16Bits(value),\n      ...safeIfNeeded(opts)\n    );\n\n    return this;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.copywithin */\n  copyWithin(target, start, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    TypedArrayPrototypeCopyWithin(float16bitsArray, target, start, ...safeIfNeeded(opts));\n\n    return this;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.sort */\n  sort(compareFn) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const sortCompare = compareFn !== undefined ? compareFn : defaultCompare;\n    TypedArrayPrototypeSort(float16bitsArray, (x, y) => {\n      return sortCompare(convertToNumber(x), convertToNumber(y));\n    });\n\n    return this;\n  }\n\n  /** @see https://tc39.es/proposal-change-array-by-copy/#sec-%typedarray%.prototype.toSorted */\n  toSorted(compareFn) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    if (compareFn !== undefined && typeof compareFn !== \"function\") {\n      throw new NativeTypeError(THE_COMPARISON_FUNCTION_MUST_BE_EITHER_A_FUNCTION_OR_UNDEFINED);\n    }\n    const sortCompare = compareFn !== undefined ? compareFn : defaultCompare;\n\n    // don't use SpeciesConstructor\n    const uint16 = new NativeUint16Array(\n      TypedArrayPrototypeGetBuffer(float16bitsArray),\n      TypedArrayPrototypeGetByteOffset(float16bitsArray),\n      TypedArrayPrototypeGetLength(float16bitsArray)\n    );\n    const cloned = new Float16Array(\n      TypedArrayPrototypeGetBuffer(\n        TypedArrayPrototypeSlice(uint16)\n      )\n    );\n\n    const clonedFloat16bitsArray = getFloat16BitsArray(cloned);\n    TypedArrayPrototypeSort(clonedFloat16bitsArray, (x, y) => {\n      return sortCompare(convertToNumber(x), convertToNumber(y));\n    });\n\n    return cloned;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.slice */\n  slice(start, end) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const Constructor = SpeciesConstructor(float16bitsArray, Float16Array);\n\n    // for optimization\n    if (Constructor === Float16Array) {\n      const uint16 = new NativeUint16Array(\n        TypedArrayPrototypeGetBuffer(float16bitsArray),\n        TypedArrayPrototypeGetByteOffset(float16bitsArray),\n        TypedArrayPrototypeGetLength(float16bitsArray)\n      );\n      return new Float16Array(\n        TypedArrayPrototypeGetBuffer(\n          TypedArrayPrototypeSlice(uint16, start, end)\n        )\n      );\n    }\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n    const relativeStart = ToIntegerOrInfinity(start);\n    const relativeEnd = end === undefined ? length : ToIntegerOrInfinity(end);\n\n    let k;\n    if (relativeStart === -Infinity) {\n      k = 0;\n    } else if (relativeStart < 0) {\n      k = length + relativeStart > 0 ? length + relativeStart : 0;\n    } else {\n      k = length < relativeStart ? length : relativeStart;\n    }\n\n    let final;\n    if (relativeEnd === -Infinity) {\n      final = 0;\n    } else if (relativeEnd < 0) {\n      final = length + relativeEnd > 0 ? length + relativeEnd : 0;\n    } else {\n      final = length < relativeEnd ? length : relativeEnd;\n    }\n\n    const count = final - k > 0 ? final - k : 0;\n    const array = new Constructor(count);\n    assertSpeciesTypedArray(array, count);\n\n    if (count === 0) {\n      return array;\n    }\n\n    const buffer = TypedArrayPrototypeGetBuffer(float16bitsArray);\n    if (IsDetachedBuffer(buffer)) {\n      throw NativeTypeError(ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);\n    }\n\n    let n = 0;\n    while (k < final) {\n      array[n] = convertToNumber(float16bitsArray[k]);\n      ++k;\n      ++n;\n    }\n\n    return /** @type {any} */ (array);\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.subarray */\n  subarray(begin, end) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const Constructor = SpeciesConstructor(float16bitsArray, Float16Array);\n\n    const uint16 = new NativeUint16Array(\n      TypedArrayPrototypeGetBuffer(float16bitsArray),\n      TypedArrayPrototypeGetByteOffset(float16bitsArray),\n      TypedArrayPrototypeGetLength(float16bitsArray)\n    );\n    const uint16Subarray = TypedArrayPrototypeSubarray(uint16, begin, end);\n\n    const array = new Constructor(\n      TypedArrayPrototypeGetBuffer(uint16Subarray),\n      TypedArrayPrototypeGetByteOffset(uint16Subarray),\n      TypedArrayPrototypeGetLength(uint16Subarray)\n    );\n    assertSpeciesTypedArray(array);\n\n    return /** @type {any} */ (array);\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.indexof */\n  indexOf(element, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n\n    let from = ToIntegerOrInfinity(opts[0]);\n    if (from === Infinity) {\n      return -1;\n    }\n\n    if (from < 0) {\n      from += length;\n      if (from < 0) {\n        from = 0;\n      }\n    }\n\n    for (let i = from; i < length; ++i) {\n      if (\n        ObjectHasOwn(float16bitsArray, i) &&\n        convertToNumber(float16bitsArray[i]) === element\n      ) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.lastindexof */\n  lastIndexOf(element, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n\n    let from = opts.length >= 1 ? ToIntegerOrInfinity(opts[0]) : length - 1;\n    if (from === -Infinity) {\n      return -1;\n    }\n\n    if (from >= 0) {\n      from = from < length - 1 ? from : length - 1;\n    } else {\n      from += length;\n    }\n\n    for (let i = from; i >= 0; --i) {\n      if (\n        ObjectHasOwn(float16bitsArray, i) &&\n        convertToNumber(float16bitsArray[i]) === element\n      ) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.includes */\n  includes(element, ...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const length = TypedArrayPrototypeGetLength(float16bitsArray);\n\n    let from = ToIntegerOrInfinity(opts[0]);\n    if (from === Infinity) {\n      return false;\n    }\n\n    if (from < 0) {\n      from += length;\n      if (from < 0) {\n        from = 0;\n      }\n    }\n\n    const isNaN = NumberIsNaN(element);\n    for (let i = from; i < length; ++i) {\n      const value = convertToNumber(float16bitsArray[i]);\n\n      if (isNaN && NumberIsNaN(value)) {\n        return true;\n      }\n\n      if (value === element) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.join */\n  join(separator) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const array = copyToArray(float16bitsArray);\n\n    return ArrayPrototypeJoin(array, separator);\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype.tolocalestring */\n  toLocaleString(...opts) {\n    assertFloat16Array(this);\n    const float16bitsArray = getFloat16BitsArray(this);\n\n    const array = copyToArray(float16bitsArray);\n\n    return ArrayPrototypeToLocaleString(array, ...safeIfNeeded(opts));\n  }\n\n  /** @see https://tc39.es/ecma262/#sec-get-%typedarray%.prototype-@@tostringtag */\n  get [SymbolToStringTag]() {\n    if (isFloat16Array(this)) {\n      return /** @type {any} */ (\"Float16Array\");\n    }\n  }\n}\n\n/** @see https://tc39.es/ecma262/#sec-typedarray.bytes_per_element */\nObjectDefineProperty(Float16Array, \"BYTES_PER_ELEMENT\", {\n  value: BYTES_PER_ELEMENT,\n});\n\n// limitation: It is peaked by `Object.getOwnPropertySymbols(Float16Array)` and `Reflect.ownKeys(Float16Array)`\nObjectDefineProperty(Float16Array, brand, {});\n\n/** @see https://tc39.es/ecma262/#sec-properties-of-the-typedarray-constructors */\nReflectSetPrototypeOf(Float16Array, TypedArray);\n\nconst Float16ArrayPrototype = Float16Array.prototype;\n\n/** @see https://tc39.es/ecma262/#sec-typedarray.prototype.bytes_per_element */\nObjectDefineProperty(Float16ArrayPrototype, \"BYTES_PER_ELEMENT\", {\n  value: BYTES_PER_ELEMENT,\n});\n\n/** @see https://tc39.es/ecma262/#sec-%typedarray%.prototype-@@iterator */\nObjectDefineProperty(Float16ArrayPrototype, SymbolIterator, {\n  value: Float16ArrayPrototype.values,\n  writable: true,\n  configurable: true,\n});\n\nReflectSetPrototypeOf(Float16ArrayPrototype, TypedArrayPrototype);\n", "import { isFloat16Array } from \"./Float16Array.mjs\";\nimport { isNativeTypedArray } from \"./_util/is.mjs\";\n\n/**\n * @param {unknown} target\n * @returns {value is Uint8Array|Uint8ClampedArray|Uint16Array|Uint32Array|Int8Array|Int16Array|Int32Array|Float16Array|Float32Array|Float64Array|BigUint64Array|BigInt64Array}\n */\nexport function isTypedArray(target) {\n  return isNativeTypedArray(target) || isFloat16Array(target);\n}\n", "import { safeIfNeeded } from \"./_util/arrayIterator.mjs\";\nimport { convertToNumber, roundToFloat16Bits } from \"./_util/converter.mjs\";\nimport {\n  DataViewPrototypeGetUint16,\n  DataViewPrototypeSetUint16,\n} from \"./_util/primordials.mjs\";\n\n/**\n * returns an unsigned 16-bit float at the specified byte offset from the start of the DataView\n * @param {DataView} dataView\n * @param {number} byteOffset\n * @param {[boolean]} opts\n * @returns {number}\n */\nexport function getFloat16(dataView, byteOffset, ...opts) {\n  return convertToNumber(\n    DataViewPrototypeGetUint16(dataView, byteOffset, ...safeIfNeeded(opts))\n  );\n}\n\n/**\n * stores an unsigned 16-bit float value at the specified byte offset from the start of the DataView\n * @param {DataView} dataView\n * @param {number} byteOffset\n * @param {number} value\n * @param {[boolean]} opts\n */\nexport function setFloat16(dataView, byteOffset, value, ...opts) {\n  return DataViewPrototypeSetUint16(\n    dataView,\n    byteOffset,\n    roundToFloat16Bits(value),\n    ...safeIfNeeded(opts)\n  );\n}\n", "import { roundToFloat16 } from \"./_util/converter.mjs\";\n\n/**\n * returns the nearest half-precision float representation of a number\n * @param {number} x\n * @returns {number}\n */\nexport function f16round(x) {\n  return roundToFloat16(x);\n}\n", "/* ignore unused exports */\n// @ts-self-types=\"../index.v5.7.d.ts\"\n\nexport { Float16Array, isFloat16Array } from \"./Float16Array.mjs\";\nexport { isTypedArray } from \"./isTypedArray.mjs\";\nexport { getFloat16, setFloat16 } from \"./DataView.mjs\";\nexport { f16round, f16round as hfround } from \"./f16round.mjs\";\n", "function getAttribute(tag, attributeName, options) {\n  const debug = (options && options.debug) || false;\n  if (debug) console.log(\"[xml-utils] getting \" + attributeName + \" in \" + tag);\n\n  const xml = typeof tag === \"object\" ? tag.outer : tag;\n\n  // only search for attributes in the opening tag\n  const opening = xml.slice(0, xml.indexOf(\">\") + 1);\n\n  const quotechars = ['\"', \"'\"];\n  for (let i = 0; i < quotechars.length; i++) {\n    const char = quotechars[i];\n    const pattern = attributeName + \"\\\\=\" + char + \"([^\" + char + \"]*)\" + char;\n    if (debug) console.log(\"[xml-utils] pattern:\", pattern);\n\n    const re = new RegExp(pattern);\n    const match = re.exec(opening);\n    if (debug) console.log(\"[xml-utils] match:\", match);\n    if (match) return match[1];\n  }\n}\n\nmodule.exports = getAttribute;\nmodule.exports.default = getAttribute;\n", "function indexOfMatch(xml, pattern, startIndex) {\n  const re = new RegExp(pattern);\n  const match = re.exec(xml.slice(startIndex));\n  if (match) return startIndex + match.index;\n  else return -1;\n}\n\nmodule.exports = indexOfMatch;\nmodule.exports.default = indexOfMatch;\n", "function indexOfMatchEnd(xml, pattern, startIndex) {\n  const re = new RegExp(pattern);\n  const match = re.exec(xml.slice(startIndex));\n  if (match) return startIndex + match.index + match[0].length - 1;\n  else return -1;\n}\n\nmodule.exports = indexOfMatchEnd;\nmodule.exports.default = indexOfMatchEnd;\n", "function countSubstring(string, substring) {\n  const pattern = new RegExp(substring, \"g\");\n  const match = string.match(pattern);\n  return match ? match.length : 0;\n}\n\nmodule.exports = countSubstring;\nmodule.exports.default = countSubstring;\n", "const indexOfMatch = require(\"./index-of-match.js\");\nconst indexOfMatchEnd = require(\"./index-of-match-end.js\");\nconst countSubstring = require(\"./count-substring.js\");\n\nfunction findTagByName(xml, tagName, options) {\n  const debug = (options && options.debug) || false;\n  const nested = !(options && typeof options.nested === false);\n\n  const startIndex = (options && options.startIndex) || 0;\n\n  if (debug) console.log(\"[xml-utils] starting findTagByName with\", tagName, \" and \", options);\n\n  const start = indexOfMatch(xml, `\\<${tagName}[ \\n\\>\\/]`, startIndex);\n  if (debug) console.log(\"[xml-utils] start:\", start);\n  if (start === -1) return undefined;\n\n  const afterStart = xml.slice(start + tagName.length);\n\n  let relativeEnd = indexOfMatchEnd(afterStart, \"^[^<]*[ /]>\", 0);\n\n  const selfClosing = relativeEnd !== -1 && afterStart[relativeEnd - 1] === \"/\";\n  if (debug) console.log(\"[xml-utils] selfClosing:\", selfClosing);\n\n  if (selfClosing === false) {\n    // check if tag has subtags with the same name\n    if (nested) {\n      let startIndex = 0;\n      let openings = 1;\n      let closings = 0;\n      while ((relativeEnd = indexOfMatchEnd(afterStart, \"[ /]\" + tagName + \">\", startIndex)) !== -1) {\n        const clip = afterStart.substring(startIndex, relativeEnd + 1);\n        openings += countSubstring(clip, \"<\" + tagName + \"[ \\n\\t>]\");\n        closings += countSubstring(clip, \"</\" + tagName + \">\");\n        // we can't have more openings than closings\n        if (closings >= openings) break;\n        startIndex = relativeEnd;\n      }\n    } else {\n      relativeEnd = indexOfMatchEnd(afterStart, \"[ /]\" + tagName + \">\", 0);\n    }\n  }\n\n  const end = start + tagName.length + relativeEnd + 1;\n  if (debug) console.log(\"[xml-utils] end:\", end);\n  if (end === -1) return undefined;\n\n  const outer = xml.slice(start, end);\n  // tag is like <gml:identifier codeSpace=\"OGP\">urn:ogc:def:crs:EPSG::32617</gml:identifier>\n\n  let inner;\n  if (selfClosing) {\n    inner = null;\n  } else {\n    inner = outer.slice(outer.indexOf(\">\") + 1, outer.lastIndexOf(\"<\"));\n  }\n\n  return { inner, outer, start, end };\n}\n\nmodule.exports = findTagByName;\nmodule.exports.default = findTagByName;\n", "const findTagByName = require(\"./find-tag-by-name.js\");\n\nfunction findTagsByName(xml, tagName, options) {\n  const tags = [];\n  const debug = (options && options.debug) || false;\n  const nested = options && typeof options.nested === \"boolean\" ? options.nested : true;\n  let startIndex = (options && options.startIndex) || 0;\n  let tag;\n  while ((tag = findTagByName(xml, tagName, { debug, startIndex }))) {\n    if (nested) {\n      startIndex = tag.start + 1 + tagName.length;\n    } else {\n      startIndex = tag.end;\n    }\n    tags.push(tag);\n  }\n  if (debug) console.log(\"findTagsByName found\", tags.length, \"tags\");\n  return tags;\n}\n\nmodule.exports = findTagsByName;\nmodule.exports.default = findTagsByName;\n", "export function fromWhiteIsZero(raster, max) {\n  const { width, height } = raster;\n  const rgbRaster = new Uint8Array(width * height * 3);\n  let value;\n  for (let i = 0, j = 0; i < raster.length; ++i, j += 3) {\n    value = 256 - (raster[i] / max * 256);\n    rgbRaster[j] = value;\n    rgbRaster[j + 1] = value;\n    rgbRaster[j + 2] = value;\n  }\n  return rgbRaster;\n}\n\nexport function fromBlackIsZero(raster, max) {\n  const { width, height } = raster;\n  const rgbRaster = new Uint8Array(width * height * 3);\n  let value;\n  for (let i = 0, j = 0; i < raster.length; ++i, j += 3) {\n    value = raster[i] / max * 256;\n    rgbRaster[j] = value;\n    rgbRaster[j + 1] = value;\n    rgbRaster[j + 2] = value;\n  }\n  return rgbRaster;\n}\n\nexport function fromPalette(raster, colorMap) {\n  const { width, height } = raster;\n  const rgbRaster = new Uint8Array(width * height * 3);\n  const greenOffset = colorMap.length / 3;\n  const blueOffset = colorMap.length / 3 * 2;\n  for (let i = 0, j = 0; i < raster.length; ++i, j += 3) {\n    const mapIndex = raster[i];\n    rgbRaster[j] = colorMap[mapIndex] / 65536 * 256;\n    rgbRaster[j + 1] = colorMap[mapIndex + greenOffset] / 65536 * 256;\n    rgbRaster[j + 2] = colorMap[mapIndex + blueOffset] / 65536 * 256;\n  }\n  return rgbRaster;\n}\n\nexport function fromCMYK(cmykRaster) {\n  const { width, height } = cmykRaster;\n  const rgbRaster = new Uint8Array(width * height * 3);\n  for (let i = 0, j = 0; i < cmykRaster.length; i += 4, j += 3) {\n    const c = cmykRaster[i];\n    const m = cmykRaster[i + 1];\n    const y = cmykRaster[i + 2];\n    const k = cmykRaster[i + 3];\n\n    rgbRaster[j] = 255 * ((255 - c) / 256) * ((255 - k) / 256);\n    rgbRaster[j + 1] = 255 * ((255 - m) / 256) * ((255 - k) / 256);\n    rgbRaster[j + 2] = 255 * ((255 - y) / 256) * ((255 - k) / 256);\n  }\n  return rgbRaster;\n}\n\nexport function fromYCbCr(yCbCrRaster) {\n  const { width, height } = yCbCrRaster;\n  const rgbRaster = new Uint8ClampedArray(width * height * 3);\n  for (let i = 0, j = 0; i < yCbCrRaster.length; i += 3, j += 3) {\n    const y = yCbCrRaster[i];\n    const cb = yCbCrRaster[i + 1];\n    const cr = yCbCrRaster[i + 2];\n\n    rgbRaster[j] = (y + (1.40200 * (cr - 0x80)));\n    rgbRaster[j + 1] = (y - (0.34414 * (cb - 0x80)) - (0.71414 * (cr - 0x80)));\n    rgbRaster[j + 2] = (y + (1.77200 * (cb - 0x80)));\n  }\n  return rgbRaster;\n}\n\nconst Xn = 0.95047;\nconst Yn = 1.00000;\nconst Zn = 1.08883;\n\n// from https://github.com/antimatter15/rgb-lab/blob/master/color.js\n\nexport function fromCIELab(cieLabRaster) {\n  const { width, height } = cieLabRaster;\n  const rgbRaster = new Uint8Array(width * height * 3);\n\n  for (let i = 0, j = 0; i < cieLabRaster.length; i += 3, j += 3) {\n    const L = cieLabRaster[i + 0];\n    const a_ = cieLabRaster[i + 1] << 24 >> 24; // conversion from uint8 to int8\n    const b_ = cieLabRaster[i + 2] << 24 >> 24; // same\n\n    let y = (L + 16) / 116;\n    let x = (a_ / 500) + y;\n    let z = y - (b_ / 200);\n    let r;\n    let g;\n    let b;\n\n    x = Xn * ((x * x * x > 0.008856) ? x * x * x : (x - (16 / 116)) / 7.787);\n    y = Yn * ((y * y * y > 0.008856) ? y * y * y : (y - (16 / 116)) / 7.787);\n    z = Zn * ((z * z * z > 0.008856) ? z * z * z : (z - (16 / 116)) / 7.787);\n\n    r = (x * 3.2406) + (y * -1.5372) + (z * -0.4986);\n    g = (x * -0.9689) + (y * 1.8758) + (z * 0.0415);\n    b = (x * 0.0557) + (y * -0.2040) + (z * 1.0570);\n\n    r = (r > 0.0031308) ? ((1.055 * (r ** (1 / 2.4))) - 0.055) : 12.92 * r;\n    g = (g > 0.0031308) ? ((1.055 * (g ** (1 / 2.4))) - 0.055) : 12.92 * g;\n    b = (b > 0.0031308) ? ((1.055 * (b ** (1 / 2.4))) - 0.055) : 12.92 * b;\n\n    rgbRaster[j] = Math.max(0, Math.min(1, r)) * 255;\n    rgbRaster[j + 1] = Math.max(0, Math.min(1, g)) * 255;\n    rgbRaster[j + 2] = Math.max(0, Math.min(1, b)) * 255;\n  }\n  return rgbRaster;\n}\n", "const registry = new Map();\n\nexport function addDecoder(cases, importFn) {\n  if (!Array.isArray(cases)) {\n    cases = [cases]; // eslint-disable-line no-param-reassign\n  }\n  cases.forEach((c) => registry.set(c, importFn));\n}\n\nexport async function getDecoder(fileDirectory) {\n  const importFn = registry.get(fileDirectory.Compression);\n  if (!importFn) {\n    throw new Error(`Unknown compression method identifier: ${fileDirectory.Compression}`);\n  }\n  const Decoder = await importFn();\n  return new Decoder(fileDirectory);\n}\n\n// Add default decoders to registry (end-user may override with other implementations)\naddDecoder([undefined, 1], () => import('./raw.js').then((m) => m.default));\naddDecoder(5, () => import('./lzw.js').then((m) => m.default));\naddDecoder(6, () => {\n  throw new Error('old style JPEG compression is not supported.');\n});\naddDecoder(7, () => import('./jpeg.js').then((m) => m.default));\naddDecoder([8, 32946], () => import('./deflate.js').then((m) => m.default));\naddDecoder(32773, () => import('./packbits.js').then((m) => m.default));\naddDecoder(34887, () => import('./lerc.js')\n  .then(async (m) => {\n    await m.zstd.init();\n    return m;\n  })\n  .then((m) => m.default),\n);\naddDecoder(50001, () => import('./webimage.js').then((m) => m.default));\n", "/**\n * @module resample\n */\n\nfunction copyNewSize(array, width, height, samplesPerPixel = 1) {\n  return new (Object.getPrototypeOf(array).constructor)(width * height * samplesPerPixel);\n}\n\n/**\n * Resample the input arrays using nearest neighbor value selection.\n * @param {TypedArray[]} valueArrays The input arrays to resample\n * @param {number} inWidth The width of the input rasters\n * @param {number} inHeight The height of the input rasters\n * @param {number} outWidth The desired width of the output rasters\n * @param {number} outHeight The desired height of the output rasters\n * @returns {TypedArray[]} The resampled rasters\n */\nexport function resampleNearest(valueArrays, inWidth, inHeight, outWidth, outHeight) {\n  const relX = inWidth / outWidth;\n  const relY = inHeight / outHeight;\n  return valueArrays.map((array) => {\n    const newArray = copyNewSize(array, outWidth, outHeight);\n    for (let y = 0; y < outHeight; ++y) {\n      const cy = Math.min(Math.round(relY * y), inHeight - 1);\n      for (let x = 0; x < outWidth; ++x) {\n        const cx = Math.min(Math.round(relX * x), inWidth - 1);\n        const value = array[(cy * inWidth) + cx];\n        newArray[(y * outWidth) + x] = value;\n      }\n    }\n    return newArray;\n  });\n}\n\n// simple linear interpolation, code from:\n// https://en.wikipedia.org/wiki/Linear_interpolation#Programming_language_support\nfunction lerp(v0, v1, t) {\n  return ((1 - t) * v0) + (t * v1);\n}\n\n/**\n * Resample the input arrays using bilinear interpolation.\n * @param {TypedArray[]} valueArrays The input arrays to resample\n * @param {number} inWidth The width of the input rasters\n * @param {number} inHeight The height of the input rasters\n * @param {number} outWidth The desired width of the output rasters\n * @param {number} outHeight The desired height of the output rasters\n * @returns {TypedArray[]} The resampled rasters\n */\nexport function resampleBilinear(valueArrays, inWidth, inHeight, outWidth, outHeight) {\n  const relX = inWidth / outWidth;\n  const relY = inHeight / outHeight;\n\n  return valueArrays.map((array) => {\n    const newArray = copyNewSize(array, outWidth, outHeight);\n    for (let y = 0; y < outHeight; ++y) {\n      const rawY = relY * y;\n\n      const yl = Math.floor(rawY);\n      const yh = Math.min(Math.ceil(rawY), (inHeight - 1));\n\n      for (let x = 0; x < outWidth; ++x) {\n        const rawX = relX * x;\n        const tx = rawX % 1;\n\n        const xl = Math.floor(rawX);\n        const xh = Math.min(Math.ceil(rawX), (inWidth - 1));\n\n        const ll = array[(yl * inWidth) + xl];\n        const hl = array[(yl * inWidth) + xh];\n        const lh = array[(yh * inWidth) + xl];\n        const hh = array[(yh * inWidth) + xh];\n\n        const value = lerp(\n          lerp(ll, hl, tx),\n          lerp(lh, hh, tx),\n          rawY % 1,\n        );\n        newArray[(y * outWidth) + x] = value;\n      }\n    }\n    return newArray;\n  });\n}\n\n/**\n * Resample the input arrays using the selected resampling method.\n * @param {TypedArray[]} valueArrays The input arrays to resample\n * @param {number} inWidth The width of the input rasters\n * @param {number} inHeight The height of the input rasters\n * @param {number} outWidth The desired width of the output rasters\n * @param {number} outHeight The desired height of the output rasters\n * @param {string} [method = 'nearest'] The desired resampling method\n * @returns {TypedArray[]} The resampled rasters\n */\nexport function resample(valueArrays, inWidth, inHeight, outWidth, outHeight, method = 'nearest') {\n  switch (method.toLowerCase()) {\n    case 'nearest':\n      return resampleNearest(valueArrays, inWidth, inHeight, outWidth, outHeight);\n    case 'bilinear':\n    case 'linear':\n      return resampleBilinear(valueArrays, inWidth, inHeight, outWidth, outHeight);\n    default:\n      throw new Error(`Unsupported resampling method: '${method}'`);\n  }\n}\n\n/**\n * Resample the pixel interleaved input array using nearest neighbor value selection.\n * @param {TypedArray} valueArrays The input arrays to resample\n * @param {number} inWidth The width of the input rasters\n * @param {number} inHeight The height of the input rasters\n * @param {number} outWidth The desired width of the output rasters\n * @param {number} outHeight The desired height of the output rasters\n * @param {number} samples The number of samples per pixel for pixel\n *                         interleaved data\n * @returns {TypedArray} The resampled raster\n */\nexport function resampleNearestInterleaved(\n  valueArray, inWidth, inHeight, outWidth, outHeight, samples) {\n  const relX = inWidth / outWidth;\n  const relY = inHeight / outHeight;\n\n  const newArray = copyNewSize(valueArray, outWidth, outHeight, samples);\n  for (let y = 0; y < outHeight; ++y) {\n    const cy = Math.min(Math.round(relY * y), inHeight - 1);\n    for (let x = 0; x < outWidth; ++x) {\n      const cx = Math.min(Math.round(relX * x), inWidth - 1);\n      for (let i = 0; i < samples; ++i) {\n        const value = valueArray[(cy * inWidth * samples) + (cx * samples) + i];\n        newArray[(y * outWidth * samples) + (x * samples) + i] = value;\n      }\n    }\n  }\n  return newArray;\n}\n\n/**\n * Resample the pixel interleaved input array using bilinear interpolation.\n * @param {TypedArray} valueArrays The input arrays to resample\n * @param {number} inWidth The width of the input rasters\n * @param {number} inHeight The height of the input rasters\n * @param {number} outWidth The desired width of the output rasters\n * @param {number} outHeight The desired height of the output rasters\n * @param {number} samples The number of samples per pixel for pixel\n *                         interleaved data\n * @returns {TypedArray} The resampled raster\n */\nexport function resampleBilinearInterleaved(\n  valueArray, inWidth, inHeight, outWidth, outHeight, samples) {\n  const relX = inWidth / outWidth;\n  const relY = inHeight / outHeight;\n  const newArray = copyNewSize(valueArray, outWidth, outHeight, samples);\n  for (let y = 0; y < outHeight; ++y) {\n    const rawY = relY * y;\n\n    const yl = Math.floor(rawY);\n    const yh = Math.min(Math.ceil(rawY), (inHeight - 1));\n\n    for (let x = 0; x < outWidth; ++x) {\n      const rawX = relX * x;\n      const tx = rawX % 1;\n\n      const xl = Math.floor(rawX);\n      const xh = Math.min(Math.ceil(rawX), (inWidth - 1));\n\n      for (let i = 0; i < samples; ++i) {\n        const ll = valueArray[(yl * inWidth * samples) + (xl * samples) + i];\n        const hl = valueArray[(yl * inWidth * samples) + (xh * samples) + i];\n        const lh = valueArray[(yh * inWidth * samples) + (xl * samples) + i];\n        const hh = valueArray[(yh * inWidth * samples) + (xh * samples) + i];\n\n        const value = lerp(\n          lerp(ll, hl, tx),\n          lerp(lh, hh, tx),\n          rawY % 1,\n        );\n        newArray[(y * outWidth * samples) + (x * samples) + i] = value;\n      }\n    }\n  }\n  return newArray;\n}\n\n/**\n * Resample the pixel interleaved input array using the selected resampling method.\n * @param {TypedArray} valueArray The input array to resample\n * @param {number} inWidth The width of the input rasters\n * @param {number} inHeight The height of the input rasters\n * @param {number} outWidth The desired width of the output rasters\n * @param {number} outHeight The desired height of the output rasters\n * @param {number} samples The number of samples per pixel for pixel\n *                                 interleaved data\n * @param {string} [method = 'nearest'] The desired resampling method\n * @returns {TypedArray} The resampled rasters\n */\nexport function resampleInterleaved(valueArray, inWidth, inHeight, outWidth, outHeight, samples, method = 'nearest') {\n  switch (method.toLowerCase()) {\n    case 'nearest':\n      return resampleNearestInterleaved(\n        valueArray, inWidth, inHeight, outWidth, outHeight, samples,\n      );\n    case 'bilinear':\n    case 'linear':\n      return resampleBilinearInterleaved(\n        valueArray, inWidth, inHeight, outWidth, outHeight, samples,\n      );\n    default:\n      throw new Error(`Unsupported resampling method: '${method}'`);\n  }\n}\n", "/** @module geotiffimage */\nimport { getFloat16 } from '@petamoriken/float16';\nimport getAttribute from 'xml-utils/get-attribute.js';\nimport findTagsByName from 'xml-utils/find-tags-by-name.js';\n\nimport { photometricInterpretations, ExtraSamplesValues } from './globals.js';\nimport { fromWhiteIsZero, fromBlackIsZero, fromPalette, fromCMYK, fromYCbCr, fromCIELab } from './rgb.js';\nimport { getDecoder } from './compression/index.js';\nimport { resample, resampleInterleaved } from './resample.js';\n\n/**\n * @typedef {Object} ReadRasterOptions\n * @property {Array<number>} [window=whole window] the subset to read data from in pixels.\n * @property {Array<number>} [bbox=whole image] the subset to read data from in\n *                                           geographical coordinates.\n * @property {Array<number>} [samples=all samples] the selection of samples to read from. Default is all samples.\n * @property {boolean} [interleave=false] whether the data shall be read\n *                                             in one single array or separate\n *                                             arrays.\n * @property {Pool} [pool=null] The optional decoder pool to use.\n * @property {number} [width] The desired width of the output. When the width is not the\n *                                 same as the images, resampling will be performed.\n * @property {number} [height] The desired height of the output. When the width is not the\n *                                  same as the images, resampling will be performed.\n * @property {string} [resampleMethod='nearest'] The desired resampling method.\n * @property {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n *                                       to be aborted\n * @property {number|number[]} [fillValue] The value to use for parts of the image\n *                                              outside of the images extent. When multiple\n *                                              samples are requested, an array of fill values\n *                                              can be passed.\n */\n\n/** @typedef {import(\"./geotiff.js\").TypedArray} TypedArray */\n/** @typedef {import(\"./geotiff.js\").ReadRasterResult} ReadRasterResult */\n\nfunction sum(array, start, end) {\n  let s = 0;\n  for (let i = start; i < end; ++i) {\n    s += array[i];\n  }\n  return s;\n}\n\nfunction arrayForType(format, bitsPerSample, size) {\n  switch (format) {\n    case 1: // unsigned integer data\n      if (bitsPerSample <= 8) {\n        return new Uint8Array(size);\n      } else if (bitsPerSample <= 16) {\n        return new Uint16Array(size);\n      } else if (bitsPerSample <= 32) {\n        return new Uint32Array(size);\n      }\n      break;\n    case 2: // twos complement signed integer data\n      if (bitsPerSample === 8) {\n        return new Int8Array(size);\n      } else if (bitsPerSample === 16) {\n        return new Int16Array(size);\n      } else if (bitsPerSample === 32) {\n        return new Int32Array(size);\n      }\n      break;\n    case 3: // floating point data\n      switch (bitsPerSample) {\n        case 16:\n        case 32:\n          return new Float32Array(size);\n        case 64:\n          return new Float64Array(size);\n        default:\n          break;\n      }\n      break;\n    default:\n      break;\n  }\n  throw Error('Unsupported data format/bitsPerSample');\n}\n\nfunction needsNormalization(format, bitsPerSample) {\n  if ((format === 1 || format === 2) && bitsPerSample <= 32 && bitsPerSample % 8 === 0) {\n    return false;\n  } else if (format === 3 && (bitsPerSample === 16 || bitsPerSample === 32 || bitsPerSample === 64)) {\n    return false;\n  }\n  return true;\n}\n\nfunction normalizeArray(inBuffer, format, planarConfiguration, samplesPerPixel, bitsPerSample, tileWidth, tileHeight) {\n  // const inByteArray = new Uint8Array(inBuffer);\n  const view = new DataView(inBuffer);\n  const outSize = planarConfiguration === 2\n    ? tileHeight * tileWidth\n    : tileHeight * tileWidth * samplesPerPixel;\n  const samplesToTransfer = planarConfiguration === 2\n    ? 1 : samplesPerPixel;\n  const outArray = arrayForType(format, bitsPerSample, outSize);\n  // let pixel = 0;\n\n  const bitMask = parseInt('1'.repeat(bitsPerSample), 2);\n\n  if (format === 1) { // unsigned integer\n    // translation of https://github.com/OSGeo/gdal/blob/master/gdal/frmts/gtiff/geotiff.cpp#L7337\n    let pixelBitSkip;\n    // let sampleBitOffset = 0;\n    if (planarConfiguration === 1) {\n      pixelBitSkip = samplesPerPixel * bitsPerSample;\n      // sampleBitOffset = (samplesPerPixel - 1) * bitsPerSample;\n    } else {\n      pixelBitSkip = bitsPerSample;\n    }\n\n    // Bits per line rounds up to next byte boundary.\n    let bitsPerLine = tileWidth * pixelBitSkip;\n    if ((bitsPerLine & 7) !== 0) {\n      bitsPerLine = (bitsPerLine + 7) & (~7);\n    }\n\n    for (let y = 0; y < tileHeight; ++y) {\n      const lineBitOffset = y * bitsPerLine;\n      for (let x = 0; x < tileWidth; ++x) {\n        const pixelBitOffset = lineBitOffset + (x * samplesToTransfer * bitsPerSample);\n        for (let i = 0; i < samplesToTransfer; ++i) {\n          const bitOffset = pixelBitOffset + (i * bitsPerSample);\n          const outIndex = (((y * tileWidth) + x) * samplesToTransfer) + i;\n\n          const byteOffset = Math.floor(bitOffset / 8);\n          const innerBitOffset = bitOffset % 8;\n          if (innerBitOffset + bitsPerSample <= 8) {\n            outArray[outIndex] = (view.getUint8(byteOffset) >> (8 - bitsPerSample) - innerBitOffset) & bitMask;\n          } else if (innerBitOffset + bitsPerSample <= 16) {\n            outArray[outIndex] = (view.getUint16(byteOffset) >> (16 - bitsPerSample) - innerBitOffset) & bitMask;\n          } else if (innerBitOffset + bitsPerSample <= 24) {\n            const raw = (view.getUint16(byteOffset) << 8) | (view.getUint8(byteOffset + 2));\n            outArray[outIndex] = (raw >> (24 - bitsPerSample) - innerBitOffset) & bitMask;\n          } else {\n            outArray[outIndex] = (view.getUint32(byteOffset) >> (32 - bitsPerSample) - innerBitOffset) & bitMask;\n          }\n\n          // let outWord = 0;\n          // for (let bit = 0; bit < bitsPerSample; ++bit) {\n          //   if (inByteArray[bitOffset >> 3]\n          //     & (0x80 >> (bitOffset & 7))) {\n          //     outWord |= (1 << (bitsPerSample - 1 - bit));\n          //   }\n          //   ++bitOffset;\n          // }\n\n          // outArray[outIndex] = outWord;\n          // outArray[pixel] = outWord;\n          // pixel += 1;\n        }\n        // bitOffset = bitOffset + pixelBitSkip - bitsPerSample;\n      }\n    }\n  } else if (format === 3) { // floating point\n    // Float16 is handled elsewhere\n    // normalize 16/24 bit floats to 32 bit floats in the array\n    // console.time();\n    // if (bitsPerSample === 16) {\n    //   for (let byte = 0, outIndex = 0; byte < inBuffer.byteLength; byte += 2, ++outIndex) {\n    //     outArray[outIndex] = getFloat16(view, byte);\n    //   }\n    // }\n    // console.timeEnd()\n  }\n\n  return outArray.buffer;\n}\n\n/**\n * GeoTIFF sub-file image.\n */\nclass GeoTIFFImage {\n  /**\n   * @constructor\n   * @param {Object} fileDirectory The parsed file directory\n   * @param {Object} geoKeys The parsed geo-keys\n   * @param {DataView} dataView The DataView for the underlying file.\n   * @param {Boolean} littleEndian Whether the file is encoded in little or big endian\n   * @param {Boolean} cache Whether or not decoded tiles shall be cached\n   * @param {import('./source/basesource').BaseSource} source The datasource to read from\n   */\n  constructor(fileDirectory, geoKeys, dataView, littleEndian, cache, source) {\n    this.fileDirectory = fileDirectory;\n    this.geoKeys = geoKeys;\n    this.dataView = dataView;\n    this.littleEndian = littleEndian;\n    this.tiles = cache ? {} : null;\n    this.isTiled = !fileDirectory.StripOffsets;\n    const planarConfiguration = fileDirectory.PlanarConfiguration;\n    this.planarConfiguration = (typeof planarConfiguration === 'undefined') ? 1 : planarConfiguration;\n    if (this.planarConfiguration !== 1 && this.planarConfiguration !== 2) {\n      throw new Error('Invalid planar configuration.');\n    }\n\n    this.source = source;\n  }\n\n  /**\n   * Returns the associated parsed file directory.\n   * @returns {Object} the parsed file directory\n   */\n  getFileDirectory() {\n    return this.fileDirectory;\n  }\n\n  /**\n   * Returns the associated parsed geo keys.\n   * @returns {Object} the parsed geo keys\n   */\n  getGeoKeys() {\n    return this.geoKeys;\n  }\n\n  /**\n   * Returns the width of the image.\n   * @returns {Number} the width of the image\n   */\n  getWidth() {\n    return this.fileDirectory.ImageWidth;\n  }\n\n  /**\n   * Returns the height of the image.\n   * @returns {Number} the height of the image\n   */\n  getHeight() {\n    return this.fileDirectory.ImageLength;\n  }\n\n  /**\n   * Returns the number of samples per pixel.\n   * @returns {Number} the number of samples per pixel\n   */\n  getSamplesPerPixel() {\n    return typeof this.fileDirectory.SamplesPerPixel !== 'undefined'\n      ? this.fileDirectory.SamplesPerPixel : 1;\n  }\n\n  /**\n   * Returns the width of each tile.\n   * @returns {Number} the width of each tile\n   */\n  getTileWidth() {\n    return this.isTiled ? this.fileDirectory.TileWidth : this.getWidth();\n  }\n\n  /**\n   * Returns the height of each tile.\n   * @returns {Number} the height of each tile\n   */\n  getTileHeight() {\n    if (this.isTiled) {\n      return this.fileDirectory.TileLength;\n    }\n    if (typeof this.fileDirectory.RowsPerStrip !== 'undefined') {\n      return Math.min(this.fileDirectory.RowsPerStrip, this.getHeight());\n    }\n    return this.getHeight();\n  }\n\n  getBlockWidth() {\n    return this.getTileWidth();\n  }\n\n  getBlockHeight(y) {\n    if (this.isTiled || (y + 1) * this.getTileHeight() <= this.getHeight()) {\n      return this.getTileHeight();\n    } else {\n      return this.getHeight() - (y * this.getTileHeight());\n    }\n  }\n\n  /**\n   * Calculates the number of bytes for each pixel across all samples. Only full\n   * bytes are supported, an exception is thrown when this is not the case.\n   * @returns {Number} the bytes per pixel\n   */\n  getBytesPerPixel() {\n    let bytes = 0;\n    for (let i = 0; i < this.fileDirectory.BitsPerSample.length; ++i) {\n      bytes += this.getSampleByteSize(i);\n    }\n    return bytes;\n  }\n\n  getSampleByteSize(i) {\n    if (i >= this.fileDirectory.BitsPerSample.length) {\n      throw new RangeError(`Sample index ${i} is out of range.`);\n    }\n    return Math.ceil(this.fileDirectory.BitsPerSample[i] / 8);\n  }\n\n  getReaderForSample(sampleIndex) {\n    const format = this.fileDirectory.SampleFormat\n      ? this.fileDirectory.SampleFormat[sampleIndex] : 1;\n    const bitsPerSample = this.fileDirectory.BitsPerSample[sampleIndex];\n    switch (format) {\n      case 1: // unsigned integer data\n        if (bitsPerSample <= 8) {\n          return DataView.prototype.getUint8;\n        } else if (bitsPerSample <= 16) {\n          return DataView.prototype.getUint16;\n        } else if (bitsPerSample <= 32) {\n          return DataView.prototype.getUint32;\n        }\n        break;\n      case 2: // twos complement signed integer data\n        if (bitsPerSample <= 8) {\n          return DataView.prototype.getInt8;\n        } else if (bitsPerSample <= 16) {\n          return DataView.prototype.getInt16;\n        } else if (bitsPerSample <= 32) {\n          return DataView.prototype.getInt32;\n        }\n        break;\n      case 3:\n        switch (bitsPerSample) {\n          case 16:\n            return function (offset, littleEndian) {\n              return getFloat16(this, offset, littleEndian);\n            };\n          case 32:\n            return DataView.prototype.getFloat32;\n          case 64:\n            return DataView.prototype.getFloat64;\n          default:\n            break;\n        }\n        break;\n      default:\n        break;\n    }\n    throw Error('Unsupported data format/bitsPerSample');\n  }\n\n  getSampleFormat(sampleIndex = 0) {\n    return this.fileDirectory.SampleFormat\n      ? this.fileDirectory.SampleFormat[sampleIndex] : 1;\n  }\n\n  getBitsPerSample(sampleIndex = 0) {\n    return this.fileDirectory.BitsPerSample[sampleIndex];\n  }\n\n  getArrayForSample(sampleIndex, size) {\n    const format = this.getSampleFormat(sampleIndex);\n    const bitsPerSample = this.getBitsPerSample(sampleIndex);\n    return arrayForType(format, bitsPerSample, size);\n  }\n\n  /**\n   * Returns the decoded strip or tile.\n   * @param {Number} x the strip or tile x-offset\n   * @param {Number} y the tile y-offset (0 for stripped images)\n   * @param {Number} sample the sample to get for separated samples\n   * @param {import(\"./geotiff\").Pool|import(\"./geotiff\").BaseDecoder} poolOrDecoder the decoder or decoder pool\n   * @param {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n   *                               to be aborted\n   * @returns {Promise.<ArrayBuffer>}\n   */\n  async getTileOrStrip(x, y, sample, poolOrDecoder, signal) {\n    const numTilesPerRow = Math.ceil(this.getWidth() / this.getTileWidth());\n    const numTilesPerCol = Math.ceil(this.getHeight() / this.getTileHeight());\n    let index;\n    const { tiles } = this;\n    if (this.planarConfiguration === 1) {\n      index = (y * numTilesPerRow) + x;\n    } else if (this.planarConfiguration === 2) {\n      index = (sample * numTilesPerRow * numTilesPerCol) + (y * numTilesPerRow) + x;\n    }\n\n    let offset;\n    let byteCount;\n    if (this.isTiled) {\n      offset = this.fileDirectory.TileOffsets[index];\n      byteCount = this.fileDirectory.TileByteCounts[index];\n    } else {\n      offset = this.fileDirectory.StripOffsets[index];\n      byteCount = this.fileDirectory.StripByteCounts[index];\n    }\n    const slice = (await this.source.fetch([{ offset, length: byteCount }], signal))[0];\n\n    let request;\n    if (tiles === null || !tiles[index]) {\n    // resolve each request by potentially applying array normalization\n      request = (async () => {\n        let data = await poolOrDecoder.decode(this.fileDirectory, slice);\n        const sampleFormat = this.getSampleFormat();\n        const bitsPerSample = this.getBitsPerSample();\n        if (needsNormalization(sampleFormat, bitsPerSample)) {\n          data = normalizeArray(\n            data,\n            sampleFormat,\n            this.planarConfiguration,\n            this.getSamplesPerPixel(),\n            bitsPerSample,\n            this.getTileWidth(),\n            this.getBlockHeight(y),\n          );\n        }\n        return data;\n      })();\n\n      // set the cache\n      if (tiles !== null) {\n        tiles[index] = request;\n      }\n    } else {\n      // get from the cache\n      request = tiles[index];\n    }\n\n    // cache the tile request\n    return { x, y, sample, data: await request };\n  }\n\n  /**\n   * Internal read function.\n   * @private\n   * @param {Array} imageWindow The image window in pixel coordinates\n   * @param {Array} samples The selected samples (0-based indices)\n   * @param {TypedArray|TypedArray[]} valueArrays The array(s) to write into\n   * @param {Boolean} interleave Whether or not to write in an interleaved manner\n   * @param {import(\"./geotiff\").Pool|AbstractDecoder} poolOrDecoder the decoder or decoder pool\n   * @param {number} width the width of window to be read into\n   * @param {number} height the height of window to be read into\n   * @param {number} resampleMethod the resampling method to be used when interpolating\n   * @param {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n   *                               to be aborted\n   * @returns {Promise<ReadRasterResult>}\n   */\n  async _readRaster(imageWindow, samples, valueArrays, interleave, poolOrDecoder, width,\n    height, resampleMethod, signal) {\n    const tileWidth = this.getTileWidth();\n    const tileHeight = this.getTileHeight();\n    const imageWidth = this.getWidth();\n    const imageHeight = this.getHeight();\n\n    const minXTile = Math.max(Math.floor(imageWindow[0] / tileWidth), 0);\n    const maxXTile = Math.min(\n      Math.ceil(imageWindow[2] / tileWidth),\n      Math.ceil(imageWidth / tileWidth),\n    );\n    const minYTile = Math.max(Math.floor(imageWindow[1] / tileHeight), 0);\n    const maxYTile = Math.min(\n      Math.ceil(imageWindow[3] / tileHeight),\n      Math.ceil(imageHeight / tileHeight),\n    );\n    const windowWidth = imageWindow[2] - imageWindow[0];\n\n    let bytesPerPixel = this.getBytesPerPixel();\n\n    const srcSampleOffsets = [];\n    const sampleReaders = [];\n    for (let i = 0; i < samples.length; ++i) {\n      if (this.planarConfiguration === 1) {\n        srcSampleOffsets.push(sum(this.fileDirectory.BitsPerSample, 0, samples[i]) / 8);\n      } else {\n        srcSampleOffsets.push(0);\n      }\n      sampleReaders.push(this.getReaderForSample(samples[i]));\n    }\n\n    const promises = [];\n    const { littleEndian } = this;\n\n    for (let yTile = minYTile; yTile < maxYTile; ++yTile) {\n      for (let xTile = minXTile; xTile < maxXTile; ++xTile) {\n        let getPromise;\n        if (this.planarConfiguration === 1) {\n          getPromise = this.getTileOrStrip(xTile, yTile, 0, poolOrDecoder, signal);\n        }\n        for (let sampleIndex = 0; sampleIndex < samples.length; ++sampleIndex) {\n          const si = sampleIndex;\n          const sample = samples[sampleIndex];\n          if (this.planarConfiguration === 2) {\n            bytesPerPixel = this.getSampleByteSize(sample);\n            getPromise = this.getTileOrStrip(xTile, yTile, sample, poolOrDecoder, signal);\n          }\n          const promise = getPromise.then((tile) => {\n            const buffer = tile.data;\n            const dataView = new DataView(buffer);\n            const blockHeight = this.getBlockHeight(tile.y);\n            const firstLine = tile.y * tileHeight;\n            const firstCol = tile.x * tileWidth;\n            const lastLine = firstLine + blockHeight;\n            const lastCol = (tile.x + 1) * tileWidth;\n            const reader = sampleReaders[si];\n\n            const ymax = Math.min(blockHeight, blockHeight - (lastLine - imageWindow[3]), imageHeight - firstLine);\n            const xmax = Math.min(tileWidth, tileWidth - (lastCol - imageWindow[2]), imageWidth - firstCol);\n\n            for (let y = Math.max(0, imageWindow[1] - firstLine); y < ymax; ++y) {\n              for (let x = Math.max(0, imageWindow[0] - firstCol); x < xmax; ++x) {\n                const pixelOffset = ((y * tileWidth) + x) * bytesPerPixel;\n                const value = reader.call(\n                  dataView, pixelOffset + srcSampleOffsets[si], littleEndian,\n                );\n                let windowCoordinate;\n                if (interleave) {\n                  windowCoordinate = ((y + firstLine - imageWindow[1]) * windowWidth * samples.length)\n                    + ((x + firstCol - imageWindow[0]) * samples.length)\n                    + si;\n                  valueArrays[windowCoordinate] = value;\n                } else {\n                  windowCoordinate = (\n                    (y + firstLine - imageWindow[1]) * windowWidth\n                  ) + x + firstCol - imageWindow[0];\n                  valueArrays[si][windowCoordinate] = value;\n                }\n              }\n            }\n          });\n          promises.push(promise);\n        }\n      }\n    }\n    await Promise.all(promises);\n\n    if ((width && (imageWindow[2] - imageWindow[0]) !== width)\n        || (height && (imageWindow[3] - imageWindow[1]) !== height)) {\n      let resampled;\n      if (interleave) {\n        resampled = resampleInterleaved(\n          valueArrays,\n          imageWindow[2] - imageWindow[0],\n          imageWindow[3] - imageWindow[1],\n          width, height,\n          samples.length,\n          resampleMethod,\n        );\n      } else {\n        resampled = resample(\n          valueArrays,\n          imageWindow[2] - imageWindow[0],\n          imageWindow[3] - imageWindow[1],\n          width, height,\n          resampleMethod,\n        );\n      }\n      resampled.width = width;\n      resampled.height = height;\n      return resampled;\n    }\n\n    valueArrays.width = width || imageWindow[2] - imageWindow[0];\n    valueArrays.height = height || imageWindow[3] - imageWindow[1];\n\n    return valueArrays;\n  }\n\n  /**\n   * Reads raster data from the image. This function reads all selected samples\n   * into separate arrays of the correct type for that sample or into a single\n   * combined array when `interleave` is set. When provided, only a subset\n   * of the raster is read for each sample.\n   *\n   * @param {ReadRasterOptions} [options={}] optional parameters\n   * @returns {Promise<ReadRasterResult>} the decoded arrays as a promise\n   */\n  async readRasters({\n    window: wnd, samples = [], interleave, pool = null,\n    width, height, resampleMethod, fillValue, signal,\n  } = {}) {\n    const imageWindow = wnd || [0, 0, this.getWidth(), this.getHeight()];\n\n    // check parameters\n    if (imageWindow[0] > imageWindow[2] || imageWindow[1] > imageWindow[3]) {\n      throw new Error('Invalid subsets');\n    }\n\n    const imageWindowWidth = imageWindow[2] - imageWindow[0];\n    const imageWindowHeight = imageWindow[3] - imageWindow[1];\n    const numPixels = imageWindowWidth * imageWindowHeight;\n    const samplesPerPixel = this.getSamplesPerPixel();\n\n    if (!samples || !samples.length) {\n      for (let i = 0; i < samplesPerPixel; ++i) {\n        samples.push(i);\n      }\n    } else {\n      for (let i = 0; i < samples.length; ++i) {\n        if (samples[i] >= samplesPerPixel) {\n          return Promise.reject(new RangeError(`Invalid sample index '${samples[i]}'.`));\n        }\n      }\n    }\n    let valueArrays;\n    if (interleave) {\n      const format = this.fileDirectory.SampleFormat\n        ? Math.max.apply(null, this.fileDirectory.SampleFormat) : 1;\n      const bitsPerSample = Math.max.apply(null, this.fileDirectory.BitsPerSample);\n      valueArrays = arrayForType(format, bitsPerSample, numPixels * samples.length);\n      if (fillValue) {\n        valueArrays.fill(fillValue);\n      }\n    } else {\n      valueArrays = [];\n      for (let i = 0; i < samples.length; ++i) {\n        const valueArray = this.getArrayForSample(samples[i], numPixels);\n        if (Array.isArray(fillValue) && i < fillValue.length) {\n          valueArray.fill(fillValue[i]);\n        } else if (fillValue && !Array.isArray(fillValue)) {\n          valueArray.fill(fillValue);\n        }\n        valueArrays.push(valueArray);\n      }\n    }\n\n    const poolOrDecoder = pool || await getDecoder(this.fileDirectory);\n\n    const result = await this._readRaster(\n      imageWindow, samples, valueArrays, interleave, poolOrDecoder, width, height, resampleMethod, signal,\n    );\n    return result;\n  }\n\n  /**\n   * Reads raster data from the image as RGB. The result is always an\n   * interleaved typed array.\n   * Colorspaces other than RGB will be transformed to RGB, color maps expanded.\n   * When no other method is applicable, the first sample is used to produce a\n   * grayscale image.\n   * When provided, only a subset of the raster is read for each sample.\n   *\n   * @param {Object} [options] optional parameters\n   * @param {Array<number>} [options.window] the subset to read data from in pixels.\n   * @param {boolean} [options.interleave=true] whether the data shall be read\n   *                                             in one single array or separate\n   *                                             arrays.\n   * @param {import(\"./geotiff\").Pool} [options.pool=null] The optional decoder pool to use.\n   * @param {number} [options.width] The desired width of the output. When the width is no the\n   *                                 same as the images, resampling will be performed.\n   * @param {number} [options.height] The desired height of the output. When the width is no the\n   *                                  same as the images, resampling will be performed.\n   * @param {string} [options.resampleMethod='nearest'] The desired resampling method.\n   * @param {boolean} [options.enableAlpha=false] Enable reading alpha channel if present.\n   * @param {AbortSignal} [options.signal] An AbortSignal that may be signalled if the request is\n   *                                       to be aborted\n   * @returns {Promise<ReadRasterResult>} the RGB array as a Promise\n   */\n  async readRGB({ window, interleave = true, pool = null, width, height,\n    resampleMethod, enableAlpha = false, signal } = {}) {\n    const imageWindow = window || [0, 0, this.getWidth(), this.getHeight()];\n\n    // check parameters\n    if (imageWindow[0] > imageWindow[2] || imageWindow[1] > imageWindow[3]) {\n      throw new Error('Invalid subsets');\n    }\n\n    const pi = this.fileDirectory.PhotometricInterpretation;\n\n    if (pi === photometricInterpretations.RGB) {\n      let s = [0, 1, 2];\n      if ((!(this.fileDirectory.ExtraSamples === ExtraSamplesValues.Unspecified)) && enableAlpha) {\n        s = [];\n        for (let i = 0; i < this.fileDirectory.BitsPerSample.length; i += 1) {\n          s.push(i);\n        }\n      }\n      return this.readRasters({\n        window,\n        interleave,\n        samples: s,\n        pool,\n        width,\n        height,\n        resampleMethod,\n        signal,\n      });\n    }\n\n    let samples;\n    switch (pi) {\n      case photometricInterpretations.WhiteIsZero:\n      case photometricInterpretations.BlackIsZero:\n      case photometricInterpretations.Palette:\n        samples = [0];\n        break;\n      case photometricInterpretations.CMYK:\n        samples = [0, 1, 2, 3];\n        break;\n      case photometricInterpretations.YCbCr:\n      case photometricInterpretations.CIELab:\n        samples = [0, 1, 2];\n        break;\n      default:\n        throw new Error('Invalid or unsupported photometric interpretation.');\n    }\n\n    const subOptions = {\n      window: imageWindow,\n      interleave: true,\n      samples,\n      pool,\n      width,\n      height,\n      resampleMethod,\n      signal,\n    };\n    const { fileDirectory } = this;\n    const raster = await this.readRasters(subOptions);\n\n    const max = 2 ** this.fileDirectory.BitsPerSample[0];\n    let data;\n    switch (pi) {\n      case photometricInterpretations.WhiteIsZero:\n        data = fromWhiteIsZero(raster, max);\n        break;\n      case photometricInterpretations.BlackIsZero:\n        data = fromBlackIsZero(raster, max);\n        break;\n      case photometricInterpretations.Palette:\n        data = fromPalette(raster, fileDirectory.ColorMap);\n        break;\n      case photometricInterpretations.CMYK:\n        data = fromCMYK(raster);\n        break;\n      case photometricInterpretations.YCbCr:\n        data = fromYCbCr(raster);\n        break;\n      case photometricInterpretations.CIELab:\n        data = fromCIELab(raster);\n        break;\n      default:\n        throw new Error('Unsupported photometric interpretation.');\n    }\n\n    // if non-interleaved data is requested, we must split the channels\n    // into their respective arrays\n    if (!interleave) {\n      const red = new Uint8Array(data.length / 3);\n      const green = new Uint8Array(data.length / 3);\n      const blue = new Uint8Array(data.length / 3);\n      for (let i = 0, j = 0; i < data.length; i += 3, ++j) {\n        red[j] = data[i];\n        green[j] = data[i + 1];\n        blue[j] = data[i + 2];\n      }\n      data = [red, green, blue];\n    }\n\n    data.width = raster.width;\n    data.height = raster.height;\n    return data;\n  }\n\n  /**\n   * Returns an array of tiepoints.\n   * @returns {Object[]}\n   */\n  getTiePoints() {\n    if (!this.fileDirectory.ModelTiepoint) {\n      return [];\n    }\n\n    const tiePoints = [];\n    for (let i = 0; i < this.fileDirectory.ModelTiepoint.length; i += 6) {\n      tiePoints.push({\n        i: this.fileDirectory.ModelTiepoint[i],\n        j: this.fileDirectory.ModelTiepoint[i + 1],\n        k: this.fileDirectory.ModelTiepoint[i + 2],\n        x: this.fileDirectory.ModelTiepoint[i + 3],\n        y: this.fileDirectory.ModelTiepoint[i + 4],\n        z: this.fileDirectory.ModelTiepoint[i + 5],\n      });\n    }\n    return tiePoints;\n  }\n\n  /**\n   * Returns the parsed GDAL metadata items.\n   *\n   * If sample is passed to null, dataset-level metadata will be returned.\n   * Otherwise only metadata specific to the provided sample will be returned.\n   *\n   * @param {number} [sample=null] The sample index.\n   * @returns {Object}\n   */\n  getGDALMetadata(sample = null) {\n    const metadata = {};\n    if (!this.fileDirectory.GDAL_METADATA) {\n      return null;\n    }\n    const string = this.fileDirectory.GDAL_METADATA;\n\n    let items = findTagsByName(string, 'Item');\n\n    if (sample === null) {\n      items = items.filter((item) => getAttribute(item, 'sample') === undefined);\n    } else {\n      items = items.filter((item) => Number(getAttribute(item, 'sample')) === sample);\n    }\n\n    for (let i = 0; i < items.length; ++i) {\n      const item = items[i];\n      metadata[getAttribute(item, 'name')] = item.inner;\n    }\n    return metadata;\n  }\n\n  /**\n   * Returns the GDAL nodata value\n   * @returns {number|null}\n   */\n  getGDALNoData() {\n    if (!this.fileDirectory.GDAL_NODATA) {\n      return null;\n    }\n    const string = this.fileDirectory.GDAL_NODATA;\n    return Number(string.substring(0, string.length - 1));\n  }\n\n  /**\n   * Returns the image origin as a XYZ-vector. When the image has no affine\n   * transformation, then an exception is thrown.\n   * @returns {Array<number>} The origin as a vector\n   */\n  getOrigin() {\n    const tiePoints = this.fileDirectory.ModelTiepoint;\n    const modelTransformation = this.fileDirectory.ModelTransformation;\n    if (tiePoints && tiePoints.length === 6) {\n      return [\n        tiePoints[3],\n        tiePoints[4],\n        tiePoints[5],\n      ];\n    }\n    if (modelTransformation) {\n      return [\n        modelTransformation[3],\n        modelTransformation[7],\n        modelTransformation[11],\n      ];\n    }\n    throw new Error('The image does not have an affine transformation.');\n  }\n\n  /**\n   * Returns the image resolution as a XYZ-vector. When the image has no affine\n   * transformation, then an exception is thrown.\n   * @param {GeoTIFFImage} [referenceImage=null] A reference image to calculate the resolution from\n   *                                             in cases when the current image does not have the\n   *                                             required tags on its own.\n   * @returns {Array<number>} The resolution as a vector\n   */\n  getResolution(referenceImage = null) {\n    const modelPixelScale = this.fileDirectory.ModelPixelScale;\n    const modelTransformation = this.fileDirectory.ModelTransformation;\n\n    if (modelPixelScale) {\n      return [\n        modelPixelScale[0],\n        -modelPixelScale[1],\n        modelPixelScale[2],\n      ];\n    }\n    if (modelTransformation) {\n      if (modelTransformation[1] === 0 && modelTransformation[4] === 0) {\n        return [\n          modelTransformation[0],\n          -modelTransformation[5],\n          modelTransformation[10],\n        ];\n      }\n      return [\n        Math.sqrt((modelTransformation[0] * modelTransformation[0])\n          + (modelTransformation[4] * modelTransformation[4])),\n        -Math.sqrt((modelTransformation[1] * modelTransformation[1])\n          + (modelTransformation[5] * modelTransformation[5])),\n        modelTransformation[10]];\n    }\n\n    if (referenceImage) {\n      const [refResX, refResY, refResZ] = referenceImage.getResolution();\n      return [\n        refResX * referenceImage.getWidth() / this.getWidth(),\n        refResY * referenceImage.getHeight() / this.getHeight(),\n        refResZ * referenceImage.getWidth() / this.getWidth(),\n      ];\n    }\n\n    throw new Error('The image does not have an affine transformation.');\n  }\n\n  /**\n   * Returns whether or not the pixels of the image depict an area (or point).\n   * @returns {Boolean} Whether the pixels are a point\n   */\n  pixelIsArea() {\n    return this.geoKeys.GTRasterTypeGeoKey === 1;\n  }\n\n  /**\n   * Returns the image bounding box as an array of 4 values: min-x, min-y,\n   * max-x and max-y. When the image has no affine transformation, then an\n   * exception is thrown.\n   * @param {boolean} [tilegrid=false] If true return extent for a tilegrid\n   *                                   without adjustment for ModelTransformation.\n   * @returns {Array<number>} The bounding box\n   */\n  getBoundingBox(tilegrid = false) {\n    const height = this.getHeight();\n    const width = this.getWidth();\n\n    if (this.fileDirectory.ModelTransformation && !tilegrid) {\n      // eslint-disable-next-line no-unused-vars\n      const [a, b, c, d, e, f, g, h] = this.fileDirectory.ModelTransformation;\n\n      const corners = [\n        [0, 0],\n        [0, height],\n        [width, 0],\n        [width, height],\n      ];\n\n      const projected = corners.map(([I, J]) => [\n        d + (a * I) + (b * J),\n        h + (e * I) + (f * J),\n      ]);\n\n      const xs = projected.map((pt) => pt[0]);\n      const ys = projected.map((pt) => pt[1]);\n\n      return [\n        Math.min(...xs),\n        Math.min(...ys),\n        Math.max(...xs),\n        Math.max(...ys),\n      ];\n    } else {\n      const origin = this.getOrigin();\n      const resolution = this.getResolution();\n\n      const x1 = origin[0];\n      const y1 = origin[1];\n\n      const x2 = x1 + (resolution[0] * width);\n      const y2 = y1 + (resolution[1] * height);\n\n      return [\n        Math.min(x1, x2),\n        Math.min(y1, y2),\n        Math.max(x1, x2),\n        Math.max(y1, y2),\n      ];\n    }\n  }\n}\n\nexport default GeoTIFFImage;\n", "import { getFloat16 } from '@petamoriken/float16';\n\nexport default class DataView64 {\n  constructor(arrayBuffer) {\n    this._dataView = new DataView(arrayBuffer);\n  }\n\n  get buffer() {\n    return this._dataView.buffer;\n  }\n\n  getUint64(offset, littleEndian) {\n    const left = this.getUint32(offset, littleEndian);\n    const right = this.getUint32(offset + 4, littleEndian);\n    let combined;\n    if (littleEndian) {\n      combined = left + ((2 ** 32) * right);\n      if (!Number.isSafeInteger(combined)) {\n        throw new Error(\n          `${combined} exceeds MAX_SAFE_INTEGER. `\n          + 'Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues',\n        );\n      }\n      return combined;\n    }\n    combined = ((2 ** 32) * left) + right;\n    if (!Number.isSafeInteger(combined)) {\n      throw new Error(\n        `${combined} exceeds MAX_SAFE_INTEGER. `\n        + 'Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues',\n      );\n    }\n\n    return combined;\n  }\n\n  // adapted from https://stackoverflow.com/a/55338384/8060591\n  getInt64(offset, littleEndian) {\n    let value = 0;\n    const isNegative = (this._dataView.getUint8(offset + (littleEndian ? 7 : 0)) & 0x80) > 0;\n    let carrying = true;\n    for (let i = 0; i < 8; i++) {\n      let byte = this._dataView.getUint8(offset + (littleEndian ? i : 7 - i));\n      if (isNegative) {\n        if (carrying) {\n          if (byte !== 0x00) {\n            byte = ~(byte - 1) & 0xff;\n            carrying = false;\n          }\n        } else {\n          byte = ~byte & 0xff;\n        }\n      }\n      value += byte * (256 ** i);\n    }\n    if (isNegative) {\n      value = -value;\n    }\n    return value;\n  }\n\n  getUint8(offset, littleEndian) {\n    return this._dataView.getUint8(offset, littleEndian);\n  }\n\n  getInt8(offset, littleEndian) {\n    return this._dataView.getInt8(offset, littleEndian);\n  }\n\n  getUint16(offset, littleEndian) {\n    return this._dataView.getUint16(offset, littleEndian);\n  }\n\n  getInt16(offset, littleEndian) {\n    return this._dataView.getInt16(offset, littleEndian);\n  }\n\n  getUint32(offset, littleEndian) {\n    return this._dataView.getUint32(offset, littleEndian);\n  }\n\n  getInt32(offset, littleEndian) {\n    return this._dataView.getInt32(offset, littleEndian);\n  }\n\n  getFloat16(offset, littleEndian) {\n    return getFloat16(this._dataView, offset, littleEndian);\n  }\n\n  getFloat32(offset, littleEndian) {\n    return this._dataView.getFloat32(offset, littleEndian);\n  }\n\n  getFloat64(offset, littleEndian) {\n    return this._dataView.getFloat64(offset, littleEndian);\n  }\n}\n", "export default class DataSlice {\n  constructor(arrayBuffer, sliceOffset, littleEndian, bigTiff) {\n    this._dataView = new DataView(arrayBuffer);\n    this._sliceOffset = sliceOffset;\n    this._littleEndian = littleEndian;\n    this._bigTiff = bigTiff;\n  }\n\n  get sliceOffset() {\n    return this._sliceOffset;\n  }\n\n  get sliceTop() {\n    return this._sliceOffset + this.buffer.byteLength;\n  }\n\n  get littleEndian() {\n    return this._littleEndian;\n  }\n\n  get bigTiff() {\n    return this._bigTiff;\n  }\n\n  get buffer() {\n    return this._dataView.buffer;\n  }\n\n  covers(offset, length) {\n    return this.sliceOffset <= offset && this.sliceTop >= offset + length;\n  }\n\n  readUint8(offset) {\n    return this._dataView.getUint8(\n      offset - this._sliceOffset, this._littleEndian,\n    );\n  }\n\n  readInt8(offset) {\n    return this._dataView.getInt8(\n      offset - this._sliceOffset, this._littleEndian,\n    );\n  }\n\n  readUint16(offset) {\n    return this._dataView.getUint16(\n      offset - this._sliceOffset, this._littleEndian,\n    );\n  }\n\n  readInt16(offset) {\n    return this._dataView.getInt16(\n      offset - this._sliceOffset, this._littleEndian,\n    );\n  }\n\n  readUint32(offset) {\n    return this._dataView.getUint32(\n      offset - this._sliceOffset, this._littleEndian,\n    );\n  }\n\n  readInt32(offset) {\n    return this._dataView.getInt32(\n      offset - this._sliceOffset, this._littleEndian,\n    );\n  }\n\n  readFloat32(offset) {\n    return this._dataView.getFloat32(\n      offset - this._sliceOffset, this._littleEndian,\n    );\n  }\n\n  readFloat64(offset) {\n    return this._dataView.getFloat64(\n      offset - this._sliceOffset, this._littleEndian,\n    );\n  }\n\n  readUint64(offset) {\n    const left = this.readUint32(offset);\n    const right = this.readUint32(offset + 4);\n    let combined;\n    if (this._littleEndian) {\n      combined = left + ((2 ** 32) * right);\n      if (!Number.isSafeInteger(combined)) {\n        throw new Error(\n          `${combined} exceeds MAX_SAFE_INTEGER. `\n          + 'Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues',\n        );\n      }\n      return combined;\n    }\n    combined = ((2 ** 32) * left) + right;\n    if (!Number.isSafeInteger(combined)) {\n      throw new Error(\n        `${combined} exceeds MAX_SAFE_INTEGER. `\n        + 'Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues',\n      );\n    }\n\n    return combined;\n  }\n\n  // adapted from https://stackoverflow.com/a/55338384/8060591\n  readInt64(offset) {\n    let value = 0;\n    const isNegative = (this._dataView.getUint8(offset + (this._littleEndian ? 7 : 0)) & 0x80)\n      > 0;\n    let carrying = true;\n    for (let i = 0; i < 8; i++) {\n      let byte = this._dataView.getUint8(\n        offset + (this._littleEndian ? i : 7 - i),\n      );\n      if (isNegative) {\n        if (carrying) {\n          if (byte !== 0x00) {\n            byte = ~(byte - 1) & 0xff;\n            carrying = false;\n          }\n        } else {\n          byte = ~byte & 0xff;\n        }\n      }\n      value += byte * (256 ** i);\n    }\n    if (isNegative) {\n      value = -value;\n    }\n    return value;\n  }\n\n  readOffset(offset) {\n    if (this._bigTiff) {\n      return this.readUint64(offset);\n    }\n    return this.readUint32(offset);\n  }\n}\n", "import { getDecoder } from './compression/index.js';\n\nconst defaultPoolSize = typeof navigator !== 'undefined' ? (navigator.hardwareConcurrency || 2) : 2;\n\n/**\n * @module pool\n */\n\n/**\n * Pool for workers to decode chunks of the images.\n */\nclass Pool {\n  /**\n   * @constructor\n   * @param {Number} [size] The size of the pool. Defaults to the number of CPUs\n   *                      available. When this parameter is `null` or 0, then the\n   *                      decoding will be done in the main thread.\n   * @param {function(): Worker} [createWorker] A function that creates the decoder worker.\n   * Defaults to a worker with all decoders that ship with geotiff.js. The `createWorker()`\n   * function is expected to return a `Worker` compatible with Web Workers. For code that\n   * runs in Node, [web-worker](https://www.npmjs.com/package/web-worker) is a good choice.\n   *\n   * A worker that uses a custom lzw decoder would look like this `my-custom-worker.js` file:\n   * ```js\n   * import { addDecoder, getDecoder } from 'geotiff';\n   * addDecoder(5, () => import ('./my-custom-lzw').then((m) => m.default));\n   * self.addEventListener('message', async (e) => {\n   *   const { id, fileDirectory, buffer } = e.data;\n   *   const decoder = await getDecoder(fileDirectory);\n   *   const decoded = await decoder.decode(fileDirectory, buffer);\n   *   self.postMessage({ decoded, id }, [decoded]);\n   * });\n   * ```\n   * The way the above code is built into a worker by the `createWorker()` function\n   * depends on the used bundler. For most bundlers, something like this will work:\n   * ```js\n   * function createWorker() {\n   *   return new Worker(new URL('./my-custom-worker.js', import.meta.url));\n   * }\n   * ```\n   */\n  constructor(size = defaultPoolSize, createWorker) {\n    this.workers = null;\n    this._awaitingDecoder = null;\n    this.size = size;\n    this.messageId = 0;\n    if (size) {\n      this._awaitingDecoder = createWorker ? Promise.resolve(createWorker) : new Promise((resolve) => {\n        import('./worker/decoder.js').then((module) => {\n          resolve(module.create);\n        });\n      });\n      this._awaitingDecoder.then((create) => {\n        this._awaitingDecoder = null;\n        this.workers = [];\n        for (let i = 0; i < size; i++) {\n          this.workers.push({ worker: create(), idle: true });\n        }\n      });\n    }\n  }\n\n  /**\n   * Decode the given block of bytes with the set compression method.\n   * @param {ArrayBuffer} buffer the array buffer of bytes to decode.\n   * @returns {Promise<ArrayBuffer>} the decoded result as a `Promise`\n   */\n  async decode(fileDirectory, buffer) {\n    if (this._awaitingDecoder) {\n      await this._awaitingDecoder;\n    }\n    return this.size === 0\n      ? getDecoder(fileDirectory).then((decoder) => decoder.decode(fileDirectory, buffer))\n      : new Promise((resolve) => {\n        const worker = this.workers.find((candidate) => candidate.idle)\n          || this.workers[Math.floor(Math.random() * this.size)];\n        worker.idle = false;\n        const id = this.messageId++;\n        const onMessage = (e) => {\n          if (e.data.id === id) {\n            worker.idle = true;\n            resolve(e.data.decoded);\n            worker.worker.removeEventListener('message', onMessage);\n          }\n        };\n        worker.worker.addEventListener('message', onMessage);\n        worker.worker.postMessage({ fileDirectory, buffer, id }, [buffer]);\n      });\n  }\n\n  destroy() {\n    if (this.workers) {\n      this.workers.forEach((worker) => {\n        worker.worker.terminate();\n      });\n      this.workers = null;\n    }\n  }\n}\n\nexport default Pool;\n", "const CRLFCRLF = '\\r\\n\\r\\n';\n\n/*\n * Shim for 'Object.fromEntries'\n */\nfunction itemsToObject(items) {\n  if (typeof Object.fromEntries !== 'undefined') {\n    return Object.fromEntries(items);\n  }\n  const obj = {};\n  for (const [key, value] of items) {\n    obj[key.toLowerCase()] = value;\n  }\n  return obj;\n}\n\n/**\n * Parse HTTP headers from a given string.\n * @param {String} text the text to parse the headers from\n * @returns {Object} the parsed headers with lowercase keys\n */\nfunction parseHeaders(text) {\n  const items = text\n    .split('\\r\\n')\n    .map((line) => {\n      const kv = line.split(':').map((str) => str.trim());\n      kv[0] = kv[0].toLowerCase();\n      return kv;\n    });\n\n  return itemsToObject(items);\n}\n\n/**\n * Parse a 'Content-Type' header value to the content-type and parameters\n * @param {String} rawContentType the raw string to parse from\n * @returns {Object} the parsed content type with the fields: type and params\n */\nexport function parseContentType(rawContentType) {\n  const [type, ...rawParams] = rawContentType.split(';').map((s) => s.trim());\n  const paramsItems = rawParams.map((param) => param.split('='));\n  return { type, params: itemsToObject(paramsItems) };\n}\n\n/**\n * Parse a 'Content-Range' header value to its start, end, and total parts\n * @param {String} rawContentRange the raw string to parse from\n * @returns {Object} the parsed parts\n */\nexport function parseContentRange(rawContentRange) {\n  let start;\n  let end;\n  let total;\n\n  if (rawContentRange) {\n    [, start, end, total] = rawContentRange.match(/bytes (\\d+)-(\\d+)\\/(\\d+)/);\n    start = parseInt(start, 10);\n    end = parseInt(end, 10);\n    total = parseInt(total, 10);\n  }\n\n  return { start, end, total };\n}\n\n/**\n * Parses a list of byteranges from the given 'multipart/byteranges' HTTP response.\n * Each item in the list has the following properties:\n * - headers: the HTTP headers\n * - data: the sliced ArrayBuffer for that specific part\n * - offset: the offset of the byterange within its originating file\n * - length: the length of the byterange\n * @param {ArrayBuffer} responseArrayBuffer the response to be parsed and split\n * @param {String} boundary the boundary string used to split the sections\n * @returns {Object[]} the parsed byteranges\n */\nexport function parseByteRanges(responseArrayBuffer, boundary) {\n  let offset = null;\n  const decoder = new TextDecoder('ascii');\n  const out = [];\n\n  const startBoundary = `--${boundary}`;\n  const endBoundary = `${startBoundary}--`;\n\n  // search for the initial boundary, may be offset by some bytes\n  // TODO: more efficient to check for `--` in bytes directly\n  for (let i = 0; i < 10; ++i) {\n    const text = decoder.decode(\n      new Uint8Array(responseArrayBuffer, i, startBoundary.length),\n    );\n    if (text === startBoundary) {\n      offset = i;\n    }\n  }\n\n  if (offset === null) {\n    throw new Error('Could not find initial boundary');\n  }\n\n  while (offset < responseArrayBuffer.byteLength) {\n    const text = decoder.decode(\n      new Uint8Array(responseArrayBuffer, offset,\n        Math.min(startBoundary.length + 1024, responseArrayBuffer.byteLength - offset),\n      ),\n    );\n\n    // break if we arrived at the end\n    if (text.length === 0 || text.startsWith(endBoundary)) {\n      break;\n    }\n\n    // assert that we are actually dealing with a byterange and are at the correct offset\n    if (!text.startsWith(startBoundary)) {\n      throw new Error('Part does not start with boundary');\n    }\n\n    // get a substring from where we read the headers\n    const innerText = text.substr(startBoundary.length + 2);\n\n    if (innerText.length === 0) {\n      break;\n    }\n\n    // find the double linebreak that denotes the end of the headers\n    const endOfHeaders = innerText.indexOf(CRLFCRLF);\n\n    // parse the headers to get the content range size\n    const headers = parseHeaders(innerText.substr(0, endOfHeaders));\n    const { start, end, total } = parseContentRange(headers['content-range']);\n\n    // calculate the length of the slice and the next offset\n    const startOfData = offset + startBoundary.length + endOfHeaders + CRLFCRLF.length;\n    const length = parseInt(end, 10) + 1 - parseInt(start, 10);\n    out.push({\n      headers,\n      data: responseArrayBuffer.slice(startOfData, startOfData + length),\n      offset: start,\n      length,\n      fileSize: total,\n    });\n\n    offset = startOfData + length + 4;\n  }\n\n  return out;\n}\n", "/**\n * @typedef Slice\n * @property {number} offset\n * @property {number} length\n */\n\nexport class BaseSource {\n  /**\n   *\n   * @param {Slice[]} slices\n   * @returns {ArrayBuffer[]}\n   */\n  async fetch(slices, signal = undefined) {\n    return Promise.all(\n      slices.map((slice) => this.fetchSlice(slice, signal)),\n    );\n  }\n\n  /**\n   *\n   * @param {Slice} slice\n   * @returns {ArrayBuffer}\n   */\n  async fetchSlice(slice) {\n    throw new Error(`fetching of slice ${slice} not possible, not implemented`);\n  }\n\n  /**\n   * Returns the filesize if already determined and null otherwise\n   */\n  get fileSize() {\n    return null;\n  }\n\n  async close() {\n    // no-op by default\n  }\n}\n", "export default class QuickLRU extends Map {\n\tconstructor(options = {}) {\n\t\tsuper();\n\n\t\tif (!(options.maxSize && options.maxSize > 0)) {\n\t\t\tthrow new TypeError('`maxSize` must be a number greater than 0');\n\t\t}\n\n\t\tif (typeof options.maxAge === 'number' && options.maxAge === 0) {\n\t\t\tthrow new TypeError('`maxAge` must be a number greater than 0');\n\t\t}\n\n\t\t// TODO: Use private class fields when ESLint supports them.\n\t\tthis.maxSize = options.maxSize;\n\t\tthis.maxAge = options.maxAge || Number.POSITIVE_INFINITY;\n\t\tthis.onEviction = options.onEviction;\n\t\tthis.cache = new Map();\n\t\tthis.oldCache = new Map();\n\t\tthis._size = 0;\n\t}\n\n\t// TODO: Use private class methods when targeting Node.js 16.\n\t_emitEvictions(cache) {\n\t\tif (typeof this.onEviction !== 'function') {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const [key, item] of cache) {\n\t\t\tthis.onEviction(key, item.value);\n\t\t}\n\t}\n\n\t_deleteIfExpired(key, item) {\n\t\tif (typeof item.expiry === 'number' && item.expiry <= Date.now()) {\n\t\t\tif (typeof this.onEviction === 'function') {\n\t\t\t\tthis.onEviction(key, item.value);\n\t\t\t}\n\n\t\t\treturn this.delete(key);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t_getOrDeleteIfExpired(key, item) {\n\t\tconst deleted = this._deleteIfExpired(key, item);\n\t\tif (deleted === false) {\n\t\t\treturn item.value;\n\t\t}\n\t}\n\n\t_getItemValue(key, item) {\n\t\treturn item.expiry ? this._getOrDeleteIfExpired(key, item) : item.value;\n\t}\n\n\t_peek(key, cache) {\n\t\tconst item = cache.get(key);\n\n\t\treturn this._getItemValue(key, item);\n\t}\n\n\t_set(key, value) {\n\t\tthis.cache.set(key, value);\n\t\tthis._size++;\n\n\t\tif (this._size >= this.maxSize) {\n\t\t\tthis._size = 0;\n\t\t\tthis._emitEvictions(this.oldCache);\n\t\t\tthis.oldCache = this.cache;\n\t\t\tthis.cache = new Map();\n\t\t}\n\t}\n\n\t_moveToRecent(key, item) {\n\t\tthis.oldCache.delete(key);\n\t\tthis._set(key, item);\n\t}\n\n\t* _entriesAscending() {\n\t\tfor (const item of this.oldCache) {\n\t\t\tconst [key, value] = item;\n\t\t\tif (!this.cache.has(key)) {\n\t\t\t\tconst deleted = this._deleteIfExpired(key, value);\n\t\t\t\tif (deleted === false) {\n\t\t\t\t\tyield item;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (const item of this.cache) {\n\t\t\tconst [key, value] = item;\n\t\t\tconst deleted = this._deleteIfExpired(key, value);\n\t\t\tif (deleted === false) {\n\t\t\t\tyield item;\n\t\t\t}\n\t\t}\n\t}\n\n\tget(key) {\n\t\tif (this.cache.has(key)) {\n\t\t\tconst item = this.cache.get(key);\n\n\t\t\treturn this._getItemValue(key, item);\n\t\t}\n\n\t\tif (this.oldCache.has(key)) {\n\t\t\tconst item = this.oldCache.get(key);\n\t\t\tif (this._deleteIfExpired(key, item) === false) {\n\t\t\t\tthis._moveToRecent(key, item);\n\t\t\t\treturn item.value;\n\t\t\t}\n\t\t}\n\t}\n\n\tset(key, value, {maxAge = this.maxAge} = {}) {\n\t\tconst expiry =\n\t\t\ttypeof maxAge === 'number' && maxAge !== Number.POSITIVE_INFINITY ?\n\t\t\t\tDate.now() + maxAge :\n\t\t\t\tundefined;\n\t\tif (this.cache.has(key)) {\n\t\t\tthis.cache.set(key, {\n\t\t\t\tvalue,\n\t\t\t\texpiry\n\t\t\t});\n\t\t} else {\n\t\t\tthis._set(key, {value, expiry});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\thas(key) {\n\t\tif (this.cache.has(key)) {\n\t\t\treturn !this._deleteIfExpired(key, this.cache.get(key));\n\t\t}\n\n\t\tif (this.oldCache.has(key)) {\n\t\t\treturn !this._deleteIfExpired(key, this.oldCache.get(key));\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpeek(key) {\n\t\tif (this.cache.has(key)) {\n\t\t\treturn this._peek(key, this.cache);\n\t\t}\n\n\t\tif (this.oldCache.has(key)) {\n\t\t\treturn this._peek(key, this.oldCache);\n\t\t}\n\t}\n\n\tdelete(key) {\n\t\tconst deleted = this.cache.delete(key);\n\t\tif (deleted) {\n\t\t\tthis._size--;\n\t\t}\n\n\t\treturn this.oldCache.delete(key) || deleted;\n\t}\n\n\tclear() {\n\t\tthis.cache.clear();\n\t\tthis.oldCache.clear();\n\t\tthis._size = 0;\n\t}\n\n\tresize(newSize) {\n\t\tif (!(newSize && newSize > 0)) {\n\t\t\tthrow new TypeError('`maxSize` must be a number greater than 0');\n\t\t}\n\n\t\tconst items = [...this._entriesAscending()];\n\t\tconst removeCount = items.length - newSize;\n\t\tif (removeCount < 0) {\n\t\t\tthis.cache = new Map(items);\n\t\t\tthis.oldCache = new Map();\n\t\t\tthis._size = items.length;\n\t\t} else {\n\t\t\tif (removeCount > 0) {\n\t\t\t\tthis._emitEvictions(items.slice(0, removeCount));\n\t\t\t}\n\n\t\t\tthis.oldCache = new Map(items.slice(removeCount));\n\t\t\tthis.cache = new Map();\n\t\t\tthis._size = 0;\n\t\t}\n\n\t\tthis.maxSize = newSize;\n\t}\n\n\t* keys() {\n\t\tfor (const [key] of this) {\n\t\t\tyield key;\n\t\t}\n\t}\n\n\t* values() {\n\t\tfor (const [, value] of this) {\n\t\t\tyield value;\n\t\t}\n\t}\n\n\t* [Symbol.iterator]() {\n\t\tfor (const item of this.cache) {\n\t\t\tconst [key, value] = item;\n\t\t\tconst deleted = this._deleteIfExpired(key, value);\n\t\t\tif (deleted === false) {\n\t\t\t\tyield [key, value.value];\n\t\t\t}\n\t\t}\n\n\t\tfor (const item of this.oldCache) {\n\t\t\tconst [key, value] = item;\n\t\t\tif (!this.cache.has(key)) {\n\t\t\t\tconst deleted = this._deleteIfExpired(key, value);\n\t\t\t\tif (deleted === false) {\n\t\t\t\t\tyield [key, value.value];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t* entriesDescending() {\n\t\tlet items = [...this.cache];\n\t\tfor (let i = items.length - 1; i >= 0; --i) {\n\t\t\tconst item = items[i];\n\t\t\tconst [key, value] = item;\n\t\t\tconst deleted = this._deleteIfExpired(key, value);\n\t\t\tif (deleted === false) {\n\t\t\t\tyield [key, value.value];\n\t\t\t}\n\t\t}\n\n\t\titems = [...this.oldCache];\n\t\tfor (let i = items.length - 1; i >= 0; --i) {\n\t\t\tconst item = items[i];\n\t\t\tconst [key, value] = item;\n\t\t\tif (!this.cache.has(key)) {\n\t\t\t\tconst deleted = this._deleteIfExpired(key, value);\n\t\t\t\tif (deleted === false) {\n\t\t\t\t\tyield [key, value.value];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t* entriesAscending() {\n\t\tfor (const [key, value] of this._entriesAscending()) {\n\t\t\tyield [key, value.value];\n\t\t}\n\t}\n\n\tget size() {\n\t\tif (!this._size) {\n\t\t\treturn this.oldCache.size;\n\t\t}\n\n\t\tlet oldCacheSize = 0;\n\t\tfor (const key of this.oldCache.keys()) {\n\t\t\tif (!this.cache.has(key)) {\n\t\t\t\toldCacheSize++;\n\t\t\t}\n\t\t}\n\n\t\treturn Math.min(this._size + oldCacheSize, this.maxSize);\n\t}\n\n\tentries() {\n\t\treturn this.entriesAscending();\n\t}\n\n\tforEach(callbackFunction, thisArgument = this) {\n\t\tfor (const [key, value] of this.entriesAscending()) {\n\t\t\tcallbackFunction.call(thisArgument, value, key, this);\n\t\t}\n\t}\n\n\tget [Symbol.toStringTag]() {\n\t\treturn JSON.stringify([...this.entriesAscending()]);\n\t}\n}\n", "export function assign(target, source) {\n  for (const key in source) {\n    if (source.hasOwnProperty(key)) {\n      target[key] = source[key];\n    }\n  }\n}\n\nexport function chunk(iterable, length) {\n  const results = [];\n  const lengthOfIterable = iterable.length;\n  for (let i = 0; i < lengthOfIterable; i += length) {\n    const chunked = [];\n    for (let ci = i; ci < i + length; ci++) {\n      chunked.push(iterable[ci]);\n    }\n    results.push(chunked);\n  }\n  return results;\n}\n\nexport function endsWith(string, expectedEnding) {\n  if (string.length < expectedEnding.length) {\n    return false;\n  }\n  const actualEnding = string.substr(string.length - expectedEnding.length);\n  return actualEnding === expectedEnding;\n}\n\nexport function forEach(iterable, func) {\n  const { length } = iterable;\n  for (let i = 0; i < length; i++) {\n    func(iterable[i], i);\n  }\n}\n\nexport function invert(oldObj) {\n  const newObj = {};\n  for (const key in oldObj) {\n    if (oldObj.hasOwnProperty(key)) {\n      const value = oldObj[key];\n      newObj[value] = key;\n    }\n  }\n  return newObj;\n}\n\nexport function range(n) {\n  const results = [];\n  for (let i = 0; i < n; i++) {\n    results.push(i);\n  }\n  return results;\n}\n\nexport function times(numTimes, func) {\n  const results = [];\n  for (let i = 0; i < numTimes; i++) {\n    results.push(func(i));\n  }\n  return results;\n}\n\nexport function toArray(iterable) {\n  const results = [];\n  const { length } = iterable;\n  for (let i = 0; i < length; i++) {\n    results.push(iterable[i]);\n  }\n  return results;\n}\n\nexport function toArrayRecursively(input) {\n  if (input.length) {\n    return toArray(input).map(toArrayRecursively);\n  }\n  return input;\n}\n\n// copied from https://github.com/academia-de-codigo/parse-content-range-header/blob/master/index.js\nexport function parseContentRange(headerValue) {\n  if (!headerValue) {\n    return null;\n  }\n\n  if (typeof headerValue !== 'string') {\n    throw new Error('invalid argument');\n  }\n\n  const parseInt = (number) => Number.parseInt(number, 10);\n\n  // Check for presence of unit\n  let matches = headerValue.match(/^(\\w*) /);\n  const unit = matches && matches[1];\n\n  // check for start-end/size header format\n  matches = headerValue.match(/(\\d+)-(\\d+)\\/(\\d+|\\*)/);\n  if (matches) {\n    return {\n      unit,\n      first: parseInt(matches[1]),\n      last: parseInt(matches[2]),\n      length: matches[3] === '*' ? null : parseInt(matches[3]),\n    };\n  }\n\n  // check for size header format\n  matches = headerValue.match(/(\\d+|\\*)/);\n  if (matches) {\n    return {\n      unit,\n      first: null,\n      last: null,\n      length: matches[1] === '*' ? null : parseInt(matches[1]),\n    };\n  }\n\n  return null;\n}\n\n/*\n * Promisified wrapper around 'setTimeout' to allow 'await'\n */\nexport async function wait(milliseconds) {\n  return new Promise((resolve) => setTimeout(resolve, milliseconds));\n}\n\nexport function zip(a, b) {\n  const A = Array.isArray(a) ? a : Array.from(a);\n  const B = Array.isArray(b) ? b : Array.from(b);\n  return A.map((k, i) => [k, B[i]]);\n}\n\n// Based on https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error\nexport class AbortError extends Error {\n  constructor(params) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(params);\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, AbortError);\n    }\n\n    this.name = 'AbortError';\n  }\n}\n\nexport class CustomAggregateError extends Error {\n  constructor(errors, message) {\n    super(message);\n    this.errors = errors;\n    this.message = message;\n    this.name = 'AggregateError';\n  }\n}\n\nexport const AggregateError = CustomAggregateError;\n", "import QuickLRU from 'quick-lru';\nimport { BaseSource } from './basesource.js';\nimport { AbortError, AggregateError, wait, zip } from '../utils.js';\n\nclass Block {\n  /**\n   *\n   * @param {number} offset\n   * @param {number} length\n   * @param {ArrayBuffer} [data]\n   */\n  constructor(offset, length, data = null) {\n    this.offset = offset;\n    this.length = length;\n    this.data = data;\n  }\n\n  /**\n   * @returns {number} the top byte border\n   */\n  get top() {\n    return this.offset + this.length;\n  }\n}\n\nclass BlockGroup {\n  /**\n   *\n   * @param {number} offset\n   * @param {number} length\n   * @param {number[]} blockIds\n   */\n  constructor(offset, length, blockIds) {\n    this.offset = offset;\n    this.length = length;\n    this.blockIds = blockIds;\n  }\n}\n\nexport class BlockedSource extends BaseSource {\n  /**\n   *\n   * @param {BaseSource} source The underlying source that shall be blocked and cached\n   * @param {object} options\n   * @param {number} [options.blockSize]\n   * @param {number} [options.cacheSize]\n   */\n  constructor(source, { blockSize = 65536, cacheSize = 100 } = {}) {\n    super();\n    this.source = source;\n    this.blockSize = blockSize;\n\n    this.blockCache = new QuickLRU({\n      maxSize: cacheSize,\n      onEviction: (blockId, block) => {\n        this.evictedBlocks.set(blockId, block);\n      },\n    });\n\n    /** @type {Map<number, Block>} */\n    this.evictedBlocks = new Map();\n\n    // mapping blockId -> Block instance\n    this.blockRequests = new Map();\n\n    // set of blockIds missing for the current requests\n    this.blockIdsToFetch = new Set();\n\n    this.abortedBlockIds = new Set();\n  }\n\n  get fileSize() {\n    return this.source.fileSize;\n  }\n\n  /**\n   *\n   * @param {import(\"./basesource\").Slice[]} slices\n   */\n  async fetch(slices, signal) {\n    const blockRequests = [];\n    const missingBlockIds = [];\n    const allBlockIds = [];\n    this.evictedBlocks.clear();\n\n    for (const { offset, length } of slices) {\n      let top = offset + length;\n\n      const { fileSize } = this;\n      if (fileSize !== null) {\n        top = Math.min(top, fileSize);\n      }\n\n      const firstBlockOffset = Math.floor(offset / this.blockSize) * this.blockSize;\n\n      for (let current = firstBlockOffset; current < top; current += this.blockSize) {\n        const blockId = Math.floor(current / this.blockSize);\n        if (!this.blockCache.has(blockId) && !this.blockRequests.has(blockId)) {\n          this.blockIdsToFetch.add(blockId);\n          missingBlockIds.push(blockId);\n        }\n        if (this.blockRequests.has(blockId)) {\n          blockRequests.push(this.blockRequests.get(blockId));\n        }\n        allBlockIds.push(blockId);\n      }\n    }\n\n    // allow additional block requests to accumulate\n    await wait();\n    this.fetchBlocks(signal);\n\n    // Gather all of the new requests that this fetch call is contributing to `fetch`.\n    const missingRequests = [];\n    for (const blockId of missingBlockIds) {\n      // The requested missing block could already be in the cache\n      // instead of having its request still be outstanding.\n      if (this.blockRequests.has(blockId)) {\n        missingRequests.push(this.blockRequests.get(blockId));\n      }\n    }\n\n    // Actually await all pending requests that are needed for this `fetch`.\n    await Promise.allSettled(blockRequests);\n    await Promise.allSettled(missingRequests);\n\n    // Perform retries if a block was interrupted by a previous signal\n    const abortedBlockRequests = [];\n    const abortedBlockIds = allBlockIds\n      .filter((id) => this.abortedBlockIds.has(id) || !this.blockCache.has(id));\n    abortedBlockIds.forEach((id) => this.blockIdsToFetch.add(id));\n    // start the retry of some blocks if required\n    if (abortedBlockIds.length > 0 && signal && !signal.aborted) {\n      this.fetchBlocks(null);\n      for (const blockId of abortedBlockIds) {\n        const block = this.blockRequests.get(blockId);\n        if (!block) {\n          throw new Error(`Block ${blockId} is not in the block requests`);\n        }\n        abortedBlockRequests.push(block);\n      }\n      await Promise.allSettled(abortedBlockRequests);\n    }\n\n    // throw an  abort error\n    if (signal && signal.aborted) {\n      throw new AbortError('Request was aborted');\n    }\n\n    const blocks = allBlockIds.map((id) => this.blockCache.get(id) || this.evictedBlocks.get(id));\n    const failedBlocks = blocks.filter((i) => !i);\n    if (failedBlocks.length) {\n      throw new AggregateError(failedBlocks, 'Request failed');\n    }\n\n    // create a final Map, with all required blocks for this request to satisfy\n    const requiredBlocks = new Map(zip(allBlockIds, blocks));\n\n    // TODO: satisfy each slice\n    return this.readSliceData(slices, requiredBlocks);\n  }\n\n  /**\n   *\n   * @param {AbortSignal} signal\n   */\n  fetchBlocks(signal) {\n    // check if we still need to\n    if (this.blockIdsToFetch.size > 0) {\n      const groups = this.groupBlocks(this.blockIdsToFetch);\n\n      // start requesting slices of data\n      const groupRequests = this.source.fetch(groups, signal);\n\n      for (let groupIndex = 0; groupIndex < groups.length; ++groupIndex) {\n        const group = groups[groupIndex];\n\n        for (const blockId of group.blockIds) {\n          // make an async IIFE for each block\n          this.blockRequests.set(blockId, (async () => {\n            try {\n              const response = (await groupRequests)[groupIndex];\n              const blockOffset = blockId * this.blockSize;\n              const o = blockOffset - response.offset;\n              const t = Math.min(o + this.blockSize, response.data.byteLength);\n              const data = response.data.slice(o, t);\n              const block = new Block(\n                blockOffset,\n                data.byteLength,\n                data,\n                blockId,\n              );\n              this.blockCache.set(blockId, block);\n              this.abortedBlockIds.delete(blockId);\n            } catch (err) {\n              if (err.name === 'AbortError') {\n                // store the signal here, we need it to determine later if an\n                // error was caused by this signal\n                err.signal = signal;\n                this.blockCache.delete(blockId);\n                this.abortedBlockIds.add(blockId);\n              } else {\n                throw err;\n              }\n            } finally {\n              this.blockRequests.delete(blockId);\n            }\n          })());\n        }\n      }\n      this.blockIdsToFetch.clear();\n    }\n  }\n\n  /**\n   *\n   * @param {Set} blockIds\n   * @returns {BlockGroup[]}\n   */\n  groupBlocks(blockIds) {\n    const sortedBlockIds = Array.from(blockIds).sort((a, b) => a - b);\n    if (sortedBlockIds.length === 0) {\n      return [];\n    }\n    let current = [];\n    let lastBlockId = null;\n    const groups = [];\n\n    for (const blockId of sortedBlockIds) {\n      if (lastBlockId === null || lastBlockId + 1 === blockId) {\n        current.push(blockId);\n        lastBlockId = blockId;\n      } else {\n        groups.push(new BlockGroup(\n          current[0] * this.blockSize,\n          current.length * this.blockSize,\n          current,\n        ));\n        current = [blockId];\n        lastBlockId = blockId;\n      }\n    }\n\n    groups.push(new BlockGroup(\n      current[0] * this.blockSize,\n      current.length * this.blockSize,\n      current,\n    ));\n\n    return groups;\n  }\n\n  /**\n   *\n   * @param {import(\"./basesource\").Slice[]} slices\n   * @param {Map} blocks\n   */\n  readSliceData(slices, blocks) {\n    return slices.map((slice) => {\n      let top = slice.offset + slice.length;\n      if (this.fileSize !== null) {\n        top = Math.min(this.fileSize, top);\n      }\n      const blockIdLow = Math.floor(slice.offset / this.blockSize);\n      const blockIdHigh = Math.floor(top / this.blockSize);\n      const sliceData = new ArrayBuffer(slice.length);\n      const sliceView = new Uint8Array(sliceData);\n\n      for (let blockId = blockIdLow; blockId <= blockIdHigh; ++blockId) {\n        const block = blocks.get(blockId);\n        const delta = block.offset - slice.offset;\n        const topDelta = block.top - top;\n        let blockInnerOffset = 0;\n        let rangeInnerOffset = 0;\n        let usedBlockLength;\n\n        if (delta < 0) {\n          blockInnerOffset = -delta;\n        } else if (delta > 0) {\n          rangeInnerOffset = delta;\n        }\n\n        if (topDelta < 0) {\n          usedBlockLength = block.length - blockInnerOffset;\n        } else {\n          usedBlockLength = top - block.offset - blockInnerOffset;\n        }\n\n        const blockView = new Uint8Array(block.data, blockInnerOffset, usedBlockLength);\n        sliceView.set(blockView, rangeInnerOffset);\n      }\n\n      return sliceData;\n    });\n  }\n}\n", "export class BaseResponse {\n  /**\n   * Returns whether the response has an ok'ish status code\n   */\n  get ok() {\n    return this.status >= 200 && this.status <= 299;\n  }\n\n  /**\n   * Returns the status code of the response\n   */\n  get status() {\n    throw new Error('not implemented');\n  }\n\n  /**\n   * Returns the value of the specified header\n   * @param {string} headerName the header name\n   * @returns {string} the header value\n   */\n  getHeader(headerName) { // eslint-disable-line no-unused-vars\n    throw new Error('not implemented');\n  }\n\n  /**\n   * @returns {ArrayBuffer} the response data of the request\n   */\n  async getData() {\n    throw new Error('not implemented');\n  }\n}\n\nexport class BaseClient {\n  constructor(url) {\n    this.url = url;\n  }\n\n  /**\n   * Send a request with the options\n   * @param {{headers: HeadersInit, signal: AbortSignal}} [options={}]\n   * @returns {Promise<BaseResponse>}\n   */\n  async request({ headers, signal } = {}) { // eslint-disable-line no-unused-vars\n    throw new Error('request is not implemented');\n  }\n}\n", "import { BaseClient, BaseResponse } from './base.js';\n\nclass FetchResponse extends BaseResponse {\n  /**\n   * BaseResponse facade for fetch API Response\n   * @param {Response} response\n   */\n  constructor(response) {\n    super();\n    this.response = response;\n  }\n\n  get status() {\n    return this.response.status;\n  }\n\n  getHeader(name) {\n    return this.response.headers.get(name);\n  }\n\n  async getData() {\n    const data = this.response.arrayBuffer\n      ? await this.response.arrayBuffer()\n      : (await this.response.buffer()).buffer;\n    return data;\n  }\n}\n\nexport class FetchClient extends BaseClient {\n  constructor(url, credentials) {\n    super(url);\n    this.credentials = credentials;\n  }\n\n  /**\n   * @param {{headers: HeadersInit, signal: AbortSignal}} [options={}]\n   * @returns {Promise<FetchResponse>}\n   */\n  async request({ headers, signal } = {}) {\n    const response = await fetch(this.url, {\n      headers, credentials: this.credentials, signal,\n    });\n    return new FetchResponse(response);\n  }\n}\n", "import { BaseClient, BaseResponse } from './base.js';\nimport { AbortError } from '../../utils.js';\n\nclass XHRResponse extends BaseResponse {\n  /**\n   * BaseResponse facade for XMLHttpRequest\n   * @param {XMLHttpRequest} xhr\n   * @param {ArrayBuffer} data\n   */\n  constructor(xhr, data) {\n    super();\n    this.xhr = xhr;\n    this.data = data;\n  }\n\n  get status() {\n    return this.xhr.status;\n  }\n\n  getHeader(name) {\n    return this.xhr.getResponseHeader(name);\n  }\n\n  async getData() {\n    return this.data;\n  }\n}\n\nexport class XHRClient extends BaseClient {\n  constructRequest(headers, signal) {\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.open('GET', this.url);\n      xhr.responseType = 'arraybuffer';\n      for (const [key, value] of Object.entries(headers)) {\n        xhr.setRequestHeader(key, value);\n      }\n\n      // hook signals\n      xhr.onload = () => {\n        const data = xhr.response;\n        resolve(new XHRResponse(xhr, data));\n      };\n      xhr.onerror = reject;\n      xhr.onabort = () => reject(new AbortError('Request aborted'));\n      xhr.send();\n\n      if (signal) {\n        if (signal.aborted) {\n          xhr.abort();\n        }\n        signal.addEventListener('abort', () => xhr.abort());\n      }\n    });\n  }\n\n  async request({ headers, signal } = {}) {\n    const response = await this.constructRequest(headers, signal);\n    return response;\n  }\n}\n", "module.exports = Object.create(new Proxy({}, {\n  get(_, key) {\n    if (\n      key !== '__esModule' &&\n      key !== '__proto__' &&\n      key !== 'constructor' &&\n      key !== 'splice'\n    ) {\n      console.warn(`Module \"http\" has been externalized for browser compatibility. Cannot access \"http.${key}\" in client code. See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n    }\n  }\n}))", "module.exports = Object.create(new Proxy({}, {\n  get(_, key) {\n    if (\n      key !== '__esModule' &&\n      key !== '__proto__' &&\n      key !== 'constructor' &&\n      key !== 'splice'\n    ) {\n      console.warn(`Module \"https\" has been externalized for browser compatibility. Cannot access \"https.${key}\" in client code. See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n    }\n  }\n}))", "module.exports = Object.create(new Proxy({}, {\n  get(_, key) {\n    if (\n      key !== '__esModule' &&\n      key !== '__proto__' &&\n      key !== 'constructor' &&\n      key !== 'splice'\n    ) {\n      console.warn(`Module \"url\" has been externalized for browser compatibility. Cannot access \"url.${key}\" in client code. See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n    }\n  }\n}))", "import http from 'http';\nimport https from 'https';\nimport urlMod from 'url';\n\nimport { BaseClient, BaseResponse } from './base.js';\nimport { AbortError } from '../../utils.js';\n\nclass HttpResponse extends BaseResponse {\n  /**\n   * BaseResponse facade for node HTTP/HTTPS API Response\n   * @param {http.ServerResponse} response\n   */\n  constructor(response, dataPromise) {\n    super();\n    this.response = response;\n    this.dataPromise = dataPromise;\n  }\n\n  get status() {\n    return this.response.statusCode;\n  }\n\n  getHeader(name) {\n    return this.response.headers[name];\n  }\n\n  async getData() {\n    const data = await this.dataPromise;\n    return data;\n  }\n}\n\nexport class HttpClient extends BaseClient {\n  constructor(url) {\n    super(url);\n    this.parsedUrl = urlMod.parse(this.url);\n    this.httpApi = (this.parsedUrl.protocol === 'http:' ? http : https);\n  }\n\n  constructRequest(headers, signal) {\n    return new Promise((resolve, reject) => {\n      const request = this.httpApi.get(\n        {\n          ...this.parsedUrl,\n          headers,\n        },\n        (response) => {\n          const dataPromise = new Promise((resolveData) => {\n            const chunks = [];\n\n            // collect chunks\n            response.on('data', (chunk) => {\n              chunks.push(chunk);\n            });\n\n            // concatenate all chunks and resolve the promise with the resulting buffer\n            response.on('end', () => {\n              const data = Buffer.concat(chunks).buffer;\n              resolveData(data);\n            });\n            response.on('error', reject);\n          });\n          resolve(new HttpResponse(response, dataPromise));\n        },\n      );\n      request.on('error', reject);\n\n      if (signal) {\n        if (signal.aborted) {\n          request.destroy(new AbortError('Request aborted'));\n        }\n        signal.addEventListener('abort', () => request.destroy(new AbortError('Request aborted')));\n      }\n    });\n  }\n\n  async request({ headers, signal } = {}) {\n    const response = await this.constructRequest(headers, signal);\n    return response;\n  }\n}\n", "import { parseByteRanges, parseContentRange, parseContentType } from './httputils.js';\nimport { BaseSource } from './basesource.js';\nimport { BlockedSource } from './blockedsource.js';\n\nimport { FetchClient } from './client/fetch.js';\nimport { XHRClient } from './client/xhr.js';\nimport { HttpClient } from './client/http.js';\n\nclass RemoteSource extends BaseSource {\n  /**\n   *\n   * @param {BaseClient} client\n   * @param {object} headers\n   * @param {numbers} maxRanges\n   * @param {boolean} allowFullFile\n   */\n  constructor(client, headers, maxRanges, allowFullFile) {\n    super();\n    this.client = client;\n    this.headers = headers;\n    this.maxRanges = maxRanges;\n    this.allowFullFile = allowFullFile;\n    this._fileSize = null;\n  }\n\n  /**\n   *\n   * @param {Slice[]} slices\n   */\n  async fetch(slices, signal) {\n    // if we allow multi-ranges, split the incoming request into that many sub-requests\n    // and join them afterwards\n    if (this.maxRanges >= slices.length) {\n      return this.fetchSlices(slices, signal);\n    } else if (this.maxRanges > 0 && slices.length > 1) {\n      // TODO: split into multiple multi-range requests\n\n      // const subSlicesRequests = [];\n      // for (let i = 0; i < slices.length; i += this.maxRanges) {\n      //   subSlicesRequests.push(\n      //     this.fetchSlices(slices.slice(i, i + this.maxRanges), signal),\n      //   );\n      // }\n      // return (await Promise.all(subSlicesRequests)).flat();\n    }\n\n    // otherwise make a single request for each slice\n    return Promise.all(\n      slices.map((slice) => this.fetchSlice(slice, signal)),\n    );\n  }\n\n  async fetchSlices(slices, signal) {\n    const response = await this.client.request({\n      headers: {\n        ...this.headers,\n        Range: `bytes=${slices\n          .map(({ offset, length }) => `${offset}-${offset + length}`)\n          .join(',')\n        }`,\n      },\n      signal,\n    });\n\n    if (!response.ok) {\n      throw new Error('Error fetching data.');\n    } else if (response.status === 206) {\n      const { type, params } = parseContentType(response.getHeader('content-type'));\n      if (type === 'multipart/byteranges') {\n        const byteRanges = parseByteRanges(await response.getData(), params.boundary);\n        this._fileSize = byteRanges[0].fileSize || null;\n        return byteRanges;\n      }\n\n      const data = await response.getData();\n\n      const { start, end, total } = parseContentRange(response.getHeader('content-range'));\n      this._fileSize = total || null;\n      const first = [{\n        data,\n        offset: start,\n        length: end - start,\n      }];\n\n      if (slices.length > 1) {\n        // we requested more than one slice, but got only the first\n        // unfortunately, some HTTP Servers don't support multi-ranges\n        // and return only the first\n\n        // get the rest of the slices and fetch them iteratively\n        const others = await Promise.all(slices.slice(1).map((slice) => this.fetchSlice(slice, signal)));\n        return first.concat(others);\n      }\n      return first;\n    } else {\n      if (!this.allowFullFile) {\n        throw new Error('Server responded with full file');\n      }\n      const data = await response.getData();\n      this._fileSize = data.byteLength;\n      return [{\n        data,\n        offset: 0,\n        length: data.byteLength,\n      }];\n    }\n  }\n\n  async fetchSlice(slice, signal) {\n    const { offset, length } = slice;\n    const response = await this.client.request({\n      headers: {\n        ...this.headers,\n        Range: `bytes=${offset}-${offset + length}`,\n      },\n      signal,\n    });\n\n    // check the response was okay and if the server actually understands range requests\n    if (!response.ok) {\n      throw new Error('Error fetching data.');\n    } else if (response.status === 206) {\n      const data = await response.getData();\n\n      const { total } = parseContentRange(response.getHeader('content-range'));\n      this._fileSize = total || null;\n      return {\n        data,\n        offset,\n        length,\n      };\n    } else {\n      if (!this.allowFullFile) {\n        throw new Error('Server responded with full file');\n      }\n\n      const data = await response.getData();\n\n      this._fileSize = data.byteLength;\n      return {\n        data,\n        offset: 0,\n        length: data.byteLength,\n      };\n    }\n  }\n\n  get fileSize() {\n    return this._fileSize;\n  }\n}\n\nfunction maybeWrapInBlockedSource(source, { blockSize, cacheSize }) {\n  if (blockSize === null) {\n    return source;\n  }\n  return new BlockedSource(source, { blockSize, cacheSize });\n}\n\nexport function makeFetchSource(url, { headers = {}, credentials, maxRanges = 0, allowFullFile = false, ...blockOptions } = {}) {\n  const client = new FetchClient(url, credentials);\n  const source = new RemoteSource(client, headers, maxRanges, allowFullFile);\n  return maybeWrapInBlockedSource(source, blockOptions);\n}\n\nexport function makeXHRSource(url, { headers = {}, maxRanges = 0, allowFullFile = false, ...blockOptions } = {}) {\n  const client = new XHRClient(url);\n  const source = new RemoteSource(client, headers, maxRanges, allowFullFile);\n  return maybeWrapInBlockedSource(source, blockOptions);\n}\n\nexport function makeHttpSource(url, { headers = {}, maxRanges = 0, allowFullFile = false, ...blockOptions } = {}) {\n  const client = new HttpClient(url);\n  const source = new RemoteSource(client, headers, maxRanges, allowFullFile);\n  return maybeWrapInBlockedSource(source, blockOptions);\n}\n\nexport function makeCustomSource(client, { headers = {}, maxRanges = 0, allowFullFile = false, ...blockOptions } = {}) {\n  const source = new RemoteSource(client, headers, maxRanges, allowFullFile);\n  return maybeWrapInBlockedSource(source, blockOptions);\n}\n\n/**\n *\n * @param {string} url\n * @param {object} options\n */\nexport function makeRemoteSource(url, { forceXHR = false, ...clientOptions } = {}) {\n  if (typeof fetch === 'function' && !forceXHR) {\n    return makeFetchSource(url, clientOptions);\n  }\n  if (typeof XMLHttpRequest !== 'undefined') {\n    return makeXHRSource(url, clientOptions);\n  }\n  return makeHttpSource(url, clientOptions);\n}\n", "import { BaseSource } from './basesource.js';\nimport { AbortError } from '../utils.js';\n\nclass ArrayBufferSource extends BaseSource {\n  constructor(arrayBuffer) {\n    super();\n    this.arrayBuffer = arrayBuffer;\n  }\n\n  fetchSlice(slice, signal) {\n    if (signal && signal.aborted) {\n      throw new AbortError('Request aborted');\n    }\n    return this.arrayBuffer.slice(slice.offset, slice.offset + slice.length);\n  }\n}\n\nexport function makeBufferSource(arrayBuffer) {\n  return new ArrayBufferSource(arrayBuffer);\n}\n", "import { BaseSource } from './basesource.js';\n\nclass FileReaderSource extends BaseSource {\n  constructor(file) {\n    super();\n    this.file = file;\n  }\n\n  async fetchSlice(slice, signal) {\n    return new Promise((resolve, reject) => {\n      const blob = this.file.slice(slice.offset, slice.offset + slice.length);\n      const reader = new FileReader();\n      reader.onload = (event) => resolve(event.target.result);\n      reader.onerror = reject;\n      reader.onabort = reject;\n      reader.readAsArrayBuffer(blob);\n\n      if (signal) {\n        signal.addEventListener('abort', () => reader.abort());\n      }\n    });\n  }\n}\n\n/**\n * Create a new source from a given file/blob.\n * @param {Blob} file The file or blob to read from.\n * @returns The constructed source\n */\nexport function makeFileReaderSource(file) {\n  return new FileReaderSource(file);\n}\n", "module.exports = Object.create(new Proxy({}, {\n  get(_, key) {\n    if (\n      key !== '__esModule' &&\n      key !== '__proto__' &&\n      key !== 'constructor' &&\n      key !== 'splice'\n    ) {\n      console.warn(`Module \"fs\" has been externalized for browser compatibility. Cannot access \"fs.${key}\" in client code. See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n    }\n  }\n}))", "import fs from 'fs';\nimport { BaseSource } from './basesource.js';\n\nfunction closeAsync(fd) {\n  return new Promise((resolve, reject) => {\n    fs.close(fd, (err) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nfunction openAsync(path, flags, mode = undefined) {\n  return new Promise((resolve, reject) => {\n    fs.open(path, flags, mode, (err, fd) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(fd);\n      }\n    });\n  });\n}\n\nfunction readAsync(...args) {\n  return new Promise((resolve, reject) => {\n    fs.read(...args, (err, bytesRead, buffer) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve({ bytesRead, buffer });\n      }\n    });\n  });\n}\n\nclass FileSource extends BaseSource {\n  constructor(path) {\n    super();\n    this.path = path;\n    this.openRequest = openAsync(path, 'r');\n  }\n\n  async fetchSlice(slice) {\n    // TODO: use `signal`\n    const fd = await this.openRequest;\n    const { buffer } = await readAsync(\n      fd,\n      Buffer.alloc(slice.length),\n      0,\n      slice.length,\n      slice.offset,\n    );\n    return buffer.buffer;\n  }\n\n  async close() {\n    const fd = await this.openRequest;\n    await closeAsync(fd);\n  }\n}\n\nexport function makeFileSource(path) {\n  return new FileSource(path);\n}\n", "/*\n  Some parts of this file are based on UTIF.js,\n  which was released under the MIT License.\n  You can view that here:\n  https://github.com/photopea/UTIF.js/blob/master/LICENSE\n*/\nimport { fieldTagNames, fieldTagTypes, fieldTypeNames, geoKeyNames } from './globals.js';\nimport { assign, endsWith, forEach, invert, times } from './utils.js';\n\nconst tagName2Code = invert(fieldTagNames);\nconst geoKeyName2Code = invert(geoKeyNames);\nconst name2code = {};\nassign(name2code, tagName2Code);\nassign(name2code, geoKeyName2Code);\nconst typeName2byte = invert(fieldTypeNames);\n\n// config variables\nconst numBytesInIfd = 1000;\n\nconst _binBE = {\n  nextZero: (data, o) => {\n    let oincr = o;\n    while (data[oincr] !== 0) {\n      oincr++;\n    }\n    return oincr;\n  },\n  readUshort: (buff, p) => {\n    return (buff[p] << 8) | buff[p + 1];\n  },\n  readShort: (buff, p) => {\n    const a = _binBE.ui8;\n    a[0] = buff[p + 1];\n    a[1] = buff[p + 0];\n    return _binBE.i16[0];\n  },\n  readInt: (buff, p) => {\n    const a = _binBE.ui8;\n    a[0] = buff[p + 3];\n    a[1] = buff[p + 2];\n    a[2] = buff[p + 1];\n    a[3] = buff[p + 0];\n    return _binBE.i32[0];\n  },\n  readUint: (buff, p) => {\n    const a = _binBE.ui8;\n    a[0] = buff[p + 3];\n    a[1] = buff[p + 2];\n    a[2] = buff[p + 1];\n    a[3] = buff[p + 0];\n    return _binBE.ui32[0];\n  },\n  readASCII: (buff, p, l) => {\n    return l.map((i) => String.fromCharCode(buff[p + i])).join('');\n  },\n  readFloat: (buff, p) => {\n    const a = _binBE.ui8;\n    times(4, (i) => {\n      a[i] = buff[p + 3 - i];\n    });\n    return _binBE.fl32[0];\n  },\n  readDouble: (buff, p) => {\n    const a = _binBE.ui8;\n    times(8, (i) => {\n      a[i] = buff[p + 7 - i];\n    });\n    return _binBE.fl64[0];\n  },\n  writeUshort: (buff, p, n) => {\n    buff[p] = (n >> 8) & 255;\n    buff[p + 1] = n & 255;\n  },\n  writeUint: (buff, p, n) => {\n    buff[p] = (n >> 24) & 255;\n    buff[p + 1] = (n >> 16) & 255;\n    buff[p + 2] = (n >> 8) & 255;\n    buff[p + 3] = (n >> 0) & 255;\n  },\n  writeASCII: (buff, p, s) => {\n    times(s.length, (i) => {\n      buff[p + i] = s.charCodeAt(i);\n    });\n  },\n  ui8: new Uint8Array(8),\n};\n\n_binBE.fl64 = new Float64Array(_binBE.ui8.buffer);\n\n_binBE.writeDouble = (buff, p, n) => {\n  _binBE.fl64[0] = n;\n  times(8, (i) => {\n    buff[p + i] = _binBE.ui8[7 - i];\n  });\n};\n\nconst _writeIFD = (bin, data, _offset, ifd) => {\n  let offset = _offset;\n\n  const keys = Object.keys(ifd).filter((key) => {\n    return key !== undefined && key !== null && key !== 'undefined';\n  });\n\n  bin.writeUshort(data, offset, keys.length);\n  offset += 2;\n\n  let eoff = offset + (12 * keys.length) + 4;\n\n  for (const key of keys) {\n    let tag = null;\n    if (typeof key === 'number') {\n      tag = key;\n    } else if (typeof key === 'string') {\n      tag = parseInt(key, 10);\n    }\n\n    const typeName = fieldTagTypes[tag];\n    const typeNum = typeName2byte[typeName];\n\n    if (typeName == null || typeName === undefined || typeof typeName === 'undefined') {\n      throw new Error(`unknown type of tag: ${tag}`);\n    }\n\n    let val = ifd[key];\n\n    if (val === undefined) {\n      throw new Error(`failed to get value for key ${key}`);\n    }\n\n    // ASCIIZ format with trailing 0 character\n    // http://www.fileformat.info/format/tiff/corion.htm\n    // https://stackoverflow.com/questions/7783044/whats-the-difference-between-asciiz-vs-ascii\n    if (typeName === 'ASCII' && typeof val === 'string' && endsWith(val, '\\u0000') === false) {\n      val += '\\u0000';\n    }\n\n    const num = val.length;\n\n    bin.writeUshort(data, offset, tag);\n    offset += 2;\n\n    bin.writeUshort(data, offset, typeNum);\n    offset += 2;\n\n    bin.writeUint(data, offset, num);\n    offset += 4;\n\n    let dlen = [-1, 1, 1, 2, 4, 8, 0, 0, 0, 0, 0, 0, 8][typeNum] * num;\n    let toff = offset;\n\n    if (dlen > 4) {\n      bin.writeUint(data, offset, eoff);\n      toff = eoff;\n    }\n\n    if (typeName === 'ASCII') {\n      bin.writeASCII(data, toff, val);\n    } else if (typeName === 'SHORT') {\n      times(num, (i) => {\n        bin.writeUshort(data, toff + (2 * i), val[i]);\n      });\n    } else if (typeName === 'LONG') {\n      times(num, (i) => {\n        bin.writeUint(data, toff + (4 * i), val[i]);\n      });\n    } else if (typeName === 'RATIONAL') {\n      times(num, (i) => {\n        bin.writeUint(data, toff + (8 * i), Math.round(val[i] * 10000));\n        bin.writeUint(data, toff + (8 * i) + 4, 10000);\n      });\n    } else if (typeName === 'DOUBLE') {\n      times(num, (i) => {\n        bin.writeDouble(data, toff + (8 * i), val[i]);\n      });\n    }\n\n    if (dlen > 4) {\n      dlen += (dlen & 1);\n      eoff += dlen;\n    }\n\n    offset += 4;\n  }\n\n  return [offset, eoff];\n};\n\nconst encodeIfds = (ifds) => {\n  const data = new Uint8Array(numBytesInIfd);\n  let offset = 4;\n  const bin = _binBE;\n\n  // set big-endian byte-order\n  // https://en.wikipedia.org/wiki/TIFF#Byte_order\n  data[0] = 77;\n  data[1] = 77;\n\n  // set format-version number\n  // https://en.wikipedia.org/wiki/TIFF#Byte_order\n  data[3] = 42;\n\n  let ifdo = 8;\n\n  bin.writeUint(data, offset, ifdo);\n\n  offset += 4;\n\n  ifds.forEach((ifd, i) => {\n    const noffs = _writeIFD(bin, data, ifdo, ifd);\n    ifdo = noffs[1];\n    if (i < ifds.length - 1) {\n      bin.writeUint(data, noffs[0], ifdo);\n    }\n  });\n\n  if (data.slice) {\n    return data.slice(0, ifdo).buffer;\n  }\n\n  // node hasn't implemented slice on Uint8Array yet\n  const result = new Uint8Array(ifdo);\n  for (let i = 0; i < ifdo; i++) {\n    result[i] = data[i];\n  }\n  return result.buffer;\n};\n\nconst encodeImage = (values, width, height, metadata) => {\n  if (height === undefined || height === null) {\n    throw new Error(`you passed into encodeImage a width of type ${height}`);\n  }\n\n  if (width === undefined || width === null) {\n    throw new Error(`you passed into encodeImage a width of type ${width}`);\n  }\n\n  const ifd = {\n    256: [width], // ImageWidth\n    257: [height], // ImageLength\n    273: [numBytesInIfd], // strips offset\n    278: [height], // RowsPerStrip\n    305: 'geotiff.js', // no array for ASCII(Z)\n  };\n\n  if (metadata) {\n    for (const i in metadata) {\n      if (metadata.hasOwnProperty(i)) {\n        ifd[i] = metadata[i];\n      }\n    }\n  }\n\n  const prfx = new Uint8Array(encodeIfds([ifd]));\n\n  const img = new Uint8Array(values);\n\n  const samplesPerPixel = ifd[277];\n\n  const data = new Uint8Array(numBytesInIfd + (width * height * samplesPerPixel));\n  times(prfx.length, (i) => {\n    data[i] = prfx[i];\n  });\n  forEach(img, (value, i) => {\n    data[numBytesInIfd + i] = value;\n  });\n\n  return data.buffer;\n};\n\nconst convertToTids = (input) => {\n  const result = {};\n  for (const key in input) {\n    if (key !== 'StripOffsets') {\n      if (!name2code[key]) {\n        console.error(key, 'not in name2code:', Object.keys(name2code));\n      }\n      result[name2code[key]] = input[key];\n    }\n  }\n  return result;\n};\n\nconst toArray = (input) => {\n  if (Array.isArray(input)) {\n    return input;\n  }\n  return [input];\n};\n\nconst metadataDefaults = [\n  ['Compression', 1], // no compression\n  ['PlanarConfiguration', 1],\n  ['ExtraSamples', 0],\n];\n\nexport function writeGeotiff(data, metadata) {\n  const isFlattened = typeof data[0] === 'number';\n\n  let height;\n  let numBands;\n  let width;\n  let flattenedValues;\n\n  if (isFlattened) {\n    height = metadata.height || metadata.ImageLength;\n    width = metadata.width || metadata.ImageWidth;\n    numBands = data.length / (height * width);\n    flattenedValues = data;\n  } else {\n    numBands = data.length;\n    height = data[0].length;\n    width = data[0][0].length;\n    flattenedValues = [];\n    times(height, (rowIndex) => {\n      times(width, (columnIndex) => {\n        times(numBands, (bandIndex) => {\n          flattenedValues.push(data[bandIndex][rowIndex][columnIndex]);\n        });\n      });\n    });\n  }\n\n  metadata.ImageLength = height;\n  delete metadata.height;\n  metadata.ImageWidth = width;\n  delete metadata.width;\n\n  // consult https://www.loc.gov/preservation/digital/formats/content/tiff_tags.shtml\n\n  if (!metadata.BitsPerSample) {\n    metadata.BitsPerSample = times(numBands, () => 8);\n  }\n\n  metadataDefaults.forEach((tag) => {\n    const key = tag[0];\n    if (!metadata[key]) {\n      const value = tag[1];\n      metadata[key] = value;\n    }\n  });\n\n  // The color space of the image data.\n  // 1=black is zero and 2=RGB.\n  if (!metadata.PhotometricInterpretation) {\n    metadata.PhotometricInterpretation = metadata.BitsPerSample.length === 3 ? 2 : 1;\n  }\n\n  // The number of components per pixel.\n  if (!metadata.SamplesPerPixel) {\n    metadata.SamplesPerPixel = [numBands];\n  }\n\n  if (!metadata.StripByteCounts) {\n    // we are only writing one strip\n    metadata.StripByteCounts = [numBands * height * width];\n  }\n\n  if (!metadata.ModelPixelScale) {\n    // assumes raster takes up exactly the whole globe\n    metadata.ModelPixelScale = [360 / width, 180 / height, 0];\n  }\n\n  if (!metadata.SampleFormat) {\n    metadata.SampleFormat = times(numBands, () => 1);\n  }\n\n  // if didn't pass in projection information, assume the popular 4326 \"geographic projection\"\n  if (!metadata.hasOwnProperty('GeographicTypeGeoKey') && !metadata.hasOwnProperty('ProjectedCSTypeGeoKey')) {\n    metadata.GeographicTypeGeoKey = 4326;\n    metadata.ModelTiepoint = [0, 0, 0, -180, 90, 0]; // raster fits whole globe\n    metadata.GeogCitationGeoKey = 'WGS 84';\n    metadata.GTModelTypeGeoKey = 2;\n  }\n\n  const geoKeys = Object.keys(metadata)\n    .filter((key) => endsWith(key, 'GeoKey'))\n    .sort((a, b) => name2code[a] - name2code[b]);\n\n  if (!metadata.GeoAsciiParams) {\n    let geoAsciiParams = '';\n    geoKeys.forEach((name) => {\n      const code = Number(name2code[name]);\n      const tagType = fieldTagTypes[code];\n      if (tagType === 'ASCII') {\n        geoAsciiParams += `${metadata[name].toString()}\\u0000`;\n      }\n    });\n    if (geoAsciiParams.length > 0) {\n      metadata.GeoAsciiParams = geoAsciiParams;\n    }\n  }\n\n  if (!metadata.GeoKeyDirectory) {\n    const NumberOfKeys = geoKeys.length;\n\n    const GeoKeyDirectory = [1, 1, 0, NumberOfKeys];\n    geoKeys.forEach((geoKey) => {\n      const KeyID = Number(name2code[geoKey]);\n      GeoKeyDirectory.push(KeyID);\n\n      let Count;\n      let TIFFTagLocation;\n      let valueOffset;\n      if (fieldTagTypes[KeyID] === 'SHORT') {\n        Count = 1;\n        TIFFTagLocation = 0;\n        valueOffset = metadata[geoKey];\n      } else if (geoKey === 'GeogCitationGeoKey') {\n        Count = metadata.GeoAsciiParams.length;\n        TIFFTagLocation = Number(name2code.GeoAsciiParams);\n        valueOffset = 0;\n      } else {\n        console.log(`[geotiff.js] couldn't get TIFFTagLocation for ${geoKey}`);\n      }\n      GeoKeyDirectory.push(TIFFTagLocation);\n      GeoKeyDirectory.push(Count);\n      GeoKeyDirectory.push(valueOffset);\n    });\n    metadata.GeoKeyDirectory = GeoKeyDirectory;\n  }\n\n  // delete GeoKeys from metadata, because stored in GeoKeyDirectory tag\n  for (const geoKey of geoKeys) {\n    if (metadata.hasOwnProperty(geoKey)) {\n      delete metadata[geoKey];\n    }\n  }\n\n  [\n    'Compression',\n    'ExtraSamples',\n    'GeographicTypeGeoKey',\n    'GTModelTypeGeoKey',\n    'GTRasterTypeGeoKey',\n    'ImageLength', // synonym of ImageHeight\n    'ImageWidth',\n    'Orientation',\n    'PhotometricInterpretation',\n    'ProjectedCSTypeGeoKey',\n    'PlanarConfiguration',\n    'ResolutionUnit',\n    'SamplesPerPixel',\n    'XPosition',\n    'YPosition',\n    'RowsPerStrip',\n  ].forEach((name) => {\n    if (metadata[name]) {\n      metadata[name] = toArray(metadata[name]);\n    }\n  });\n\n  const encodedMetadata = convertToTids(metadata);\n\n  const outputImage = encodeImage(flattenedValues, width, height, encodedMetadata);\n\n  return outputImage;\n}\n", "/**\n * A no-op logger\n */\nclass DummyLogger {\n  log() {}\n\n  debug() {}\n\n  info() {}\n\n  warn() {}\n\n  error() {}\n\n  time() {}\n\n  timeEnd() {}\n}\n\nlet LOGGER = new DummyLogger();\n\n/**\n *\n * @param {object} logger the new logger. e.g `console`\n */\nexport function setLogger(logger = new DummyLogger()) {\n  LOGGER = logger;\n}\n\nexport function debug(...args) {\n  return LOGGER.debug(...args);\n}\n\nexport function log(...args) {\n  return LOGGER.log(...args);\n}\n\nexport function info(...args) {\n  return LOGGER.info(...args);\n}\n\nexport function warn(...args) {\n  return LOGGER.warn(...args);\n}\n\nexport function error(...args) {\n  return LOGGER.error(...args);\n}\n\nexport function time(...args) {\n  return LOGGER.time(...args);\n}\n\nexport function timeEnd(...args) {\n  return LOGGER.timeEnd(...args);\n}\n", "/** @module geotiff */\nimport GeoTIFFImage from './geotiffimage.js';\nimport DataView64 from './dataview64.js';\nimport DataSlice from './dataslice.js';\nimport Pool from './pool.js';\n\nimport { makeRemoteSource, makeCustomSource } from './source/remote.js';\nimport { makeBufferSource } from './source/arraybuffer.js';\nimport { makeFileReaderSource } from './source/filereader.js';\nimport { makeFileSource } from './source/file.js';\nimport { BaseClient, BaseResponse } from './source/client/base.js';\n\nimport { fieldTypes, fieldTagNames, arrayFields, geoKeyNames } from './globals.js';\nimport { writeGeotiff } from './geotiffwriter.js';\nimport * as globals from './globals.js';\nimport * as rgb from './rgb.js';\nimport { getDecoder, addDecoder } from './compression/index.js';\nimport { setLogger } from './logging.js';\n\nexport { globals };\nexport { rgb };\nexport { default as BaseDecoder } from './compression/basedecoder.js';\nexport { getDecoder, addDecoder };\nexport { setLogger };\n\n/**\n * @typedef {Uint8Array | Int8Array | Uint16Array | Int16Array | Uint32Array | Int32Array | Float32Array | Float64Array}\n * TypedArray\n */\n\n/**\n * @typedef {{ height:number, width: number }} Dimensions\n */\n\n/**\n * The autogenerated docs are a little confusing here. The effective type is:\n *\n * `TypedArray & { height: number; width: number}`\n * @typedef {TypedArray & Dimensions} TypedArrayWithDimensions\n */\n\n/**\n * The autogenerated docs are a little confusing here. The effective type is:\n *\n * `TypedArray[] & { height: number; width: number}`\n * @typedef {TypedArray[] & Dimensions} TypedArrayArrayWithDimensions\n */\n\n/**\n *  The autogenerated docs are a little confusing here. The effective type is:\n *\n * `(TypedArray | TypedArray[]) & { height: number; width: number}`\n * @typedef {TypedArrayWithDimensions | TypedArrayArrayWithDimensions} ReadRasterResult\n */\n\nfunction getFieldTypeLength(fieldType) {\n  switch (fieldType) {\n    case fieldTypes.BYTE: case fieldTypes.ASCII: case fieldTypes.SBYTE: case fieldTypes.UNDEFINED:\n      return 1;\n    case fieldTypes.SHORT: case fieldTypes.SSHORT:\n      return 2;\n    case fieldTypes.LONG: case fieldTypes.SLONG: case fieldTypes.FLOAT: case fieldTypes.IFD:\n      return 4;\n    case fieldTypes.RATIONAL: case fieldTypes.SRATIONAL: case fieldTypes.DOUBLE:\n    case fieldTypes.LONG8: case fieldTypes.SLONG8: case fieldTypes.IFD8:\n      return 8;\n    default:\n      throw new RangeError(`Invalid field type: ${fieldType}`);\n  }\n}\n\nfunction parseGeoKeyDirectory(fileDirectory) {\n  const rawGeoKeyDirectory = fileDirectory.GeoKeyDirectory;\n  if (!rawGeoKeyDirectory) {\n    return null;\n  }\n\n  const geoKeyDirectory = {};\n  for (let i = 4; i <= rawGeoKeyDirectory[3] * 4; i += 4) {\n    const key = geoKeyNames[rawGeoKeyDirectory[i]];\n    const location = (rawGeoKeyDirectory[i + 1])\n      ? (fieldTagNames[rawGeoKeyDirectory[i + 1]]) : null;\n    const count = rawGeoKeyDirectory[i + 2];\n    const offset = rawGeoKeyDirectory[i + 3];\n\n    let value = null;\n    if (!location) {\n      value = offset;\n    } else {\n      value = fileDirectory[location];\n      if (typeof value === 'undefined' || value === null) {\n        throw new Error(`Could not get value of geoKey '${key}'.`);\n      } else if (typeof value === 'string') {\n        value = value.substring(offset, offset + count - 1);\n      } else if (value.subarray) {\n        value = value.subarray(offset, offset + count);\n        if (count === 1) {\n          value = value[0];\n        }\n      }\n    }\n    geoKeyDirectory[key] = value;\n  }\n  return geoKeyDirectory;\n}\n\nfunction getValues(dataSlice, fieldType, count, offset) {\n  let values = null;\n  let readMethod = null;\n  const fieldTypeLength = getFieldTypeLength(fieldType);\n\n  switch (fieldType) {\n    case fieldTypes.BYTE: case fieldTypes.ASCII: case fieldTypes.UNDEFINED:\n      values = new Uint8Array(count); readMethod = dataSlice.readUint8;\n      break;\n    case fieldTypes.SBYTE:\n      values = new Int8Array(count); readMethod = dataSlice.readInt8;\n      break;\n    case fieldTypes.SHORT:\n      values = new Uint16Array(count); readMethod = dataSlice.readUint16;\n      break;\n    case fieldTypes.SSHORT:\n      values = new Int16Array(count); readMethod = dataSlice.readInt16;\n      break;\n    case fieldTypes.LONG: case fieldTypes.IFD:\n      values = new Uint32Array(count); readMethod = dataSlice.readUint32;\n      break;\n    case fieldTypes.SLONG:\n      values = new Int32Array(count); readMethod = dataSlice.readInt32;\n      break;\n    case fieldTypes.LONG8: case fieldTypes.IFD8:\n      values = new Array(count); readMethod = dataSlice.readUint64;\n      break;\n    case fieldTypes.SLONG8:\n      values = new Array(count); readMethod = dataSlice.readInt64;\n      break;\n    case fieldTypes.RATIONAL:\n      values = new Uint32Array(count * 2); readMethod = dataSlice.readUint32;\n      break;\n    case fieldTypes.SRATIONAL:\n      values = new Int32Array(count * 2); readMethod = dataSlice.readInt32;\n      break;\n    case fieldTypes.FLOAT:\n      values = new Float32Array(count); readMethod = dataSlice.readFloat32;\n      break;\n    case fieldTypes.DOUBLE:\n      values = new Float64Array(count); readMethod = dataSlice.readFloat64;\n      break;\n    default:\n      throw new RangeError(`Invalid field type: ${fieldType}`);\n  }\n\n  // normal fields\n  if (!(fieldType === fieldTypes.RATIONAL || fieldType === fieldTypes.SRATIONAL)) {\n    for (let i = 0; i < count; ++i) {\n      values[i] = readMethod.call(\n        dataSlice, offset + (i * fieldTypeLength),\n      );\n    }\n  } else { // RATIONAL or SRATIONAL\n    for (let i = 0; i < count; i += 2) {\n      values[i] = readMethod.call(\n        dataSlice, offset + (i * fieldTypeLength),\n      );\n      values[i + 1] = readMethod.call(\n        dataSlice, offset + ((i * fieldTypeLength) + 4),\n      );\n    }\n  }\n\n  if (fieldType === fieldTypes.ASCII) {\n    return new TextDecoder('utf-8').decode(values);\n  }\n  return values;\n}\n\n/**\n * Data class to store the parsed file directory, geo key directory and\n * offset to the next IFD\n */\nclass ImageFileDirectory {\n  constructor(fileDirectory, geoKeyDirectory, nextIFDByteOffset) {\n    this.fileDirectory = fileDirectory;\n    this.geoKeyDirectory = geoKeyDirectory;\n    this.nextIFDByteOffset = nextIFDByteOffset;\n  }\n}\n\n/**\n * Error class for cases when an IFD index was requested, that does not exist\n * in the file.\n */\nclass GeoTIFFImageIndexError extends Error {\n  constructor(index) {\n    super(`No image at index ${index}`);\n    this.index = index;\n  }\n}\n\nclass GeoTIFFBase {\n  /**\n   * (experimental) Reads raster data from the best fitting image. This function uses\n   * the image with the lowest resolution that is still a higher resolution than the\n   * requested resolution.\n   * When specified, the `bbox` option is translated to the `window` option and the\n   * `resX` and `resY` to `width` and `height` respectively.\n   * Then, the [readRasters]{@link GeoTIFFImage#readRasters} method of the selected\n   * image is called and the result returned.\n   * @see GeoTIFFImage.readRasters\n   * @param {import('./geotiffimage').ReadRasterOptions} [options={}] optional parameters\n   * @returns {Promise<ReadRasterResult>} the decoded array(s), with `height` and `width`, as a promise\n   */\n  async readRasters(options = {}) {\n    const { window: imageWindow, width, height } = options;\n    let { resX, resY, bbox } = options;\n\n    const firstImage = await this.getImage();\n    let usedImage = firstImage;\n    const imageCount = await this.getImageCount();\n    const imgBBox = firstImage.getBoundingBox();\n\n    if (imageWindow && bbox) {\n      throw new Error('Both \"bbox\" and \"window\" passed.');\n    }\n\n    // if width/height is passed, transform it to resolution\n    if (width || height) {\n      // if we have an image window (pixel coordinates), transform it to a BBox\n      // using the origin/resolution of the first image.\n      if (imageWindow) {\n        const [oX, oY] = firstImage.getOrigin();\n        const [rX, rY] = firstImage.getResolution();\n\n        bbox = [\n          oX + (imageWindow[0] * rX),\n          oY + (imageWindow[1] * rY),\n          oX + (imageWindow[2] * rX),\n          oY + (imageWindow[3] * rY),\n        ];\n      }\n\n      // if we have a bbox (or calculated one)\n\n      const usedBBox = bbox || imgBBox;\n\n      if (width) {\n        if (resX) {\n          throw new Error('Both width and resX passed');\n        }\n        resX = (usedBBox[2] - usedBBox[0]) / width;\n      }\n      if (height) {\n        if (resY) {\n          throw new Error('Both width and resY passed');\n        }\n        resY = (usedBBox[3] - usedBBox[1]) / height;\n      }\n    }\n\n    // if resolution is set or calculated, try to get the image with the worst acceptable resolution\n    if (resX || resY) {\n      const allImages = [];\n      for (let i = 0; i < imageCount; ++i) {\n        const image = await this.getImage(i);\n        const { SubfileType: subfileType, NewSubfileType: newSubfileType } = image.fileDirectory;\n        if (i === 0 || subfileType === 2 || newSubfileType & 1) {\n          allImages.push(image);\n        }\n      }\n\n      allImages.sort((a, b) => a.getWidth() - b.getWidth());\n      for (let i = 0; i < allImages.length; ++i) {\n        const image = allImages[i];\n        const imgResX = (imgBBox[2] - imgBBox[0]) / image.getWidth();\n        const imgResY = (imgBBox[3] - imgBBox[1]) / image.getHeight();\n\n        usedImage = image;\n        if ((resX && resX > imgResX) || (resY && resY > imgResY)) {\n          break;\n        }\n      }\n    }\n\n    let wnd = imageWindow;\n    if (bbox) {\n      const [oX, oY] = firstImage.getOrigin();\n      const [imageResX, imageResY] = usedImage.getResolution(firstImage);\n\n      wnd = [\n        Math.round((bbox[0] - oX) / imageResX),\n        Math.round((bbox[1] - oY) / imageResY),\n        Math.round((bbox[2] - oX) / imageResX),\n        Math.round((bbox[3] - oY) / imageResY),\n      ];\n      wnd = [\n        Math.min(wnd[0], wnd[2]),\n        Math.min(wnd[1], wnd[3]),\n        Math.max(wnd[0], wnd[2]),\n        Math.max(wnd[1], wnd[3]),\n      ];\n    }\n\n    return usedImage.readRasters({ ...options, window: wnd });\n  }\n}\n\n/**\n * @typedef {Object} GeoTIFFOptions\n * @property {boolean} [cache=false] whether or not decoded tiles shall be cached.\n */\n\n/**\n * The abstraction for a whole GeoTIFF file.\n * @augments GeoTIFFBase\n */\nclass GeoTIFF extends GeoTIFFBase {\n  /**\n   * @constructor\n   * @param {*} source The datasource to read from.\n   * @param {boolean} littleEndian Whether the image uses little endian.\n   * @param {boolean} bigTiff Whether the image uses bigTIFF conventions.\n   * @param {number} firstIFDOffset The numeric byte-offset from the start of the image\n   *                                to the first IFD.\n   * @param {GeoTIFFOptions} [options] further options.\n   */\n  constructor(source, littleEndian, bigTiff, firstIFDOffset, options = {}) {\n    super();\n    this.source = source;\n    this.littleEndian = littleEndian;\n    this.bigTiff = bigTiff;\n    this.firstIFDOffset = firstIFDOffset;\n    this.cache = options.cache || false;\n    this.ifdRequests = [];\n    this.ghostValues = null;\n  }\n\n  async getSlice(offset, size) {\n    const fallbackSize = this.bigTiff ? 4048 : 1024;\n    return new DataSlice(\n      (await this.source.fetch([{\n        offset,\n        length: typeof size !== 'undefined' ? size : fallbackSize,\n      }]))[0],\n      offset,\n      this.littleEndian,\n      this.bigTiff,\n    );\n  }\n\n  /**\n   * Instructs to parse an image file directory at the given file offset.\n   * As there is no way to ensure that a location is indeed the start of an IFD,\n   * this function must be called with caution (e.g only using the IFD offsets from\n   * the headers or other IFDs).\n   * @param {number} offset the offset to parse the IFD at\n   * @returns {Promise<ImageFileDirectory>} the parsed IFD\n   */\n  async parseFileDirectoryAt(offset) {\n    const entrySize = this.bigTiff ? 20 : 12;\n    const offsetSize = this.bigTiff ? 8 : 2;\n\n    let dataSlice = await this.getSlice(offset);\n    const numDirEntries = this.bigTiff\n      ? dataSlice.readUint64(offset)\n      : dataSlice.readUint16(offset);\n\n    // if the slice does not cover the whole IFD, request a bigger slice, where the\n    // whole IFD fits: num of entries + n x tag length + offset to next IFD\n    const byteSize = (numDirEntries * entrySize) + (this.bigTiff ? 16 : 6);\n    if (!dataSlice.covers(offset, byteSize)) {\n      dataSlice = await this.getSlice(offset, byteSize);\n    }\n\n    const fileDirectory = {};\n\n    // loop over the IFD and create a file directory object\n    let i = offset + (this.bigTiff ? 8 : 2);\n    for (let entryCount = 0; entryCount < numDirEntries; i += entrySize, ++entryCount) {\n      const fieldTag = dataSlice.readUint16(i);\n      const fieldType = dataSlice.readUint16(i + 2);\n      const typeCount = this.bigTiff\n        ? dataSlice.readUint64(i + 4)\n        : dataSlice.readUint32(i + 4);\n\n      let fieldValues;\n      let value;\n      const fieldTypeLength = getFieldTypeLength(fieldType);\n      const valueOffset = i + (this.bigTiff ? 12 : 8);\n\n      // check whether the value is directly encoded in the tag or refers to a\n      // different external byte range\n      if (fieldTypeLength * typeCount <= (this.bigTiff ? 8 : 4)) {\n        fieldValues = getValues(dataSlice, fieldType, typeCount, valueOffset);\n      } else {\n        // resolve the reference to the actual byte range\n        const actualOffset = dataSlice.readOffset(valueOffset);\n        const length = getFieldTypeLength(fieldType) * typeCount;\n\n        // check, whether we actually cover the referenced byte range; if not,\n        // request a new slice of bytes to read from it\n        if (dataSlice.covers(actualOffset, length)) {\n          fieldValues = getValues(dataSlice, fieldType, typeCount, actualOffset);\n        } else {\n          const fieldDataSlice = await this.getSlice(actualOffset, length);\n          fieldValues = getValues(fieldDataSlice, fieldType, typeCount, actualOffset);\n        }\n      }\n\n      // unpack single values from the array\n      if (typeCount === 1 && arrayFields.indexOf(fieldTag) === -1\n        && !(fieldType === fieldTypes.RATIONAL || fieldType === fieldTypes.SRATIONAL)) {\n        value = fieldValues[0];\n      } else {\n        value = fieldValues;\n      }\n\n      // write the tags value to the file directly\n      fileDirectory[fieldTagNames[fieldTag]] = value;\n    }\n    const geoKeyDirectory = parseGeoKeyDirectory(fileDirectory);\n    const nextIFDByteOffset = dataSlice.readOffset(\n      offset + offsetSize + (entrySize * numDirEntries),\n    );\n\n    return new ImageFileDirectory(\n      fileDirectory,\n      geoKeyDirectory,\n      nextIFDByteOffset,\n    );\n  }\n\n  async requestIFD(index) {\n    // see if we already have that IFD index requested.\n    if (this.ifdRequests[index]) {\n      // attach to an already requested IFD\n      return this.ifdRequests[index];\n    } else if (index === 0) {\n      // special case for index 0\n      this.ifdRequests[index] = this.parseFileDirectoryAt(this.firstIFDOffset);\n      return this.ifdRequests[index];\n    } else if (!this.ifdRequests[index - 1]) {\n      // if the previous IFD was not yet loaded, load that one first\n      // this is the recursive call.\n      try {\n        this.ifdRequests[index - 1] = this.requestIFD(index - 1);\n      } catch (e) {\n        // if the previous one already was an index error, rethrow\n        // with the current index\n        if (e instanceof GeoTIFFImageIndexError) {\n          throw new GeoTIFFImageIndexError(index);\n        }\n        // rethrow anything else\n        throw e;\n      }\n    }\n    // if the previous IFD was loaded, we can finally fetch the one we are interested in.\n    // we need to wrap this in an IIFE, otherwise this.ifdRequests[index] would be delayed\n    this.ifdRequests[index] = (async () => {\n      const previousIfd = await this.ifdRequests[index - 1];\n      if (previousIfd.nextIFDByteOffset === 0) {\n        throw new GeoTIFFImageIndexError(index);\n      }\n      return this.parseFileDirectoryAt(previousIfd.nextIFDByteOffset);\n    })();\n    return this.ifdRequests[index];\n  }\n\n  /**\n   * Get the n-th internal subfile of an image. By default, the first is returned.\n   *\n   * @param {number} [index=0] the index of the image to return.\n   * @returns {Promise<GeoTIFFImage>} the image at the given index\n   */\n  async getImage(index = 0) {\n    const ifd = await this.requestIFD(index);\n    return new GeoTIFFImage(\n      ifd.fileDirectory, ifd.geoKeyDirectory,\n      this.dataView, this.littleEndian, this.cache, this.source,\n    );\n  }\n\n  /**\n   * Returns the count of the internal subfiles.\n   *\n   * @returns {Promise<number>} the number of internal subfile images\n   */\n  async getImageCount() {\n    let index = 0;\n    // loop until we run out of IFDs\n    let hasNext = true;\n    while (hasNext) {\n      try {\n        await this.requestIFD(index);\n        ++index;\n      } catch (e) {\n        if (e instanceof GeoTIFFImageIndexError) {\n          hasNext = false;\n        } else {\n          throw e;\n        }\n      }\n    }\n    return index;\n  }\n\n  /**\n   * Get the values of the COG ghost area as a parsed map.\n   * See https://gdal.org/drivers/raster/cog.html#header-ghost-area for reference\n   * @returns {Promise<Object>} the parsed ghost area or null, if no such area was found\n   */\n  async getGhostValues() {\n    const offset = this.bigTiff ? 16 : 8;\n    if (this.ghostValues) {\n      return this.ghostValues;\n    }\n    const detectionString = 'GDAL_STRUCTURAL_METADATA_SIZE=';\n    const heuristicAreaSize = detectionString.length + 100;\n    let slice = await this.getSlice(offset, heuristicAreaSize);\n    if (detectionString === getValues(slice, fieldTypes.ASCII, detectionString.length, offset)) {\n      const valuesString = getValues(slice, fieldTypes.ASCII, heuristicAreaSize, offset);\n      const firstLine = valuesString.split('\\n')[0];\n      const metadataSize = Number(firstLine.split('=')[1].split(' ')[0]) + firstLine.length;\n      if (metadataSize > heuristicAreaSize) {\n        slice = await this.getSlice(offset, metadataSize);\n      }\n      const fullString = getValues(slice, fieldTypes.ASCII, metadataSize, offset);\n      this.ghostValues = {};\n      fullString\n        .split('\\n')\n        .filter((line) => line.length > 0)\n        .map((line) => line.split('='))\n        .forEach(([key, value]) => {\n          this.ghostValues[key] = value;\n        });\n    }\n    return this.ghostValues;\n  }\n\n  /**\n   * Parse a (Geo)TIFF file from the given source.\n   *\n   * @param {*} source The source of data to parse from.\n   * @param {GeoTIFFOptions} [options] Additional options.\n   * @param {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n   *                               to be aborted\n   */\n  static async fromSource(source, options, signal) {\n    const headerData = (await source.fetch([{ offset: 0, length: 1024 }], signal))[0];\n    const dataView = new DataView64(headerData);\n\n    const BOM = dataView.getUint16(0, 0);\n    let littleEndian;\n    if (BOM === 0x4949) {\n      littleEndian = true;\n    } else if (BOM === 0x4D4D) {\n      littleEndian = false;\n    } else {\n      throw new TypeError('Invalid byte order value.');\n    }\n\n    const magicNumber = dataView.getUint16(2, littleEndian);\n    let bigTiff;\n    if (magicNumber === 42) {\n      bigTiff = false;\n    } else if (magicNumber === 43) {\n      bigTiff = true;\n      const offsetByteSize = dataView.getUint16(4, littleEndian);\n      if (offsetByteSize !== 8) {\n        throw new Error('Unsupported offset byte-size.');\n      }\n    } else {\n      throw new TypeError('Invalid magic number.');\n    }\n\n    const firstIFDOffset = bigTiff\n      ? dataView.getUint64(8, littleEndian)\n      : dataView.getUint32(4, littleEndian);\n    return new GeoTIFF(source, littleEndian, bigTiff, firstIFDOffset, options);\n  }\n\n  /**\n   * Closes the underlying file buffer\n   * N.B. After the GeoTIFF has been completely processed it needs\n   * to be closed but only if it has been constructed from a file.\n   */\n  close() {\n    if (typeof this.source.close === 'function') {\n      return this.source.close();\n    }\n    return false;\n  }\n}\n\nexport { GeoTIFF };\nexport default GeoTIFF;\n\n/**\n * Wrapper for GeoTIFF files that have external overviews.\n * @augments GeoTIFFBase\n */\nclass MultiGeoTIFF extends GeoTIFFBase {\n  /**\n   * Construct a new MultiGeoTIFF from a main and several overview files.\n   * @param {GeoTIFF} mainFile The main GeoTIFF file.\n   * @param {GeoTIFF[]} overviewFiles An array of overview files.\n   */\n  constructor(mainFile, overviewFiles) {\n    super();\n    this.mainFile = mainFile;\n    this.overviewFiles = overviewFiles;\n    this.imageFiles = [mainFile].concat(overviewFiles);\n\n    this.fileDirectoriesPerFile = null;\n    this.fileDirectoriesPerFileParsing = null;\n    this.imageCount = null;\n  }\n\n  async parseFileDirectoriesPerFile() {\n    const requests = [this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)]\n      .concat(this.overviewFiles.map((file) => file.parseFileDirectoryAt(file.firstIFDOffset)));\n\n    this.fileDirectoriesPerFile = await Promise.all(requests);\n    return this.fileDirectoriesPerFile;\n  }\n\n  /**\n   * Get the n-th internal subfile of an image. By default, the first is returned.\n   *\n   * @param {number} [index=0] the index of the image to return.\n   * @returns {Promise<GeoTIFFImage>} the image at the given index\n   */\n  async getImage(index = 0) {\n    await this.getImageCount();\n    await this.parseFileDirectoriesPerFile();\n    let visited = 0;\n    let relativeIndex = 0;\n    for (let i = 0; i < this.imageFiles.length; i++) {\n      const imageFile = this.imageFiles[i];\n      for (let ii = 0; ii < this.imageCounts[i]; ii++) {\n        if (index === visited) {\n          const ifd = await imageFile.requestIFD(relativeIndex);\n          return new GeoTIFFImage(\n            ifd.fileDirectory, ifd.geoKeyDirectory,\n            imageFile.dataView, imageFile.littleEndian, imageFile.cache, imageFile.source,\n          );\n        }\n        visited++;\n        relativeIndex++;\n      }\n      relativeIndex = 0;\n    }\n\n    throw new RangeError('Invalid image index');\n  }\n\n  /**\n   * Returns the count of the internal subfiles.\n   *\n   * @returns {Promise<number>} the number of internal subfile images\n   */\n  async getImageCount() {\n    if (this.imageCount !== null) {\n      return this.imageCount;\n    }\n    const requests = [this.mainFile.getImageCount()]\n      .concat(this.overviewFiles.map((file) => file.getImageCount()));\n    this.imageCounts = await Promise.all(requests);\n    this.imageCount = this.imageCounts.reduce((count, ifds) => count + ifds, 0);\n    return this.imageCount;\n  }\n}\n\nexport { MultiGeoTIFF };\n\n/**\n * Creates a new GeoTIFF from a remote URL.\n * @param {string} url The URL to access the image from\n * @param {object} [options] Additional options to pass to the source.\n *                           See {@link makeRemoteSource} for details.\n * @param {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n *                               to be aborted\n * @returns {Promise<GeoTIFF>} The resulting GeoTIFF file.\n */\nexport async function fromUrl(url, options = {}, signal) {\n  return GeoTIFF.fromSource(makeRemoteSource(url, options), signal);\n}\n\n/**\n * Creates a new GeoTIFF from a custom {@link BaseClient}.\n * @param {BaseClient} client The client.\n * @param {object} [options] Additional options to pass to the source.\n *                           See {@link makeRemoteSource} for details.\n * @param {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n *                               to be aborted\n * @returns {Promise<GeoTIFF>} The resulting GeoTIFF file.\n */\nexport async function fromCustomClient(client, options = {}, signal) {\n  return GeoTIFF.fromSource(makeCustomSource(client, options), signal);\n}\n\n/**\n * Construct a new GeoTIFF from an\n * [ArrayBuffer]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer}.\n * @param {ArrayBuffer} arrayBuffer The data to read the file from.\n * @param {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n *                               to be aborted\n * @returns {Promise<GeoTIFF>} The resulting GeoTIFF file.\n */\nexport async function fromArrayBuffer(arrayBuffer, signal) {\n  return GeoTIFF.fromSource(makeBufferSource(arrayBuffer), signal);\n}\n\n/**\n * Construct a GeoTIFF from a local file path. This uses the node\n * [filesystem API]{@link https://nodejs.org/api/fs.html} and is\n * not available on browsers.\n *\n * N.B. After the GeoTIFF has been completely processed it needs\n * to be closed but only if it has been constructed from a file.\n * @param {string} path The file path to read from.\n * @param {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n *                               to be aborted\n * @returns {Promise<GeoTIFF>} The resulting GeoTIFF file.\n */\nexport async function fromFile(path, signal) {\n  return GeoTIFF.fromSource(makeFileSource(path), signal);\n}\n\n/**\n * Construct a GeoTIFF from an HTML\n * [Blob]{@link https://developer.mozilla.org/en-US/docs/Web/API/Blob} or\n * [File]{@link https://developer.mozilla.org/en-US/docs/Web/API/File}\n * object.\n * @param {Blob|File} blob The Blob or File object to read from.\n * @param {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n *                               to be aborted\n * @returns {Promise<GeoTIFF>} The resulting GeoTIFF file.\n */\nexport async function fromBlob(blob, signal) {\n  return GeoTIFF.fromSource(makeFileReaderSource(blob), signal);\n}\n\n/**\n * Construct a MultiGeoTIFF from the given URLs.\n * @param {string} mainUrl The URL for the main file.\n * @param {string[]} overviewUrls An array of URLs for the overview images.\n * @param {Object} [options] Additional options to pass to the source.\n *                           See [makeRemoteSource]{@link module:source.makeRemoteSource}\n *                           for details.\n * @param {AbortSignal} [signal] An AbortSignal that may be signalled if the request is\n *                               to be aborted\n * @returns {Promise<MultiGeoTIFF>} The resulting MultiGeoTIFF file.\n */\nexport async function fromUrls(mainUrl, overviewUrls = [], options = {}, signal) {\n  const mainFile = await GeoTIFF.fromSource(makeRemoteSource(mainUrl, options), signal);\n  const overviewFiles = await Promise.all(\n    overviewUrls.map((url) => GeoTIFF.fromSource(makeRemoteSource(url, options))),\n  );\n\n  return new MultiGeoTIFF(mainFile, overviewFiles);\n}\n\n/**\n * Main creating function for GeoTIFF files.\n * @param {(Array)} array of pixel values\n * @returns {metadata} metadata\n */\nexport function writeArrayBuffer(values, metadata) {\n  return writeGeotiff(values, metadata);\n}\n\nexport { Pool };\nexport { GeoTIFFImage };\nexport { BaseClient, BaseResponse };\n", "/**\n * @module ol/source/GeoTIFF\n */\nimport {\n  Pool,\n  fromBlob as tiffFromBlob,\n  fromUrl as tiffFromUrl,\n  fromUrls as tiffFromUrls,\n  globals as geotiffGlobals,\n} from 'geotiff';\nimport {error as logError} from '../console.js';\nimport {applyTransform, getCenter, getIntersection} from '../extent.js';\nimport {clamp} from '../math.js';\nimport {fromCode as unitsFromCode} from '../proj/Units.js';\nimport {\n  Projection,\n  createTransformFromCoordinateTransform,\n  get as getCachedProjection,\n  toUserCoordinate,\n  toUserExtent,\n} from '../proj.js';\nimport TileGrid from '../tilegrid/TileGrid.js';\nimport {\n  apply as applyMatrix,\n  create as createMatrix,\n  makeInverse,\n  multiply as multiplyTransform,\n} from '../transform.js';\nimport DataTile from './DataTile.js';\n\n/**\n * Determine if an image type is a mask.\n * See https://www.awaresystems.be/imaging/tiff/tifftags/newsubfiletype.html\n * @param {GeoTIFFImage} image The image.\n * @return {boolean} The image is a mask.\n */\nfunction isMask(image) {\n  const fileDirectory = image.fileDirectory;\n  const type = fileDirectory.NewSubfileType || 0;\n  return (type & 4) === 4;\n}\n\n/**\n * @param {true|false|'auto'} preference The convertToRGB option.\n * @param {GeoTIFFImage} image The image.\n * @return {boolean} Use the `image.readRGB()` method.\n */\nfunction readRGB(preference, image) {\n  if (!preference) {\n    return false;\n  }\n  if (preference === true) {\n    return true;\n  }\n  if (image.getSamplesPerPixel() !== 3) {\n    return false;\n  }\n  const interpretation = image.fileDirectory.PhotometricInterpretation;\n  const interpretations = geotiffGlobals.photometricInterpretations;\n  return (\n    interpretation === interpretations.CMYK ||\n    interpretation === interpretations.YCbCr ||\n    interpretation === interpretations.CIELab ||\n    interpretation === interpretations.ICCLab\n  );\n}\n\n/**\n * @typedef {Object} SourceInfo\n * @property {string} [url] URL for the source GeoTIFF.\n * @property {Array<string>} [overviews] List of any overview URLs, only applies if the url parameter is given.\n * @property {Blob} [blob] Blob containing the source GeoTIFF. `blob` and `url` are mutually exclusive.\n * @property {number} [min=0] The minimum source data value.  Rendered values are scaled from 0 to 1 based on\n * the configured min and max.  If not provided and raster statistics are available, those will be used instead.\n * If neither are available, the minimum for the data type will be used.  To disable this behavior, set\n * the `normalize` option to `false` in the constructor.\n * @property {number} [max] The maximum source data value.  Rendered values are scaled from 0 to 1 based on\n * the configured min and max.  If not provided and raster statistics are available, those will be used instead.\n * If neither are available, the maximum for the data type will be used.  To disable this behavior, set\n * the `normalize` option to `false` in the constructor.\n * @property {number} [nodata] Values to discard (overriding any nodata values in the metadata).\n * When provided, an additional alpha band will be added to the data.  Often the GeoTIFF metadata\n * will include information about nodata values, so you should only need to set this property if\n * you find that it is not already extracted from the metadata.\n * @property {Array<number>} [bands] Band numbers to be read from (where the first band is `1`). If not provided, all bands will\n * be read. For example, if a GeoTIFF has blue (1), green (2), red (3), and near-infrared (4) bands, and you only need the\n * near-infrared band, configure `bands: [4]`.\n */\n\n/**\n * @typedef {Object} GeoKeys\n * @property {number} GTModelTypeGeoKey Model type.\n * @property {number} GTRasterTypeGeoKey Raster type.\n * @property {number} GeogAngularUnitsGeoKey Angular units.\n * @property {number} GeogInvFlatteningGeoKey Inverse flattening.\n * @property {number} GeogSemiMajorAxisGeoKey Semi-major axis.\n * @property {number} GeographicTypeGeoKey Geographic coordinate system code.\n * @property {number} ProjLinearUnitsGeoKey Projected linear unit code.\n * @property {number} ProjectedCSTypeGeoKey Projected coordinate system code.\n */\n\n/**\n * @typedef {import(\"geotiff\").GeoTIFF} GeoTIFF\n */\n\n/**\n * @typedef {import(\"geotiff\").MultiGeoTIFF} MultiGeoTIFF\n */\n\n/**\n * @typedef {Object} GDALMetadata\n * @property {string} STATISTICS_MINIMUM The minimum value (as a string).\n * @property {string} STATISTICS_MAXIMUM The maximum value (as a string).\n */\n\nconst STATISTICS_MAXIMUM = 'STATISTICS_MAXIMUM';\nconst STATISTICS_MINIMUM = 'STATISTICS_MINIMUM';\n\nconst defaultTileSize = 256;\n\n/**\n * @typedef {import(\"geotiff\").GeoTIFFImage} GeoTIFFImage\n */\n\nlet workerPool;\nfunction getWorkerPool() {\n  if (!workerPool) {\n    workerPool = new Pool();\n  }\n  return workerPool;\n}\n\n/**\n * Get the bounding box of an image.  If the image does not have an affine transform,\n * the pixel bounds are returned.\n * @param {GeoTIFFImage} image The image.\n * @return {Array<number>} The image bounding box.\n */\nfunction getBoundingBox(image) {\n  try {\n    return image.getBoundingBox(true);\n  } catch {\n    return [0, 0, image.getWidth(), image.getHeight()];\n  }\n}\n\n/**\n * Get the origin of an image.  If the image does not have an affine transform,\n * the top-left corner of the pixel bounds is returned.\n * @param {GeoTIFFImage} image The image.\n * @return {Array<number>} The image origin.\n */\nfunction getOrigin(image) {\n  try {\n    return image.getOrigin().slice(0, 2);\n  } catch {\n    return [0, image.getHeight()];\n  }\n}\n\n/**\n * Get the resolution of an image.  If the image does not have an affine transform,\n * the width of the image is compared with the reference image.\n * @param {GeoTIFFImage} image The image.\n * @param {GeoTIFFImage} referenceImage The reference image.\n * @return {Array<number>} The map x and y units per pixel.\n */\nfunction getResolutions(image, referenceImage) {\n  try {\n    return image.getResolution(referenceImage);\n  } catch {\n    return [\n      referenceImage.getWidth() / image.getWidth(),\n      referenceImage.getHeight() / image.getHeight(),\n    ];\n  }\n}\n\n/**\n * @param {GeoTIFFImage} image A GeoTIFF.\n * @return {import(\"../proj/Projection.js\").default} The image projection.\n */\nfunction getProjection(image) {\n  const geoKeys = image.geoKeys;\n  if (!geoKeys) {\n    return null;\n  }\n\n  if (\n    geoKeys.ProjectedCSTypeGeoKey &&\n    geoKeys.ProjectedCSTypeGeoKey !== 32767\n  ) {\n    const code = 'EPSG:' + geoKeys.ProjectedCSTypeGeoKey;\n    let projection = getCachedProjection(code);\n    if (!projection) {\n      const units = unitsFromCode(geoKeys.ProjLinearUnitsGeoKey);\n      if (units) {\n        projection = new Projection({\n          code: code,\n          units: units,\n        });\n      }\n    }\n    return projection;\n  }\n\n  if (geoKeys.GeographicTypeGeoKey && geoKeys.GeographicTypeGeoKey !== 32767) {\n    const code = 'EPSG:' + geoKeys.GeographicTypeGeoKey;\n    let projection = getCachedProjection(code);\n    if (!projection) {\n      const units = unitsFromCode(geoKeys.GeogAngularUnitsGeoKey);\n      if (units) {\n        projection = new Projection({\n          code: code,\n          units: units,\n        });\n      }\n    }\n    return projection;\n  }\n\n  return null;\n}\n\n/**\n * @param {GeoTIFF|MultiGeoTIFF} tiff A GeoTIFF.\n * @return {Promise<Array<GeoTIFFImage>>} Resolves to a list of images.\n */\nfunction getImagesForTIFF(tiff) {\n  return tiff.getImageCount().then(function (count) {\n    const requests = new Array(count);\n    for (let i = 0; i < count; ++i) {\n      requests[i] = tiff.getImage(i);\n    }\n    return Promise.all(requests);\n  });\n}\n\n/**\n * @param {SourceInfo} source The GeoTIFF source.\n * @param {Object} options Options for the GeoTIFF source.\n * @return {Promise<Array<GeoTIFFImage>>} Resolves to a list of images.\n */\nfunction getImagesForSource(source, options) {\n  let request;\n  if (source.blob) {\n    request = tiffFromBlob(source.blob);\n  } else if (source.overviews) {\n    request = tiffFromUrls(source.url, source.overviews, options);\n  } else {\n    request = tiffFromUrl(source.url, options);\n  }\n  return request.then(getImagesForTIFF);\n}\n\n/**\n * @param {number|Array<number>|Array<Array<number>>} expected Expected value.\n * @param {number|Array<number>|Array<Array<number>>} got Actual value.\n * @param {number} tolerance Accepted tolerance in fraction of expected between expected and got.\n * @param {string} message The error message.\n * @param {function(Error):void} rejector A function to be called with any error.\n */\nfunction assertEqual(expected, got, tolerance, message, rejector) {\n  if (Array.isArray(expected)) {\n    const length = expected.length;\n    if (!Array.isArray(got) || length != got.length) {\n      const error = new Error(message);\n      rejector(error);\n      throw error;\n    }\n    for (let i = 0; i < length; ++i) {\n      assertEqual(expected[i], got[i], tolerance, message, rejector);\n    }\n    return;\n  }\n\n  got = /** @type {number} */ (got);\n  if (Math.abs(expected - got) > tolerance * expected) {\n    throw new Error(message);\n  }\n}\n\n/**\n * @param {Array} array The data array.\n * @return {number} The minimum value.\n */\nfunction getMinForDataType(array) {\n  if (array instanceof Int8Array) {\n    return -128;\n  }\n  if (array instanceof Int16Array) {\n    return -32768;\n  }\n  if (array instanceof Int32Array) {\n    return -2147483648;\n  }\n  if (array instanceof Float32Array) {\n    return 1.2e-38;\n  }\n  return 0;\n}\n\n/**\n * @param {Array} array The data array.\n * @return {number} The maximum value.\n */\nfunction getMaxForDataType(array) {\n  if (array instanceof Int8Array) {\n    return 127;\n  }\n  if (array instanceof Uint8Array) {\n    return 255;\n  }\n  if (array instanceof Uint8ClampedArray) {\n    return 255;\n  }\n  if (array instanceof Int16Array) {\n    return 32767;\n  }\n  if (array instanceof Uint16Array) {\n    return 65535;\n  }\n  if (array instanceof Int32Array) {\n    return 2147483647;\n  }\n  if (array instanceof Uint32Array) {\n    return 4294967295;\n  }\n  if (array instanceof Float32Array) {\n    return 3.4e38;\n  }\n  return 255;\n}\n\n/**\n * @typedef {Object} GeoTIFFSourceOptions\n * @property {boolean} [forceXHR=false] Whether to force the usage of the browsers XMLHttpRequest API.\n * @property {Object<string, string>} [headers] additional key-value pairs of headers to be passed with each request. Key is the header name, value the header value.\n * @property {string} [credentials] How credentials shall be handled. See\n * https://developer.mozilla.org/en-US/docs/Web/API/fetch for reference and possible values\n * @property {number} [maxRanges] The maximum amount of ranges to request in a single multi-range request.\n * By default only a single range is used.\n * @property {boolean} [allowFullFile=false] Whether or not a full file is accepted when only a portion is\n * requested. Only use this when you know the source image to be small enough to fit in memory.\n * @property {number} [blockSize=65536] The block size to use.\n * @property {number} [cacheSize=100] The number of blocks that shall be held in a LRU cache.\n */\n\n/**\n * @typedef {Object} Options\n * @property {Array<SourceInfo>} sources List of information about GeoTIFF sources.\n * Multiple sources can be combined when their resolution sets are equal after applying a scale.\n * The list of sources defines a mapping between input bands as they are read from each GeoTIFF and\n * the output bands that are provided by data tiles. To control which bands to read from each GeoTIFF,\n * use the {@link import(\"./GeoTIFF.js\").SourceInfo bands} property. If, for example, you specify two\n * sources, one with 3 bands and {@link import(\"./GeoTIFF.js\").SourceInfo nodata} configured, and\n * another with 1 band, the resulting data tiles will have 5 bands: 3 from the first source, 1 alpha\n * band from the first source, and 1 band from the second source.\n * @property {GeoTIFFSourceOptions} [sourceOptions] Additional options to be passed to [geotiff.js](https://geotiffjs.github.io/geotiff.js/module-geotiff.html)'s `fromUrl` or `fromUrls` methods.\n * @property {true|false|'auto'} [convertToRGB=false] By default, bands from the sources are read as-is. When\n * reading GeoTIFFs with the purpose of displaying them as RGB images, setting this to `true` will\n * convert other color spaces (YCbCr, CMYK) to RGB.  Setting the option to `'auto'` will make it so CMYK, YCbCr,\n * CIELab, and ICCLab images will automatically be converted to RGB.\n * @property {boolean} [normalize=true] By default, the source data is normalized to values between\n * 0 and 1 with scaling factors based on the raster statistics or `min` and `max` properties of each source.\n * If instead you want to work with the raw values in a style expression, set this to `false`.  Setting this option\n * to `false` will make it so any `min` and `max` properties on sources are ignored.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Source projection.  If not provided, the GeoTIFF metadata\n * will be read for projection information.\n * @property {number} [transition=250] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {boolean} [wrapX=false] Render tiles beyond the tile grid extent.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * the linear interpolation is used to resample the data.  If false, nearest neighbor is used.\n */\n\n/**\n * @classdesc\n * A source for working with GeoTIFF data.\n * **Note for users of the full build**: The `GeoTIFF` source requires the\n * [geotiff.js](https://github.com/geotiffjs/geotiff.js) library to be loaded as well.\n *\n * @api\n */\nclass GeoTIFFSource extends DataTile {\n  /**\n   * @param {Options} options Data tile options.\n   */\n  constructor(options) {\n    super({\n      state: 'loading',\n      tileGrid: null,\n      projection: options.projection || null,\n      transition: options.transition,\n      interpolate: options.interpolate !== false,\n      wrapX: options.wrapX,\n    });\n\n    /**\n     * @type {Array<SourceInfo>}\n     * @private\n     */\n    this.sourceInfo_ = options.sources;\n\n    const numSources = this.sourceInfo_.length;\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.sourceOptions_ = options.sourceOptions;\n\n    /**\n     * @type {Array<Array<GeoTIFFImage>>}\n     * @private\n     */\n    this.sourceImagery_ = new Array(numSources);\n\n    /**\n     * @type {Array<Array<GeoTIFFImage>>}\n     * @private\n     */\n    this.sourceMasks_ = new Array(numSources);\n\n    /**\n     * @type {Array<number>}\n     * @private\n     */\n    this.resolutionFactors_ = new Array(numSources);\n\n    /**\n     * @type {Array<number>}\n     * @private\n     */\n    this.samplesPerPixel_;\n\n    /**\n     * @type {Array<Array<number>>}\n     * @private\n     */\n    this.nodataValues_;\n\n    /**\n     * @type {Array<Array<GDALMetadata>>}\n     * @private\n     */\n    this.metadata_;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.normalize_ = options.normalize !== false;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.addAlpha_ = false;\n\n    /**\n     * @type {Error}\n     * @private\n     */\n    this.error_ = null;\n\n    /**\n     * @type {true|false|'auto'}\n     * @private\n     */\n    this.convertToRGB_ = options.convertToRGB || false;\n\n    this.setKey(this.sourceInfo_.map((source) => source.url).join(','));\n\n    const self = this;\n    const requests = new Array(numSources);\n    for (let i = 0; i < numSources; ++i) {\n      requests[i] = getImagesForSource(\n        this.sourceInfo_[i],\n        this.sourceOptions_,\n      );\n    }\n    Promise.all(requests)\n      .then(function (sources) {\n        self.configure_(sources);\n      })\n      .catch(function (error) {\n        logError(error);\n        self.error_ = error;\n        self.setState('error');\n      });\n  }\n\n  /**\n   * @return {Error} A source loading error. When the source state is `error`, use this function\n   * to get more information about the error. To debug a faulty configuration, you may want to use\n   * a listener like\n   * ```js\n   * geotiffSource.on('change', () => {\n   *   if (geotiffSource.getState() === 'error') {\n   *     console.error(geotiffSource.getError());\n   *   }\n   * });\n   * ```\n   */\n  getError() {\n    return this.error_;\n  }\n\n  /**\n   * Determine the projection of the images in this GeoTIFF.\n   * The default implementation looks at the ProjectedCSTypeGeoKey and the GeographicTypeGeoKey\n   * of each image in turn.\n   * You can override this method in a subclass to support more projections.\n   *\n   * @param {Array<Array<GeoTIFFImage>>} sources Each source is a list of images\n   * from a single GeoTIFF.\n   */\n  determineProjection(sources) {\n    const firstSource = sources[0];\n    for (let i = firstSource.length - 1; i >= 0; --i) {\n      const image = firstSource[i];\n      const projection = getProjection(image);\n      if (projection) {\n        this.projection = projection;\n        break;\n      }\n    }\n  }\n\n  /**\n   * Determine any transform matrix for the images in this GeoTIFF.\n   *\n   * @param {Array<Array<GeoTIFFImage>>} sources Each source is a list of images\n   * from a single GeoTIFF.\n   */\n  determineTransformMatrix(sources) {\n    const firstSource = sources[0];\n    for (let i = firstSource.length - 1; i >= 0; --i) {\n      const image = firstSource[i];\n      const modelTransformation = image.fileDirectory.ModelTransformation;\n      if (modelTransformation) {\n        // eslint-disable-next-line no-unused-vars\n        const [a, b, c, d, e, f, g, h] = modelTransformation;\n        const matrix = multiplyTransform(\n          multiplyTransform(\n            [\n              1 / Math.sqrt(a * a + e * e),\n              0,\n              0,\n              -1 / Math.sqrt(b * b + f * f),\n              d,\n              h,\n            ],\n            [a, e, b, f, 0, 0],\n          ),\n          [1, 0, 0, 1, -d, -h],\n        );\n        this.transformMatrix = matrix;\n        this.addAlpha_ = true;\n        break;\n      }\n    }\n  }\n\n  /**\n   * Configure the tile grid based on images within the source GeoTIFFs.  Each GeoTIFF\n   * must have the same internal tiled structure.\n   * @param {Array<Array<GeoTIFFImage>>} sources Each source is a list of images\n   * from a single GeoTIFF.\n   * @private\n   */\n  configure_(sources) {\n    let extent;\n    let origin;\n    let commonRenderTileSizes;\n    let commonSourceTileSizes;\n    let resolutions;\n    const samplesPerPixel = new Array(sources.length);\n    const nodataValues = new Array(sources.length);\n    const metadata = new Array(sources.length);\n    let minZoom = 0;\n\n    const sourceCount = sources.length;\n    for (let sourceIndex = 0; sourceIndex < sourceCount; ++sourceIndex) {\n      const images = [];\n      const masks = [];\n      sources[sourceIndex].forEach((item) => {\n        if (isMask(item)) {\n          masks.push(item);\n        } else {\n          images.push(item);\n        }\n      });\n\n      const imageCount = images.length;\n      if (masks.length > 0 && masks.length !== imageCount) {\n        throw new Error(\n          `Expected one mask per image found ${masks.length} masks and ${imageCount} images`,\n        );\n      }\n\n      let sourceExtent;\n      let sourceOrigin;\n      const sourceTileSizes = new Array(imageCount);\n      const renderTileSizes = new Array(imageCount);\n      const sourceResolutions = new Array(imageCount);\n\n      nodataValues[sourceIndex] = new Array(imageCount);\n      metadata[sourceIndex] = new Array(imageCount);\n\n      for (let imageIndex = 0; imageIndex < imageCount; ++imageIndex) {\n        const image = images[imageIndex];\n        const nodataValue = image.getGDALNoData();\n        metadata[sourceIndex][imageIndex] = image.getGDALMetadata(0);\n        nodataValues[sourceIndex][imageIndex] = nodataValue;\n\n        const wantedSamples = this.sourceInfo_[sourceIndex].bands;\n        samplesPerPixel[sourceIndex] = wantedSamples\n          ? wantedSamples.length\n          : image.getSamplesPerPixel();\n        const level = imageCount - (imageIndex + 1);\n\n        if (!sourceExtent) {\n          sourceExtent = getBoundingBox(image);\n        }\n\n        if (!sourceOrigin) {\n          sourceOrigin = getOrigin(image);\n        }\n\n        const imageResolutions = getResolutions(image, images[0]);\n        sourceResolutions[level] = imageResolutions[0];\n\n        const sourceTileSize = [image.getTileWidth(), image.getTileHeight()];\n\n        // request larger blocks for untiled layouts\n        if (\n          sourceTileSize[0] !== sourceTileSize[1] &&\n          sourceTileSize[1] < defaultTileSize\n        ) {\n          sourceTileSize[0] = defaultTileSize;\n          sourceTileSize[1] = defaultTileSize;\n        }\n\n        sourceTileSizes[level] = sourceTileSize;\n\n        const aspectRatio = imageResolutions[0] / Math.abs(imageResolutions[1]);\n        renderTileSizes[level] = [\n          sourceTileSize[0],\n          sourceTileSize[1] / aspectRatio,\n        ];\n      }\n\n      if (!extent) {\n        extent = sourceExtent;\n      } else {\n        getIntersection(extent, sourceExtent, extent);\n      }\n\n      if (!origin) {\n        origin = sourceOrigin;\n      } else {\n        const message = `Origin mismatch for source ${sourceIndex}, got [${sourceOrigin}] but expected [${origin}]`;\n        assertEqual(origin, sourceOrigin, 0, message, this.viewRejector);\n      }\n\n      if (!resolutions) {\n        resolutions = sourceResolutions;\n        this.resolutionFactors_[sourceIndex] = 1;\n      } else {\n        if (resolutions.length - minZoom > sourceResolutions.length) {\n          minZoom = resolutions.length - sourceResolutions.length;\n        }\n        const resolutionFactor =\n          resolutions[resolutions.length - 1] /\n          sourceResolutions[sourceResolutions.length - 1];\n        this.resolutionFactors_[sourceIndex] = resolutionFactor;\n        const scaledSourceResolutions = sourceResolutions.map(\n          (resolution) => (resolution *= resolutionFactor),\n        );\n        const message = `Resolution mismatch for source ${sourceIndex}, got [${scaledSourceResolutions}] but expected [${resolutions}]`;\n        assertEqual(\n          resolutions.slice(minZoom, resolutions.length),\n          scaledSourceResolutions,\n          0.02,\n          message,\n          this.viewRejector,\n        );\n      }\n\n      if (!commonRenderTileSizes) {\n        commonRenderTileSizes = renderTileSizes;\n      } else {\n        assertEqual(\n          commonRenderTileSizes.slice(minZoom, commonRenderTileSizes.length),\n          renderTileSizes,\n          0.01,\n          `Tile size mismatch for source ${sourceIndex}`,\n          this.viewRejector,\n        );\n      }\n\n      if (!commonSourceTileSizes) {\n        commonSourceTileSizes = sourceTileSizes;\n      } else {\n        assertEqual(\n          commonSourceTileSizes.slice(minZoom, commonSourceTileSizes.length),\n          sourceTileSizes,\n          0,\n          `Tile size mismatch for source ${sourceIndex}`,\n          this.viewRejector,\n        );\n      }\n\n      this.sourceImagery_[sourceIndex] = images.reverse();\n      this.sourceMasks_[sourceIndex] = masks.reverse();\n    }\n\n    for (let i = 0, ii = this.sourceImagery_.length; i < ii; ++i) {\n      const sourceImagery = this.sourceImagery_[i];\n      while (sourceImagery.length < resolutions.length) {\n        sourceImagery.unshift(undefined);\n      }\n    }\n\n    if (!this.getProjection()) {\n      this.determineProjection(sources);\n    }\n    this.determineTransformMatrix(sources);\n\n    this.samplesPerPixel_ = samplesPerPixel;\n    this.nodataValues_ = nodataValues;\n    this.metadata_ = metadata;\n\n    // decide if we need to add an alpha band to handle nodata\n    outer: for (let sourceIndex = 0; sourceIndex < sourceCount; ++sourceIndex) {\n      // option 1: source is configured with a nodata value\n      if (this.sourceInfo_[sourceIndex].nodata !== undefined) {\n        this.addAlpha_ = true;\n        break;\n      }\n      if (this.sourceMasks_[sourceIndex].length) {\n        this.addAlpha_ = true;\n        break;\n      }\n\n      const values = nodataValues[sourceIndex];\n\n      // option 2: check image metadata for limited bands\n      const bands = this.sourceInfo_[sourceIndex].bands;\n      if (bands) {\n        for (let i = 0; i < bands.length; ++i) {\n          if (values[bands[i] - 1] !== null) {\n            this.addAlpha_ = true;\n            break outer;\n          }\n        }\n        continue;\n      }\n\n      // option 3: check image metadata for all bands\n      for (let imageIndex = 0; imageIndex < values.length; ++imageIndex) {\n        if (values[imageIndex] !== null) {\n          this.addAlpha_ = true;\n          break outer;\n        }\n      }\n    }\n\n    let bandCount = this.addAlpha_ ? 1 : 0;\n    for (let sourceIndex = 0; sourceIndex < sourceCount; ++sourceIndex) {\n      bandCount += samplesPerPixel[sourceIndex];\n    }\n    this.bandCount = bandCount;\n\n    const tileGrid = new TileGrid({\n      extent: extent,\n      minZoom: minZoom,\n      origin: origin,\n      resolutions: resolutions,\n      tileSizes: commonRenderTileSizes,\n    });\n\n    this.tileGrid = tileGrid;\n    this.setTileSizes(commonSourceTileSizes);\n\n    this.setLoader(this.loadTile_.bind(this));\n    this.setState('ready');\n\n    const zoom = 1;\n    if (resolutions.length === 2) {\n      resolutions = [resolutions[0], resolutions[1], resolutions[1] / 2];\n    } else if (resolutions.length === 1) {\n      resolutions = [resolutions[0] * 2, resolutions[0], resolutions[0] / 2];\n    }\n\n    let viewExtent = extent;\n    if (this.transformMatrix) {\n      const matrix = makeInverse(createMatrix(), this.transformMatrix.slice());\n      const transformFn = createTransformFromCoordinateTransform((input) =>\n        applyMatrix(matrix, input),\n      );\n      viewExtent = applyTransform(extent, transformFn);\n    }\n\n    this.viewResolver({\n      showFullExtent: true,\n      projection: this.projection,\n      resolutions: resolutions,\n      center: toUserCoordinate(getCenter(viewExtent), this.projection),\n      extent: toUserExtent(viewExtent, this.projection),\n      zoom: zoom,\n    });\n  }\n\n  /**\n   * @param {number} z The z tile index.\n   * @param {number} x The x tile index.\n   * @param {number} y The y tile index.\n   * @param {import('./DataTile.js').LoaderOptions} options The loader options.\n   * @return {Promise} The composed tile data.\n   * @private\n   */\n  loadTile_(z, x, y, options) {\n    const sourceTileSize = this.getTileSize(z);\n    const sourceCount = this.sourceImagery_.length;\n    const requests = new Array(sourceCount * 2);\n    const nodataValues = this.nodataValues_;\n    const sourceInfo = this.sourceInfo_;\n    const pool = getWorkerPool();\n    for (let sourceIndex = 0; sourceIndex < sourceCount; ++sourceIndex) {\n      const source = sourceInfo[sourceIndex];\n      const resolutionFactor = this.resolutionFactors_[sourceIndex];\n      const pixelBounds = [\n        Math.round(x * (sourceTileSize[0] * resolutionFactor)),\n        Math.round(y * (sourceTileSize[1] * resolutionFactor)),\n        Math.round((x + 1) * (sourceTileSize[0] * resolutionFactor)),\n        Math.round((y + 1) * (sourceTileSize[1] * resolutionFactor)),\n      ];\n      const image = this.sourceImagery_[sourceIndex][z];\n      let samples;\n      if (source.bands) {\n        samples = source.bands.map(function (bandNumber) {\n          return bandNumber - 1;\n        });\n      }\n\n      /** @type {number|Array<number>} */\n      let fillValue;\n      if ('nodata' in source && source.nodata !== null) {\n        fillValue = source.nodata;\n      } else {\n        if (!samples) {\n          fillValue = nodataValues[sourceIndex];\n        } else {\n          fillValue = samples.map(function (sampleIndex) {\n            return nodataValues[sourceIndex][sampleIndex];\n          });\n        }\n      }\n\n      const readOptions = {\n        window: pixelBounds,\n        width: sourceTileSize[0],\n        height: sourceTileSize[1],\n        samples: samples,\n        fillValue: fillValue,\n        pool: pool,\n        interleave: false,\n        signal: options.signal,\n      };\n      if (readRGB(this.convertToRGB_, image)) {\n        requests[sourceIndex] = image.readRGB(readOptions);\n      } else {\n        requests[sourceIndex] = image.readRasters(readOptions);\n      }\n\n      // requests after `sourceCount` are for mask data (if any)\n      const maskIndex = sourceCount + sourceIndex;\n      const mask = this.sourceMasks_[sourceIndex][z];\n      if (!mask) {\n        requests[maskIndex] = Promise.resolve(null);\n        continue;\n      }\n\n      requests[maskIndex] = mask.readRasters({\n        window: pixelBounds,\n        width: sourceTileSize[0],\n        height: sourceTileSize[1],\n        samples: [0],\n        pool: pool,\n        interleave: false,\n      });\n    }\n\n    return Promise.all(requests)\n      .then(this.composeTile_.bind(this, sourceTileSize))\n      .catch(function (error) {\n        logError(error);\n        throw error;\n      });\n  }\n\n  /**\n   * @param {import(\"../size.js\").Size} sourceTileSize The source tile size.\n   * @param {Array} sourceSamples The source samples.\n   * @return {import(\"../DataTile.js\").Data} The composed tile data.\n   * @private\n   */\n  composeTile_(sourceTileSize, sourceSamples) {\n    const metadata = this.metadata_;\n    const sourceInfo = this.sourceInfo_;\n    const sourceCount = this.sourceImagery_.length;\n    const bandCount = this.bandCount;\n    const samplesPerPixel = this.samplesPerPixel_;\n    const nodataValues = this.nodataValues_;\n    const normalize = this.normalize_;\n    const addAlpha = this.addAlpha_;\n\n    const pixelCount = sourceTileSize[0] * sourceTileSize[1];\n    const dataLength = pixelCount * bandCount;\n\n    /** @type {Uint8Array|Float32Array} */\n    let data;\n    if (normalize) {\n      data = new Uint8Array(dataLength);\n    } else {\n      data = new Float32Array(dataLength);\n    }\n\n    let dataIndex = 0;\n    for (let pixelIndex = 0; pixelIndex < pixelCount; ++pixelIndex) {\n      let transparent = addAlpha;\n      for (let sourceIndex = 0; sourceIndex < sourceCount; ++sourceIndex) {\n        const source = sourceInfo[sourceIndex];\n\n        let min = source.min;\n        let max = source.max;\n        let gain, bias;\n        if (normalize) {\n          const stats = metadata[sourceIndex][0];\n          if (min === undefined) {\n            if (stats && STATISTICS_MINIMUM in stats) {\n              min = parseFloat(stats[STATISTICS_MINIMUM]);\n            } else {\n              min = getMinForDataType(sourceSamples[sourceIndex][0]);\n            }\n          }\n          if (max === undefined) {\n            if (stats && STATISTICS_MAXIMUM in stats) {\n              max = parseFloat(stats[STATISTICS_MAXIMUM]);\n            } else {\n              max = getMaxForDataType(sourceSamples[sourceIndex][0]);\n            }\n          }\n\n          gain = 255 / (max - min);\n          bias = -min * gain;\n        }\n\n        for (\n          let sampleIndex = 0;\n          sampleIndex < samplesPerPixel[sourceIndex];\n          ++sampleIndex\n        ) {\n          const sourceValue =\n            sourceSamples[sourceIndex][sampleIndex][pixelIndex];\n\n          let value;\n          if (normalize) {\n            value = clamp(gain * sourceValue + bias, 0, 255);\n          } else {\n            value = sourceValue;\n          }\n\n          if (!addAlpha) {\n            data[dataIndex] = value;\n          } else {\n            let nodata = source.nodata;\n            if (nodata === undefined) {\n              let bandIndex;\n              if (source.bands) {\n                bandIndex = source.bands[sampleIndex] - 1;\n              } else {\n                bandIndex = sampleIndex;\n              }\n              nodata = nodataValues[sourceIndex][bandIndex];\n            }\n\n            const nodataIsNaN = isNaN(nodata);\n            if (\n              (!nodataIsNaN && sourceValue !== nodata) ||\n              (nodataIsNaN && !isNaN(sourceValue))\n            ) {\n              transparent = false;\n              data[dataIndex] = value;\n            }\n          }\n          dataIndex++;\n        }\n        if (!transparent) {\n          const maskIndex = sourceCount + sourceIndex;\n          const mask = sourceSamples[maskIndex];\n          if (mask && !mask[0][pixelIndex]) {\n            transparent = true;\n          }\n        }\n      }\n      if (addAlpha) {\n        if (!transparent) {\n          data[dataIndex] = 255;\n        }\n        dataIndex++;\n      }\n    }\n\n    return data;\n  }\n}\n\n/**\n * Get a promise for view properties based on the source.  Use the result of this function\n * as the `view` option in a map constructor.\n *\n *     const source = new GeoTIFF(options);\n *\n *     const map = new Map({\n *       target: 'map',\n *       layers: [\n *         new TileLayer({\n *           source: source,\n *         }),\n *       ],\n *       view: source.getView(),\n *     });\n *\n * @function\n * @return {Promise<import(\"../View.js\").ViewOptions>} A promise for view-related properties.\n * @api\n *\n */\nGeoTIFFSource.prototype.getView;\n\nexport default GeoTIFFSource;\n", "/**\n * @module ol/source/Google\n */\n\nimport ViewHint from '../ViewHint.js';\nimport {getBottomLeft, getTopRight} from '../extent.js';\nimport {toLonLat} from '../proj.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\nimport TileImage from './TileImage.js';\n\nconst createSessionUrl = 'https://tile.googleapis.com/v1/createSession';\nconst tileUrl = 'https://tile.googleapis.com/v1/2dtiles';\nconst attributionUrl = 'https://tile.googleapis.com/tile/v1/viewport';\nconst maxZoom = 22;\n\n/**\n * @typedef {Object} Options\n * @property {string} key Google Map Tiles API key. Get yours at https://developers.google.com/maps/documentation/tile/get-api-key.\n * @property {string} [mapType='roadmap'] The type of [base map](https://developers.google.com/maps/documentation/tile/session_tokens#required_fields).\n * @property {string} [language='en-US'] An [IETF language tag](https://en.wikipedia.org/wiki/IETF_language_tag) for information displayed on the tiles.\n * @property {string} [region='US'] A [Common Locale Data Repository](https://cldr.unicode.org/) (CLDR) region identifier that represents the user location.\n * @property {string} [imageFormat] The image format used for the map tiles (e.g. `'jpeg'`, or `'png'`).\n * @property {string} [scale] Scale for map elements (`'scaleFactor1x'`, `'scaleFactor2x'`, or `'scaleFactor4x'`).\n * @property {boolean} [highDpi=false] Use high-resolution tiles.\n * @property {Array<string>} [layerTypes] The layer types added to the map (e.g. `'layerRoadmap'`, `'layerStreetview'`, or `'layerTraffic'`).\n * @property {boolean} [overlay=false] Display only the `layerTypes` and not the underlying `mapType` (only works if `layerTypes` is provided).\n * @property {Array<Object>} [styles] [Custom styles](https://developers.google.com/maps/documentation/tile/style-reference) applied to the map.\n * @property {boolean} [attributionsCollapsible=true] Allow the attributions to be collapsed.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {number} [cacheSize] Initial tile cache size. Will auto-grow to hold at least the number of tiles in the viewport.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {Array<string>} [apiOptions] An array of values specifying additional options to apply.\n * @property {boolean} [wrapX=true] Wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @typedef {Object} SessionTokenRequest\n * @property {string} mapType The map type.\n * @property {string} language The language.\n * @property {string} region The region.\n * @property {string} [imageFormat] The image format.\n * @property {string} [scale] The scale.\n * @property {boolean} [highDpi] Use high resolution tiles.\n * @property {Array<string>} [layerTypes] The layer types.\n * @property {boolean} [overlay] The overlay.\n * @property {Array<Object>} [styles] The styles.\n * @property {Array<string>} [apiOptions] An array of values specifying additional options to apply.\n */\n\n/**\n * @typedef {Object} SessionTokenResponse\n * @property {string} session The session token.\n * @property {string} expiry The session token expiry (seconds since the epoch as a string).\n * @property {number} tileWidth The tile width.\n * @property {number} tileHeight The tile height.\n * @property {string} imageFormat The image format.\n */\n\n/**\n * @classdesc\n * A tile layer source that renders tiles from the Google [Map Tiles API](https://developers.google.com/maps/documentation/tile/overview).\n * The constructor takes options that are passed to the request to create a session token.  Refer to the\n * [documentation](https://developers.google.com/maps/documentation/tile/session_tokens#required_fields)\n * for additional details.\n * @api\n */\nclass Google extends TileImage {\n  /**\n   * @param {Options} options Google Maps options.\n   */\n  constructor(options) {\n    const highDpi = !!options.highDpi;\n\n    super({\n      attributionsCollapsible: options.attributionsCollapsible,\n      cacheSize: options.cacheSize,\n      crossOrigin: 'anonymous',\n      interpolate: options.interpolate,\n      projection: 'EPSG:3857',\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      state: 'loading',\n      tileLoadFunction: options.tileLoadFunction,\n      tilePixelRatio: highDpi ? 2 : 1,\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      transition: options.transition,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.apiKey_ = options.key;\n\n    /**\n     * @type {Error|null}\n     * @private\n     */\n    this.error_ = null;\n\n    /**\n     * @type {SessionTokenRequest}\n     */\n    const sessionTokenRequest = {\n      mapType: options.mapType || 'roadmap',\n      language: options.language || 'en-US',\n      region: options.region || 'US',\n    };\n    if (options.imageFormat) {\n      sessionTokenRequest.imageFormat = options.imageFormat;\n    }\n    if (options.scale) {\n      sessionTokenRequest.scale = options.scale;\n    }\n    if (highDpi) {\n      sessionTokenRequest.highDpi = true;\n    }\n    if (options.layerTypes) {\n      sessionTokenRequest.layerTypes = options.layerTypes;\n    }\n    if (options.styles) {\n      sessionTokenRequest.styles = options.styles;\n    }\n    if (options.overlay === true) {\n      sessionTokenRequest.overlay = true;\n    }\n    if (options.apiOptions) {\n      sessionTokenRequest.apiOptions = options.apiOptions;\n    }\n\n    /**\n     * @type {SessionTokenRequest}\n     * @private\n     */\n    this.sessionTokenRequest_ = sessionTokenRequest;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.sessionTokenValue_;\n\n    /**\n     * @type {ReturnType<typeof setTimeout>}\n     * @private\n     */\n    this.sessionRefreshId_;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.previousViewportAttribution_;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.previousViewportExtent_;\n\n    this.createSession_();\n  }\n\n  /**\n   * @return {Error|null} A source loading error. When the source state is `error`, use this function\n   * to get more information about the error. To debug a faulty configuration, you may want to use\n   * a listener like\n   * ```js\n   * source.on('change', () => {\n   *   if (source.getState() === 'error') {\n   *     console.error(source.getError());\n   *   }\n   * });\n   * ```\n   */\n  getError() {\n    return this.error_;\n  }\n\n  /**\n   * Exposed here so it can be overridden in the tests.\n   * @param {string} url The URL.\n   * @param {RequestInit} config The config.\n   * @return {Promise<Response>} A promise that resolves with the response.\n   */\n  fetchSessionToken(url, config) {\n    return fetch(url, config);\n  }\n\n  /**\n   * Get or renew a session token for use with tile requests.\n   * @private\n   */\n  async createSession_() {\n    const url = createSessionUrl + '?key=' + this.apiKey_;\n    const config = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(this.sessionTokenRequest_),\n    };\n\n    const response = await this.fetchSessionToken(url, config);\n    if (!response.ok) {\n      try {\n        const body = await response.json();\n        this.error_ = new Error(body.error.message);\n      } catch {\n        this.error_ = new Error('Error fetching session token');\n      }\n      this.setState('error');\n      return;\n    }\n\n    /**\n     * @type {SessionTokenResponse}\n     */\n    const sessionTokenResponse = await response.json();\n\n    const tilePixelRatio = this.getTilePixelRatio(1);\n    const tileSize = [\n      sessionTokenResponse.tileWidth / tilePixelRatio,\n      sessionTokenResponse.tileHeight / tilePixelRatio,\n    ];\n\n    this.tileGrid = createXYZ({\n      extent: extentFromProjection(this.getProjection()),\n      maxZoom: maxZoom,\n      tileSize: tileSize,\n    });\n\n    const session = sessionTokenResponse.session;\n    this.sessionTokenValue_ = session;\n    const key = this.apiKey_;\n    this.tileUrlFunction = function (tileCoord, pixelRatio, projection) {\n      const z = tileCoord[0];\n      const x = tileCoord[1];\n      const y = tileCoord[2];\n      const url = `${tileUrl}/${z}/${x}/${y}?session=${session}&key=${key}`;\n      return url;\n    };\n\n    const expiry = parseInt(sessionTokenResponse.expiry, 10) * 1000;\n    const timeout = Math.max(expiry - Date.now() - 60 * 1000, 1);\n    this.sessionRefreshId_ = setTimeout(() => this.createSession_(), timeout);\n\n    this.setAttributions(this.fetchAttributions_.bind(this));\n    // even if the state is already ready, we want the change event\n    this.setState('ready');\n  }\n\n  /**\n   * @param {import('../Map.js').FrameState} frameState The frame state.\n   * @return {Promise<string>} The attributions.\n   * @private\n   */\n  async fetchAttributions_(frameState) {\n    if (\n      frameState.viewHints[ViewHint.ANIMATING] ||\n      frameState.viewHints[ViewHint.INTERACTING] ||\n      frameState.animate\n    ) {\n      return this.previousViewportAttribution_;\n    }\n    const [west, south] = toLonLat(\n      getBottomLeft(frameState.extent),\n      frameState.viewState.projection,\n    );\n    const [east, north] = toLonLat(\n      getTopRight(frameState.extent),\n      frameState.viewState.projection,\n    );\n    const tileGrid = this.getTileGrid();\n    const zoom = tileGrid.getZForResolution(\n      frameState.viewState.resolution,\n      this.zDirection,\n    );\n    const viewportExtent = `zoom=${zoom}&north=${north}&south=${south}&east=${east}&west=${west}`;\n    // check if the extent or zoom has actually changed to avoid unnecessary requests\n    if (this.previousViewportExtent_ == viewportExtent) {\n      return this.previousViewportAttribution_;\n    }\n    this.previousViewportExtent_ = viewportExtent;\n    const session = this.sessionTokenValue_;\n    const key = this.apiKey_;\n    const url = `${attributionUrl}?session=${session}&key=${key}&${viewportExtent}`;\n    this.previousViewportAttribution_ = await fetch(url)\n      .then((response) => response.json())\n      .then((json) => json.copyright);\n\n    return this.previousViewportAttribution_;\n  }\n\n  /**\n   * @override\n   */\n  disposeInternal() {\n    clearTimeout(this.sessionRefreshId_);\n    super.disposeInternal();\n  }\n}\n\nexport default Google;\n", "/**\n * @module ol/format/IIIFInfo\n */\n\nimport {assert} from '../asserts.js';\n\n/**\n * @typedef {Object} PreferredOptions\n * @property {string} [format] Preferred image format. Will be used if the image information\n * indicates support for that format.\n * @property {string} [quality] IIIF image qualitiy.  Will be used if the image information\n * indicates support for that quality.\n */\n\n/**\n * @typedef {Object} SupportedFeatures\n * @property {Array<string>} [supports] Supported IIIF image size and region\n * calculation features.\n * @property {Array<string>} [formats] Supported image formats.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n */\n\n/**\n * @typedef {Object} TileInfo\n * @property {Array<number>} scaleFactors Supported resolution scaling factors.\n * @property {number} width Tile width in pixels.\n * @property {number} [height] Tile height in pixels. Same as tile width if height is\n * not given.\n */\n\n/**\n * @typedef {Object} IiifProfile\n * @property {Array<string>} [formats] Supported image formats for the image service.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n * @property {Array<string>} [supports] Supported features.\n * @property {number} [maxArea] Maximum area (pixels) available for this image service.\n * @property {number} [maxHeight] Maximum height.\n * @property {number} [maxWidth] Maximum width.\n */\n\n/**\n * @typedef {Object<string,string|number|Array<number|string|IiifProfile|Object<string, number>|TileInfo>>}\n *    ImageInformationResponse\n */\n\n/**\n * Enum representing the major IIIF Image API versions\n * @enum {string}\n */\nexport const Versions = {\n  VERSION1: 'version1',\n  VERSION2: 'version2',\n  VERSION3: 'version3',\n};\n\n/**\n * Supported image formats, qualities and supported region / size calculation features\n * for different image API versions and compliance levels\n * @const\n * @type {Object<string, Object<string, SupportedFeatures>>}\n */\nconst IIIF_PROFILE_VALUES = {};\nIIIF_PROFILE_VALUES[Versions.VERSION1] = {\n  'level0': {\n    supports: [],\n    formats: [],\n    qualities: ['native'],\n  },\n  'level1': {\n    supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n    formats: ['jpg'],\n    qualities: ['native'],\n  },\n  'level2': {\n    supports: [\n      'regionByPx',\n      'regionByPct',\n      'sizeByW',\n      'sizeByH',\n      'sizeByPct',\n      'sizeByConfinedWh',\n      'sizeByWh',\n    ],\n    formats: ['jpg', 'png'],\n    qualities: ['native', 'color', 'grey', 'bitonal'],\n  },\n};\nIIIF_PROFILE_VALUES[Versions.VERSION2] = {\n  'level0': {\n    supports: [],\n    formats: ['jpg'],\n    qualities: ['default'],\n  },\n  'level1': {\n    supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n    formats: ['jpg'],\n    qualities: ['default'],\n  },\n  'level2': {\n    supports: [\n      'regionByPx',\n      'regionByPct',\n      'sizeByW',\n      'sizeByH',\n      'sizeByPct',\n      'sizeByConfinedWh',\n      'sizeByDistortedWh',\n      'sizeByWh',\n    ],\n    formats: ['jpg', 'png'],\n    qualities: ['default', 'bitonal'],\n  },\n};\nIIIF_PROFILE_VALUES[Versions.VERSION3] = {\n  'level0': {\n    supports: [],\n    formats: ['jpg'],\n    qualities: ['default'],\n  },\n  'level1': {\n    supports: ['regionByPx', 'regionSquare', 'sizeByW', 'sizeByH', 'sizeByWh'],\n    formats: ['jpg'],\n    qualities: ['default'],\n  },\n  'level2': {\n    supports: [\n      'regionByPx',\n      'regionSquare',\n      'regionByPct',\n      'sizeByW',\n      'sizeByH',\n      'sizeByPct',\n      'sizeByConfinedWh',\n      'sizeByWh',\n    ],\n    formats: ['jpg', 'png'],\n    qualities: ['default'],\n  },\n};\nIIIF_PROFILE_VALUES['none'] = {\n  'none': {\n    supports: [],\n    formats: [],\n    qualities: [],\n  },\n};\n\nconst COMPLIANCE_VERSION1 =\n  /^https?:\\/\\/library\\.stanford\\.edu\\/iiif\\/image-api\\/(?:1\\.1\\/)?compliance\\.html#level[0-2]$/;\nconst COMPLIANCE_VERSION2 =\n  /^https?:\\/\\/iiif\\.io\\/api\\/image\\/2\\/level[0-2](?:\\.json)?$/;\nconst COMPLIANCE_VERSION3 =\n  /(^https?:\\/\\/iiif\\.io\\/api\\/image\\/3\\/level[0-2](?:\\.json)?$)|(^level[0-2]$)/;\n\nfunction generateVersion1Options(iiifInfo) {\n  let levelProfile = iiifInfo.getComplianceLevelSupportedFeatures();\n  // Version 1.0 and 1.1 do not require a profile.\n  if (levelProfile === undefined) {\n    levelProfile = IIIF_PROFILE_VALUES[Versions.VERSION1]['level0'];\n  }\n  return {\n    url:\n      iiifInfo.imageInfo['@id'] === undefined\n        ? undefined\n        : iiifInfo.imageInfo['@id'].replace(/\\/?(?:info\\.json)?$/g, ''),\n    supports: levelProfile.supports,\n    formats: [\n      ...levelProfile.formats,\n      iiifInfo.imageInfo.formats === undefined\n        ? []\n        : iiifInfo.imageInfo.formats,\n    ],\n    qualities: [\n      ...levelProfile.qualities,\n      iiifInfo.imageInfo.qualities === undefined\n        ? []\n        : iiifInfo.imageInfo.qualities,\n    ],\n    resolutions: iiifInfo.imageInfo.scale_factors,\n    tileSize:\n      iiifInfo.imageInfo.tile_width !== undefined\n        ? iiifInfo.imageInfo.tile_height !== undefined\n          ? [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_height]\n          : [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_width]\n        : iiifInfo.imageInfo.tile_height != undefined\n          ? [iiifInfo.imageInfo.tile_height, iiifInfo.imageInfo.tile_height]\n          : undefined,\n  };\n}\n\nfunction generateVersion2Options(iiifInfo) {\n  const levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(),\n    additionalProfile =\n      Array.isArray(iiifInfo.imageInfo.profile) &&\n      iiifInfo.imageInfo.profile.length > 1,\n    profileSupports =\n      additionalProfile && iiifInfo.imageInfo.profile[1].supports\n        ? iiifInfo.imageInfo.profile[1].supports\n        : [],\n    profileFormats =\n      additionalProfile && iiifInfo.imageInfo.profile[1].formats\n        ? iiifInfo.imageInfo.profile[1].formats\n        : [],\n    profileQualities =\n      additionalProfile && iiifInfo.imageInfo.profile[1].qualities\n        ? iiifInfo.imageInfo.profile[1].qualities\n        : [];\n  return {\n    url: iiifInfo.imageInfo['@id'].replace(/\\/?(?:info\\.json)?$/g, ''),\n    sizes:\n      iiifInfo.imageInfo.sizes === undefined\n        ? undefined\n        : iiifInfo.imageInfo.sizes.map(function (size) {\n            return [size.width, size.height];\n          }),\n    tileSize:\n      iiifInfo.imageInfo.tiles === undefined\n        ? undefined\n        : [\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n              return tile.width;\n            })[0],\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n              return tile.height === undefined ? tile.width : tile.height;\n            })[0],\n          ],\n    resolutions:\n      iiifInfo.imageInfo.tiles === undefined\n        ? undefined\n        : iiifInfo.imageInfo.tiles.map(function (tile) {\n            return tile.scaleFactors;\n          })[0],\n    supports: [...levelProfile.supports, ...profileSupports],\n    formats: [...levelProfile.formats, ...profileFormats],\n    qualities: [...levelProfile.qualities, ...profileQualities],\n  };\n}\n\nfunction generateVersion3Options(iiifInfo) {\n  const levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(),\n    formats =\n      iiifInfo.imageInfo.extraFormats === undefined\n        ? levelProfile.formats\n        : [...levelProfile.formats, ...iiifInfo.imageInfo.extraFormats],\n    preferredFormat =\n      iiifInfo.imageInfo.preferredFormats !== undefined &&\n      Array.isArray(iiifInfo.imageInfo.preferredFormats) &&\n      iiifInfo.imageInfo.preferredFormats.length > 0\n        ? iiifInfo.imageInfo.preferredFormats\n            .filter(function (format) {\n              return ['jpg', 'png', 'gif'].includes(format);\n            })\n            .reduce(function (acc, format) {\n              return acc === undefined && formats.includes(format)\n                ? format\n                : acc;\n            }, undefined)\n        : undefined;\n  return {\n    url: iiifInfo.imageInfo['id'],\n    sizes:\n      iiifInfo.imageInfo.sizes === undefined\n        ? undefined\n        : iiifInfo.imageInfo.sizes.map(function (size) {\n            return [size.width, size.height];\n          }),\n    tileSize:\n      iiifInfo.imageInfo.tiles === undefined\n        ? undefined\n        : [\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n              return tile.width;\n            })[0],\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n              return tile.height;\n            })[0],\n          ],\n    resolutions:\n      iiifInfo.imageInfo.tiles === undefined\n        ? undefined\n        : iiifInfo.imageInfo.tiles.map(function (tile) {\n            return tile.scaleFactors;\n          })[0],\n    supports:\n      iiifInfo.imageInfo.extraFeatures === undefined\n        ? levelProfile.supports\n        : [...levelProfile.supports, ...iiifInfo.imageInfo.extraFeatures],\n    formats: formats,\n    qualities:\n      iiifInfo.imageInfo.extraQualities === undefined\n        ? levelProfile.qualities\n        : [...levelProfile.qualities, ...iiifInfo.imageInfo.extraQualities],\n    preferredFormat: preferredFormat,\n  };\n}\n\nconst versionFunctions = {};\nversionFunctions[Versions.VERSION1] = generateVersion1Options;\nversionFunctions[Versions.VERSION2] = generateVersion2Options;\nversionFunctions[Versions.VERSION3] = generateVersion3Options;\n\n/**\n * @classdesc\n * Format for transforming IIIF Image API image information responses into\n * IIIF tile source ready options\n *\n * @api\n */\nclass IIIFInfo {\n  /**\n   * @param {string|ImageInformationResponse} imageInfo\n   * Deserialized image information JSON response object or JSON response as string\n   */\n  constructor(imageInfo) {\n    this.setImageInfo(imageInfo);\n  }\n\n  /**\n   * @param {string|ImageInformationResponse} imageInfo\n   * Deserialized image information JSON response object or JSON response as string\n   * @api\n   */\n  setImageInfo(imageInfo) {\n    if (typeof imageInfo == 'string') {\n      this.imageInfo = JSON.parse(imageInfo);\n    } else {\n      this.imageInfo = imageInfo;\n    }\n  }\n\n  /**\n   * @return {Versions|undefined} Major IIIF version.\n   * @api\n   */\n  getImageApiVersion() {\n    if (this.imageInfo === undefined) {\n      return undefined;\n    }\n    let context = this.imageInfo['@context'] || 'ol-no-context';\n    if (typeof context == 'string') {\n      context = [context];\n    }\n    for (let i = 0; i < context.length; i++) {\n      switch (context[i]) {\n        case 'http://library.stanford.edu/iiif/image-api/1.1/context.json':\n        case 'http://iiif.io/api/image/1/context.json':\n          return Versions.VERSION1;\n        case 'http://iiif.io/api/image/2/context.json':\n          return Versions.VERSION2;\n        case 'http://iiif.io/api/image/3/context.json':\n          return Versions.VERSION3;\n        case 'ol-no-context':\n          // Image API 1.0 has no '@context'\n          if (\n            this.getComplianceLevelEntryFromProfile(Versions.VERSION1) &&\n            this.imageInfo.identifier\n          ) {\n            return Versions.VERSION1;\n          }\n          break;\n        default:\n      }\n    }\n    assert(\n      false,\n      'Cannot determine IIIF Image API version from provided image information JSON',\n    );\n  }\n\n  /**\n   * @param {Versions} version Optional IIIF image API version\n   * @return {string|undefined} Compliance level as it appears in the IIIF image information\n   * response.\n   */\n  getComplianceLevelEntryFromProfile(version) {\n    if (this.imageInfo === undefined || this.imageInfo.profile === undefined) {\n      return undefined;\n    }\n    if (version === undefined) {\n      version = this.getImageApiVersion();\n    }\n    switch (version) {\n      case Versions.VERSION1:\n        if (COMPLIANCE_VERSION1.test(this.imageInfo.profile)) {\n          return this.imageInfo.profile;\n        }\n        break;\n      case Versions.VERSION3:\n        if (COMPLIANCE_VERSION3.test(this.imageInfo.profile)) {\n          return this.imageInfo.profile;\n        }\n        break;\n      case Versions.VERSION2:\n        if (\n          typeof this.imageInfo.profile === 'string' &&\n          COMPLIANCE_VERSION2.test(this.imageInfo.profile)\n        ) {\n          return this.imageInfo.profile;\n        }\n        if (\n          Array.isArray(this.imageInfo.profile) &&\n          this.imageInfo.profile.length > 0 &&\n          typeof this.imageInfo.profile[0] === 'string' &&\n          COMPLIANCE_VERSION2.test(this.imageInfo.profile[0])\n        ) {\n          return this.imageInfo.profile[0];\n        }\n        break;\n      default:\n    }\n    return undefined;\n  }\n\n  /**\n   * @param {Versions} version Optional IIIF image API version\n   * @return {string} Compliance level, on of 'level0', 'level1' or 'level2' or undefined\n   */\n  getComplianceLevelFromProfile(version) {\n    const complianceLevel = this.getComplianceLevelEntryFromProfile(version);\n    if (complianceLevel === undefined) {\n      return undefined;\n    }\n    const level = complianceLevel.match(/level[0-2](?:\\.json)?$/g);\n    return Array.isArray(level) ? level[0].replace('.json', '') : undefined;\n  }\n\n  /**\n   * @return {SupportedFeatures|undefined} Image formats, qualities and region / size calculation\n   * methods that are supported by the IIIF service.\n   */\n  getComplianceLevelSupportedFeatures() {\n    if (this.imageInfo === undefined) {\n      return undefined;\n    }\n    const version = this.getImageApiVersion();\n    const level = this.getComplianceLevelFromProfile(version);\n    if (level === undefined) {\n      return IIIF_PROFILE_VALUES['none']['none'];\n    }\n    return IIIF_PROFILE_VALUES[version][level];\n  }\n\n  /**\n   * @param {PreferredOptions} [preferredOptions] Optional options for preferred format and quality.\n   * @return {import(\"../source/IIIF.js\").Options|undefined} IIIF tile source ready constructor options.\n   * @api\n   */\n  getTileSourceOptions(preferredOptions) {\n    const options = preferredOptions || {},\n      version = this.getImageApiVersion();\n    if (version === undefined) {\n      return undefined;\n    }\n    const imageOptions =\n      version === undefined ? undefined : versionFunctions[version](this);\n    if (imageOptions === undefined) {\n      return undefined;\n    }\n    return {\n      url: imageOptions.url,\n      version: version,\n      size: [this.imageInfo.width, this.imageInfo.height],\n      sizes: imageOptions.sizes,\n      format:\n        options.format !== undefined &&\n        imageOptions.formats.includes(options.format)\n          ? options.format\n          : imageOptions.preferredFormat !== undefined\n            ? imageOptions.preferredFormat\n            : 'jpg',\n      supports: imageOptions.supports,\n      quality:\n        options.quality && imageOptions.qualities.includes(options.quality)\n          ? options.quality\n          : imageOptions.qualities.includes('native')\n            ? 'native'\n            : 'default',\n      resolutions: Array.isArray(imageOptions.resolutions)\n        ? imageOptions.resolutions.sort(function (a, b) {\n            return b - a;\n          })\n        : undefined,\n      tileSize: imageOptions.tileSize,\n    };\n  }\n}\n\nexport default IIIFInfo;\n", "/**\n * @module ol/source/Zoomify\n */\n\nimport ImageTile from '../ImageTile.js';\nimport TileState from '../TileState.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {getCenter} from '../extent.js';\nimport {toSize} from '../size.js';\nimport TileGrid from '../tilegrid/TileGrid.js';\nimport {DEFAULT_TILE_SIZE} from '../tilegrid/common.js';\nimport {createFromTileUrlFunctions} from '../tileurlfunction.js';\nimport {expandUrl} from '../uri.js';\nimport TileImage from './TileImage.js';\n\n/**\n * @typedef {'default' | 'truncated'} TierSizeCalculation\n */\n\nexport class CustomTile extends ImageTile {\n  /**\n   * @param {import(\"../size.js\").Size} tileSize Full tile size.\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"../TileState.js\").default} state State.\n   * @param {string} src Image source URI.\n   * @param {?string} crossOrigin Cross origin.\n   * @param {import(\"../Tile.js\").LoadFunction} tileLoadFunction Tile load function.\n   * @param {import(\"../Tile.js\").Options} [options] Tile options.\n   */\n  constructor(\n    tileSize,\n    tileCoord,\n    state,\n    src,\n    crossOrigin,\n    tileLoadFunction,\n    options,\n  ) {\n    super(tileCoord, state, src, crossOrigin, tileLoadFunction, options);\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement}\n     */\n    this.zoomifyImage_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n    this.tileSize_ = tileSize;\n  }\n\n  /**\n   * Get the image element for this tile.\n   * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n   * @override\n   */\n  getImage() {\n    if (this.zoomifyImage_) {\n      return this.zoomifyImage_;\n    }\n    const image = super.getImage();\n    if (this.state == TileState.LOADED) {\n      const tileSize = this.tileSize_;\n      if (image.width == tileSize[0] && image.height == tileSize[1]) {\n        this.zoomifyImage_ = image;\n        return image;\n      }\n      const context = createCanvasContext2D(tileSize[0], tileSize[1]);\n      context.drawImage(image, 0, 0);\n      this.zoomifyImage_ = context.canvas;\n      return context.canvas;\n    }\n    return image;\n  }\n}\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value  you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection.\n * @property {number} [tilePixelRatio] The pixel ratio used by the tile service. For example, if the tile service advertizes 256px by 256px tiles but actually sends 512px by 512px images (for retina/hidpi devices) then `tilePixelRatio` should be set to `2`\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {string} url URL template or base URL of the Zoomify service.\n * A base URL is the fixed part\n * of the URL, excluding the tile group, z, x, and y folder structure, e.g.\n * `http://my.zoomify.info/IMAGE.TIF/`. A URL template must include\n * `{TileGroup}`, `{x}`, `{y}`, and `{z}` placeholders, e.g.\n * `http://my.zoomify.info/IMAGE.TIF/{TileGroup}/{z}-{x}-{y}.jpg`.\n * Internet Imaging Protocol (IIP) with JTL extension can be also used with\n * `{tileIndex}` and `{z}` placeholders, e.g.\n * `http://my.zoomify.info?FIF=IMAGE.TIF&JTL={z},{tileIndex}`.\n * A `{?-?}` template pattern, for example `subdomain{a-f}.domain.com`, may be\n * used instead of defining each one separately in the `urls` option.\n * @property {TierSizeCalculation} [tierSizeCalculation] Tier size calculation method: `default` or `truncated`.\n * @property {import(\"../size.js\").Size} size Size.\n * @property {import(\"../extent.js\").Extent} [extent] Extent for the TileGrid that is created.\n * Default sets the TileGrid in the\n * fourth quadrant, meaning extent is `[0, -height, width, 0]`. To change the\n * extent to the first quadrant (the default for OpenLayers 2) set the extent\n * as `[0, 0, width, height]`.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number} [tileSize=256] Tile size. Same tile size is used for all zoom levels.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for tile data in Zoomify format (both Zoomify and Internet\n * Imaging Protocol are supported).\n * @api\n */\nclass Zoomify extends TileImage {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    const size = options.size;\n    const tierSizeCalculation =\n      options.tierSizeCalculation !== undefined\n        ? options.tierSizeCalculation\n        : 'default';\n\n    const tilePixelRatio = options.tilePixelRatio || 1;\n    const imageWidth = size[0];\n    const imageHeight = size[1];\n    const tierSizeInTiles = [];\n    const tileSize = options.tileSize || DEFAULT_TILE_SIZE;\n    let tileSizeForTierSizeCalculation = tileSize * tilePixelRatio;\n\n    switch (tierSizeCalculation) {\n      case 'default':\n        while (\n          imageWidth > tileSizeForTierSizeCalculation ||\n          imageHeight > tileSizeForTierSizeCalculation\n        ) {\n          tierSizeInTiles.push([\n            Math.ceil(imageWidth / tileSizeForTierSizeCalculation),\n            Math.ceil(imageHeight / tileSizeForTierSizeCalculation),\n          ]);\n          tileSizeForTierSizeCalculation += tileSizeForTierSizeCalculation;\n        }\n        break;\n      case 'truncated':\n        let width = imageWidth;\n        let height = imageHeight;\n        while (\n          width > tileSizeForTierSizeCalculation ||\n          height > tileSizeForTierSizeCalculation\n        ) {\n          tierSizeInTiles.push([\n            Math.ceil(width / tileSizeForTierSizeCalculation),\n            Math.ceil(height / tileSizeForTierSizeCalculation),\n          ]);\n          width >>= 1;\n          height >>= 1;\n        }\n        break;\n      default:\n        throw new Error('Unknown `tierSizeCalculation` configured');\n    }\n\n    tierSizeInTiles.push([1, 1]);\n    tierSizeInTiles.reverse();\n\n    const resolutions = [tilePixelRatio];\n    const tileCountUpToTier = [0];\n    for (let i = 1, ii = tierSizeInTiles.length; i < ii; i++) {\n      resolutions.push(tilePixelRatio << i);\n      tileCountUpToTier.push(\n        tierSizeInTiles[i - 1][0] * tierSizeInTiles[i - 1][1] +\n          tileCountUpToTier[i - 1],\n      );\n    }\n    resolutions.reverse();\n\n    const tileGrid = new TileGrid({\n      tileSize: tileSize,\n      extent: options.extent || [0, -imageHeight, imageWidth, 0],\n      resolutions: resolutions,\n    });\n\n    let url = options.url;\n    if (url && !url.includes('{TileGroup}') && !url.includes('{tileIndex}')) {\n      url += '{TileGroup}/{z}-{x}-{y}.jpg';\n    }\n    const urls = expandUrl(url);\n\n    let tileWidth = tileSize * tilePixelRatio;\n\n    /**\n     * @param {string} template Template.\n     * @return {import(\"../Tile.js\").UrlFunction} Tile URL function.\n     */\n    function createFromTemplate(template) {\n      return (\n        /**\n         * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile Coordinate.\n         * @param {number} pixelRatio Pixel ratio.\n         * @param {import(\"../proj/Projection.js\").default} projection Projection.\n         * @return {string|undefined} Tile URL.\n         */\n        function (tileCoord, pixelRatio, projection) {\n          if (!tileCoord) {\n            return undefined;\n          }\n          const tileCoordZ = tileCoord[0];\n          const tileCoordX = tileCoord[1];\n          const tileCoordY = tileCoord[2];\n          const tileIndex =\n            tileCoordX + tileCoordY * tierSizeInTiles[tileCoordZ][0];\n          const tileGroup =\n            ((tileIndex + tileCountUpToTier[tileCoordZ]) / tileWidth) | 0;\n          const localContext = {\n            'z': tileCoordZ,\n            'x': tileCoordX,\n            'y': tileCoordY,\n            'tileIndex': tileIndex,\n            'TileGroup': 'TileGroup' + tileGroup,\n          };\n          return template.replace(/\\{(\\w+?)\\}/g, function (m, p) {\n            return localContext[p];\n          });\n        }\n      );\n    }\n\n    const tileUrlFunction = createFromTileUrlFunctions(\n      urls.map(createFromTemplate),\n    );\n\n    const ZoomifyTileClass = CustomTile.bind(\n      null,\n      toSize(tileSize * tilePixelRatio),\n    );\n\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      tilePixelRatio: tilePixelRatio,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileClass: ZoomifyTileClass,\n      tileGrid: tileGrid,\n      tileUrlFunction: tileUrlFunction,\n      transition: options.transition,\n    });\n\n    /**\n     * @type {number|import(\"../array.js\").NearestDirectionFunction}\n     */\n    this.zDirection = options.zDirection;\n\n    // Server retina tile detection (non-standard):\n    // Try loading the center tile for the highest resolution. If it is not\n    // available, we are dealing with retina tiles, and need to adjust the\n    // tile url calculation.\n    const tileUrl = tileGrid.getTileCoordForCoordAndResolution(\n      getCenter(tileGrid.getExtent()),\n      resolutions[resolutions.length - 1],\n    );\n    const testTileUrl = tileUrlFunction(tileUrl, 1, null);\n    const image = new Image();\n    image.addEventListener('error', () => {\n      tileWidth = tileSize;\n      this.changed();\n    });\n    image.src = testTileUrl;\n  }\n}\n\nexport default Zoomify;\n", "/**\n * @module ol/source/IIIF\n */\n\nimport {assert} from '../asserts.js';\nimport {getTopLeft} from '../extent.js';\nimport {Versions} from '../format/IIIFInfo.js';\nimport {toSize} from '../size.js';\nimport TileGrid from '../tilegrid/TileGrid.js';\nimport {DEFAULT_TILE_SIZE} from '../tilegrid/common.js';\nimport TileImage from './TileImage.js';\nimport {CustomTile} from './Zoomify.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The value for the crossOrigin option of the request.\n * @property {import(\"../extent.js\").Extent} [extent=[0, -height, width, 0]] The extent.\n * @property {string} [format='jpg'] Requested image format.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection.\n * @property {string} [quality] Requested IIIF image quality. Default is 'native'\n * for version 1, 'default' for versions 2 and 3.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {Array<number>} [resolutions] Supported resolutions as given in IIIF 'scaleFactors'\n * @property {import(\"../size.js\").Size} size Size of the image [width, height].\n * @property {Array<import(\"../size.js\").Size>} [sizes] Supported scaled image sizes.\n * Content of the IIIF info.json 'sizes' property, but as array of Size objects.\n * @property {import(\"./Source.js\").State} [state] Source state.\n * @property {Array<string>} [supports=[]] Supported IIIF region and size calculation\n * features.\n * @property {number} [tilePixelRatio] Tile pixel ratio.\n * @property {number|import(\"../size.js\").Size} [tileSize] Tile size.\n * Same tile size is used for all zoom levels. If tile size is a number,\n * a square tile is assumed. If the IIIF image service supports arbitrary\n * tiling (sizeByH, sizeByW, sizeByWh or sizeByPct as well as regionByPx or regionByPct\n * are supported), the default tilesize is 256.\n * @property {number} [transition] Transition.\n * @property {string} [url] Base URL of the IIIF Image service.\n * This should be the same as the IIIF Image ID.\n * @property {import(\"../format/IIIFInfo.js\").Versions} [version=Versions.VERSION2] Service's IIIF Image API version.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\nfunction formatPercentage(percentage) {\n  return percentage.toLocaleString('en', {maximumFractionDigits: 10});\n}\n\n/**\n * @classdesc\n * Layer source for IIIF Image API services.\n * @api\n */\nclass IIIF extends TileImage {\n  /**\n   * @param {Options} [options] Tile source options. Use {@link import(\"../format/IIIFInfo.js\").IIIFInfo}\n   * to parse Image API service information responses into constructor options.\n   * @api\n   */\n  constructor(options) {\n    /**\n     * @type {Partial<Options>}\n     */\n    const partialOptions = options || {};\n\n    let baseUrl = partialOptions.url || '';\n    baseUrl =\n      baseUrl +\n      (baseUrl.lastIndexOf('/') === baseUrl.length - 1 || baseUrl === ''\n        ? ''\n        : '/');\n    const version = partialOptions.version || Versions.VERSION2;\n    const sizes = partialOptions.sizes || [];\n    const size = partialOptions.size;\n    assert(\n      size != undefined &&\n        Array.isArray(size) &&\n        size.length == 2 &&\n        !isNaN(size[0]) &&\n        size[0] > 0 &&\n        !isNaN(size[1]) &&\n        size[1] > 0,\n      'Missing or invalid `size`',\n    );\n    const width = size[0];\n    const height = size[1];\n    const tileSize = partialOptions.tileSize;\n    const tilePixelRatio = partialOptions.tilePixelRatio || 1;\n    const format = partialOptions.format || 'jpg';\n    const quality =\n      partialOptions.quality ||\n      (partialOptions.version == Versions.VERSION1 ? 'native' : 'default');\n    let resolutions = partialOptions.resolutions || [];\n    const supports = partialOptions.supports || [];\n    const extent = partialOptions.extent || [0, -height, width, 0];\n\n    const supportsListedSizes =\n      sizes != undefined && Array.isArray(sizes) && sizes.length > 0;\n    const supportsListedTiles =\n      tileSize !== undefined &&\n      ((typeof tileSize === 'number' &&\n        Number.isInteger(tileSize) &&\n        tileSize > 0) ||\n        (Array.isArray(tileSize) && tileSize.length > 0));\n    const supportsArbitraryTiling =\n      supports != undefined &&\n      Array.isArray(supports) &&\n      (supports.includes('regionByPx') || supports.includes('regionByPct')) &&\n      (supports.includes('sizeByWh') ||\n        supports.includes('sizeByH') ||\n        supports.includes('sizeByW') ||\n        supports.includes('sizeByPct'));\n\n    let tileWidth, tileHeight, maxZoom;\n\n    resolutions.sort(function (a, b) {\n      return b - a;\n    });\n\n    if (supportsListedTiles || supportsArbitraryTiling) {\n      if (tileSize != undefined) {\n        if (\n          typeof tileSize === 'number' &&\n          Number.isInteger(tileSize) &&\n          tileSize > 0\n        ) {\n          tileWidth = tileSize;\n          tileHeight = tileSize;\n        } else if (Array.isArray(tileSize) && tileSize.length > 0) {\n          if (\n            tileSize.length == 1 ||\n            (tileSize[1] == undefined && Number.isInteger(tileSize[0]))\n          ) {\n            tileWidth = tileSize[0];\n            tileHeight = tileSize[0];\n          }\n          if (tileSize.length == 2) {\n            if (\n              Number.isInteger(tileSize[0]) &&\n              Number.isInteger(tileSize[1])\n            ) {\n              tileWidth = tileSize[0];\n              tileHeight = tileSize[1];\n            } else if (\n              tileSize[0] == undefined &&\n              Number.isInteger(tileSize[1])\n            ) {\n              tileWidth = tileSize[1];\n              tileHeight = tileSize[1];\n            }\n          }\n        }\n      }\n      if (tileWidth === undefined || tileHeight === undefined) {\n        tileWidth = DEFAULT_TILE_SIZE;\n        tileHeight = DEFAULT_TILE_SIZE;\n      }\n      if (resolutions.length == 0) {\n        maxZoom = Math.max(\n          Math.ceil(Math.log(width / tileWidth) / Math.LN2),\n          Math.ceil(Math.log(height / tileHeight) / Math.LN2),\n        );\n        for (let i = maxZoom; i >= 0; i--) {\n          resolutions.push(Math.pow(2, i));\n        }\n      } else {\n        const maxScaleFactor = Math.max(...resolutions);\n        // TODO maxScaleFactor might not be a power to 2\n        maxZoom = Math.round(Math.log(maxScaleFactor) / Math.LN2);\n      }\n    } else {\n      // No tile support.\n      tileWidth = width;\n      tileHeight = height;\n      resolutions = [];\n      if (supportsListedSizes) {\n        /*\n         * 'sizes' provided. Use full region in different resolutions. Every\n         * resolution has only one tile.\n         */\n        sizes.sort(function (a, b) {\n          return a[0] - b[0];\n        });\n        maxZoom = -1;\n        const ignoredSizesIndex = [];\n        for (let i = 0; i < sizes.length; i++) {\n          const resolution = width / sizes[i][0];\n          if (\n            resolutions.length > 0 &&\n            resolutions[resolutions.length - 1] == resolution\n          ) {\n            ignoredSizesIndex.push(i);\n            continue;\n          }\n          resolutions.push(resolution);\n          maxZoom++;\n        }\n        if (ignoredSizesIndex.length > 0) {\n          for (let i = 0; i < ignoredSizesIndex.length; i++) {\n            sizes.splice(ignoredSizesIndex[i] - i, 1);\n          }\n        }\n      } else {\n        // No useful image information at all. Try pseudo tile with full image.\n        resolutions.push(1);\n        sizes.push([width, height]);\n        maxZoom = 0;\n      }\n    }\n\n    const tileGrid = new TileGrid({\n      tileSize: [tileWidth, tileHeight],\n      extent: extent,\n      origin: getTopLeft(extent),\n      resolutions: resolutions,\n    });\n\n    const tileUrlFunction = function (tileCoord, pixelRatio, projection) {\n      let regionParam, sizeParam;\n      const zoom = tileCoord[0];\n      if (zoom > maxZoom) {\n        return;\n      }\n      const tileX = tileCoord[1],\n        tileY = tileCoord[2],\n        scale = resolutions[zoom];\n      if (\n        tileX === undefined ||\n        tileY === undefined ||\n        scale === undefined ||\n        tileX < 0 ||\n        Math.ceil(width / scale / tileWidth) <= tileX ||\n        tileY < 0 ||\n        Math.ceil(height / scale / tileHeight) <= tileY\n      ) {\n        return;\n      }\n      if (supportsArbitraryTiling || supportsListedTiles) {\n        const regionX = tileX * tileWidth * scale,\n          regionY = tileY * tileHeight * scale;\n        let regionW = tileWidth * scale,\n          regionH = tileHeight * scale,\n          sizeW = tileWidth,\n          sizeH = tileHeight;\n        if (regionX + regionW > width) {\n          regionW = width - regionX;\n        }\n        if (regionY + regionH > height) {\n          regionH = height - regionY;\n        }\n        if (regionX + tileWidth * scale > width) {\n          sizeW = Math.floor((width - regionX + scale - 1) / scale);\n        }\n        if (regionY + tileHeight * scale > height) {\n          sizeH = Math.floor((height - regionY + scale - 1) / scale);\n        }\n        if (\n          regionX == 0 &&\n          regionW == width &&\n          regionY == 0 &&\n          regionH == height\n        ) {\n          // canonical full image region parameter is 'full', not 'x,y,w,h'\n          regionParam = 'full';\n        } else if (\n          !supportsArbitraryTiling ||\n          supports.includes('regionByPx')\n        ) {\n          regionParam = regionX + ',' + regionY + ',' + regionW + ',' + regionH;\n        } else if (supports.includes('regionByPct')) {\n          const pctX = formatPercentage((regionX / width) * 100),\n            pctY = formatPercentage((regionY / height) * 100),\n            pctW = formatPercentage((regionW / width) * 100),\n            pctH = formatPercentage((regionH / height) * 100);\n          regionParam = 'pct:' + pctX + ',' + pctY + ',' + pctW + ',' + pctH;\n        }\n        if (\n          version == Versions.VERSION3 &&\n          (!supportsArbitraryTiling || supports.includes('sizeByWh'))\n        ) {\n          sizeParam = sizeW + ',' + sizeH;\n        } else if (!supportsArbitraryTiling || supports.includes('sizeByW')) {\n          sizeParam = sizeW + ',';\n        } else if (supports.includes('sizeByH')) {\n          sizeParam = ',' + sizeH;\n        } else if (supports.includes('sizeByWh')) {\n          sizeParam = sizeW + ',' + sizeH;\n        } else if (supports.includes('sizeByPct')) {\n          sizeParam = 'pct:' + formatPercentage(100 / scale);\n        }\n      } else {\n        regionParam = 'full';\n        if (supportsListedSizes) {\n          const regionWidth = sizes[zoom][0],\n            regionHeight = sizes[zoom][1];\n          if (version == Versions.VERSION3) {\n            if (regionWidth == width && regionHeight == height) {\n              sizeParam = 'max';\n            } else {\n              sizeParam = regionWidth + ',' + regionHeight;\n            }\n          } else {\n            if (regionWidth == width) {\n              sizeParam = 'full';\n            } else {\n              sizeParam = regionWidth + ',';\n            }\n          }\n        } else {\n          sizeParam = version == Versions.VERSION3 ? 'max' : 'full';\n        }\n      }\n      return (\n        baseUrl + regionParam + '/' + sizeParam + '/0/' + quality + '.' + format\n      );\n    };\n\n    const IiifTileClass = CustomTile.bind(\n      null,\n      toSize(tileSize || 256).map(function (size) {\n        return size * tilePixelRatio;\n      }),\n    );\n\n    super({\n      attributions: partialOptions.attributions,\n      attributionsCollapsible: partialOptions.attributionsCollapsible,\n      cacheSize: partialOptions.cacheSize,\n      crossOrigin: partialOptions.crossOrigin,\n      interpolate: partialOptions.interpolate,\n      projection: partialOptions.projection,\n      reprojectionErrorThreshold: partialOptions.reprojectionErrorThreshold,\n      state: partialOptions.state,\n      tileClass: IiifTileClass,\n      tileGrid: tileGrid,\n      tilePixelRatio: partialOptions.tilePixelRatio,\n      tileUrlFunction: tileUrlFunction,\n      transition: partialOptions.transition,\n    });\n\n    /**\n     * @type {number|import(\"../array.js\").NearestDirectionFunction}\n     */\n    this.zDirection = partialOptions.zDirection;\n  }\n}\n\nexport default IIIF;\n", "/**\n * @module ol/source/arcgisRest\n */\n\nimport {decode} from '../Image.js';\nimport {getHeight, getWidth} from '../extent.js';\nimport {round} from '../math.js';\nimport {get as getProjection} from '../proj.js';\nimport {appendParams} from '../uri.js';\nimport {getRequestExtent} from './Image.js';\nimport {DECIMALS} from './common.js';\n\n/**\n * @param {string} baseUrl Base URL for the ArcGIS Rest service.\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {import(\"../proj/Projection.js\").default} projection Projection.\n * @param {Object} params Params.\n * @return {string} Request URL.\n */\nexport function getRequestUrl(\n  baseUrl,\n  extent,\n  resolution,\n  pixelRatio,\n  projection,\n  params,\n) {\n  // ArcGIS Server only wants the numeric portion of the projection ID.\n  // (if there is no numeric portion the entire projection code must\n  // form a valid ArcGIS SpatialReference definition).\n  const srid = projection\n    .getCode()\n    .split(/:(?=\\d+$)/)\n    .pop();\n\n  const imageResolution = resolution / pixelRatio;\n\n  const imageSize = [\n    round(getWidth(extent) / imageResolution, DECIMALS),\n    round(getHeight(extent) / imageResolution, DECIMALS),\n  ];\n\n  params['SIZE'] = imageSize[0] + ',' + imageSize[1];\n  params['BBOX'] = extent.join(',');\n  params['BBOXSR'] = srid;\n  params['IMAGESR'] = srid;\n  params['DPI'] = Math.round(\n    params['DPI'] ? params['DPI'] * pixelRatio : 90 * pixelRatio,\n  );\n\n  const modifiedUrl = baseUrl\n    .replace(/MapServer\\/?$/, 'MapServer/export')\n    .replace(/ImageServer\\/?$/, 'ImageServer/exportImage');\n  return appendParams(modifiedUrl, params);\n}\n\n/**\n * @typedef {Object} LoaderOptions\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting the image from\n * the remote server.\n * @property {Object<string,*>} [params] ArcGIS Rest parameters. This field is optional. Service\n * defaults will be used for any fields not specified. `FORMAT` is `PNG32` by default. `F` is\n * `IMAGE` by default. `TRANSPARENT` is `true` by default.  `BBOX`, `SIZE`, `BBOXSR`, and `IMAGESR`\n * will be set dynamically. Set `LAYERS` to override the default service layer visibility. See\n * https://developers.arcgis.com/rest/services-reference/export-map.htm\n * for further reference.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is 'EPSG:3857'.\n * The projection code must contain a numeric end portion separated by :\n * or the entire code must form a valid ArcGIS SpatialReference definition.\n * @property {number} [ratio=1.5] Ratio. `1` means image requests are the size of the map viewport,\n * `2` means twice the size of the map viewport, and so on.\n * @property {string} url ArcGIS Rest service URL for a Map Service or Image Service. The url\n * should include /MapServer or /ImageServer.\n * @property {function(HTMLImageElement, string): Promise<import('../DataTile.js').ImageLike>} [load] Function\n * to perform loading of the image. Receives the created `HTMLImageElement` and the desired `src` as argument and\n * returns a promise resolving to the loaded or decoded image. Default is {@link module:ol/Image.decode}.\n */\n\n/**\n * Creates a loader for ArcGIS Rest images.\n * @param {LoaderOptions} options Image ArcGIS Rest Options.\n * @return {import('../Image.js').ImageObjectPromiseLoader} ArcGIS Rest image.\n * @api\n */\nexport function createLoader(options) {\n  const load = options.load ? options.load : decode;\n  const projection = getProjection(options.projection || 'EPSG:3857');\n  const ratio = options.ratio ?? 1.5;\n  const crossOrigin = options.crossOrigin ?? null;\n\n  return function (extent, resolution, pixelRatio) {\n    pixelRatio = options.hidpi ? pixelRatio : 1;\n\n    const params = {\n      'F': 'image',\n      'FORMAT': 'PNG32',\n      'TRANSPARENT': true,\n    };\n    Object.assign(params, options.params);\n\n    extent = getRequestExtent(extent, resolution, pixelRatio, ratio);\n\n    const src = getRequestUrl(\n      options.url,\n      extent,\n      resolution,\n      pixelRatio,\n      projection,\n      params,\n    );\n\n    const image = new Image();\n    image.crossOrigin = crossOrigin;\n\n    return load(image, src).then((image) => {\n      // Update resolution, because the server may return a smaller size than requested\n      const resolution = (getWidth(extent) / image.width) * pixelRatio;\n      return {image, extent, resolution, pixelRatio};\n    });\n  };\n}\n", "/**\n * @module ol/source/ImageArcGISRest\n */\n\nimport {decode} from '../Image.js';\nimport ImageSource, {defaultImageLoadFunction} from './Image.js';\nimport {createLoader} from './arcgisRest.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting the image from\n * the remote server.\n * @property {import(\"../Image.js\").LoadFunction} [imageLoadFunction] Optional function to load an image given\n * a URL.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {Object<string,*>} [params] ArcGIS Rest parameters. This field is optional. Service\n * defaults will be used for any fields not specified. `FORMAT` is `PNG32` by default. `F` is\n * `IMAGE` by default. `TRANSPARENT` is `true` by default.  `BBOX`, `SIZE`, `BBOXSR`, and `IMAGESR`\n * will be set dynamically. Set `LAYERS` to override the default service layer visibility. See\n * https://developers.arcgis.com/rest/services-reference/export-map.htm\n * for further reference.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * The projection code must contain a numeric end portion separated by :\n * or the entire code must form a valid ArcGIS SpatialReference definition.\n * @property {number} [ratio=1.5] Ratio. `1` means image requests are the size of the map viewport,\n * `2` means twice the size of the map viewport, and so on.\n * @property {Array<number>} [resolutions] Resolutions. If specified, requests will be made for\n * these resolutions only.\n * @property {string} [url] ArcGIS Rest service URL for a Map Service or Image Service. The url\n * should include /MapServer or /ImageServer.\n */\n\n/**\n * @classdesc\n * Source for data from ArcGIS Rest services providing single, untiled images.\n * Useful when underlying map service has labels.\n *\n * If underlying map service is not using labels,\n * take advantage of ol image caching and use\n * {@link module:ol/source/TileArcGISRest~TileArcGISRest} data source.\n *\n * @fires module:ol/source/Image.ImageSourceEvent\n * @api\n */\nclass ImageArcGISRest extends ImageSource {\n  /**\n   * @param {Options} [options] Image ArcGIS Rest Options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    super({\n      attributions: options.attributions,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      resolutions: options.resolutions,\n    });\n\n    /**\n     * @private\n     * @type {?string}\n     */\n    this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.url_ = options.url;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").LoadFunction}\n     */\n    this.imageLoadFunction_ =\n      options.imageLoadFunction !== undefined\n        ? options.imageLoadFunction\n        : defaultImageLoadFunction;\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.params_ = Object.assign({}, options.params);\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n    this.imageSize_ = [0, 0];\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRevision_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.ratio_ = options.ratio !== undefined ? options.ratio : 1.5;\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.loaderProjection_ = null;\n  }\n\n  /**\n   * Get the user-provided params, i.e. those passed to the constructor through\n   * the \"params\" option, and possibly updated using the updateParams method.\n   * @return {Object} Params.\n   * @api\n   */\n  getParams() {\n    return this.params_;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   * @override\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    if (this.url_ === undefined) {\n      return null;\n    }\n    if (!this.loader || this.loaderProjection_ !== projection) {\n      // Lazily create loader to pick up the view projection and to allow `params` updates\n      this.loaderProjection_ = projection;\n      this.loader = createLoader({\n        crossOrigin: this.crossOrigin_,\n        params: this.params_,\n        projection: projection,\n        hidpi: this.hidpi_,\n        url: this.url_,\n        ratio: this.ratio_,\n        load: (image, src) => {\n          this.image.setImage(image);\n          this.imageLoadFunction_(this.image, src);\n          return decode(image);\n        },\n      });\n    }\n\n    return super.getImageInternal(extent, resolution, pixelRatio, projection);\n  }\n\n  /**\n   * Return the image load function of the source.\n   * @return {import(\"../Image.js\").LoadFunction} The image load function.\n   * @api\n   */\n  getImageLoadFunction() {\n    return this.imageLoadFunction_;\n  }\n\n  /**\n   * Return the URL used for this ArcGIS source.\n   * @return {string|undefined} URL.\n   * @api\n   */\n  getUrl() {\n    return this.url_;\n  }\n\n  /**\n   * Set the image load function of the source.\n   * @param {import(\"../Image.js\").LoadFunction} imageLoadFunction Image load function.\n   * @api\n   */\n  setImageLoadFunction(imageLoadFunction) {\n    this.imageLoadFunction_ = imageLoadFunction;\n    this.changed();\n  }\n\n  /**\n   * Set the URL to use for requests.\n   * @param {string|undefined} url URL.\n   * @api\n   */\n  setUrl(url) {\n    if (url != this.url_) {\n      this.url_ = url;\n      this.loader = null;\n      this.changed();\n    }\n  }\n\n  /**\n   * Set the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  setParams(params) {\n    this.params_ = Object.assign({}, params);\n    this.changed();\n  }\n\n  /**\n   * Update the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  updateParams(params) {\n    Object.assign(this.params_, params);\n    this.changed();\n  }\n\n  /**\n   * @override\n   */\n  changed() {\n    this.image = null;\n    super.changed();\n  }\n}\n\nexport default ImageArcGISRest;\n", "/**\n * @module ol/source/ImageCanvas\n */\n\nimport ImageCanvas from '../ImageCanvas.js';\nimport {\n  containsExtent,\n  getHeight,\n  getWidth,\n  scaleFromCenter,\n} from '../extent.js';\nimport ImageSource from './Image.js';\n\n/**\n * A function returning the canvas element (`{HTMLCanvasElement}`)\n * used by the source as an image. The arguments passed to the function are:\n * {@link module:ol/extent~Extent} the image extent, `{number}` the image resolution,\n * `{number}` the pixel ratio of the map, {@link module:ol/size~Size} the image size,\n * and {@link module:ol/proj/Projection~Projection} the image projection. The canvas returned by\n * this function is cached by the source. The this keyword inside the function\n * references the {@link module:ol/source/ImageCanvas~ImageCanvasSource}.\n *\n * @typedef {function(this:import(\"../ImageCanvas.js\").default, import(\"../extent.js\").Extent, number,\n *     number, import(\"../size.js\").Size, import(\"../proj/Projection.js\").default): HTMLCanvasElement} FunctionType\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {FunctionType} [canvasFunction] Canvas function.\n * The function returning the canvas element used by the source\n * as an image. The arguments passed to the function are: {@link import(\"../extent.js\").Extent} the\n * image extent, `{number}` the image resolution, `{number}` the pixel ratio of the map,\n * {@link import(\"../size.js\").Size} the image size, and {@link import(\"../proj/Projection.js\").default} the image\n * projection. The canvas returned by this function is cached by the source. If\n * the value returned by the function is later changed then\n * `changed` should be called on the source for the source to\n * invalidate the current cached image. See: {@link module:ol/Observable~Observable#changed}\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {number} [ratio=1.5] Ratio. 1 means canvases are the size of the map viewport, 2 means twice the\n * width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {Array<number>} [resolutions] Resolutions.\n * If specified, new canvases will be created for these resolutions\n * @property {import(\"./Source.js\").State} [state] Source state.\n */\n\n/**\n * @classdesc\n * Base class for image sources where a canvas element is the image.\n * @api\n */\nclass ImageCanvasSource extends ImageSource {\n  /**\n   * @param {Options} [options] ImageCanvas options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    super({\n      attributions: options.attributions,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      resolutions: options.resolutions,\n      state: options.state,\n    });\n\n    /**\n     * @private\n     * @type {FunctionType}\n     */\n    this.canvasFunction_ = options.canvasFunction;\n\n    /**\n     * @private\n     * @type {import(\"../ImageCanvas.js\").default}\n     */\n    this.canvas_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRevision_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.ratio_ = options.ratio !== undefined ? options.ratio : 1.5;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../ImageCanvas.js\").default} Single image.\n   * @override\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    resolution = this.findNearestResolution(resolution);\n\n    let canvas = this.canvas_;\n    if (\n      canvas &&\n      this.renderedRevision_ == this.getRevision() &&\n      canvas.getResolution() == resolution &&\n      canvas.getPixelRatio() == pixelRatio &&\n      containsExtent(canvas.getExtent(), extent)\n    ) {\n      return canvas;\n    }\n\n    extent = extent.slice();\n    scaleFromCenter(extent, this.ratio_);\n    const width = getWidth(extent) / resolution;\n    const height = getHeight(extent) / resolution;\n    const size = [width * pixelRatio, height * pixelRatio];\n\n    const canvasElement = this.canvasFunction_.call(\n      this,\n      extent,\n      resolution,\n      pixelRatio,\n      size,\n      projection,\n    );\n    if (canvasElement) {\n      canvas = new ImageCanvas(extent, resolution, pixelRatio, canvasElement);\n    }\n    this.canvas_ = canvas;\n    this.renderedRevision_ = this.getRevision();\n\n    return canvas;\n  }\n}\n\nexport default ImageCanvasSource;\n", "/**\n * @module ol/source/mapguide\n */\n\nimport {decode} from '../Image.js';\nimport {getCenter, getHeight, getWidth} from '../extent.js';\nimport {appendParams} from '../uri.js';\nimport {getRequestExtent} from './Image.js';\n\n/**\n * @typedef {Object} LoaderOptions\n * @property {string} url The mapagent url.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {number} [displayDpi=96] The display resolution.\n * @property {number} [metersPerUnit=1] The meters-per-unit value.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {boolean} [useOverlay] If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n * @property {number} [ratio=1] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {Object} [params] Additional query parameters.\n * @property {function(HTMLImageElement, string): Promise<import('../DataTile.js').ImageLike>} [load] Function\n * to perform loading of the image. Receives the created `HTMLImageElement` and the desired `src` as argument and\n * returns a promise resolving to the loaded or decoded image. Default is {@link module:ol/Image.decode}.\n */\n\n/**\n * @param {import(\"../extent.js\").Extent} extent The map extents.\n * @param {import(\"../size.js\").Size} size The viewport size.\n * @param {number} metersPerUnit The meters-per-unit value.\n * @param {number} dpi The display resolution.\n * @return {number} The computed map scale.\n */\nfunction getScale(extent, size, metersPerUnit, dpi) {\n  const mcsW = getWidth(extent);\n  const mcsH = getHeight(extent);\n  const devW = size[0];\n  const devH = size[1];\n  const mpp = 0.0254 / dpi;\n  if (devH * mcsW > devW * mcsH) {\n    return (mcsW * metersPerUnit) / (devW * mpp); // width limited\n  }\n  return (mcsH * metersPerUnit) / (devH * mpp); // height limited\n}\n\n/**\n * @param {string} baseUrl The mapagent url.\n * @param {Object<string, string|number>} params Request parameters.\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {import(\"../size.js\").Size} size Size.\n * @param {boolean} useOverlay If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n * @param {number} metersPerUnit The meters-per-unit value.\n * @param {number} displayDpi The display resolution.\n * @return {string} The mapagent map image request URL.\n */\nfunction getUrl(\n  baseUrl,\n  params,\n  extent,\n  size,\n  useOverlay,\n  metersPerUnit,\n  displayDpi,\n) {\n  const scale = getScale(extent, size, metersPerUnit, displayDpi);\n  const center = getCenter(extent);\n  const baseParams = {\n    'OPERATION': useOverlay ? 'GETDYNAMICMAPOVERLAYIMAGE' : 'GETMAPIMAGE',\n    'VERSION': '2.0.0',\n    'LOCALE': 'en',\n    'CLIENTAGENT': 'ol/source/ImageMapGuide source',\n    'CLIP': '1',\n    'SETDISPLAYDPI': displayDpi,\n    'SETDISPLAYWIDTH': Math.round(size[0]),\n    'SETDISPLAYHEIGHT': Math.round(size[1]),\n    'SETVIEWSCALE': scale,\n    'SETVIEWCENTERX': center[0],\n    'SETVIEWCENTERY': center[1],\n  };\n  Object.assign(baseParams, params);\n  return appendParams(baseUrl, baseParams);\n}\n\n/**\n * Creates a loader for MapGuide images.\n * @param {LoaderOptions} options Image ArcGIS Rest Options.\n * @return {import('../Image.js').ImageObjectPromiseLoader} ArcGIS Rest image.\n * @api\n */\nexport function createLoader(options) {\n  const load = options.load || decode;\n  const useOverlay = options.useOverlay ?? false;\n  const metersPerUnit = options.metersPerUnit || 1;\n  const displayDpi = options.displayDpi || 96;\n  const ratio = options.ratio ?? 1;\n  const crossOrigin = options.crossOrigin ?? null;\n\n  return function (extent, resolution, pixelRatio) {\n    const image = new Image();\n    image.crossOrigin = crossOrigin;\n    extent = getRequestExtent(extent, resolution, pixelRatio, ratio);\n    const width = getWidth(extent) / resolution;\n    const height = getHeight(extent) / resolution;\n    const size = [width * pixelRatio, height * pixelRatio];\n    const src = getUrl(\n      options.url,\n      options.params,\n      extent,\n      size,\n      useOverlay,\n      metersPerUnit,\n      displayDpi,\n    );\n    return load(image, src).then((image) => ({image, extent, pixelRatio}));\n  };\n}\n", "/**\n * @module ol/source/ImageMapGuide\n */\n\nimport {decode} from '../Image.js';\nimport ImageSource, {defaultImageLoadFunction} from './Image.js';\nimport {createLoader} from './mapguide.js';\n\n/**\n * @typedef {Object} Options\n * @property {string} [url] The mapagent url.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {number} [displayDpi=96] The display resolution.\n * @property {number} [metersPerUnit=1] The meters-per-unit value.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {boolean} [useOverlay] If `true`, will use `GETDYNAMICMAPOVERLAYIMAGE`.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {number} [ratio=1] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or higher.\n * @property {Array<number>} [resolutions] Resolutions.\n * If specified, requests will be made for these resolutions only.\n * @property {import(\"../Image.js\").LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {Object} [params] Additional parameters.\n */\n\n/**\n * @classdesc\n * Source for images from Mapguide servers\n *\n * @fires module:ol/source/Image.ImageSourceEvent\n * @api\n */\nclass ImageMapGuide extends ImageSource {\n  /**\n   * @param {Options} options ImageMapGuide options.\n   */\n  constructor(options) {\n    super({\n      interpolate: options.interpolate,\n      projection: options.projection,\n      resolutions: options.resolutions,\n    });\n\n    /**\n     * @private\n     * @type {?string}\n     */\n    this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.displayDpi_ =\n      options.displayDpi !== undefined ? options.displayDpi : 96;\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.params_ = Object.assign({}, options.params);\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.url_ = options.url;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").LoadFunction}\n     */\n    this.imageLoadFunction_ =\n      options.imageLoadFunction !== undefined\n        ? options.imageLoadFunction\n        : defaultImageLoadFunction;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.metersPerUnit_ =\n      options.metersPerUnit !== undefined ? options.metersPerUnit : 1;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.ratio_ = options.ratio !== undefined ? options.ratio : 1;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.useOverlay_ =\n      options.useOverlay !== undefined ? options.useOverlay : false;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRevision_ = 0;\n\n    /**\n     * @private\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.loaderProjection_ = null;\n  }\n\n  /**\n   * Get the user-provided params, i.e. those passed to the constructor through\n   * the \"params\" option, and possibly updated using the updateParams method.\n   * @return {Object} Params.\n   * @api\n   */\n  getParams() {\n    return this.params_;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   * @override\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    if (this.url_ === undefined) {\n      return null;\n    }\n    if (!this.loader || this.loaderProjection_ !== projection) {\n      // Lazily create loader to pick up the view projection and to allow `params` updates\n      this.loaderProjection_ = projection;\n      this.loader = createLoader({\n        crossOrigin: this.crossOrigin_,\n        params: this.params_,\n        hidpi: this.hidpi_,\n        metersPerUnit: this.metersPerUnit_,\n        url: this.url_,\n        useOverlay: this.useOverlay_,\n        ratio: this.ratio_,\n        load: (image, src) => {\n          this.image.setImage(image);\n          this.imageLoadFunction_(this.image, src);\n          return decode(image);\n        },\n      });\n    }\n\n    return super.getImageInternal(extent, resolution, pixelRatio, projection);\n  }\n\n  /**\n   * Return the image load function of the source.\n   * @return {import(\"../Image.js\").LoadFunction} The image load function.\n   * @api\n   */\n  getImageLoadFunction() {\n    return this.imageLoadFunction_;\n  }\n\n  /**\n   * Set the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  setParams(params) {\n    this.params_ = Object.assign({}, params);\n    this.changed();\n  }\n\n  /**\n   * Update the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  updateParams(params) {\n    Object.assign(this.params_, params);\n    this.changed();\n  }\n\n  /**\n   * Set the image load function of the MapGuide source.\n   * @param {import(\"../Image.js\").LoadFunction} imageLoadFunction Image load function.\n   * @api\n   */\n  setImageLoadFunction(imageLoadFunction) {\n    this.imageLoadFunction_ = imageLoadFunction;\n    this.changed();\n  }\n\n  /**\n   * @override\n   */\n  changed() {\n    this.image = null;\n    super.changed();\n  }\n}\n\nexport default ImageMapGuide;\n", "/**\n * @module ol/source/ImageTile\n */\nimport {expandUrl, pickUrl, renderXYZTemplate} from '../uri.js';\nimport DataTileSource from './DataTile.js';\n\n/**\n * Image tile loading function.  The function is called with z, x, and y tile coordinates and\n * returns an {@link import(\"../DataTile.js\").ImageLike image} or a promise for the same.\n *\n * @typedef {function(number, number, number, import(\"./DataTile.js\").LoaderOptions):(import(\"../DataTile.js\").ImageLike|Promise<import(\"../DataTile.js\").ImageLike>)} Loader\n */\n\n/**\n * @typedef {function(number, number, number, import(\"./DataTile.js\").LoaderOptions):string} UrlGetter\n */\n\n/**\n * @typedef {string | Array<string> | UrlGetter} UrlLike\n */\n\n/**\n * @typedef {Object} Options\n * @property {UrlLike} [url] The image URL template.  In addition to a single URL template, an array of URL templates or a function\n * can be provided.  If a function is provided, it will be called with z, x, y tile coordinates and loader options and should\n * return a URL.\n * @property {Loader} [loader] Data loader.  Called with z, x, and y tile coordinates.\n * Returns an {@link import(\"../DataTile.js\").ImageLike image} for a tile or a promise for the same.\n * The promise should not resolve until the image is loaded.  If the `url` option is provided, a loader will be created.\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [maxZoom=42] Optional max zoom level. Not used if `tileGrid` is provided.\n * @property {number} [minZoom=0] Optional min zoom level. Not used if `tileGrid` is provided.\n * @property {number|import(\"../size.js\").Size} [tileSize=[256, 256]] The pixel width and height of the source tiles.\n * This may be different than the rendered pixel size if a `tileGrid` is provided.\n * @property {number} [gutter=0] The size in pixels of the gutter around data tiles to ignore.\n * This allows artifacts of rendering at tile edges to be ignored.\n * Supported data should be wider and taller than the tile size by a value of `2 x gutter`.\n * @property {number} [maxResolution] Optional tile grid resolution at level zero. Not used if `tileGrid` is provided.\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Tile projection.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid.\n * @property {import(\"./Source.js\").State} [state] The source state.\n * @property {boolean} [wrapX=true] Render tiles beyond the antimeridian.\n * @property {number} [transition] Transition time when fading in new tiles (in miliseconds).\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.\n * @property {import('./DataTile.js').CrossOriginAttribute} [crossOrigin='anonymous'] The crossOrigin property to pass to loaders for image data.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\nconst loadError = new Error('Image failed to load');\n\n/**\n * @param {string} template The image url template.\n * @param {number} z The tile z coordinate.\n * @param {number} x The tile x coordinate.\n * @param {number} y The tile y coordinate.\n * @param {import('./DataTile.js').LoaderOptions} options The loader options.\n * @return {Promise<HTMLImageElement>} Resolves with a loaded image.\n */\nfunction loadImage(template, z, x, y, options) {\n  return new Promise((resolve, reject) => {\n    const image = new Image();\n    image.crossOrigin = options.crossOrigin ?? null;\n    image.addEventListener('load', () => resolve(image));\n    image.addEventListener('error', () => reject(loadError));\n    image.src = renderXYZTemplate(template, z, x, y, options.maxY);\n  });\n}\n\n/**\n * @param {Array<string>} templates The url templates.\n * @return {Loader} The image loader.\n */\nfunction makeLoaderFromTemplates(templates) {\n  return function (z, x, y, options) {\n    const template = pickUrl(templates, z, x, y);\n    return loadImage(template, z, x, y, options);\n  };\n}\n\n/**\n * @param {UrlGetter} getter The url getter.\n * @return {Loader} The image loader.\n */\nfunction makeLoaderFromGetter(getter) {\n  return function (z, x, y, options) {\n    const url = getter(z, x, y, options);\n    return loadImage(url, z, x, y, options);\n  };\n}\n\n/**\n * @param {UrlLike} url The URL-like option.\n * @return {Loader} The tile loader.\n */\nfunction makeLoaderFromUrlLike(url) {\n  /**\n   * @type {Loader}\n   */\n  let loader;\n\n  if (Array.isArray(url)) {\n    loader = makeLoaderFromTemplates(url);\n  } else if (typeof url === 'string') {\n    const urls = expandUrl(url);\n    loader = makeLoaderFromTemplates(urls);\n  } else if (typeof url === 'function') {\n    loader = makeLoaderFromGetter(url);\n  } else {\n    throw new Error(\n      'The url option must be a single template, an array of templates, or a function for getting a URL',\n    );\n  }\n  return loader;\n}\n\nlet keyCount = 0;\n\n/**\n * @param {UrlLike} url The URL-like option.\n * @return {string} A key for the URL.\n */\nfunction keyFromUrlLike(url) {\n  if (Array.isArray(url)) {\n    return url.join('\\n');\n  }\n\n  if (typeof url === 'string') {\n    return url;\n  }\n\n  ++keyCount;\n  return 'url-function-key-' + keyCount;\n}\n\n/**\n * @classdesc\n * A source for typed array data tiles.\n *\n * @extends DataTileSource<import(\"../ImageTile.js\").default>\n * @fires import(\"./Tile.js\").TileSourceEvent\n * @api\n */\nclass ImageTileSource extends DataTileSource {\n  /**\n   * @param {Options} [options] DataTile source options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    /**\n     * @type {Loader}\n     */\n    let loader = options.loader;\n\n    /**\n     * @type {string}\n     */\n    let key;\n\n    if (options.url) {\n      loader = makeLoaderFromUrlLike(options.url);\n      key = keyFromUrlLike(options.url);\n    }\n\n    /**\n     * @type {import('./Source.js').State}\n     */\n    const state = !loader ? 'loading' : options.state;\n\n    const wrapX = options.wrapX === undefined ? true : options.wrapX;\n\n    super({\n      loader: loader,\n      key: key,\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      maxZoom: options.maxZoom,\n      minZoom: options.minZoom,\n      tileSize: options.tileSize,\n      gutter: options.gutter,\n      maxResolution: options.maxResolution,\n      projection: options.projection,\n      tileGrid: options.tileGrid,\n      state: state,\n      wrapX: wrapX,\n      transition: options.transition,\n      interpolate: options.interpolate !== false,\n      crossOrigin: options.crossOrigin,\n      zDirection: options.zDirection,\n    });\n  }\n\n  /**\n   * @param {UrlLike} url The new URL.\n   * @api\n   */\n  setUrl(url) {\n    const loader = makeLoaderFromUrlLike(url);\n    this.setLoader(loader);\n    this.setKey(keyFromUrlLike(url));\n    if (this.getState() !== 'ready') {\n      this.setState('ready');\n    }\n  }\n}\n\nexport default ImageTileSource;\n", "/**\n * @module ol/net\n */\nimport {getUid} from './util.js';\n\n/**\n * Simple JSONP helper. Supports error callbacks and a custom callback param.\n * The error callback will be called when no JSONP is executed after 10 seconds.\n *\n * @param {string} url Request url. A 'callback' query parameter will be\n *     appended.\n * @param {Function} callback Callback on success.\n * @param {Function} [errback] Callback on error.\n * @param {string} [callbackParam] Custom query parameter for the JSONP\n *     callback. Default is 'callback'.\n */\nexport function jsonp(url, callback, errback, callbackParam) {\n  const script = document.createElement('script');\n  const key = 'olc_' + getUid(callback);\n  function cleanup() {\n    delete window[key];\n    script.parentNode.removeChild(script);\n  }\n  script.async = true;\n  script.src =\n    url +\n    (url.includes('?') ? '&' : '?') +\n    (callbackParam || 'callback') +\n    '=' +\n    key;\n  const timer = setTimeout(function () {\n    cleanup();\n    if (errback) {\n      errback();\n    }\n  }, 10000);\n  window[key] = function (data) {\n    clearTimeout(timer);\n    cleanup();\n    callback(data);\n  };\n  document.head.appendChild(script);\n}\n\nexport class ResponseError extends Error {\n  /**\n   * @param {XMLHttpRequest} response The XHR object.\n   */\n  constructor(response) {\n    const message = 'Unexpected response status: ' + response.status;\n    super(message);\n\n    /**\n     * @type {string}\n     */\n    this.name = 'ResponseError';\n\n    /**\n     * @type {XMLHttpRequest}\n     */\n    this.response = response;\n  }\n}\n\nexport class ClientError extends Error {\n  /**\n   * @param {XMLHttpRequest} client The XHR object.\n   */\n  constructor(client) {\n    super('Failed to issue request');\n\n    /**\n     * @type {string}\n     */\n    this.name = 'ClientError';\n\n    /**\n     * @type {XMLHttpRequest}\n     */\n    this.client = client;\n  }\n}\n\n/**\n * @param {string} url The URL.\n * @return {Promise<Object>} A promise that resolves to the JSON response.\n */\nexport function getJSON(url) {\n  return new Promise(function (resolve, reject) {\n    /**\n     * @param {ProgressEvent<XMLHttpRequest>} event The load event.\n     */\n    function onLoad(event) {\n      const client = event.target;\n      // status will be 0 for file:// urls\n      if (!client.status || (client.status >= 200 && client.status < 300)) {\n        let data;\n        try {\n          data = JSON.parse(client.responseText);\n        } catch (err) {\n          const message = 'Error parsing response text as JSON: ' + err.message;\n          reject(new Error(message));\n          return;\n        }\n        resolve(data);\n        return;\n      }\n\n      reject(new ResponseError(client));\n    }\n\n    /**\n     * @param {ProgressEvent<XMLHttpRequest>} event The error event.\n     */\n    function onError(event) {\n      reject(new ClientError(event.target));\n    }\n\n    const client = new XMLHttpRequest();\n    client.addEventListener('load', onLoad);\n    client.addEventListener('error', onError);\n    client.open('GET', url);\n    client.setRequestHeader('Accept', 'application/json');\n    client.send();\n  });\n}\n\n/**\n * @param {string} base The base URL.\n * @param {string} url The potentially relative URL.\n * @return {string} The full URL.\n */\nexport function resolveUrl(base, url) {\n  if (url.includes('://')) {\n    return url;\n  }\n  return new URL(url, base).href;\n}\n\nlet originalXHR;\nexport function overrideXHR(xhr) {\n  if (typeof XMLHttpRequest !== 'undefined') {\n    originalXHR = XMLHttpRequest;\n  }\n  global.XMLHttpRequest = xhr;\n}\n\nexport function restoreXHR() {\n  global.XMLHttpRequest = originalXHR;\n}\n", "/**\n * @module ol/source/ogcTileUtil\n */\n\nimport {error as logError} from '../console.js';\nimport {getIntersection as intersectExtents} from '../extent.js';\nimport {getJSON, resolveUrl} from '../net.js';\nimport {get as getProjection} from '../proj.js';\nimport TileGrid from '../tilegrid/TileGrid.js';\n\n/**\n * See https://ogcapi.ogc.org/tiles/.\n */\n\n/**\n * @typedef {'map' | 'vector'} TileType\n */\n\n/**\n * @typedef {'topLeft' | 'bottomLeft'} CornerOfOrigin\n */\n\n/**\n * @typedef {Object} TileSet\n * @property {TileType} dataType Type of data represented in the tileset.\n * @property {string} [tileMatrixSetDefinition] Reference to a tile matrix set definition.\n * @property {TileMatrixSet} [tileMatrixSet] Tile matrix set definition.\n * @property {Array<TileMatrixSetLimit>} [tileMatrixSetLimits] Tile matrix set limits.\n * @property {Array<Link>} links Tileset links.\n */\n\n/**\n * @typedef {Object} Link\n * @property {string} rel The link rel attribute.\n * @property {string} href The link URL.\n * @property {string} type The link type.\n */\n\n/**\n * @typedef {Object} TileMatrixSetLimit\n * @property {string} tileMatrix The tile matrix id.\n * @property {number} minTileRow The minimum tile row.\n * @property {number} maxTileRow The maximum tile row.\n * @property {number} minTileCol The minimum tile column.\n * @property {number} maxTileCol The maximum tile column.\n */\n\n/**\n * @typedef {Object} TileMatrixSet\n * @property {string} id The tile matrix set identifier.\n * @property {string|CrsUri|CrsWkt|CrsReferenceSystem} crs The coordinate reference system.\n * @property {Array<string>} [orderedAxes] Axis order.\n * @property {Array<TileMatrix>} tileMatrices Array of tile matrices.\n */\n\n/**\n * @typedef {Object} CrsUri\n * @property {string} uri Reference to one coordinate reference system (CRS).\n */\n\n/**\n * @typedef {Object} CrsWkt\n * @property {Object} wkt JSON encoding for WKT representation of CRS 2.0.\n */\n\n/**\n * @typedef {Object} CrsReferenceSystem\n * @property {Object} referenceSystem Data structure as defined in the MD_ReferenceSystem of the ISO 19115.\n */\n\n/**\n * @typedef {Object} TileMatrix\n * @property {string} id The tile matrix identifier.\n * @property {number} cellSize The pixel resolution (map units per pixel).\n * @property {Array<number>} pointOfOrigin The map location of the matrix origin.\n * @property {CornerOfOrigin} [cornerOfOrigin='topLeft'] The corner of the matrix that represents the origin ('topLeft' or 'bottomLeft').\n * @property {number} matrixWidth The number of columns.\n * @property {number} matrixHeight The number of rows.\n * @property {number} tileWidth The pixel width of a tile.\n * @property {number} tileHeight The pixel height of a tile.\n */\n\n/**\n * @type {Object<string, boolean>}\n */\nconst knownMapMediaTypes = {\n  'image/png': true,\n  'image/jpeg': true,\n  'image/gif': true,\n  'image/webp': true,\n};\n\n/**\n * @type {Object<string, boolean>}\n */\nconst knownVectorMediaTypes = {\n  'application/vnd.mapbox-vector-tile': true,\n  'application/geo+json': true,\n};\n\n/**\n * @typedef {Object} TileSetInfo\n * @property {string} urlTemplate The tile URL template.\n * @property {import(\"../proj/Projection.js\").default} projection The source projection.\n * @property {import(\"../tilegrid/TileGrid.js\").default} grid The tile grid.\n * @property {import(\"../Tile.js\").UrlFunction} urlFunction The tile URL function.\n */\n\n/**\n * @typedef {Object} SourceInfo\n * @property {string} url The tile set URL.\n * @property {string} mediaType The preferred tile media type.\n * @property {Array<string>} [supportedMediaTypes] The supported media types.\n * @property {import(\"../proj/Projection.js\").default} projection The source projection.\n * @property {Object} [context] Optional context for constructing the URL.\n * @property {Array<string>} [collections] Optional collections to append the URL with.\n */\n\n/**\n * @param {string} tileUrlTemplate Tile URL template.\n * @param {Array<string>} collections List of collections to include as query parameter.\n * @return {string} The tile URL template with appended collections query parameter.\n */\nexport function appendCollectionsQueryParam(tileUrlTemplate, collections) {\n  if (!collections.length) {\n    return tileUrlTemplate;\n  }\n\n  // making sure we can always construct a URL instance.\n  const url = new URL(tileUrlTemplate, 'file:/');\n\n  if (url.pathname.split('/').includes('collections')) {\n    logError(\n      'The \"collections\" query parameter cannot be added to collection endpoints',\n    );\n    return tileUrlTemplate;\n  }\n  // According to conformance class\n  // http://www.opengis.net/spec/ogcapi-tiles-1/1.0/conf/collections-selection\n  // commata in the identifiers of the `collections` query parameter\n  // need to be URLEncoded, while the commata separating the identifiers\n  // should not.\n  const encodedCollections = collections\n    .map((c) => encodeURIComponent(c))\n    .join(',');\n\n  url.searchParams.append('collections', encodedCollections);\n  const baseUrl = tileUrlTemplate.split('?')[0];\n  const queryParams = decodeURIComponent(url.searchParams.toString());\n  return `${baseUrl}?${queryParams}`;\n}\n\n/**\n * @param {Array<Link>} links Tileset links.\n * @param {string} [mediaType] The preferred media type.\n * @param {Array<string>} [collections] Optional collections to append the URL with.\n * @return {string} The tile URL template.\n */\nexport function getMapTileUrlTemplate(links, mediaType, collections) {\n  let tileUrlTemplate;\n  let fallbackUrlTemplate;\n  for (let i = 0; i < links.length; ++i) {\n    const link = links[i];\n    if (link.rel === 'item') {\n      if (link.type === mediaType) {\n        tileUrlTemplate = link.href;\n        break;\n      }\n      if (knownMapMediaTypes[link.type]) {\n        fallbackUrlTemplate = link.href;\n      } else if (!fallbackUrlTemplate && link.type.startsWith('image/')) {\n        fallbackUrlTemplate = link.href;\n      }\n    }\n  }\n\n  if (!tileUrlTemplate) {\n    if (fallbackUrlTemplate) {\n      tileUrlTemplate = fallbackUrlTemplate;\n    } else {\n      throw new Error('Could not find \"item\" link');\n    }\n  }\n\n  if (collections) {\n    tileUrlTemplate = appendCollectionsQueryParam(tileUrlTemplate, collections);\n  }\n\n  return tileUrlTemplate;\n}\n\n/**\n * @param {Array<Link>} links Tileset links.\n * @param {string} [mediaType] The preferred media type.\n * @param {Array<string>} [supportedMediaTypes] The media types supported by the parser.\n * @param {Array<string>} [collections] Optional collections to append the URL with.\n * @return {string} The tile URL template.\n */\nexport function getVectorTileUrlTemplate(\n  links,\n  mediaType,\n  supportedMediaTypes,\n  collections,\n) {\n  let tileUrlTemplate;\n  let fallbackUrlTemplate;\n\n  /**\n   * Lookup of URL by media type.\n   * @type {Object<string, string>}\n   */\n  const hrefLookup = {};\n\n  for (let i = 0; i < links.length; ++i) {\n    const link = links[i];\n    hrefLookup[link.type] = link.href;\n    if (link.rel === 'item') {\n      if (link.type === mediaType) {\n        tileUrlTemplate = link.href;\n        break;\n      }\n      if (knownVectorMediaTypes[link.type]) {\n        fallbackUrlTemplate = link.href;\n      }\n    }\n  }\n\n  if (!tileUrlTemplate && supportedMediaTypes) {\n    for (let i = 0; i < supportedMediaTypes.length; ++i) {\n      const supportedMediaType = supportedMediaTypes[i];\n      if (hrefLookup[supportedMediaType]) {\n        tileUrlTemplate = hrefLookup[supportedMediaType];\n        break;\n      }\n    }\n  }\n\n  if (!tileUrlTemplate) {\n    if (fallbackUrlTemplate) {\n      tileUrlTemplate = fallbackUrlTemplate;\n    } else {\n      throw new Error('Could not find \"item\" link');\n    }\n  }\n\n  if (collections) {\n    tileUrlTemplate = appendCollectionsQueryParam(tileUrlTemplate, collections);\n  }\n\n  return tileUrlTemplate;\n}\n\n/**\n * @param {SourceInfo} sourceInfo The source info.\n * @param {TileMatrixSet} tileMatrixSet Tile matrix set.\n * @param {string} tileUrlTemplate Tile URL template.\n * @param {Array<TileMatrixSetLimit>} [tileMatrixSetLimits] Tile matrix set limits.\n * @return {TileSetInfo} Tile set info.\n */\nfunction parseTileMatrixSet(\n  sourceInfo,\n  tileMatrixSet,\n  tileUrlTemplate,\n  tileMatrixSetLimits,\n) {\n  let projection = sourceInfo.projection;\n  if (!projection) {\n    if (typeof tileMatrixSet.crs === 'string') {\n      projection = getProjection(tileMatrixSet.crs);\n    } else if ('uri' in tileMatrixSet.crs) {\n      projection = getProjection(tileMatrixSet.crs.uri);\n    }\n    if (!projection) {\n      throw new Error(`Unsupported CRS: ${JSON.stringify(tileMatrixSet.crs)}`);\n    }\n  }\n  const orderedAxes = tileMatrixSet.orderedAxes;\n  const axisOrientation = orderedAxes\n    ? orderedAxes\n        .slice(0, 2)\n        .map((s) => s.replace(/E|X|Lon/i, 'e').replace(/N|Y|Lat/i, 'n'))\n        .join('')\n    : projection.getAxisOrientation();\n  const backwards = !axisOrientation.startsWith('en');\n\n  const matrices = tileMatrixSet.tileMatrices;\n\n  /**\n   * @type {Object<string, TileMatrix>}\n   */\n  const matrixLookup = {};\n  for (let i = 0; i < matrices.length; ++i) {\n    const matrix = matrices[i];\n    matrixLookup[matrix.id] = matrix;\n  }\n\n  /**\n   * @type {Object<string, TileMatrixSetLimit>}\n   */\n  const limitLookup = {};\n\n  /**\n   * @type {Array<string>}\n   */\n  const matrixIds = [];\n\n  if (tileMatrixSetLimits) {\n    for (let i = 0; i < tileMatrixSetLimits.length; ++i) {\n      const limit = tileMatrixSetLimits[i];\n      const id = limit.tileMatrix;\n      matrixIds.push(id);\n      limitLookup[id] = limit;\n    }\n  } else {\n    for (let i = 0; i < matrices.length; ++i) {\n      const id = matrices[i].id;\n      matrixIds.push(id);\n    }\n  }\n\n  const length = matrixIds.length;\n  const origins = new Array(length);\n  const resolutions = new Array(length);\n  const sizes = new Array(length);\n  const tileSizes = new Array(length);\n  const extent = [-Infinity, -Infinity, Infinity, Infinity];\n\n  for (let i = 0; i < length; ++i) {\n    const id = matrixIds[i];\n    const matrix = matrixLookup[id];\n    const origin = matrix.pointOfOrigin;\n    if (backwards) {\n      origins[i] = [origin[1], origin[0]];\n    } else {\n      origins[i] = origin;\n    }\n    resolutions[i] = matrix.cellSize;\n    sizes[i] = [matrix.matrixWidth, matrix.matrixHeight];\n    tileSizes[i] = [matrix.tileWidth, matrix.tileHeight];\n    const limit = limitLookup[id];\n    if (limit) {\n      const tileMapWidth = matrix.cellSize * matrix.tileWidth;\n      const minX = origins[i][0] + limit.minTileCol * tileMapWidth;\n      const maxX = origins[i][0] + (limit.maxTileCol + 1) * tileMapWidth;\n\n      const tileMapHeight = matrix.cellSize * matrix.tileHeight;\n      const upsideDown = matrix.cornerOfOrigin === 'bottomLeft';\n\n      let minY;\n      let maxY;\n      if (upsideDown) {\n        minY = origins[i][1] + limit.minTileRow * tileMapHeight;\n        maxY = origins[i][1] + (limit.maxTileRow + 1) * tileMapHeight;\n      } else {\n        minY = origins[i][1] - (limit.maxTileRow + 1) * tileMapHeight;\n        maxY = origins[i][1] - limit.minTileRow * tileMapHeight;\n      }\n\n      intersectExtents(extent, [minX, minY, maxX, maxY], extent);\n    }\n  }\n\n  const tileGrid = new TileGrid({\n    origins: origins,\n    resolutions: resolutions,\n    sizes: sizes,\n    tileSizes: tileSizes,\n    extent: tileMatrixSetLimits ? extent : undefined,\n  });\n\n  const context = sourceInfo.context;\n  const base = sourceInfo.url;\n\n  /** @type {import('../Tile.js').UrlFunction} */\n  function tileUrlFunction(tileCoord, pixelRatio, projection) {\n    if (!tileCoord) {\n      return undefined;\n    }\n\n    const id = matrixIds[tileCoord[0]];\n    const matrix = matrixLookup[id];\n    const upsideDown = matrix.cornerOfOrigin === 'bottomLeft';\n\n    const localContext = {\n      tileMatrix: id,\n      tileCol: tileCoord[1],\n      tileRow: upsideDown ? -tileCoord[2] - 1 : tileCoord[2],\n    };\n\n    if (tileMatrixSetLimits) {\n      const limit = limitLookup[matrix.id];\n      if (\n        localContext.tileCol < limit.minTileCol ||\n        localContext.tileCol > limit.maxTileCol ||\n        localContext.tileRow < limit.minTileRow ||\n        localContext.tileRow > limit.maxTileRow\n      ) {\n        return undefined;\n      }\n    }\n\n    Object.assign(localContext, context);\n\n    const url = tileUrlTemplate.replace(/\\{(\\w+?)\\}/g, function (m, p) {\n      return localContext[p];\n    });\n\n    return resolveUrl(base, url);\n  }\n\n  return {\n    grid: tileGrid,\n    projection: projection,\n    urlTemplate: tileUrlTemplate,\n    urlFunction: tileUrlFunction,\n  };\n}\n\n/**\n * @param {SourceInfo} sourceInfo The source info.\n * @param {TileSet} tileSet Tile set.\n * @return {TileSetInfo|Promise<TileSetInfo>} Tile set info.\n */\nfunction parseTileSetMetadata(sourceInfo, tileSet) {\n  const tileMatrixSetLimits = tileSet.tileMatrixSetLimits;\n  /** @type {string} */\n  let tileUrlTemplate;\n\n  if (tileSet.dataType === 'map') {\n    tileUrlTemplate = getMapTileUrlTemplate(\n      tileSet.links,\n      sourceInfo.mediaType,\n      sourceInfo.collections,\n    );\n  } else if (tileSet.dataType === 'vector') {\n    tileUrlTemplate = getVectorTileUrlTemplate(\n      tileSet.links,\n      sourceInfo.mediaType,\n      sourceInfo.supportedMediaTypes,\n      sourceInfo.collections,\n    );\n  } else {\n    throw new Error('Expected tileset data type to be \"map\" or \"vector\"');\n  }\n\n  if (tileSet.tileMatrixSet) {\n    return parseTileMatrixSet(\n      sourceInfo,\n      tileSet.tileMatrixSet,\n      tileUrlTemplate,\n      tileMatrixSetLimits,\n    );\n  }\n\n  const tileMatrixSetLink = tileSet.links.find(\n    (link) =>\n      link.rel === 'http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme',\n  );\n  if (!tileMatrixSetLink) {\n    throw new Error(\n      'Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet',\n    );\n  }\n  const tileMatrixSetDefinition = tileMatrixSetLink.href;\n\n  const url = resolveUrl(sourceInfo.url, tileMatrixSetDefinition);\n  return getJSON(url).then(function (tileMatrixSet) {\n    return parseTileMatrixSet(\n      sourceInfo,\n      tileMatrixSet,\n      tileUrlTemplate,\n      tileMatrixSetLimits,\n    );\n  });\n}\n\n/**\n * @param {SourceInfo} sourceInfo Source info.\n * @return {Promise<TileSetInfo>} Tile set info.\n */\nexport function getTileSetInfo(sourceInfo) {\n  return getJSON(sourceInfo.url).then(function (tileSet) {\n    return parseTileSetMetadata(sourceInfo, tileSet);\n  });\n}\n", "/**\n * @module ol/source/OGCMapTile\n */\nimport {error as logError} from '../console.js';\nimport TileImage from './TileImage.js';\nimport {getTileSetInfo} from './ogcTileUtil.js';\n\n/**\n * @typedef {Object} Options\n * @property {string} url URL to the OGC Map Tileset endpoint.\n * @property {Object} [context] A lookup of values to use in the tile URL template.  The `{tileMatrix}`\n * (zoom level), `{tileRow}`, and `{tileCol}` variables in the URL will always be provided by the source.\n * @property {string} [mediaType] The content type for the tiles (e.g. \"image/png\").  If not provided,\n * the source will try to find a link with rel=\"item\" that uses a supported image type.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. By default, the projection\n * will be derived from the `crs` of the `tileMatrixSet`.  You can override this by supplying\n * a projection to the constructor.\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(tile, src) {\n *   tile.getImage().src = src;\n * };\n * ```\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {Array<string>} [collections] A list of geospatial data sub-resources to include. If not provided, the entire dataset will\n * be included. This option is not applicable when requesting the tileset for a single collection.\n */\n\n/**\n * @classdesc\n * Layer source for map tiles from an [OGC API - Tiles](https://ogcapi.ogc.org/tiles/) service that provides \"map\" type tiles.\n * The service must conform to at least the core (http://www.opengis.net/spec/ogcapi-tiles-1/1.0/conf/core)\n * and tileset (http://www.opengis.net/spec/ogcapi-tiles-1/1.0/conf/tileset) conformance classes. For supporting the `collections`\n * option, the service must conform to the collections selection\n * (http://www.opengis.net/spec/ogcapi-tiles-1/1.0/conf/collections-selection) conformance class.\n * @api\n */\nclass OGCMapTile extends TileImage {\n  /**\n   * @param {Options} options OGC map tile options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      state: 'loading',\n      tileLoadFunction: options.tileLoadFunction,\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      transition: options.transition,\n    });\n\n    const sourceInfo = {\n      url: options.url,\n      projection: this.getProjection(),\n      mediaType: options.mediaType,\n      context: options.context || null,\n      collections: options.collections,\n    };\n\n    getTileSetInfo(sourceInfo)\n      .then(this.handleTileSetInfo_.bind(this))\n      .catch(this.handleError_.bind(this));\n  }\n\n  /**\n   * @param {import(\"./ogcTileUtil.js\").TileSetInfo} tileSetInfo Tile set info.\n   * @private\n   */\n  handleTileSetInfo_(tileSetInfo) {\n    this.tileGrid = tileSetInfo.grid;\n    this.projection = tileSetInfo.projection;\n    this.setTileUrlFunction(tileSetInfo.urlFunction, tileSetInfo.urlTemplate);\n    this.setState('ready');\n  }\n\n  /**\n   * @private\n   * @param {Error} error The error.\n   */\n  handleError_(error) {\n    logError(error);\n    this.setState('error');\n  }\n}\n\nexport default OGCMapTile;\n", "/**\n * @module ol/source/OGCVectorTile\n */\n\nimport {error as logError} from '../console.js';\nimport VectorTileSource from './VectorTile.js';\nimport {getTileSetInfo} from './ogcTileUtil.js';\n\n/**\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../render/Feature.js\").default]\n * @typedef {Object} Options\n * @property {string} url URL to the OGC Vector Tileset endpoint.\n * @property {Object} [context] A lookup of values to use in the tile URL template.  The `{tileMatrix}`\n * (zoom level), `{tileRow}`, and `{tileCol}` variables in the URL will always be provided by the source.\n * @property {import(\"../format/Feature.js\").default<FeatureType>} [format] Feature format for tiles. Used and required by the default.\n * @property {string} [mediaType] The content type for the tiles (e.g. \"application/vnd.mapbox-vector-tile\").  If not provided,\n * the source will try to find a link with rel=\"item\" that uses a vector type supported by the configured format.\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {boolean} [overlaps=true] This source may have overlapping geometries. Setting this\n * to `false` (e.g. for sources with polygons that represent administrative\n * boundaries or TopoJSON sources) allows the renderer to optimise fill and\n * stroke operations.\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Projection of the tile grid.\n * @property {typeof import(\"../VectorTile.js\").default} [tileClass] Class used to instantiate image tiles.\n * Default is {@link module:ol/VectorTile~VectorTile}.\n * @property {number} [transition] A duration for tile opacity\n * transitions in milliseconds. A duration of 0 disables the opacity transition.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * When set to `false`, only one world\n * will be rendered. When set to `true`, tiles will be wrapped horizontally to\n * render multiple worlds.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=1]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n * @property {Array<string>} [collections] A list of geospatial data sub-resources to include. If not provided, the entire dataset will\n * be included. This option is not applicable when requesting the tileset for a single collection.\n */\n\n/**\n * @classdesc\n * Layer source for map tiles from an [OGC API - Tiles](https://ogcapi.ogc.org/tiles/) service that provides \"vector\" type tiles.\n * The service must conform to at least the core (http://www.opengis.net/spec/ogcapi-tiles-1/1.0/conf/core)\n * and tileset (http://www.opengis.net/spec/ogcapi-tiles-1/1.0/conf/tileset) conformance classes. For supporting the `collections`\n * option, the service must conform to the collections selection\n * (http://www.opengis.net/spec/ogcapi-tiles-1/1.0/conf/collections-selection) conformance class.\n *\n * Vector tile sets may come in a variety of formats (e.g. GeoJSON, MVT).  The `format` option is used to determine\n * which of the advertised media types is used.  If you need to force the use of a particular media type, you can\n * provide the `mediaType` option.\n * @api\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../render/Feature.js\").default]\n * @extends {VectorTileSource<FeatureType>}\n */\nclass OGCVectorTile extends VectorTileSource {\n  /**\n   * @param {Options<FeatureType>} options OGC vector tile options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      cacheSize: options.cacheSize,\n      format: options.format,\n      overlaps: options.overlaps,\n      projection: options.projection,\n      tileClass: options.tileClass,\n      transition: options.transition,\n      wrapX: options.wrapX,\n      zDirection: options.zDirection,\n      state: 'loading',\n    });\n\n    const sourceInfo = {\n      url: options.url,\n      projection: this.getProjection(),\n      mediaType: options.mediaType,\n      supportedMediaTypes: options.format.supportedMediaTypes,\n      context: options.context || null,\n      collections: options.collections,\n    };\n\n    getTileSetInfo(sourceInfo)\n      .then(this.handleTileSetInfo_.bind(this))\n      .catch(this.handleError_.bind(this));\n  }\n\n  /**\n   * @param {import(\"./ogcTileUtil.js\").TileSetInfo} tileSetInfo Tile set info.\n   * @private\n   */\n  handleTileSetInfo_(tileSetInfo) {\n    this.tileGrid = tileSetInfo.grid;\n    this.projection = tileSetInfo.projection;\n    this.setTileUrlFunction(tileSetInfo.urlFunction, tileSetInfo.urlTemplate);\n    this.setState('ready');\n  }\n\n  /**\n   * @private\n   * @param {Error} error The error.\n   */\n  handleError_(error) {\n    logError(error);\n    this.setState('error');\n  }\n}\n\nexport default OGCVectorTile;\n", "/**\n * @module ol/source/Raster\n */\nimport Disposable from '../Disposable.js';\nimport ImageCanvas from '../ImageCanvas.js';\nimport TileQueue from '../TileQueue.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport {equals, getCenter, getHeight, getWidth} from '../extent.js';\nimport ImageLayer from '../layer/Image.js';\nimport TileLayer from '../layer/Tile.js';\nimport {create as createTransform} from '../transform.js';\nimport {getUid} from '../util.js';\nimport ImageSource from './Image.js';\nimport Source from './Source.js';\nimport TileSource from './Tile.js';\n\n/**\n * @typedef {Object} MinionData\n * @property {Array<ArrayBuffer>} buffers Array of buffers.\n * @property {Object} meta Operation metadata.\n * @property {boolean} imageOps The operation is an image operation.\n * @property {number} width The width of the image.\n * @property {number} height The height of the image.\n */\n\n/* istanbul ignore next */\n/**\n * Create a function for running operations.  This function is serialized for\n * use in a worker.\n * @param {function(Array, Object):*} operation The operation.\n * @return {function(MinionData):ArrayBuffer} A function that takes an object with\n * buffers, meta, imageOps, width, and height properties and returns an array\n * buffer.\n */\nfunction createMinion(operation) {\n  return function (data) {\n    // bracket notation for minification support\n    const buffers = data['buffers'];\n    const meta = data['meta'];\n    const imageOps = data['imageOps'];\n    const width = data['width'];\n    const height = data['height'];\n\n    const numBuffers = buffers.length;\n    const numBytes = buffers[0].byteLength;\n\n    if (imageOps) {\n      const images = new Array(numBuffers);\n      for (let b = 0; b < numBuffers; ++b) {\n        images[b] = new ImageData(\n          new Uint8ClampedArray(buffers[b]),\n          width,\n          height,\n        );\n      }\n      const output = operation(images, meta).data;\n      return output.buffer;\n    }\n\n    const output = new Uint8ClampedArray(numBytes);\n    const arrays = new Array(numBuffers);\n    const pixels = new Array(numBuffers);\n    for (let b = 0; b < numBuffers; ++b) {\n      arrays[b] = new Uint8ClampedArray(buffers[b]);\n      pixels[b] = [0, 0, 0, 0];\n    }\n    for (let i = 0; i < numBytes; i += 4) {\n      for (let j = 0; j < numBuffers; ++j) {\n        const array = arrays[j];\n        pixels[j][0] = array[i];\n        pixels[j][1] = array[i + 1];\n        pixels[j][2] = array[i + 2];\n        pixels[j][3] = array[i + 3];\n      }\n      const pixel = operation(pixels, meta);\n      output[i] = pixel[0];\n      output[i + 1] = pixel[1];\n      output[i + 2] = pixel[2];\n      output[i + 3] = pixel[3];\n    }\n    return output.buffer;\n  };\n}\n\n/**\n * Create a worker for running operations.\n * @param {ProcessorOptions} config Processor options.\n * @param {function(MessageEvent): void} onMessage Called with a message event.\n * @return {Worker} The worker.\n */\nfunction createWorker(config, onMessage) {\n  const lib = Object.keys(config.lib || {}).map(function (name) {\n    return 'const ' + name + ' = ' + config.lib[name].toString() + ';';\n  });\n\n  const lines = lib.concat([\n    'const __minion__ = (' + createMinion.toString() + ')(',\n    config.operation.toString(),\n    ');',\n    'self.addEventListener(\"message\", function(event) {',\n    '  const buffer = __minion__(event.data);',\n    '  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);',\n    '});',\n  ]);\n\n  const worker = new Worker(\n    typeof Blob === 'undefined'\n      ? 'data:text/javascript;base64,' +\n        Buffer.from(lines.join('\\n'), 'binary').toString('base64')\n      : URL.createObjectURL(new Blob(lines, {type: 'text/javascript'})),\n  );\n  worker.addEventListener('message', onMessage);\n  return worker;\n}\n\n/**\n * @typedef {Object} FauxMessageEvent\n * @property {Object} data Message data.\n */\n\n/**\n * Create a faux worker for running operations.\n * @param {ProcessorOptions} config Configuration.\n * @param {function(FauxMessageEvent): void} onMessage Called with a message event.\n * @return {Object} The faux worker.\n */\nfunction createFauxWorker(config, onMessage) {\n  const minion = createMinion(config.operation);\n  let terminated = false;\n  return {\n    postMessage: function (data) {\n      setTimeout(function () {\n        if (terminated) {\n          return;\n        }\n        onMessage({data: {buffer: minion(data), meta: data['meta']}});\n      }, 0);\n    },\n    terminate: function () {\n      terminated = true;\n    },\n  };\n}\n\n/**\n * @typedef {function(Error, ImageData, (Object|Array<Object>)): void} JobCallback\n */\n\n/**\n * @typedef {Object} Job\n * @property {Object} meta Job metadata.\n * @property {Array<ImageData>} inputs Array of input data.\n * @property {JobCallback} callback Called when the job is complete.\n */\n\n/**\n * @typedef {Object} ProcessorOptions\n * @property {number} threads Number of workers to spawn.\n * @property {Operation} operation The operation.\n * @property {Object<string, Function>} [lib] Functions that will be made available to operations run in a worker.\n * @property {number} queue The number of queued jobs to allow.\n * @property {boolean} [imageOps=false] Pass all the image data to the operation instead of a single pixel.\n */\n\n/**\n * @classdesc\n * A processor runs pixel or image operations in workers.\n */\nexport class Processor extends Disposable {\n  /**\n   * @param {ProcessorOptions} config Configuration.\n   */\n  constructor(config) {\n    super();\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.imageOps_ = !!config.imageOps;\n    let threads;\n    if (config.threads === 0) {\n      threads = 0;\n    } else if (this.imageOps_) {\n      threads = 1;\n    } else {\n      threads = config.threads || 1;\n    }\n\n    /**\n     * @type {Array<Worker>}\n     */\n    const workers = new Array(threads);\n    if (threads) {\n      for (let i = 0; i < threads; ++i) {\n        workers[i] = createWorker(config, this.onWorkerMessage_.bind(this, i));\n      }\n    } else {\n      workers[0] = createFauxWorker(\n        config,\n        this.onWorkerMessage_.bind(this, 0),\n      );\n    }\n    /**\n     * @type {Array<Worker>}\n     * @private\n     */\n    this.workers_ = workers;\n\n    /**\n     * @type {Array<Job>}\n     * @private\n     */\n    this.queue_ = [];\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.maxQueueLength_ = config.queue || Infinity;\n    /**\n     * @type {number}\n     * @private\n     */\n    this.running_ = 0;\n\n    /**\n     * @type {Object<number, any>}\n     * @private\n     */\n    this.dataLookup_ = {};\n\n    /**\n     * @type {Job|null}\n     * @private\n     */\n    this.job_ = null;\n  }\n\n  /**\n   * Run operation on input data.\n   * @param {Array<ImageData>} inputs Array of image data.\n   * @param {Object} meta A user data object.  This is passed to all operations\n   *     and must be serializable.\n   * @param {function(Error, ImageData, Object): void} callback Called when work\n   *     completes.  The first argument is any error.  The second is the ImageData\n   *     generated by operations.  The third is the user data object.\n   */\n  process(inputs, meta, callback) {\n    this.enqueue_({\n      inputs: inputs,\n      meta: meta,\n      callback: callback,\n    });\n    this.dispatch_();\n  }\n\n  /**\n   * Add a job to the queue.\n   * @param {Job} job The job.\n   */\n  enqueue_(job) {\n    this.queue_.push(job);\n    while (this.queue_.length > this.maxQueueLength_) {\n      this.queue_.shift().callback(null, null);\n    }\n  }\n\n  /**\n   * Dispatch a job.\n   */\n  dispatch_() {\n    if (this.running_ || this.queue_.length === 0) {\n      return;\n    }\n\n    const job = this.queue_.shift();\n    this.job_ = job;\n    const width = job.inputs[0].width;\n    const height = job.inputs[0].height;\n    const buffers = job.inputs.map(function (input) {\n      return input.data.buffer;\n    });\n    const threads = this.workers_.length;\n    this.running_ = threads;\n    if (threads === 1) {\n      this.workers_[0].postMessage(\n        {\n          buffers: buffers,\n          meta: job.meta,\n          imageOps: this.imageOps_,\n          width: width,\n          height: height,\n        },\n        buffers,\n      );\n      return;\n    }\n\n    const length = job.inputs[0].data.length;\n    const segmentLength = 4 * Math.ceil(length / 4 / threads);\n    for (let i = 0; i < threads; ++i) {\n      const offset = i * segmentLength;\n      const slices = [];\n      for (let j = 0, jj = buffers.length; j < jj; ++j) {\n        slices.push(buffers[j].slice(offset, offset + segmentLength));\n      }\n      this.workers_[i].postMessage(\n        {\n          buffers: slices,\n          meta: job.meta,\n          imageOps: this.imageOps_,\n          width: width,\n          height: height,\n        },\n        slices,\n      );\n    }\n  }\n\n  /**\n   * Handle messages from the worker.\n   * @param {number} index The worker index.\n   * @param {MessageEvent} event The message event.\n   */\n  onWorkerMessage_(index, event) {\n    if (this.disposed) {\n      return;\n    }\n    this.dataLookup_[index] = event.data;\n    --this.running_;\n    if (this.running_ === 0) {\n      this.resolveJob_();\n    }\n  }\n\n  /**\n   * Resolve a job.  If there are no more worker threads, the processor callback\n   * will be called.\n   */\n  resolveJob_() {\n    const job = this.job_;\n    const threads = this.workers_.length;\n    let data, meta;\n    if (threads === 1) {\n      data = new Uint8ClampedArray(this.dataLookup_[0]['buffer']);\n      meta = this.dataLookup_[0]['meta'];\n    } else {\n      const length = job.inputs[0].data.length;\n      data = new Uint8ClampedArray(length);\n      meta = new Array(threads);\n      const segmentLength = 4 * Math.ceil(length / 4 / threads);\n      for (let i = 0; i < threads; ++i) {\n        const buffer = this.dataLookup_[i]['buffer'];\n        const offset = i * segmentLength;\n        data.set(new Uint8ClampedArray(buffer), offset);\n        meta[i] = this.dataLookup_[i]['meta'];\n      }\n    }\n    this.job_ = null;\n    this.dataLookup_ = {};\n    job.callback(\n      null,\n      new ImageData(data, job.inputs[0].width, job.inputs[0].height),\n      meta,\n    );\n    this.dispatch_();\n  }\n\n  /**\n   * Terminate all workers associated with the processor.\n   * @override\n   */\n  disposeInternal() {\n    for (let i = 0; i < this.workers_.length; ++i) {\n      this.workers_[i].terminate();\n    }\n    this.workers_.length = 0;\n  }\n}\n\n/**\n * A function that takes an array of input data, performs some operation, and\n * returns an array of output data.\n * For `pixel` type operations, the function will be called with an array of\n * pixels, where each pixel is an array of four numbers (`[r, g, b, a]`) in the\n * range of 0 - 255. It should return a single pixel array.\n * For `'image'` type operations, functions will be called with an array of\n * [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData)\n * and should return a single\n * [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData).\n * The operations\n * are called with a second \"data\" argument, which can be used for storage.  The\n * data object is accessible from raster events, where it can be initialized in\n * \"beforeoperations\" and accessed again in \"afteroperations\".\n *\n * @typedef {function((Array<Array<number>>|Array<ImageData>), Object):\n *     (Array<number>|ImageData)} Operation\n */\n\n/**\n * @enum {string}\n */\nconst RasterEventType = {\n  /**\n   * Triggered before operations are run.  Listeners will receive an event object with\n   * a `data` property that can be used to make data available to operations.\n   * @event module:ol/source/Raster.RasterSourceEvent#beforeoperations\n   * @api\n   */\n  BEFOREOPERATIONS: 'beforeoperations',\n\n  /**\n   * Triggered after operations are run.  Listeners will receive an event object with\n   * a `data` property.  If more than one thread is used, `data` will be an array of\n   * objects.  If a single thread is used, `data` will be a single object.\n   * @event module:ol/source/Raster.RasterSourceEvent#afteroperations\n   * @api\n   */\n  AFTEROPERATIONS: 'afteroperations',\n};\n\n/**\n * @typedef {'pixel' | 'image'} RasterOperationType\n * Raster operation type. Supported values are `'pixel'` and `'image'`.\n */\n\n/**\n * @typedef {import(\"./Image.js\").ImageSourceEventTypes|'beforeoperations'|'afteroperations'} RasterSourceEventTypes\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Raster~RasterSource} instances are instances of this\n * type.\n */\nexport class RasterSourceEvent extends Event {\n  /**\n   * @param {string} type Type.\n   * @param {import(\"../Map.js\").FrameState} frameState The frame state.\n   * @param {Object|Array<Object>} data An object made available to operations.  For \"afteroperations\" evenets\n   * this will be an array of objects if more than one thread is used.\n   */\n  constructor(type, frameState, data) {\n    super(type);\n\n    /**\n     * The raster extent.\n     * @type {import(\"../extent.js\").Extent}\n     * @api\n     */\n    this.extent = frameState.extent;\n\n    /**\n     * The pixel resolution (map units per pixel).\n     * @type {number}\n     * @api\n     */\n    this.resolution = frameState.viewState.resolution / frameState.pixelRatio;\n\n    /**\n     * An object made available to all operations.  This can be used by operations\n     * as a storage object (e.g. for calculating statistics).\n     * @type {Object}\n     * @api\n     */\n    this.data = data;\n  }\n}\n\n/**\n * @typedef {Object} Options\n * @property {Array<import(\"./Source.js\").default|import(\"../layer/Layer.js\").default>} sources Input\n * sources or layers.  For vector data, use an VectorImage layer.\n * @property {Operation} [operation] Raster operation.\n * The operation will be called with data from input sources\n * and the output will be assigned to the raster source.\n * @property {Object} [lib] Functions that will be made available to operations run in a worker.\n * @property {number} [threads] By default, operations will be run in a single worker thread.\n * To avoid using workers altogether, set `threads: 0`.  For pixel operations, operations can\n * be run in multiple worker threads.  Note that there is additional overhead in\n * transferring data to multiple workers, and that depending on the user's\n * system, it may not be possible to parallelize the work.\n * @property {RasterOperationType} [operationType='pixel'] Operation type.\n * Supported values are `'pixel'` and `'image'`.  By default,\n * `'pixel'` operations are assumed, and operations will be called with an\n * array of pixels from input sources.  If set to `'image'`, operations will\n * be called with an array of ImageData objects from input sources.\n * @property {Array<number>|null} [resolutions] Resolutions. If specified, raster operations will only\n * be run at the given resolutions.  By default, the resolutions of the first source with resolutions\n * specified will be used, if any. Set to `null` to use any view resolution instead.\n */\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types, import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<import(\"./Image.js\").ImageSourceEventTypes, import(\"./Image.js\").ImageSourceEvent, Return> &\n *   import(\"../Observable\").OnSignature<RasterSourceEventTypes, RasterSourceEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types\n *     |RasterSourceEventTypes, Return>} RasterSourceOnSignature\n */\n\n/**\n * @classdesc\n * A source that transforms data from any number of input sources using an\n * {@link module:ol/source/Raster~Operation} function to transform input pixel values into\n * output pixel values.\n *\n * @fires module:ol/source/Raster.RasterSourceEvent\n * @api\n */\nclass RasterSource extends ImageSource {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    super({\n      projection: null,\n    });\n\n    /***\n     * @type {RasterSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {RasterSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {RasterSourceOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @private\n     * @type {Processor}\n     */\n    this.processor_ = null;\n\n    /**\n     * @private\n     * @type {RasterOperationType}\n     */\n    this.operationType_ =\n      options.operationType !== undefined ? options.operationType : 'pixel';\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.threads_ = options.threads !== undefined ? options.threads : 1;\n\n    /**\n     * @private\n     * @type {Array<import(\"../layer/Layer.js\").default>}\n     */\n    this.layers_ = createLayers(options.sources);\n\n    const changed = this.changed.bind(this);\n    for (let i = 0, ii = this.layers_.length; i < ii; ++i) {\n      this.layers_[i].addEventListener(EventType.CHANGE, changed);\n    }\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.useResolutions_ = options.resolutions !== null;\n\n    /**\n     * @private\n     * @type {import(\"../TileQueue.js\").default}\n     */\n    this.tileQueue_ = new TileQueue(function () {\n      return 1;\n    }, this.processSources_.bind(this));\n\n    /**\n     * The most recently requested frame state.\n     * @type {import(\"../Map.js\").FrameState}\n     * @private\n     */\n    this.requestedFrameState_;\n\n    /**\n     * The most recently rendered image canvas.\n     * @type {import(\"../ImageCanvas.js\").default}\n     * @private\n     */\n    this.renderedImageCanvas_ = null;\n\n    /**\n     * The most recently rendered revision.\n     * @type {number}\n     * @private\n     */\n    this.renderedRevision_;\n\n    /**\n     * @private\n     * @type {import(\"../Map.js\").FrameState}\n     */\n    this.frameState_ = {\n      animate: false,\n      coordinateToPixelTransform: createTransform(),\n      declutter: null,\n      extent: null,\n      index: 0,\n      layerIndex: 0,\n      layerStatesArray: getLayerStatesArray(this.layers_),\n      pixelRatio: 1,\n      pixelToCoordinateTransform: createTransform(),\n      postRenderFunctions: [],\n      size: [0, 0],\n      tileQueue: this.tileQueue_,\n      time: Date.now(),\n      usedTiles: {},\n      viewState: /** @type {import(\"../View.js\").State} */ ({\n        rotation: 0,\n      }),\n      viewHints: [],\n      wantedTiles: {},\n      mapId: getUid(this),\n      renderTargets: {},\n    };\n\n    this.setAttributions(function (frameState) {\n      /** @type {Array<string>} */\n      const attributions = [];\n      for (let i = 0, iMax = options.sources.length; i < iMax; ++i) {\n        const sourceOrLayer = options.sources[i];\n        const source =\n          sourceOrLayer instanceof Source\n            ? sourceOrLayer\n            : sourceOrLayer.getSource();\n        if (!source) {\n          continue;\n        }\n        const sourceAttributions = source.getAttributions()?.(frameState);\n        if (typeof sourceAttributions === 'string') {\n          attributions.push(sourceAttributions);\n        } else if (sourceAttributions !== undefined) {\n          attributions.push(...sourceAttributions);\n        }\n      }\n      return attributions;\n    });\n\n    if (options.operation !== undefined) {\n      this.setOperation(options.operation, options.lib);\n    }\n  }\n\n  /**\n   * Set the operation.\n   * @param {Operation} operation New operation.\n   * @param {Object} [lib] Functions that will be available to operations run\n   *     in a worker.\n   * @api\n   */\n  setOperation(operation, lib) {\n    if (this.processor_) {\n      this.processor_.dispose();\n    }\n\n    this.processor_ = new Processor({\n      operation: operation,\n      imageOps: this.operationType_ === 'image',\n      queue: 1,\n      lib: lib,\n      threads: this.threads_,\n    });\n    this.changed();\n  }\n\n  /**\n   * Update the stored frame state.\n   * @param {import(\"../extent.js\").Extent} extent The view extent (in map units).\n   * @param {number} resolution The view resolution.\n   * @param {import(\"../proj/Projection.js\").default} projection The view projection.\n   * @return {import(\"../Map.js\").FrameState} The updated frame state.\n   * @private\n   */\n  updateFrameState_(extent, resolution, projection) {\n    const frameState = /** @type {import(\"../Map.js\").FrameState} */ (\n      Object.assign({}, this.frameState_)\n    );\n\n    frameState.viewState = /** @type {import(\"../View.js\").State} */ (\n      Object.assign({}, frameState.viewState)\n    );\n\n    const center = getCenter(extent);\n\n    frameState.size[0] = Math.ceil(getWidth(extent) / resolution);\n    frameState.size[1] = Math.ceil(getHeight(extent) / resolution);\n    frameState.extent = [\n      center[0] - (frameState.size[0] * resolution) / 2,\n      center[1] - (frameState.size[1] * resolution) / 2,\n      center[0] + (frameState.size[0] * resolution) / 2,\n      center[1] + (frameState.size[1] * resolution) / 2,\n    ];\n    frameState.time = Date.now();\n\n    const viewState = frameState.viewState;\n    viewState.center = center;\n    viewState.projection = projection;\n    viewState.resolution = resolution;\n    return frameState;\n  }\n\n  /**\n   * Determine if all sources are ready.\n   * @return {boolean} All sources are ready.\n   * @private\n   */\n  allSourcesReady_() {\n    let ready = true;\n    let source;\n    for (let i = 0, ii = this.layers_.length; i < ii; ++i) {\n      source = this.layers_[i].getSource();\n      if (!source || source.getState() !== 'ready') {\n        ready = false;\n        break;\n      }\n    }\n    return ready;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../ImageCanvas.js\").default} Single image.\n   * @override\n   */\n  getImage(extent, resolution, pixelRatio, projection) {\n    if (!this.allSourcesReady_()) {\n      return null;\n    }\n\n    this.tileQueue_.loadMoreTiles(16, 16);\n\n    resolution = this.findNearestResolution(resolution);\n    const frameState = this.updateFrameState_(extent, resolution, projection);\n    this.requestedFrameState_ = frameState;\n\n    // check if we can't reuse the existing ol/ImageCanvas\n    if (this.renderedImageCanvas_) {\n      const renderedResolution = this.renderedImageCanvas_.getResolution();\n      const renderedExtent = this.renderedImageCanvas_.getExtent();\n      if (\n        resolution !== renderedResolution ||\n        !equals(frameState.extent, renderedExtent)\n      ) {\n        this.renderedImageCanvas_ = null;\n      }\n    }\n\n    if (\n      !this.renderedImageCanvas_ ||\n      this.getRevision() !== this.renderedRevision_\n    ) {\n      this.processSources_();\n    }\n\n    if (frameState.animate) {\n      requestAnimationFrame(this.changed.bind(this));\n    }\n\n    return this.renderedImageCanvas_;\n  }\n\n  /**\n   * Start processing source data.\n   * @private\n   */\n  processSources_() {\n    const frameState = this.requestedFrameState_;\n    const len = this.layers_.length;\n    const imageDatas = new Array(len);\n    for (let i = 0; i < len; ++i) {\n      frameState.layerIndex = i;\n      frameState.renderTargets = {};\n      const imageData = getImageData(this.layers_[i], frameState);\n      if (imageData) {\n        imageDatas[i] = imageData;\n      } else {\n        return;\n      }\n    }\n\n    const data = {};\n    this.dispatchEvent(\n      new RasterSourceEvent(RasterEventType.BEFOREOPERATIONS, frameState, data),\n    );\n    this.processor_.process(\n      imageDatas,\n      data,\n      this.onWorkerComplete_.bind(this, frameState),\n    );\n  }\n\n  /**\n   * Called when pixel processing is complete.\n   * @param {import(\"../Map.js\").FrameState} frameState The frame state.\n   * @param {Error} err Any error during processing.\n   * @param {ImageData} output The output image data.\n   * @param {Object|Array<Object>} data The user data (or an array if more than one thread).\n   * @private\n   */\n  onWorkerComplete_(frameState, err, output, data) {\n    if (err || !output) {\n      return;\n    }\n\n    // do nothing if extent or resolution changed\n    const extent = frameState.extent;\n    const resolution = frameState.viewState.resolution;\n    if (\n      resolution !== this.requestedFrameState_.viewState.resolution ||\n      !equals(extent, this.requestedFrameState_.extent)\n    ) {\n      return;\n    }\n\n    let context;\n    if (this.renderedImageCanvas_) {\n      context = this.renderedImageCanvas_.getImage().getContext('2d');\n    } else {\n      const width = Math.round(getWidth(extent) / resolution);\n      const height = Math.round(getHeight(extent) / resolution);\n      context = createCanvasContext2D(width, height);\n      this.renderedImageCanvas_ = new ImageCanvas(\n        extent,\n        resolution,\n        1,\n        context.canvas,\n      );\n    }\n    context.putImageData(output, 0, 0);\n\n    if (frameState.animate) {\n      requestAnimationFrame(this.changed.bind(this));\n    } else {\n      this.changed();\n    }\n    this.renderedRevision_ = this.getRevision();\n\n    this.dispatchEvent(\n      new RasterSourceEvent(RasterEventType.AFTEROPERATIONS, frameState, data),\n    );\n  }\n\n  /**\n   * @param {import(\"../proj/Projection\").default} [projection] Projection.\n   * @return {Array<number>|null} Resolutions.\n   * @override\n   */\n  getResolutions(projection) {\n    if (!this.useResolutions_) {\n      return null;\n    }\n    let resolutions = super.getResolutions();\n    if (!resolutions) {\n      for (let i = 0, ii = this.layers_.length; i < ii; ++i) {\n        const source = this.layers_[i].getSource();\n        resolutions = source.getResolutions(projection);\n        if (resolutions) {\n          break;\n        }\n      }\n    }\n    return resolutions;\n  }\n\n  /**\n   * @override\n   */\n  disposeInternal() {\n    if (this.processor_) {\n      this.processor_.dispose();\n    }\n    super.disposeInternal();\n  }\n}\n\n/**\n * Clean up and unregister the worker.\n * @function\n * @api\n */\nRasterSource.prototype.dispose;\n\n/**\n * A reusable canvas context.\n * @type {CanvasRenderingContext2D}\n * @private\n */\nlet sharedContext = null;\n\n/**\n * Get image data from a layer.\n * @param {import(\"../layer/Layer.js\").default} layer Layer to render.\n * @param {import(\"../Map.js\").FrameState} frameState The frame state.\n * @return {ImageData} The image data.\n */\nfunction getImageData(layer, frameState) {\n  const renderer = layer.getRenderer();\n  if (!renderer) {\n    throw new Error('Unsupported layer type: ' + layer);\n  }\n\n  if (!renderer.prepareFrame(frameState)) {\n    return null;\n  }\n  const width = frameState.size[0];\n  const height = frameState.size[1];\n  if (width === 0 || height === 0) {\n    return null;\n  }\n  const container = renderer.renderFrame(frameState, null);\n  let element;\n  if (container instanceof HTMLCanvasElement) {\n    element = container;\n  } else {\n    if (container) {\n      element = container.firstElementChild;\n    }\n    if (!(element instanceof HTMLCanvasElement)) {\n      throw new Error('Unsupported rendered element: ' + element);\n    }\n    if (element.width === width && element.height === height) {\n      const context = element.getContext('2d');\n      return context.getImageData(0, 0, width, height);\n    }\n  }\n\n  if (!sharedContext) {\n    sharedContext = createCanvasContext2D(width, height, undefined, {\n      willReadFrequently: true,\n    });\n  } else {\n    const canvas = sharedContext.canvas;\n    if (canvas.width !== width || canvas.height !== height) {\n      sharedContext = createCanvasContext2D(width, height, undefined, {\n        willReadFrequently: true,\n      });\n    } else {\n      sharedContext.clearRect(0, 0, width, height);\n    }\n  }\n  sharedContext.drawImage(element, 0, 0, width, height);\n  return sharedContext.getImageData(0, 0, width, height);\n}\n\n/**\n * Get a list of layer states from a list of layers.\n * @param {Array<import(\"../layer/Layer.js\").default>} layers Layers.\n * @return {Array<import(\"../layer/Layer.js\").State>} The layer states.\n */\nfunction getLayerStatesArray(layers) {\n  return layers.map(function (layer) {\n    return layer.getLayerState();\n  });\n}\n\n/**\n * Create layers for all sources.\n * @param {Array<import(\"./Source.js\").default|import(\"../layer/Layer.js\").default>} sources The sources.\n * @return {Array<import(\"../layer/Layer.js\").default>} Array of layers.\n */\nfunction createLayers(sources) {\n  const len = sources.length;\n  const layers = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    layers[i] = createLayer(sources[i]);\n  }\n  return layers;\n}\n\n/**\n * Create a layer for the provided source.\n * @param {import(\"./Source.js\").default|import(\"../layer/Layer.js\").default} layerOrSource The layer or source.\n * @return {import(\"../layer/Layer.js\").default} The layer.\n */\nfunction createLayer(layerOrSource) {\n  // @type {import(\"../layer/Layer.js\").default}\n  let layer;\n  if (layerOrSource instanceof Source) {\n    if (layerOrSource instanceof TileSource) {\n      layer = new TileLayer({source: layerOrSource});\n    } else if (layerOrSource instanceof ImageSource) {\n      layer = new ImageLayer({source: layerOrSource});\n    }\n  } else {\n    layer = layerOrSource;\n  }\n  return layer;\n}\n\nexport default RasterSource;\n", "/**\n * @module ol/source/StadiaMaps\n */\n\nimport {ATTRIBUTION as OSM_ATTRIBUTION} from './OSM.js';\nimport XYZ from './XYZ.js';\n\n/**\n * @type {string}\n */\nconst STADIA_ATTRIBUTION =\n  '&copy; <a href=\"https://www.stadiamaps.com/\" target=\"_blank\">Stadia Maps</a>';\n\n/**\n * @type {string}\n */\nconst OMT_ATTRIBUTION =\n  '&copy; <a href=\"https://openmaptiles.org/\" target=\"_blank\">OpenMapTiles</a>';\n\n/**\n * @type {string}\n */\nconst STAMEN_ATTRIBUTION =\n  '&copy; <a href=\"https://stamen.com/\" target=\"_blank\">Stamen Design</a>';\n\n/**\n * @type {Object<string, {extension: string}>}\n */\nconst LayerConfig = {\n  'stamen_terrain': {\n    extension: 'png',\n  },\n  'stamen_terrain_background': {\n    extension: 'png',\n  },\n  'stamen_terrain_labels': {\n    extension: 'png',\n  },\n  'stamen_terrain_lines': {\n    extension: 'png',\n  },\n  'stamen_toner_background': {\n    extension: 'png',\n  },\n  'stamen_toner': {\n    extension: 'png',\n  },\n  'stamen_toner_labels': {\n    extension: 'png',\n  },\n  'stamen_toner_lines': {\n    extension: 'png',\n  },\n  'stamen_toner_lite': {\n    extension: 'png',\n  },\n  'stamen_watercolor': {\n    extension: 'jpg',\n  },\n  'alidade_smooth': {\n    extension: 'png',\n  },\n  'alidade_smooth_dark': {\n    extension: 'png',\n  },\n  'alidade_satellite': {\n    extension: 'png',\n  },\n  'outdoors': {\n    extension: 'png',\n  },\n  'osm_bright': {\n    extension: 'png',\n  },\n};\n\n/**\n * @type {Object<string, {minZoom: number, maxZoom: number, retina: boolean}>}\n */\nconst ProviderConfig = {\n  'stamen_terrain': {\n    minZoom: 0,\n    maxZoom: 18,\n    retina: true,\n  },\n  'stamen_toner': {\n    minZoom: 0,\n    maxZoom: 20,\n    retina: true,\n  },\n  'stamen_watercolor': {\n    minZoom: 1,\n    maxZoom: 18,\n    retina: false,\n  },\n};\n\n/**\n * @typedef {Object} Options\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {string} layer Layer name. Valid values: `alidade_smooth`, `alidade_smooth_dark`, `outdoors`, `stamen_terrain`, `stamen_terrain_background`, `stamen_terrain_labels`, `stamen_terrain_lines`, `stamen_toner_background`, `stamen_toner`, `stamen_toner_labels`, `stamen_toner_lines`, `stamen_toner_lite`, `stamen_watercolor`, and `osm_bright`.\n * @property {number} [minZoom] Minimum zoom.\n * @property {number} [maxZoom] Maximum zoom.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction]\n * Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {number} [transition=250] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {string} [url] URL template. Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n * @property {string} [apiKey] Stadia Maps API key. Not required for localhost or most public web deployments. See https://docs.stadiamaps.com/authentication/ for details.\n * @property {boolean} [retina] Use retina tiles (if available; not available for Stamen Watercolor).\n */\n\n/**\n * @classdesc\n * Layer source for the Stadia Maps tile server.\n * @api\n */\nclass StadiaMaps extends XYZ {\n  /**\n   * @param {Options} options StadiaMaps options.\n   */\n  constructor(options) {\n    const i = options.layer.indexOf('-');\n    const provider = i == -1 ? options.layer : options.layer.slice(0, i);\n    const providerConfig = ProviderConfig[provider] || {\n      'minZoom': 0,\n      'maxZoom': 20,\n      'retina': true,\n    };\n\n    const layerConfig = LayerConfig[options.layer];\n    const query = options.apiKey ? '?api_key=' + options.apiKey : '';\n    const retina = providerConfig.retina && options.retina ? '@2x' : '';\n\n    const url =\n      options.url !== undefined\n        ? options.url\n        : 'https://tiles.stadiamaps.com/tiles/' +\n          options.layer +\n          '/{z}/{x}/{y}' +\n          retina +\n          '.' +\n          layerConfig.extension +\n          query;\n\n    const attributions = [STADIA_ATTRIBUTION, OMT_ATTRIBUTION, OSM_ATTRIBUTION];\n\n    if (options.layer.startsWith('stamen_')) {\n      attributions.splice(1, 0, STAMEN_ATTRIBUTION);\n    }\n\n    super({\n      attributions: attributions,\n      cacheSize: options.cacheSize,\n      crossOrigin: 'anonymous',\n      interpolate: options.interpolate,\n      maxZoom:\n        options.maxZoom !== undefined\n          ? options.maxZoom\n          : providerConfig.maxZoom,\n      minZoom:\n        options.minZoom !== undefined\n          ? options.minZoom\n          : providerConfig.minZoom,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileLoadFunction: options.tileLoadFunction,\n      transition: options.transition,\n      url: url,\n      tilePixelRatio: retina ? 2 : 1,\n      wrapX: options.wrapX,\n      zDirection: options.zDirection,\n    });\n  }\n}\n\nexport default StadiaMaps;\n", "/**\n * @module ol/source/TileArcGISRest\n */\n\nimport {createEmpty} from '../extent.js';\nimport {modulo} from '../math.js';\nimport {scale as scaleSize, toSize} from '../size.js';\nimport {hash as tileCoordHash} from '../tilecoord.js';\nimport TileImage from './TileImage.js';\nimport {getRequestUrl} from './arcgisRest.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {Object<string,*>} [params] ArcGIS Rest parameters. This field is optional. Service defaults will be\n * used for any fields not specified. `FORMAT` is `PNG32` by default. `F` is `IMAGE` by\n * default. `TRANSPARENT` is `true` by default.  `BBOX`, `SIZE`, `BBOXSR`,\n * and `IMAGESR` will be set dynamically. Set `LAYERS` to\n * override the default service layer visibility. See\n * https://developers.arcgis.com/rest/services-reference/export-map.htm\n * for further reference.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid. Base this on the resolutions,\n * tilesize and extent supported by the server.\n * If this is not defined, a default grid will be used: if there is a projection\n * extent, the grid will be based on that; if not, a grid based on a global\n * extent with origin at 0,0 will be used.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * The projection code must contain a numeric end portion separated by :\n * or the entire code must form a valid ArcGIS SpatialReference definition.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL.\n * The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {string} [url] ArcGIS Rest service URL for a Map Service or Image Service. The\n * url should include /MapServer or /ImageServer.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.  To disable the opacity\n * transition, pass `transition: 0`.\n * @property {Array<string>} [urls] ArcGIS Rest service urls. Use this instead of `url` when the ArcGIS\n * Service supports multiple urls for export requests.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for tile data from ArcGIS Rest services. Map and Image\n * Services are supported.\n *\n * For cached ArcGIS services, better performance is available using the\n * {@link module:ol/source/XYZ~XYZ} data source.\n * @api\n */\nclass TileArcGISRest extends TileImage {\n  /**\n   * @param {Options} [options] Tile ArcGIS Rest options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileGrid: options.tileGrid,\n      tileLoadFunction: options.tileLoadFunction,\n      url: options.url,\n      urls: options.urls,\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      transition: options.transition,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.params_ = Object.assign({}, options.params);\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.tmpExtent_ = createEmpty();\n\n    this.setKey(this.getKeyForParams_());\n  }\n\n  /**\n   * @private\n   * @return {string} The key for the current params.\n   */\n  getKeyForParams_() {\n    let i = 0;\n    const res = [];\n    for (const key in this.params_) {\n      res[i++] = key + '-' + this.params_[key];\n    }\n    return res.join('/');\n  }\n\n  /**\n   * Get the user-provided params, i.e. those passed to the constructor through\n   * the \"params\" option, and possibly updated using the updateParams method.\n   * @return {Object} Params.\n   * @api\n   */\n  getParams() {\n    return this.params_;\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"../size.js\").Size} tileSize Tile size.\n   * @param {import(\"../extent.js\").Extent} tileExtent Tile extent.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @param {Object} params Params.\n   * @return {string|undefined} Request URL.\n   * @private\n   */\n  getRequestUrl_(\n    tileCoord,\n    tileSize,\n    tileExtent,\n    pixelRatio,\n    projection,\n    params,\n  ) {\n    const urls = this.urls;\n    if (!urls) {\n      return undefined;\n    }\n    let url;\n    if (urls.length == 1) {\n      url = urls[0];\n    } else {\n      const index = modulo(tileCoordHash(tileCoord), urls.length);\n      url = urls[index];\n    }\n\n    return getRequestUrl(\n      url,\n      tileExtent,\n      (\n        this.tileGrid || this.getTileGridForProjection(projection)\n      ).getResolution(tileCoord[0]),\n      pixelRatio,\n      projection,\n      params,\n    );\n  }\n\n  /**\n   * Get the tile pixel ratio for this source.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Tile pixel ratio.\n   * @override\n   */\n  getTilePixelRatio(pixelRatio) {\n    return this.hidpi_ ? pixelRatio : 1;\n  }\n\n  /**\n   * Set the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  setParams(params) {\n    this.params_ = Object.assign({}, params);\n    this.setKey(this.getKeyForParams_());\n  }\n\n  /**\n   * Update the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  updateParams(params) {\n    Object.assign(this.params_, params);\n    this.setKey(this.getKeyForParams_());\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord The tile coordinate\n   * @param {number} pixelRatio The pixel ratio\n   * @param {import(\"../proj/Projection.js\").default} projection The projection\n   * @return {string|undefined} The tile URL\n   * @override\n   */\n  tileUrlFunction(tileCoord, pixelRatio, projection) {\n    let tileGrid = this.getTileGrid();\n    if (!tileGrid) {\n      tileGrid = this.getTileGridForProjection(projection);\n    }\n\n    if (tileGrid.getResolutions().length <= tileCoord[0]) {\n      return undefined;\n    }\n\n    if (pixelRatio != 1 && !this.hidpi_) {\n      pixelRatio = 1;\n    }\n\n    const tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent_);\n    let tileSize = toSize(tileGrid.getTileSize(tileCoord[0]), this.tmpSize);\n\n    if (pixelRatio != 1) {\n      tileSize = scaleSize(tileSize, pixelRatio, this.tmpSize);\n    }\n\n    // Apply default params and override with user specified values.\n    const baseParams = {\n      'F': 'image',\n      'FORMAT': 'PNG32',\n      'TRANSPARENT': true,\n    };\n    Object.assign(baseParams, this.params_);\n\n    return this.getRequestUrl_(\n      tileCoord,\n      tileSize,\n      tileExtent,\n      pixelRatio,\n      projection,\n      baseParams,\n    );\n  }\n}\n\nexport default TileArcGISRest;\n", "/**\n * @module ol/source/TileDebug\n */\n\nimport {createCanvasContext2D} from '../dom.js';\nimport EventType from '../events/EventType.js';\nimport {get as getProjection} from '../proj.js';\nimport {toSize} from '../size.js';\nimport {renderXYZTemplate} from '../uri.js';\nimport DataTile from './DataTile.js';\nimport ImageTile from './ImageTile.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Optional projection.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Set to `1` when debugging `VectorTile` sources with a default configuration.\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n * @property {import(\"./Tile.js\").default} [source] Tile source.\n * This allows `projection`, `tileGrid`, `wrapX` and `zDirection` to be copied from another source.\n * If both `source` and individual options are specified the individual options will have precedence.\n * @property {string} [template='z:{z} x:{x} y:{y}'] Template for labeling the tiles.\n * Should include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * @property {string} [color='grey'] CSS color to fill text and stroke grid lines of each tile.\n */\n\n/**\n * @classdesc\n * A pseudo tile source, which does not fetch tiles from a server, but renders\n * a grid outline for the tile grid/projection along with the coordinates for\n * each tile. See examples/canvas-tiles for an example.\n * @api\n */\nclass TileDebug extends ImageTile {\n  /**\n   * @param {Options} [options] Debug tile options.\n   */\n  constructor(options) {\n    /**\n     * @type {Options}\n     */\n    options = options || {};\n    const template = options.template || 'z:{z} x:{x} y:{y}';\n    const source = options.source;\n    const color = options.color || 'grey';\n\n    super({\n      transition: 0,\n      wrapX:\n        options.wrapX !== undefined\n          ? options.wrapX\n          : source !== undefined\n            ? source.getWrapX()\n            : undefined,\n    });\n\n    const setReady = () => {\n      this.projection =\n        options.projection !== undefined\n          ? getProjection(options.projection)\n          : source !== undefined\n            ? source.getProjection()\n            : this.projection;\n      this.tileGrid =\n        options.tileGrid !== undefined\n          ? options.tileGrid\n          : source !== undefined\n            ? source.getTileGrid()\n            : this.tileGrid;\n      this.zDirection =\n        options.zDirection !== undefined\n          ? options.zDirection\n          : source !== undefined\n            ? source.zDirection\n            : this.zDirection;\n\n      if (source instanceof DataTile) {\n        this.transformMatrix = source.transformMatrix?.slice() || null;\n      }\n\n      const tileGrid = this.tileGrid;\n      if (tileGrid) {\n        this.setTileSizes(\n          tileGrid\n            .getResolutions()\n            .map((r, i) =>\n              toSize(tileGrid.getTileSize(i)).map((s) =>\n                Math.max(Math.floor(s), 1),\n              ),\n            ),\n        );\n      }\n\n      this.setLoader((z, x, y, loaderOptions) => {\n        const text = renderXYZTemplate(template, z, x, y, loaderOptions.maxY);\n        const [width, height] = this.getTileSize(z);\n        const context = createCanvasContext2D(width, height);\n\n        context.strokeStyle = color;\n        context.strokeRect(0.5, 0.5, width + 0.5, height + 0.5);\n\n        context.fillStyle = color;\n        context.strokeStyle = 'white';\n        context.textAlign = 'center';\n        context.textBaseline = 'middle';\n        context.font = '24px sans-serif';\n        context.lineWidth = 4;\n        context.strokeText(text, width / 2, height / 2, width);\n        context.fillText(text, width / 2, height / 2, width);\n        // make the loader aysnc, so it behaves like other sources that fetch data from a remote server\n        return Promise.resolve(context.canvas);\n      });\n      this.setState('ready');\n    };\n\n    if (source === undefined || source.getState() === 'ready') {\n      setReady();\n    } else {\n      const handler = () => {\n        if (source.getState() === 'ready') {\n          source.removeEventListener(EventType.CHANGE, handler);\n          setReady();\n        }\n      };\n      source.addEventListener(EventType.CHANGE, handler);\n    }\n  }\n}\n\nexport default TileDebug;\n", "/**\n * @module ol/source/TileJSON\n */\n// FIXME check order of async callbacks\n\n/**\n * See https://mapbox.com/developers/api/.\n */\n\nimport {applyTransform, intersects} from '../extent.js';\nimport {jsonp as requestJSONP} from '../net.js';\nimport {get as getProjection, getTransformFromProjections} from '../proj.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\nimport {createFromTemplates} from '../tileurlfunction.js';\nimport TileImage from './TileImage.js';\n\n/**\n * @typedef {Object} Config\n * @property {string} [name] The name.\n * @property {string} [description] The description.\n * @property {string} [version] The version.\n * @property {string} [attribution] The attribution.\n * @property {string} [template] The template.\n * @property {string} [legend] The legend.\n * @property {string} [scheme] The scheme.\n * @property {Array<string>} tiles The tile URL templates.\n * @property {Array<string>} [grids] Optional grids.\n * @property {number} [minzoom] Minimum zoom level.\n * @property {number} [maxzoom] Maximum zoom level.\n * @property {Array<number>} [bounds] Optional bounds.\n * @property {Array<number>} [center] Optional center.\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {boolean} [jsonp=false] Use JSONP with callback to load the TileJSON.\n * Useful when the server does not support CORS..\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {Config} [tileJSON] TileJSON configuration for this source.\n * If not provided, `url` must be configured.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {number|import(\"../size.js\").Size} [tileSize=[256, 256]] The tile size used by the tile service.\n * Note: `tileSize` and other non-standard TileJSON properties are currently ignored.\n * @property {string} [url] URL to the TileJSON file. If not provided, `tileJSON` must be configured.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for tile data in TileJSON format.\n * @api\n */\nclass TileJSON extends TileImage {\n  /**\n   * @param {Options} options TileJSON options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: getProjection('EPSG:3857'),\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      state: 'loading',\n      tileLoadFunction: options.tileLoadFunction,\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      transition: options.transition,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @type {Config}\n     * @private\n     */\n    this.tileJSON_ = null;\n\n    /**\n     * @type {number|import(\"../size.js\").Size}\n     * @private\n     */\n    this.tileSize_ = options.tileSize;\n\n    if (options.url) {\n      if (options.jsonp) {\n        requestJSONP(\n          options.url,\n          this.handleTileJSONResponse.bind(this),\n          this.handleTileJSONError.bind(this),\n        );\n      } else {\n        const client = new XMLHttpRequest();\n        client.addEventListener('load', this.onXHRLoad_.bind(this));\n        client.addEventListener('error', this.onXHRError_.bind(this));\n        client.open('GET', options.url);\n        client.send();\n      }\n    } else if (options.tileJSON) {\n      this.handleTileJSONResponse(options.tileJSON);\n    } else {\n      throw new Error('Either `url` or `tileJSON` options must be provided');\n    }\n  }\n\n  /**\n   * @private\n   * @param {Event} event The load event.\n   */\n  onXHRLoad_(event) {\n    const client = /** @type {XMLHttpRequest} */ (event.target);\n    // status will be 0 for file:// urls\n    if (!client.status || (client.status >= 200 && client.status < 300)) {\n      let response;\n      try {\n        response = /** @type {Config} */ (JSON.parse(client.responseText));\n      } catch {\n        this.handleTileJSONError();\n        return;\n      }\n      this.handleTileJSONResponse(response);\n    } else {\n      this.handleTileJSONError();\n    }\n  }\n\n  /**\n   * @private\n   * @param {Event} event The error event.\n   */\n  onXHRError_(event) {\n    this.handleTileJSONError();\n  }\n\n  /**\n   * @return {Config} The tilejson object.\n   * @api\n   */\n  getTileJSON() {\n    return this.tileJSON_;\n  }\n\n  /**\n   * @protected\n   * @param {Config} tileJSON Tile JSON.\n   */\n  handleTileJSONResponse(tileJSON) {\n    const epsg4326Projection = getProjection('EPSG:4326');\n\n    const sourceProjection = this.getProjection();\n    let extent;\n    if (tileJSON['bounds'] !== undefined) {\n      const transform = getTransformFromProjections(\n        epsg4326Projection,\n        sourceProjection,\n      );\n      extent = applyTransform(tileJSON['bounds'], transform);\n    }\n\n    const gridExtent = extentFromProjection(sourceProjection);\n    const minZoom = tileJSON['minzoom'] || 0;\n    const maxZoom = tileJSON['maxzoom'] || 22;\n    const tileGrid = createXYZ({\n      extent: gridExtent,\n      maxZoom: maxZoom,\n      minZoom: minZoom,\n      tileSize: this.tileSize_,\n    });\n    this.tileGrid = tileGrid;\n\n    this.tileUrlFunction = createFromTemplates(tileJSON['tiles'], tileGrid);\n\n    if (tileJSON['attribution'] && !this.getAttributions()) {\n      const attributionExtent = extent !== undefined ? extent : gridExtent;\n      this.setAttributions(function (frameState) {\n        if (intersects(attributionExtent, frameState.extent)) {\n          return [tileJSON['attribution']];\n        }\n        return null;\n      });\n    }\n    this.tileJSON_ = tileJSON;\n    this.setState('ready');\n  }\n\n  /**\n   * @protected\n   */\n  handleTileJSONError() {\n    this.setState('error');\n  }\n}\n\nexport default TileJSON;\n", "/**\n * @module ol/source/UTFGrid\n */\n\nimport Tile from '../Tile.js';\nimport TileState from '../TileState.js';\nimport EventType from '../events/EventType.js';\nimport {listenOnce} from '../events.js';\nimport {applyTransform, intersects} from '../extent.js';\nimport {jsonp as requestJSONP} from '../net.js';\nimport {get as getProjection, getTransformFromProjections} from '../proj.js';\nimport LRUCache from '../structs/LRUCache.js';\nimport {getKeyZXY} from '../tilecoord.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\nimport {createFromTemplates, nullTileUrlFunction} from '../tileurlfunction.js';\nimport TileSource from './Tile.js';\n\n/**\n * @typedef {Object} UTFGridJSON\n * @property {Array<string>} grid The grid.\n * @property {Array<string>} keys The keys.\n * @property {Object<string, Object>} [data] Optional data.\n */\n\nexport class CustomTile extends Tile {\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"../TileState.js\").default} state State.\n   * @param {string} src Image source URI.\n   * @param {import(\"../extent.js\").Extent} extent Extent of the tile.\n   * @param {boolean} preemptive Load the tile when visible (before it's needed).\n   * @param {boolean} jsonp Load the tile as a script.\n   */\n  constructor(tileCoord, state, src, extent, preemptive, jsonp) {\n    super(tileCoord, state);\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.src_ = src;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.extent_ = extent;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.preemptive_ = preemptive;\n\n    /**\n     * @private\n     * @type {Array<string>}\n     */\n    this.grid_ = null;\n\n    /**\n     * @private\n     * @type {Array<string>}\n     */\n    this.keys_ = null;\n\n    /**\n     * @private\n     * @type {Object<string, Object>|undefined}\n     */\n    this.data_ = null;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.jsonp_ = jsonp;\n  }\n\n  /**\n   * Get the image element for this tile.\n   * @return {HTMLImageElement} Image.\n   */\n  getImage() {\n    return null;\n  }\n\n  /**\n   * Synchronously returns data at given coordinate (if available).\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @return {*} The data.\n   */\n  getData(coordinate) {\n    if (!this.grid_ || !this.keys_) {\n      return null;\n    }\n    const xRelative =\n      (coordinate[0] - this.extent_[0]) / (this.extent_[2] - this.extent_[0]);\n    const yRelative =\n      (coordinate[1] - this.extent_[1]) / (this.extent_[3] - this.extent_[1]);\n\n    const row = this.grid_[Math.floor((1 - yRelative) * this.grid_.length)];\n\n    if (typeof row !== 'string') {\n      return null;\n    }\n\n    let code = row.charCodeAt(Math.floor(xRelative * row.length));\n    if (code >= 93) {\n      code--;\n    }\n    if (code >= 35) {\n      code--;\n    }\n    code -= 32;\n\n    let data = null;\n    if (code in this.keys_) {\n      const id = this.keys_[code];\n      if (this.data_ && id in this.data_) {\n        data = this.data_[id];\n      } else {\n        data = id;\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Calls the callback (synchronously by default) with the available data\n   * for given coordinate (or `null` if not yet loaded).\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {function(*): void} callback Callback.\n   * @param {boolean} [request] If `true` the callback is always async.\n   *                               The tile data is requested if not yet loaded.\n   */\n  forDataAtCoordinate(coordinate, callback, request) {\n    if (this.state == TileState.EMPTY && request === true) {\n      this.state = TileState.IDLE;\n      listenOnce(this, EventType.CHANGE, (e) => {\n        callback(this.getData(coordinate));\n      });\n      this.loadInternal_();\n    } else {\n      if (request === true) {\n        setTimeout(() => {\n          callback(this.getData(coordinate));\n        }, 0);\n      } else {\n        callback(this.getData(coordinate));\n      }\n    }\n  }\n\n  /**\n   * Return the key to be used for all tiles in the source.\n   * @return {string} The key for all tiles.\n   * @override\n   */\n  getKey() {\n    return this.src_;\n  }\n\n  /**\n   * @private\n   */\n  handleError_() {\n    this.state = TileState.ERROR;\n    this.changed();\n  }\n\n  /**\n   * @param {!UTFGridJSON} json UTFGrid data.\n   * @private\n   */\n  handleLoad_(json) {\n    this.grid_ = json['grid'];\n    this.keys_ = json['keys'];\n    this.data_ = json['data'];\n\n    this.state = TileState.LOADED;\n    this.changed();\n  }\n\n  /**\n   * @private\n   */\n  loadInternal_() {\n    if (this.state == TileState.IDLE) {\n      this.state = TileState.LOADING;\n      if (this.jsonp_) {\n        requestJSONP(\n          this.src_,\n          this.handleLoad_.bind(this),\n          this.handleError_.bind(this),\n        );\n      } else {\n        const client = new XMLHttpRequest();\n        client.addEventListener('load', this.onXHRLoad_.bind(this));\n        client.addEventListener('error', this.onXHRError_.bind(this));\n        client.open('GET', this.src_);\n        client.send();\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @param {Event} event The load event.\n   */\n  onXHRLoad_(event) {\n    const client = /** @type {XMLHttpRequest} */ (event.target);\n    // status will be 0 for file:// urls\n    if (!client.status || (client.status >= 200 && client.status < 300)) {\n      let response;\n      try {\n        response = /** @type {!UTFGridJSON} */ (\n          JSON.parse(client.responseText)\n        );\n      } catch {\n        this.handleError_();\n        return;\n      }\n      this.handleLoad_(response);\n    } else {\n      this.handleError_();\n    }\n  }\n\n  /**\n   * @private\n   * @param {Event} event The error event.\n   */\n  onXHRError_(event) {\n    this.handleError_();\n  }\n\n  /**\n   * @override\n   */\n  load() {\n    if (this.preemptive_) {\n      this.loadInternal_();\n    } else {\n      this.setState(TileState.EMPTY);\n    }\n  }\n}\n\n/**\n * @typedef {Object} Options\n * @property {boolean} [preemptive=true]\n * If `true` the UTFGrid source loads the tiles based on their \"visibility\".\n * This improves the speed of response, but increases traffic.\n * Note that if set to `false` (lazy loading), you need to pass `true` as\n * `request` to the `forDataAtCoordinateAndResolution` method otherwise no\n * data will ever be loaded.\n * @property {boolean} [jsonp=false] Use JSONP with callback to load the TileJSON.\n * Useful when the server does not support CORS..\n * @property {import(\"./TileJSON.js\").Config} [tileJSON] TileJSON configuration for this source.\n * If not provided, `url` must be configured.\n * @property {string} [url] TileJSON endpoint that provides the configuration for this source.\n * Request will be made through JSONP. If not provided, `tileJSON` must be configured.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for UTFGrid interaction data loaded from TileJSON format.\n * @api\n */\nclass UTFGrid extends TileSource {\n  /**\n   * @param {Options} options Source options.\n   */\n  constructor(options) {\n    super({\n      projection: getProjection('EPSG:3857'),\n      state: 'loading',\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.preemptive_ =\n      options.preemptive !== undefined ? options.preemptive : true;\n\n    /**\n     * @private\n     * @type {!import(\"../Tile.js\").UrlFunction}\n     */\n    this.tileUrlFunction_ = nullTileUrlFunction;\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.template_ = undefined;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.jsonp_ = options.jsonp || false;\n\n    /**\n     * @private\n     * @type {LRUCache}\n     */\n    this.tileCache_ = new LRUCache(512);\n\n    if (options.url) {\n      if (this.jsonp_) {\n        requestJSONP(\n          options.url,\n          this.handleTileJSONResponse.bind(this),\n          this.handleTileJSONError.bind(this),\n        );\n      } else {\n        const client = new XMLHttpRequest();\n        client.addEventListener('load', this.onXHRLoad_.bind(this));\n        client.addEventListener('error', this.onXHRError_.bind(this));\n        client.open('GET', options.url);\n        client.send();\n      }\n    } else if (options.tileJSON) {\n      this.handleTileJSONResponse(options.tileJSON);\n    } else {\n      throw new Error('Either `url` or `tileJSON` options must be provided');\n    }\n  }\n\n  /**\n   * @private\n   * @param {Event} event The load event.\n   */\n  onXHRLoad_(event) {\n    const client = /** @type {XMLHttpRequest} */ (event.target);\n    // status will be 0 for file:// urls\n    if (!client.status || (client.status >= 200 && client.status < 300)) {\n      let response;\n      try {\n        response = /** @type {import(\"./TileJSON.js\").Config} */ (\n          JSON.parse(client.responseText)\n        );\n      } catch {\n        this.handleTileJSONError();\n        return;\n      }\n      this.handleTileJSONResponse(response);\n    } else {\n      this.handleTileJSONError();\n    }\n  }\n\n  /**\n   * @private\n   * @param {Event} event The error event.\n   */\n  onXHRError_(event) {\n    this.handleTileJSONError();\n  }\n\n  /**\n   * Return the template from TileJSON.\n   * @return {string|undefined} The template from TileJSON.\n   * @api\n   */\n  getTemplate() {\n    return this.template_;\n  }\n\n  /**\n   * Calls the callback (synchronously by default) with the available data\n   * for given coordinate and resolution (or `null` if not yet loaded or\n   * in case of an error).\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {number} resolution Resolution.\n   * @param {function(*): void} callback Callback.\n   * @param {boolean} [request] If `true` the callback is always async.\n   *                               The tile data is requested if not yet loaded.\n   * @api\n   */\n  forDataAtCoordinateAndResolution(coordinate, resolution, callback, request) {\n    if (this.tileGrid) {\n      const z = this.tileGrid.getZForResolution(resolution, this.zDirection);\n      const tileCoord = this.tileGrid.getTileCoordForCoordAndZ(coordinate, z);\n      const tile = /** @type {!CustomTile} */ (\n        this.getTile(\n          tileCoord[0],\n          tileCoord[1],\n          tileCoord[2],\n          1,\n          this.getProjection(),\n        )\n      );\n      if (tile.getState() == TileState.IDLE) {\n        tile.load();\n      }\n      tile.forDataAtCoordinate(coordinate, callback, request);\n    } else {\n      if (request === true) {\n        setTimeout(function () {\n          callback(null);\n        }, 0);\n      } else {\n        callback(null);\n      }\n    }\n  }\n\n  /**\n   * @protected\n   */\n  handleTileJSONError() {\n    this.setState('error');\n  }\n\n  /**\n   * TODO: very similar to ol/source/TileJSON#handleTileJSONResponse\n   * @protected\n   * @param {import(\"./TileJSON.js\").Config} tileJSON Tile JSON.\n   */\n  handleTileJSONResponse(tileJSON) {\n    const epsg4326Projection = getProjection('EPSG:4326');\n\n    const sourceProjection = this.getProjection();\n    let extent;\n    if (tileJSON['bounds'] !== undefined) {\n      const transform = getTransformFromProjections(\n        epsg4326Projection,\n        sourceProjection,\n      );\n      extent = applyTransform(tileJSON['bounds'], transform);\n    }\n\n    const gridExtent = extentFromProjection(sourceProjection);\n    const minZoom = tileJSON['minzoom'] || 0;\n    const maxZoom = tileJSON['maxzoom'] || 22;\n    const tileGrid = createXYZ({\n      extent: gridExtent,\n      maxZoom: maxZoom,\n      minZoom: minZoom,\n    });\n    this.tileGrid = tileGrid;\n\n    this.template_ = tileJSON['template'];\n\n    const grids = tileJSON['grids'];\n    if (!grids) {\n      this.setState('error');\n      return;\n    }\n\n    this.tileUrlFunction_ = createFromTemplates(grids, tileGrid);\n\n    if (tileJSON['attribution']) {\n      const attributionExtent = extent !== undefined ? extent : gridExtent;\n      this.setAttributions(function (frameState) {\n        if (intersects(attributionExtent, frameState.extent)) {\n          return [tileJSON['attribution']];\n        }\n        return null;\n      });\n    }\n\n    this.setState('ready');\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!CustomTile} Tile.\n   * @override\n   */\n  getTile(z, x, y, pixelRatio, projection) {\n    const tileCoord = [z, x, y];\n    const urlTileCoord = this.getTileCoordForTileUrlFunction(\n      tileCoord,\n      projection,\n    );\n    const tileUrl = this.tileUrlFunction_(urlTileCoord, pixelRatio, projection);\n    const tileKey = `${this.getKey()},${getKeyZXY(z, x, y)}`;\n    if (this.tileCache_.containsKey(tileKey)) {\n      return this.tileCache_.get(tileKey);\n    }\n    this.tileCache_.expireCache();\n    const tile = new CustomTile(\n      tileCoord,\n      tileUrl !== undefined ? TileState.IDLE : TileState.EMPTY,\n      tileUrl !== undefined ? tileUrl : '',\n      this.tileGrid.getTileCoordExtent(tileCoord),\n      this.preemptive_,\n      this.jsonp_,\n    );\n    this.tileCache_.set(tileKey, tile);\n    return tile;\n  }\n}\n\nexport default UTFGrid;\n", "/**\n * @module ol/source/WMTS\n */\n\nimport {containsExtent} from '../extent.js';\nimport {equivalent, get as getProjection, transformExtent} from '../proj.js';\nimport {createFromCapabilitiesMatrixSet} from '../tilegrid/WMTS.js';\nimport {createFromTileUrlFunctions} from '../tileurlfunction.js';\nimport {appendParams, expandUrl} from '../uri.js';\nimport TileImage from './TileImage.js';\n\n/**\n * Request encoding. One of 'KVP', 'REST'.\n * @typedef {'KVP' | 'REST'} RequestEncoding\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Deprecated.  Use the cacheSize option on the layer instead.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../tilegrid/WMTS.js\").default} tileGrid Tile grid.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {RequestEncoding} [requestEncoding='KVP'] Request encoding.\n * @property {string} layer Layer name as advertised in the WMTS capabilities.\n * @property {string} style Style name as advertised in the WMTS capabilities.\n * @property {typeof import(\"../ImageTile.js\").default} [tileClass]  Class used to instantiate image tiles. Default is {@link module:ol/ImageTile~ImageTile}.\n * @property {number} [tilePixelRatio=1] The pixel ratio used by the tile service.\n * For example, if the tile service advertizes 256px by 256px tiles but actually sends 512px\n * by 512px images (for retina/hidpi devices) then `tilePixelRatio`\n * should be set to `2`.\n * @property {string} [format='image/jpeg'] Image format. Only used when `requestEncoding` is `'KVP'`.\n * @property {string} [version='1.0.0'] WMTS version.\n * @property {string} matrixSet Matrix set.\n * @property {!Object} [dimensions] Additional \"dimensions\" for tile requests.\n * This is an object with properties named like the advertised WMTS dimensions.\n * @property {string} [url]  A URL for the service.\n * For the RESTful request encoding, this is a URL\n * template.  For KVP encoding, it is normal URL. A `{?-?}` template pattern,\n * for example `subdomain{a-f}.domain.com`, may be used instead of defining\n * each one separately in the `urls` option.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {Array<string>} [urls] An array of URLs.\n * Requests will be distributed among the URLs in this array.\n * @property {boolean} [wrapX=false] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for tile data from WMTS servers.\n * @api\n */\nclass WMTS extends TileImage {\n  /**\n   * @param {Options} options WMTS options.\n   */\n  constructor(options) {\n    // TODO: add support for TileMatrixLimits\n\n    const requestEncoding =\n      options.requestEncoding !== undefined ? options.requestEncoding : 'KVP';\n\n    // FIXME: should we create a default tileGrid?\n    // we could issue a getCapabilities xhr to retrieve missing configuration\n    const tileGrid = options.tileGrid;\n\n    let urls = options.urls;\n    if (urls === undefined && options.url !== undefined) {\n      urls = expandUrl(options.url);\n    }\n\n    super({\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileClass: options.tileClass,\n      tileGrid: tileGrid,\n      tileLoadFunction: options.tileLoadFunction,\n      tilePixelRatio: options.tilePixelRatio,\n      urls: urls,\n      wrapX: options.wrapX !== undefined ? options.wrapX : false,\n      transition: options.transition,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.version_ = options.version !== undefined ? options.version : '1.0.0';\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.format_ = options.format !== undefined ? options.format : 'image/jpeg';\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.dimensions_ =\n      options.dimensions !== undefined ? options.dimensions : {};\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.layer_ = options.layer;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.matrixSet_ = options.matrixSet;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.style_ = options.style;\n\n    // FIXME: should we guess this requestEncoding from options.url(s)\n    //        structure? that would mean KVP only if a template is not provided.\n\n    /**\n     * @private\n     * @type {RequestEncoding}\n     */\n    this.requestEncoding_ = requestEncoding;\n\n    this.setKey(this.getKeyForDimensions_());\n\n    if (urls && urls.length > 0) {\n      this.tileUrlFunction = createFromTileUrlFunctions(\n        urls.map(this.createFromWMTSTemplate.bind(this)),\n      );\n    }\n  }\n\n  /**\n   * Set the URLs to use for requests.\n   * URLs may contain OGC conform URL Template Variables: {TileMatrix}, {TileRow}, {TileCol}.\n   * @param {Array<string>} urls URLs.\n   * @override\n   */\n  setUrls(urls) {\n    this.urls = urls;\n    const key = urls.join('\\n');\n    this.setTileUrlFunction(\n      createFromTileUrlFunctions(\n        urls.map(this.createFromWMTSTemplate.bind(this)),\n      ),\n      key,\n    );\n  }\n\n  /**\n   * Get the dimensions, i.e. those passed to the constructor through the\n   * \"dimensions\" option, and possibly updated using the updateDimensions\n   * method.\n   * @return {!Object} Dimensions.\n   * @api\n   */\n  getDimensions() {\n    return this.dimensions_;\n  }\n\n  /**\n   * Return the image format of the WMTS source.\n   * @return {string} Format.\n   * @api\n   */\n  getFormat() {\n    return this.format_;\n  }\n\n  /**\n   * Return the layer of the WMTS source.\n   * @return {string} Layer.\n   * @api\n   */\n  getLayer() {\n    return this.layer_;\n  }\n\n  /**\n   * Return the matrix set of the WMTS source.\n   * @return {string} MatrixSet.\n   * @api\n   */\n  getMatrixSet() {\n    return this.matrixSet_;\n  }\n\n  /**\n   * Return the request encoding, either \"KVP\" or \"REST\".\n   * @return {RequestEncoding} Request encoding.\n   * @api\n   */\n  getRequestEncoding() {\n    return this.requestEncoding_;\n  }\n\n  /**\n   * Return the style of the WMTS source.\n   * @return {string} Style.\n   * @api\n   */\n  getStyle() {\n    return this.style_;\n  }\n\n  /**\n   * Return the version of the WMTS source.\n   * @return {string} Version.\n   * @api\n   */\n  getVersion() {\n    return this.version_;\n  }\n\n  /**\n   * @private\n   * @return {string} The key for the current dimensions.\n   */\n  getKeyForDimensions_() {\n    const res = this.urls ? this.urls.slice(0) : [];\n    for (const key in this.dimensions_) {\n      res.push(key + '-' + this.dimensions_[key]);\n    }\n    return res.join('/');\n  }\n\n  /**\n   * Update the dimensions.\n   * @param {Object} dimensions Dimensions.\n   * @api\n   */\n  updateDimensions(dimensions) {\n    Object.assign(this.dimensions_, dimensions);\n    this.setKey(this.getKeyForDimensions_());\n  }\n\n  /**\n   * @param {string} template Template.\n   * @return {import(\"../Tile.js\").UrlFunction} Tile URL function.\n   */\n  createFromWMTSTemplate(template) {\n    const requestEncoding = this.requestEncoding_;\n\n    // context property names are lower case to allow for a case insensitive\n    // replacement as some services use different naming conventions\n    const context = {\n      'layer': this.layer_,\n      'style': this.style_,\n      'tilematrixset': this.matrixSet_,\n    };\n\n    if (requestEncoding == 'KVP') {\n      Object.assign(context, {\n        'Service': 'WMTS',\n        'Request': 'GetTile',\n        'Version': this.version_,\n        'Format': this.format_,\n      });\n    }\n\n    // TODO: we may want to create our own appendParams function so that params\n    // order conforms to wmts spec guidance, and so that we can avoid to escape\n    // special template params\n\n    template =\n      requestEncoding == 'KVP'\n        ? appendParams(template, context)\n        : template.replace(/\\{(\\w+?)\\}/g, function (m, p) {\n            return p.toLowerCase() in context ? context[p.toLowerCase()] : m;\n          });\n\n    const tileGrid = /** @type {import(\"../tilegrid/WMTS.js\").default} */ (\n      this.tileGrid\n    );\n    const dimensions = this.dimensions_;\n\n    return (\n      /**\n       * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n       * @param {number} pixelRatio Pixel ratio.\n       * @param {import(\"../proj/Projection.js\").default} projection Projection.\n       * @return {string|undefined} Tile URL.\n       */\n      function (tileCoord, pixelRatio, projection) {\n        if (!tileCoord) {\n          return undefined;\n        }\n        const localContext = {\n          'TileMatrix': tileGrid.getMatrixId(tileCoord[0]),\n          'TileCol': tileCoord[1],\n          'TileRow': tileCoord[2],\n        };\n        Object.assign(localContext, dimensions);\n        let url = template;\n        if (requestEncoding == 'KVP') {\n          url = appendParams(url, localContext);\n        } else {\n          url = url.replace(/\\{(\\w+?)\\}/g, function (m, p) {\n            return encodeURIComponent(localContext[p]);\n          });\n        }\n        return url;\n      }\n    );\n  }\n}\n\nexport default WMTS;\n\n/**\n * Generate source options from a capabilities object.\n * @param {Object} wmtsCap An object representing the capabilities document.\n * @param {!Object} config Configuration properties for the layer.  Defaults for\n *                  the layer will apply if not provided.\n *\n * Required config properties:\n *  - layer - {string} The layer identifier.\n *\n * Optional config properties:\n *  - matrixSet - {string} The matrix set identifier, required if there is\n *       more than one matrix set in the layer capabilities.\n *  - projection - {string} The desired CRS when no matrixSet is specified.\n *       eg: \"EPSG:3857\". If the desired projection is not available,\n *       an error is thrown.\n *  - requestEncoding - {string} url encoding format for the layer. Default is\n *       the first tile url format found in the GetCapabilities response.\n *  - style - {string} The name of the style\n *  - format - {string} Image format for the layer. Default is the first\n *       format returned in the GetCapabilities response.\n *  - crossOrigin - {string|null|undefined} Cross origin. Default is `undefined`.\n * @return {Options|null} WMTS source options object or `null` if the layer was not found.\n * @api\n */\nexport function optionsFromCapabilities(wmtsCap, config) {\n  const layers = wmtsCap['Contents']['Layer'];\n  const l = layers?.find(function (elt) {\n    return elt['Identifier'] == config['layer'];\n  });\n  if (!l) {\n    return null;\n  }\n  const tileMatrixSets = wmtsCap['Contents']['TileMatrixSet'];\n  let idx;\n  if (l['TileMatrixSetLink'].length > 1) {\n    if ('projection' in config) {\n      idx = l['TileMatrixSetLink'].findIndex(function (elt) {\n        const tileMatrixSet = tileMatrixSets.find(function (el) {\n          return el['Identifier'] == elt['TileMatrixSet'];\n        });\n        const supportedCRS = tileMatrixSet['SupportedCRS'];\n        const proj1 = getProjection(supportedCRS);\n        const proj2 = getProjection(config['projection']);\n        if (proj1 && proj2) {\n          return equivalent(proj1, proj2);\n        }\n        return supportedCRS == config['projection'];\n      });\n    } else {\n      idx = l['TileMatrixSetLink'].findIndex(function (elt) {\n        return elt['TileMatrixSet'] == config['matrixSet'];\n      });\n    }\n  } else {\n    idx = 0;\n  }\n  if (idx < 0) {\n    idx = 0;\n  }\n  const matrixSet =\n    /** @type {string} */\n    (l['TileMatrixSetLink'][idx]['TileMatrixSet']);\n  const matrixLimits =\n    /** @type {Array<Object>} */\n    (l['TileMatrixSetLink'][idx]['TileMatrixSetLimits']);\n\n  let format = /** @type {string} */ (l['Format'][0]);\n  if ('format' in config) {\n    format = config['format'];\n  }\n  idx = l['Style'].findIndex(function (elt) {\n    if ('style' in config) {\n      return elt['Title'] == config['style'];\n    }\n    return elt['isDefault'];\n  });\n  if (idx < 0) {\n    idx = 0;\n  }\n  const style = /** @type {string} */ (l['Style'][idx]['Identifier']);\n\n  const dimensions = {};\n  if ('Dimension' in l) {\n    l['Dimension'].forEach(function (elt, index, array) {\n      const key = elt['Identifier'];\n      let value = elt['Default'];\n      if (value === undefined) {\n        value = elt['Value'][0];\n      }\n      dimensions[key] = value;\n    });\n  }\n\n  const matrixSets = wmtsCap['Contents']['TileMatrixSet'];\n  const matrixSetObj = matrixSets.find(function (elt) {\n    return elt['Identifier'] == matrixSet;\n  });\n\n  let projection;\n  const code = matrixSetObj['SupportedCRS'];\n  if (code) {\n    projection = getProjection(code);\n  }\n  if ('projection' in config) {\n    const projConfig = getProjection(config['projection']);\n    if (projConfig) {\n      if (!projection || equivalent(projConfig, projection)) {\n        projection = projConfig;\n      }\n    }\n  }\n\n  let wrapX = false;\n  const switchXY = projection.getAxisOrientation().startsWith('ne');\n\n  let matrix = matrixSetObj.TileMatrix[0];\n\n  // create default matrixLimit\n  let selectedMatrixLimit = {\n    MinTileCol: 0,\n    MinTileRow: 0,\n    // subtract one to end up at tile top left\n    MaxTileCol: matrix.MatrixWidth - 1,\n    MaxTileRow: matrix.MatrixHeight - 1,\n  };\n\n  //in case of matrix limits, use matrix limits to calculate extent\n  if (matrixLimits) {\n    selectedMatrixLimit = matrixLimits[matrixLimits.length - 1];\n    const m = matrixSetObj.TileMatrix.find(\n      (tileMatrixValue) =>\n        tileMatrixValue.Identifier === selectedMatrixLimit.TileMatrix ||\n        matrixSetObj.Identifier + ':' + tileMatrixValue.Identifier ===\n          selectedMatrixLimit.TileMatrix,\n    );\n    if (m) {\n      matrix = m;\n    }\n  }\n\n  const resolution =\n    (matrix.ScaleDenominator * 0.00028) / projection.getMetersPerUnit(); // WMTS 1.0.0: standardized rendering pixel size\n  const origin = switchXY\n    ? [matrix.TopLeftCorner[1], matrix.TopLeftCorner[0]]\n    : matrix.TopLeftCorner;\n  const tileSpanX = matrix.TileWidth * resolution;\n  const tileSpanY = matrix.TileHeight * resolution;\n  let matrixSetExtent = matrixSetObj['BoundingBox'];\n  if (matrixSetExtent && switchXY) {\n    matrixSetExtent = [\n      matrixSetExtent[1],\n      matrixSetExtent[0],\n      matrixSetExtent[3],\n      matrixSetExtent[2],\n    ];\n  }\n  let extent = [\n    origin[0] + tileSpanX * selectedMatrixLimit.MinTileCol,\n    // add one to get proper bottom/right coordinate\n    origin[1] - tileSpanY * (1 + selectedMatrixLimit.MaxTileRow),\n    origin[0] + tileSpanX * (1 + selectedMatrixLimit.MaxTileCol),\n    origin[1] - tileSpanY * selectedMatrixLimit.MinTileRow,\n  ];\n\n  if (\n    matrixSetExtent !== undefined &&\n    !containsExtent(matrixSetExtent, extent)\n  ) {\n    const wgs84BoundingBox = l['WGS84BoundingBox'];\n    const wgs84ProjectionExtent = getProjection('EPSG:4326').getExtent();\n    extent = matrixSetExtent;\n    if (wgs84BoundingBox) {\n      wrapX =\n        wgs84BoundingBox[0] === wgs84ProjectionExtent[0] &&\n        wgs84BoundingBox[2] === wgs84ProjectionExtent[2];\n    } else {\n      const wgs84MatrixSetExtent = transformExtent(\n        matrixSetExtent,\n        matrixSetObj['SupportedCRS'],\n        'EPSG:4326',\n      );\n      // Ignore slight deviation from the correct x limits\n      wrapX =\n        wgs84MatrixSetExtent[0] - 1e-10 <= wgs84ProjectionExtent[0] &&\n        wgs84MatrixSetExtent[2] + 1e-10 >= wgs84ProjectionExtent[2];\n    }\n  }\n\n  const tileGrid = createFromCapabilitiesMatrixSet(\n    matrixSetObj,\n    extent,\n    matrixLimits,\n  );\n\n  /** @type {!Array<string>} */\n  const urls = [];\n  let requestEncoding = config['requestEncoding'];\n  requestEncoding = requestEncoding !== undefined ? requestEncoding : '';\n\n  if (\n    'OperationsMetadata' in wmtsCap &&\n    'GetTile' in wmtsCap['OperationsMetadata']\n  ) {\n    const gets = wmtsCap['OperationsMetadata']['GetTile']['DCP']['HTTP']['Get'];\n\n    for (let i = 0, ii = gets.length; i < ii; ++i) {\n      if (gets[i]['Constraint']) {\n        const constraint = gets[i]['Constraint'].find(function (element) {\n          return element['name'] == 'GetEncoding';\n        });\n        const encodings = constraint['AllowedValues']['Value'];\n\n        if (requestEncoding === '') {\n          // requestEncoding not provided, use the first encoding from the list\n          requestEncoding = encodings[0];\n        }\n        if (requestEncoding === 'KVP') {\n          if (encodings.includes('KVP')) {\n            urls.push(/** @type {string} */ (gets[i]['href']));\n          }\n        } else {\n          break;\n        }\n      } else if (gets[i]['href']) {\n        requestEncoding = 'KVP';\n        urls.push(/** @type {string} */ (gets[i]['href']));\n      }\n    }\n  }\n  if (urls.length === 0) {\n    requestEncoding = 'REST';\n    l['ResourceURL'].forEach(function (element) {\n      if (element['resourceType'] === 'tile') {\n        format = element['format'];\n        urls.push(/** @type {string} */ (element['template']));\n      }\n    });\n  }\n\n  return {\n    urls: urls,\n    layer: config['layer'],\n    matrixSet: matrixSet,\n    format: format,\n    projection: projection,\n    requestEncoding: requestEncoding,\n    tileGrid: tileGrid,\n    style: style,\n    dimensions: dimensions,\n    wrapX: wrapX,\n    crossOrigin: config['crossOrigin'],\n  };\n}\n", "/**\n * @module ol/source\n */\n\nimport {getIntersection} from './extent.js';\nimport LRUCache from './structs/LRUCache.js';\n\nexport {default as BingMaps} from './source/BingMaps.js';\nexport {default as CartoDB} from './source/CartoDB.js';\nexport {default as Cluster} from './source/Cluster.js';\nexport {default as DataTile} from './source/DataTile.js';\nexport {default as GeoTIFF} from './source/GeoTIFF.js';\nexport {default as Google} from './source/Google.js';\nexport {default as IIIF} from './source/IIIF.js';\nexport {default as Image} from './source/Image.js';\nexport {default as ImageArcGISRest} from './source/ImageArcGISRest.js';\nexport {default as ImageCanvas} from './source/ImageCanvas.js';\nexport {default as ImageMapGuide} from './source/ImageMapGuide.js';\nexport {default as ImageStatic} from './source/ImageStatic.js';\nexport {default as ImageTile} from './source/ImageTile.js';\nexport {default as ImageWMS} from './source/ImageWMS.js';\nexport {default as OGCMapTile} from './source/OGCMapTile.js';\nexport {default as OGCVectorTile} from './source/OGCVectorTile.js';\nexport {default as OSM} from './source/OSM.js';\nexport {default as Raster} from './source/Raster.js';\nexport {default as Source} from './source/Source.js';\nexport {default as StadiaMaps} from './source/StadiaMaps.js';\nexport {default as Tile} from './source/Tile.js';\nexport {default as TileArcGISRest} from './source/TileArcGISRest.js';\nexport {default as TileDebug} from './source/TileDebug.js';\nexport {default as TileImage} from './source/TileImage.js';\nexport {default as TileJSON} from './source/TileJSON.js';\nexport {default as TileWMS} from './source/TileWMS.js';\nexport {default as UrlTile} from './source/UrlTile.js';\nexport {default as UTFGrid} from './source/UTFGrid.js';\nexport {default as Vector} from './source/Vector.js';\nexport {default as VectorTile} from './source/VectorTile.js';\nexport {default as WMTS} from './source/WMTS.js';\nexport {default as XYZ} from './source/XYZ.js';\nexport {default as Zoomify} from './source/Zoomify.js';\nexport {createLoader as createWMSLoader} from './source/wms.js';\nexport {createLoader as createArcGISRestLoader} from './source/arcgisRest.js';\nexport {createLoader as createStaticLoader} from './source/static.js';\nexport {createLoader as createMapGuideLoader} from './source/mapguide.js';\n\n/**\n * Creates a sources function from a tile grid. This function can be used as value for the\n * `sources` property of the {@link module:ol/layer/Layer~Layer} subclasses that support it.\n * @param {import(\"./tilegrid/TileGrid.js\").default} tileGrid Tile grid.\n * @param {function(import(\"./tilecoord.js\").TileCoord): import(\"./source/Source.js\").default} factory Source factory.\n * This function takes a {@link module:ol/tilecoord~TileCoord} as argument and is expected to return a\n * {@link module:ol/source/Source~Source}. **Note**: The returned sources should have a tile grid with\n * a limited set of resolutions, matching the resolution range of a single zoom level of the pyramid\n * `tileGrid` that `sourcesFromTileGrid` was called with.\n * @return {function(import(\"./extent.js\").Extent, number): Array<import(\"./source/Source.js\").default>} Sources function.\n * @api\n */\nexport function sourcesFromTileGrid(tileGrid, factory) {\n  const sourceCache = new LRUCache(32);\n  const tileGridExtent = tileGrid.getExtent();\n  return function (extent, resolution) {\n    sourceCache.expireCache();\n    if (tileGridExtent) {\n      extent = getIntersection(tileGridExtent, extent);\n    }\n    const z = tileGrid.getZForResolution(resolution);\n    const wantedSources = [];\n    tileGrid.forEachTileCoord(extent, z, (tileCoord) => {\n      const key = tileCoord.toString();\n      if (!sourceCache.containsKey(key)) {\n        const source = factory(tileCoord);\n        sourceCache.set(key, source);\n      }\n      wantedSources.push(sourceCache.get(key));\n    });\n    return wantedSources;\n  };\n}\n", "\nconst SHIFT_LEFT_32 = (1 << 16) * (1 << 16);\nconst SHIFT_RIGHT_32 = 1 / SHIFT_LEFT_32;\n\n// Threshold chosen based on both benchmarking and knowledge about browser string\n// data structures (which currently switch structure types at 12 bytes or more)\nconst TEXT_DECODER_MIN_LENGTH = 12;\nconst utf8TextDecoder = typeof TextDecoder === 'undefined' ? null : new TextDecoder('utf-8');\n\nconst PBF_VARINT  = 0; // varint: int32, int64, uint32, uint64, sint32, sint64, bool, enum\nconst PBF_FIXED64 = 1; // 64-bit: double, fixed64, sfixed64\nconst PBF_BYTES   = 2; // length-delimited: string, bytes, embedded messages, packed repeated fields\nconst PBF_FIXED32 = 5; // 32-bit: float, fixed32, sfixed32\n\nexport default class Pbf {\n    /**\n     * @param {Uint8Array | ArrayBuffer} [buf]\n     */\n    constructor(buf = new Uint8Array(16)) {\n        this.buf = ArrayBuffer.isView(buf) ? buf : new Uint8Array(buf);\n        this.dataView = new DataView(this.buf.buffer);\n        this.pos = 0;\n        this.type = 0;\n        this.length = this.buf.length;\n    }\n\n    // === READING =================================================================\n\n    /**\n     * @template T\n     * @param {(tag: number, result: T, pbf: Pbf) => void} readField\n     * @param {T} result\n     * @param {number} [end]\n     */\n    readFields(readField, result, end = this.length) {\n        while (this.pos < end) {\n            const val = this.readVarint(),\n                tag = val >> 3,\n                startPos = this.pos;\n\n            this.type = val & 0x7;\n            readField(tag, result, this);\n\n            if (this.pos === startPos) this.skip(val);\n        }\n        return result;\n    }\n\n    /**\n     * @template T\n     * @param {(tag: number, result: T, pbf: Pbf) => void} readField\n     * @param {T} result\n     */\n    readMessage(readField, result) {\n        return this.readFields(readField, result, this.readVarint() + this.pos);\n    }\n\n    readFixed32() {\n        const val = this.dataView.getUint32(this.pos, true);\n        this.pos += 4;\n        return val;\n    }\n\n    readSFixed32() {\n        const val = this.dataView.getInt32(this.pos, true);\n        this.pos += 4;\n        return val;\n    }\n\n    // 64-bit int handling is based on github.com/dpw/node-buffer-more-ints (MIT-licensed)\n\n    readFixed64() {\n        const val = this.dataView.getUint32(this.pos, true) + this.dataView.getUint32(this.pos + 4, true) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    }\n\n    readSFixed64() {\n        const val = this.dataView.getUint32(this.pos, true) + this.dataView.getInt32(this.pos + 4, true) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    }\n\n    readFloat() {\n        const val = this.dataView.getFloat32(this.pos, true);\n        this.pos += 4;\n        return val;\n    }\n\n    readDouble() {\n        const val = this.dataView.getFloat64(this.pos, true);\n        this.pos += 8;\n        return val;\n    }\n\n    /**\n     * @param {boolean} [isSigned]\n     */\n    readVarint(isSigned) {\n        const buf = this.buf;\n        let val, b;\n\n        b = buf[this.pos++]; val  =  b & 0x7f;        if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 7;  if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 14; if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 21; if (b < 0x80) return val;\n        b = buf[this.pos];   val |= (b & 0x0f) << 28;\n\n        return readVarintRemainder(val, isSigned, this);\n    }\n\n    readVarint64() { // for compatibility with v2.0.1\n        return this.readVarint(true);\n    }\n\n    readSVarint() {\n        const num = this.readVarint();\n        return num % 2 === 1 ? (num + 1) / -2 : num / 2; // zigzag encoding\n    }\n\n    readBoolean() {\n        return Boolean(this.readVarint());\n    }\n\n    readString() {\n        const end = this.readVarint() + this.pos;\n        const pos = this.pos;\n        this.pos = end;\n\n        if (end - pos >= TEXT_DECODER_MIN_LENGTH && utf8TextDecoder) {\n            // longer strings are fast with the built-in browser TextDecoder API\n            return utf8TextDecoder.decode(this.buf.subarray(pos, end));\n        }\n        // short strings are fast with our custom implementation\n        return readUtf8(this.buf, pos, end);\n    }\n\n    readBytes() {\n        const end = this.readVarint() + this.pos,\n            buffer = this.buf.subarray(this.pos, end);\n        this.pos = end;\n        return buffer;\n    }\n\n    // verbose for performance reasons; doesn't affect gzipped size\n\n    /**\n     * @param {number[]} [arr]\n     * @param {boolean} [isSigned]\n     */\n    readPackedVarint(arr = [], isSigned) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readVarint(isSigned));\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedSVarint(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readSVarint());\n        return arr;\n    }\n    /** @param {boolean[]} [arr] */\n    readPackedBoolean(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readBoolean());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedFloat(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readFloat());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedDouble(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readDouble());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedFixed32(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readFixed32());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedSFixed32(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readSFixed32());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedFixed64(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readFixed64());\n        return arr;\n    }\n    /** @param {number[]} [arr] */\n    readPackedSFixed64(arr = []) {\n        const end = this.readPackedEnd();\n        while (this.pos < end) arr.push(this.readSFixed64());\n        return arr;\n    }\n    readPackedEnd() {\n        return this.type === PBF_BYTES ? this.readVarint() + this.pos : this.pos + 1;\n    }\n\n    /** @param {number} val */\n    skip(val) {\n        const type = val & 0x7;\n        if (type === PBF_VARINT) while (this.buf[this.pos++] > 0x7f) {}\n        else if (type === PBF_BYTES) this.pos = this.readVarint() + this.pos;\n        else if (type === PBF_FIXED32) this.pos += 4;\n        else if (type === PBF_FIXED64) this.pos += 8;\n        else throw new Error(`Unimplemented type: ${type}`);\n    }\n\n    // === WRITING =================================================================\n\n    /**\n     * @param {number} tag\n     * @param {number} type\n     */\n    writeTag(tag, type) {\n        this.writeVarint((tag << 3) | type);\n    }\n\n    /** @param {number} min */\n    realloc(min) {\n        let length = this.length || 16;\n\n        while (length < this.pos + min) length *= 2;\n\n        if (length !== this.length) {\n            const buf = new Uint8Array(length);\n            buf.set(this.buf);\n            this.buf = buf;\n            this.dataView = new DataView(buf.buffer);\n            this.length = length;\n        }\n    }\n\n    finish() {\n        this.length = this.pos;\n        this.pos = 0;\n        return this.buf.subarray(0, this.length);\n    }\n\n    /** @param {number} val */\n    writeFixed32(val) {\n        this.realloc(4);\n        this.dataView.setInt32(this.pos, val, true);\n        this.pos += 4;\n    }\n\n    /** @param {number} val */\n    writeSFixed32(val) {\n        this.realloc(4);\n        this.dataView.setInt32(this.pos, val, true);\n        this.pos += 4;\n    }\n\n    /** @param {number} val */\n    writeFixed64(val) {\n        this.realloc(8);\n        this.dataView.setInt32(this.pos, val & -1, true);\n        this.dataView.setInt32(this.pos + 4, Math.floor(val * SHIFT_RIGHT_32), true);\n        this.pos += 8;\n    }\n\n    /** @param {number} val */\n    writeSFixed64(val) {\n        this.realloc(8);\n        this.dataView.setInt32(this.pos, val & -1, true);\n        this.dataView.setInt32(this.pos + 4, Math.floor(val * SHIFT_RIGHT_32), true);\n        this.pos += 8;\n    }\n\n    /** @param {number} val */\n    writeVarint(val) {\n        val = +val || 0;\n\n        if (val > 0xfffffff || val < 0) {\n            writeBigVarint(val, this);\n            return;\n        }\n\n        this.realloc(4);\n\n        this.buf[this.pos++] =           val & 0x7f  | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] =   (val >>> 7) & 0x7f;\n    }\n\n    /** @param {number} val */\n    writeSVarint(val) {\n        this.writeVarint(val < 0 ? -val * 2 - 1 : val * 2);\n    }\n\n    /** @param {boolean} val */\n    writeBoolean(val) {\n        this.writeVarint(+val);\n    }\n\n    /** @param {string} str */\n    writeString(str) {\n        str = String(str);\n        this.realloc(str.length * 4);\n\n        this.pos++; // reserve 1 byte for short string length\n\n        const startPos = this.pos;\n        // write the string directly to the buffer and see how much was written\n        this.pos = writeUtf8(this.buf, str, this.pos);\n        const len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    }\n\n    /** @param {number} val */\n    writeFloat(val) {\n        this.realloc(4);\n        this.dataView.setFloat32(this.pos, val, true);\n        this.pos += 4;\n    }\n\n    /** @param {number} val */\n    writeDouble(val) {\n        this.realloc(8);\n        this.dataView.setFloat64(this.pos, val, true);\n        this.pos += 8;\n    }\n\n    /** @param {Uint8Array} buffer */\n    writeBytes(buffer) {\n        const len = buffer.length;\n        this.writeVarint(len);\n        this.realloc(len);\n        for (let i = 0; i < len; i++) this.buf[this.pos++] = buffer[i];\n    }\n\n    /**\n     * @template T\n     * @param {(obj: T, pbf: Pbf) => void} fn\n     * @param {T} obj\n     */\n    writeRawMessage(fn, obj) {\n        this.pos++; // reserve 1 byte for short message length\n\n        // write the message directly to the buffer and see how much was written\n        const startPos = this.pos;\n        fn(obj, this);\n        const len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    }\n\n    /**\n     * @template T\n     * @param {number} tag\n     * @param {(obj: T, pbf: Pbf) => void} fn\n     * @param {T} obj\n     */\n    writeMessage(tag, fn, obj) {\n        this.writeTag(tag, PBF_BYTES);\n        this.writeRawMessage(fn, obj);\n    }\n\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedVarint(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedVarint, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedSVarint(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedSVarint, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {boolean[]} arr\n     */\n    writePackedBoolean(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedBoolean, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedFloat(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedFloat, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedDouble(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedDouble, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedFixed32(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedFixed32, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedSFixed32(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedSFixed32, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedFixed64(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedFixed64, arr);\n    }\n    /**\n     * @param {number} tag\n     * @param {number[]} arr\n     */\n    writePackedSFixed64(tag, arr) {\n        if (arr.length) this.writeMessage(tag, writePackedSFixed64, arr);\n    }\n\n    /**\n     * @param {number} tag\n     * @param {Uint8Array} buffer\n     */\n    writeBytesField(tag, buffer) {\n        this.writeTag(tag, PBF_BYTES);\n        this.writeBytes(buffer);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeFixed32Field(tag, val) {\n        this.writeTag(tag, PBF_FIXED32);\n        this.writeFixed32(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeSFixed32Field(tag, val) {\n        this.writeTag(tag, PBF_FIXED32);\n        this.writeSFixed32(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeFixed64Field(tag, val) {\n        this.writeTag(tag, PBF_FIXED64);\n        this.writeFixed64(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeSFixed64Field(tag, val) {\n        this.writeTag(tag, PBF_FIXED64);\n        this.writeSFixed64(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeVarintField(tag, val) {\n        this.writeTag(tag, PBF_VARINT);\n        this.writeVarint(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeSVarintField(tag, val) {\n        this.writeTag(tag, PBF_VARINT);\n        this.writeSVarint(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {string} str\n     */\n    writeStringField(tag, str) {\n        this.writeTag(tag, PBF_BYTES);\n        this.writeString(str);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeFloatField(tag, val) {\n        this.writeTag(tag, PBF_FIXED32);\n        this.writeFloat(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {number} val\n     */\n    writeDoubleField(tag, val) {\n        this.writeTag(tag, PBF_FIXED64);\n        this.writeDouble(val);\n    }\n    /**\n     * @param {number} tag\n     * @param {boolean} val\n     */\n    writeBooleanField(tag, val) {\n        this.writeVarintField(tag, +val);\n    }\n};\n\n/**\n * @param {number} l\n * @param {boolean | undefined} s\n * @param {Pbf} p\n */\nfunction readVarintRemainder(l, s, p) {\n    const buf = p.buf;\n    let h, b;\n\n    b = buf[p.pos++]; h  = (b & 0x70) >> 4;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 3;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 10; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 17; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 24; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x01) << 31; if (b < 0x80) return toNum(l, h, s);\n\n    throw new Error('Expected varint not more than 10 bytes');\n}\n\n/**\n * @param {number} low\n * @param {number} high\n * @param {boolean} [isSigned]\n */\nfunction toNum(low, high, isSigned) {\n    return isSigned ? high * 0x100000000 + (low >>> 0) : ((high >>> 0) * 0x100000000) + (low >>> 0);\n}\n\n/**\n * @param {number} val\n * @param {Pbf} pbf\n */\nfunction writeBigVarint(val, pbf) {\n    let low, high;\n\n    if (val >= 0) {\n        low  = (val % 0x100000000) | 0;\n        high = (val / 0x100000000) | 0;\n    } else {\n        low  = ~(-val % 0x100000000);\n        high = ~(-val / 0x100000000);\n\n        if (low ^ 0xffffffff) {\n            low = (low + 1) | 0;\n        } else {\n            low = 0;\n            high = (high + 1) | 0;\n        }\n    }\n\n    if (val >= 0x10000000000000000 || val < -0x10000000000000000) {\n        throw new Error('Given varint doesn\\'t fit into 10 bytes');\n    }\n\n    pbf.realloc(10);\n\n    writeBigVarintLow(low, high, pbf);\n    writeBigVarintHigh(high, pbf);\n}\n\n/**\n * @param {number} high\n * @param {number} low\n * @param {Pbf} pbf\n */\nfunction writeBigVarintLow(low, high, pbf) {\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos]   = low & 0x7f;\n}\n\n/**\n * @param {number} high\n * @param {Pbf} pbf\n */\nfunction writeBigVarintHigh(high, pbf) {\n    const lsb = (high & 0x07) << 4;\n\n    pbf.buf[pbf.pos++] |= lsb         | ((high >>>= 3) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f;\n}\n\n/**\n * @param {number} startPos\n * @param {number} len\n * @param {Pbf} pbf\n */\nfunction makeRoomForExtraLength(startPos, len, pbf) {\n    const extraLen =\n        len <= 0x3fff ? 1 :\n        len <= 0x1fffff ? 2 :\n        len <= 0xfffffff ? 3 : Math.floor(Math.log(len) / (Math.LN2 * 7));\n\n    // if 1 byte isn't enough for encoding message length, shift the data to the right\n    pbf.realloc(extraLen);\n    for (let i = pbf.pos - 1; i >= startPos; i--) pbf.buf[i + extraLen] = pbf.buf[i];\n}\n\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedVarint(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeVarint(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedSVarint(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeSVarint(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedFloat(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeFloat(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedDouble(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeDouble(arr[i]);\n}\n/**\n * @param {boolean[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedBoolean(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeBoolean(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedFixed32(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeFixed32(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedSFixed32(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeSFixed32(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedFixed64(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeFixed64(arr[i]);\n}\n/**\n * @param {number[]} arr\n * @param {Pbf} pbf\n */\nfunction writePackedSFixed64(arr, pbf) {\n    for (let i = 0; i < arr.length; i++) pbf.writeSFixed64(arr[i]);\n}\n\n// Buffer code below from https://github.com/feross/buffer, MIT-licensed\n\n/**\n * @param {Uint8Array} buf\n * @param {number} pos\n * @param {number} end\n */\nfunction readUtf8(buf, pos, end) {\n    let str = '';\n    let i = pos;\n\n    while (i < end) {\n        const b0 = buf[i];\n        let c = null; // codepoint\n        let bytesPerSequence =\n            b0 > 0xEF ? 4 :\n            b0 > 0xDF ? 3 :\n            b0 > 0xBF ? 2 : 1;\n\n        if (i + bytesPerSequence > end) break;\n\n        let b1, b2, b3;\n\n        if (bytesPerSequence === 1) {\n            if (b0 < 0x80) {\n                c = b0;\n            }\n        } else if (bytesPerSequence === 2) {\n            b1 = buf[i + 1];\n            if ((b1 & 0xC0) === 0x80) {\n                c = (b0 & 0x1F) << 0x6 | (b1 & 0x3F);\n                if (c <= 0x7F) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 3) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0xC | (b1 & 0x3F) << 0x6 | (b2 & 0x3F);\n                if (c <= 0x7FF || (c >= 0xD800 && c <= 0xDFFF)) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 4) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            b3 = buf[i + 3];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80 && (b3 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0x12 | (b1 & 0x3F) << 0xC | (b2 & 0x3F) << 0x6 | (b3 & 0x3F);\n                if (c <= 0xFFFF || c >= 0x110000) {\n                    c = null;\n                }\n            }\n        }\n\n        if (c === null) {\n            c = 0xFFFD;\n            bytesPerSequence = 1;\n\n        } else if (c > 0xFFFF) {\n            c -= 0x10000;\n            str += String.fromCharCode(c >>> 10 & 0x3FF | 0xD800);\n            c = 0xDC00 | c & 0x3FF;\n        }\n\n        str += String.fromCharCode(c);\n        i += bytesPerSequence;\n    }\n\n    return str;\n}\n\n/**\n * @param {Uint8Array} buf\n * @param {string} str\n * @param {number} pos\n */\nfunction writeUtf8(buf, str, pos) {\n    for (let i = 0, c, lead; i < str.length; i++) {\n        c = str.charCodeAt(i); // code point\n\n        if (c > 0xD7FF && c < 0xE000) {\n            if (lead) {\n                if (c < 0xDC00) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                    lead = c;\n                    continue;\n                } else {\n                    c = lead - 0xD800 << 10 | c - 0xDC00 | 0x10000;\n                    lead = null;\n                }\n            } else {\n                if (c > 0xDBFF || (i + 1 === str.length)) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                } else {\n                    lead = c;\n                }\n                continue;\n            }\n        } else if (lead) {\n            buf[pos++] = 0xEF;\n            buf[pos++] = 0xBF;\n            buf[pos++] = 0xBD;\n            lead = null;\n        }\n\n        if (c < 0x80) {\n            buf[pos++] = c;\n        } else {\n            if (c < 0x800) {\n                buf[pos++] = c >> 0x6 | 0xC0;\n            } else {\n                if (c < 0x10000) {\n                    buf[pos++] = c >> 0xC | 0xE0;\n                } else {\n                    buf[pos++] = c >> 0x12 | 0xF0;\n                    buf[pos++] = c >> 0xC & 0x3F | 0x80;\n                }\n                buf[pos++] = c >> 0x6 & 0x3F | 0x80;\n            }\n            buf[pos++] = c & 0x3F | 0x80;\n        }\n    }\n    return pos;\n}\n", "/**\n * @module ol/format/Feature\n */\nimport Feature from '../Feature.js';\nimport {\n  linearRingsAreOriented,\n  linearRingssAreOriented,\n  orientLinearRings,\n  orientLinearRingsArray,\n} from '../geom/flat/orient.js';\nimport {\n  GeometryCollection,\n  LineString,\n  MultiLineString,\n  MultiPoint,\n  MultiPolygon,\n  Point,\n  Polygon,\n} from '../geom.js';\nimport {\n  equivalent as equivalentProjection,\n  get as getProjection,\n  getTransform,\n  transformExtent,\n} from '../proj.js';\nimport RenderFeature from '../render/Feature.js';\nimport {abstract} from '../util.js';\n\n/**\n * @typedef {Object} ReadOptions\n * @property {import(\"../proj.js\").ProjectionLike} [dataProjection] Projection of the data we are reading.\n * If not provided, the projection will be derived from the data (where possible) or\n * the `dataProjection` of the format is assigned (where set). If the projection\n * can not be derived from the data and if no `dataProjection` is set for a format,\n * the features will not be reprojected.\n * @property {import(\"../extent.js\").Extent} [extent] Tile extent in map units of the tile being read.\n * This is only required when reading data with tile pixels as geometry units. When configured,\n * a `dataProjection` with `TILE_PIXELS` as `units` and the tile's pixel extent as `extent` needs to be\n * provided.\n * @property {import(\"../proj.js\").ProjectionLike} [featureProjection] Projection of the feature geometries\n * created by the format reader. If not provided, features will be returned in the\n * `dataProjection`.\n */\n\n/**\n * @typedef {Object} WriteOptions\n * @property {import(\"../proj.js\").ProjectionLike} [dataProjection] Projection of the data we are writing.\n * If not provided, the `dataProjection` of the format is assigned (where set).\n * If no `dataProjection` is set for a format, the features will be returned\n * in the `featureProjection`.\n * @property {import(\"../proj.js\").ProjectionLike} [featureProjection] Projection of the feature geometries\n * that will be serialized by the format writer. If not provided, geometries are assumed\n * to be in the `dataProjection` if that is set; in other words, they are not transformed.\n * @property {boolean} [rightHanded] When writing geometries, follow the right-hand\n * rule for linear ring orientation.  This means that polygons will have counter-clockwise\n * exterior rings and clockwise interior rings.  By default, coordinates are serialized\n * as they are provided at construction.  If `true`, the right-hand rule will\n * be applied.  If `false`, the left-hand rule will be applied (clockwise for\n * exterior and counter-clockwise for interior rings).  Note that not all\n * formats support this.  The GeoJSON format does use this property when writing\n * geometries.\n * @property {number} [decimals] Maximum number of decimal places for coordinates.\n * Coordinates are stored internally as floats, but floating-point arithmetic can create\n * coordinates with a large number of decimal places, not generally wanted on output.\n * Set a number here to round coordinates. Can also be used to ensure that\n * coordinates read in can be written back out with the same number of decimals.\n * Default is no rounding.\n */\n\n/**\n * @typedef {'arraybuffer' | 'json' | 'text' | 'xml'} Type\n */\n\n/**\n * @typedef {Object} SimpleGeometryObject\n * @property {import('../geom/Geometry.js').Type} type Type.\n * @property {Array<number>} flatCoordinates Flat coordinates.\n * @property {Array<number>|Array<Array<number>>} [ends] Ends or endss.\n * @property {import('../geom/Geometry.js').GeometryLayout} [layout] Layout.\n */\n\n/**\n * @typedef {Array<GeometryObject>} GeometryCollectionObject\n */\n\n/**\n * @typedef {SimpleGeometryObject|GeometryCollectionObject} GeometryObject\n */\n\n/**\n * @typedef {Object} FeatureObject\n * @property {string|number} [id] Id.\n * @property {GeometryObject} [geometry] Geometry.\n * @property {Object<string, *>} [properties] Properties.\n */\n\n/***\n * @template {import('../Feature.js').FeatureLike} T\n * @typedef {T extends RenderFeature ? typeof RenderFeature : typeof Feature} FeatureToFeatureClass\n */\n\n/***\n * @template {import(\"../Feature.js\").FeatureClass} T\n * @typedef {T[keyof T] extends RenderFeature ? RenderFeature : Feature} FeatureClassToFeature\n */\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for feature formats.\n * {@link module:ol/format/Feature~FeatureFormat} subclasses provide the ability to decode and encode\n * {@link module:ol/Feature~Feature} objects from a variety of commonly used geospatial\n * file formats.  See the documentation for each format for more details.\n *\n * @template {import('../Feature.js').FeatureLike} [FeatureType=import(\"../Feature.js\").default]\n * @abstract\n * @api\n */\nclass FeatureFormat {\n  constructor() {\n    /**\n     * @protected\n     * @type {import(\"../proj/Projection.js\").default|undefined}\n     */\n    this.dataProjection = undefined;\n\n    /**\n     * @protected\n     * @type {import(\"../proj/Projection.js\").default|undefined}\n     */\n    this.defaultFeatureProjection = undefined;\n\n    /**\n     * @protected\n     * @type {FeatureToFeatureClass<FeatureType>}\n     */\n    this.featureClass = /** @type {FeatureToFeatureClass<FeatureType>} */ (\n      Feature\n    );\n\n    /**\n     * A list media types supported by the format in descending order of preference.\n     * @type {Array<string>}\n     */\n    this.supportedMediaTypes = null;\n  }\n\n  /**\n   * Adds the data projection to the read options.\n   * @param {Document|Element|Object|string} source Source.\n   * @param {ReadOptions} [options] Options.\n   * @return {ReadOptions|undefined} Options.\n   * @protected\n   */\n  getReadOptions(source, options) {\n    if (options) {\n      let dataProjection = options.dataProjection\n        ? getProjection(options.dataProjection)\n        : this.readProjection(source);\n      if (\n        options.extent &&\n        dataProjection &&\n        dataProjection.getUnits() === 'tile-pixels'\n      ) {\n        dataProjection = getProjection(dataProjection);\n        dataProjection.setWorldExtent(options.extent);\n      }\n      options = {\n        dataProjection: dataProjection,\n        featureProjection: options.featureProjection,\n      };\n    }\n    return this.adaptOptions(options);\n  }\n\n  /**\n   * Sets the `dataProjection` on the options, if no `dataProjection`\n   * is set.\n   * @param {WriteOptions|ReadOptions|undefined} options\n   *     Options.\n   * @protected\n   * @return {WriteOptions|ReadOptions|undefined}\n   *     Updated options.\n   */\n  adaptOptions(options) {\n    return Object.assign(\n      {\n        dataProjection: this.dataProjection,\n        featureProjection: this.defaultFeatureProjection,\n        featureClass: this.featureClass,\n      },\n      options,\n    );\n  }\n\n  /**\n   * @abstract\n   * @return {Type} The format type.\n   */\n  getType() {\n    return abstract();\n  }\n\n  /**\n   * Read a single feature from a source.\n   *\n   * @abstract\n   * @param {Document|Element|Object|string} source Source.\n   * @param {ReadOptions} [options] Read options.\n   * @return {FeatureType|Array<FeatureType>} Feature.\n   */\n  readFeature(source, options) {\n    return abstract();\n  }\n\n  /**\n   * Read all features from a source.\n   *\n   * @abstract\n   * @param {Document|Element|ArrayBuffer|Object|string} source Source.\n   * @param {ReadOptions} [options] Read options.\n   * @return {Array<FeatureType>} Features.\n   */\n  readFeatures(source, options) {\n    return abstract();\n  }\n\n  /**\n   * Read a single geometry from a source.\n   *\n   * @abstract\n   * @param {Document|Element|Object|string} source Source.\n   * @param {ReadOptions} [options] Read options.\n   * @return {import(\"../geom/Geometry.js\").default} Geometry.\n   */\n  readGeometry(source, options) {\n    return abstract();\n  }\n\n  /**\n   * Read the projection from a source.\n   *\n   * @abstract\n   * @param {Document|Element|Object|string} source Source.\n   * @return {import(\"../proj/Projection.js\").default|undefined} Projection.\n   */\n  readProjection(source) {\n    return abstract();\n  }\n\n  /**\n   * Encode a feature in this format.\n   *\n   * @abstract\n   * @param {Feature} feature Feature.\n   * @param {WriteOptions} [options] Write options.\n   * @return {string|ArrayBuffer} Result.\n   */\n  writeFeature(feature, options) {\n    return abstract();\n  }\n\n  /**\n   * Encode an array of features in this format.\n   *\n   * @abstract\n   * @param {Array<Feature>} features Features.\n   * @param {WriteOptions} [options] Write options.\n   * @return {string|ArrayBuffer} Result.\n   */\n  writeFeatures(features, options) {\n    return abstract();\n  }\n\n  /**\n   * Write a single geometry in this format.\n   *\n   * @abstract\n   * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n   * @param {WriteOptions} [options] Write options.\n   * @return {string|ArrayBuffer} Result.\n   */\n  writeGeometry(geometry, options) {\n    return abstract();\n  }\n}\n\nexport default FeatureFormat;\n\n/**\n * @template {import(\"../geom/Geometry.js\").default|RenderFeature} T\n * @param {T} geometry Geometry.\n * @param {boolean} write Set to true for writing, false for reading.\n * @param {WriteOptions|ReadOptions} [options] Options.\n * @return {T} Transformed geometry.\n */\nexport function transformGeometryWithOptions(geometry, write, options) {\n  const featureProjection = options\n    ? getProjection(options.featureProjection)\n    : null;\n  const dataProjection = options ? getProjection(options.dataProjection) : null;\n\n  let transformed = geometry;\n  if (\n    featureProjection &&\n    dataProjection &&\n    !equivalentProjection(featureProjection, dataProjection)\n  ) {\n    if (write) {\n      transformed = /** @type {T} */ (geometry.clone());\n    }\n    const fromProjection = write ? featureProjection : dataProjection;\n    const toProjection = write ? dataProjection : featureProjection;\n    if (fromProjection.getUnits() === 'tile-pixels') {\n      transformed.transform(fromProjection, toProjection);\n    } else {\n      transformed.applyTransform(getTransform(fromProjection, toProjection));\n    }\n  }\n  if (\n    write &&\n    options &&\n    /** @type {WriteOptions} */ (options).decimals !== undefined\n  ) {\n    const power = Math.pow(10, /** @type {WriteOptions} */ (options).decimals);\n    // if decimals option on write, round each coordinate appropriately\n    /**\n     * @param {Array<number>} coordinates Coordinates.\n     * @return {Array<number>} Transformed coordinates.\n     */\n    const transform = function (coordinates) {\n      for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n        coordinates[i] = Math.round(coordinates[i] * power) / power;\n      }\n      return coordinates;\n    };\n    if (transformed === geometry) {\n      transformed = /** @type {T} */ (geometry.clone());\n    }\n    transformed.applyTransform(transform);\n  }\n  return transformed;\n}\n\n/**\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {ReadOptions} [options] Read options.\n * @return {import(\"../extent.js\").Extent} Transformed extent.\n */\nexport function transformExtentWithOptions(extent, options) {\n  const featureProjection = options\n    ? getProjection(options.featureProjection)\n    : null;\n  const dataProjection = options ? getProjection(options.dataProjection) : null;\n\n  if (\n    featureProjection &&\n    dataProjection &&\n    !equivalentProjection(featureProjection, dataProjection)\n  ) {\n    return transformExtent(extent, dataProjection, featureProjection);\n  }\n  return extent;\n}\n\nconst GeometryConstructor = {\n  Point: Point,\n  LineString: LineString,\n  Polygon: Polygon,\n  MultiPoint: MultiPoint,\n  MultiLineString: MultiLineString,\n  MultiPolygon: MultiPolygon,\n};\n\nfunction orientFlatCoordinates(flatCoordinates, ends, stride) {\n  if (Array.isArray(ends[0])) {\n    // MultiPolagon\n    if (!linearRingssAreOriented(flatCoordinates, 0, ends, stride)) {\n      flatCoordinates = flatCoordinates.slice();\n      orientLinearRingsArray(flatCoordinates, 0, ends, stride);\n    }\n    return flatCoordinates;\n  }\n  if (!linearRingsAreOriented(flatCoordinates, 0, ends, stride)) {\n    flatCoordinates = flatCoordinates.slice();\n    orientLinearRings(flatCoordinates, 0, ends, stride);\n  }\n  return flatCoordinates;\n}\n\n/**\n * @param {FeatureObject} object Feature object.\n * @param {WriteOptions|ReadOptions} [options] Options.\n * @return {RenderFeature|Array<RenderFeature>} Render feature.\n */\nexport function createRenderFeature(object, options) {\n  const geometry = object.geometry;\n  if (!geometry) {\n    return [];\n  }\n  if (Array.isArray(geometry)) {\n    return geometry\n      .map((geometry) => createRenderFeature({...object, geometry}))\n      .flat();\n  }\n\n  const geometryType =\n    geometry.type === 'MultiPolygon' ? 'Polygon' : geometry.type;\n  if (geometryType === 'GeometryCollection' || geometryType === 'Circle') {\n    throw new Error('Unsupported geometry type: ' + geometryType);\n  }\n\n  const stride = geometry.layout.length;\n  return transformGeometryWithOptions(\n    new RenderFeature(\n      geometryType,\n      geometryType === 'Polygon'\n        ? orientFlatCoordinates(geometry.flatCoordinates, geometry.ends, stride)\n        : geometry.flatCoordinates,\n      geometry.ends?.flat(),\n      stride,\n      object.properties || {},\n      object.id,\n    ).enableSimplifyTransformed(),\n    false,\n    options,\n  );\n}\n\n/**\n * @param {GeometryObject|null} object Geometry object.\n * @param {WriteOptions|ReadOptions} [options] Options.\n * @return {import(\"../geom/Geometry.js\").default} Geometry.\n */\nexport function createGeometry(object, options) {\n  if (!object) {\n    return null;\n  }\n  if (Array.isArray(object)) {\n    const geometries = object.map((geometry) =>\n      createGeometry(geometry, options),\n    );\n    return new GeometryCollection(geometries);\n  }\n  const Geometry = GeometryConstructor[object.type];\n  return transformGeometryWithOptions(\n    new Geometry(object.flatCoordinates, object.layout || 'XY', object.ends),\n    false,\n    options,\n  );\n}\n", "/**\n * @module ol/format/MVT\n */\n//FIXME Implement projection handling\n\nimport PBF from 'pbf';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {inflateEnds} from '../geom/flat/orient.js';\nimport Projection from '../proj/Projection.js';\nimport {get} from '../proj.js';\nimport RenderFeature from '../render/Feature.js';\nimport FeatureFormat, {transformGeometryWithOptions} from './Feature.js';\n\n/**\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=import(\"../render/Feature.js\").default]\n * @typedef {Object} Options\n * @property {import('./Feature.js').FeatureToFeatureClass<FeatureType>} [featureClass] Class for features returned by\n * {@link module:ol/format/MVT~MVT#readFeatures}. Set to {@link module:ol/Feature~Feature} to get full editing and geometry\n * support at the cost of decreased rendering performance. The default is\n * {@link module:ol/render/Feature~RenderFeature}, which is optimized for rendering and hit detection.\n * @property {string} [geometryName='geometry'] Geometry name to use when creating features.\n * @property {string} [layerName='layer'] Name of the feature attribute that holds the layer name.\n * @property {Array<string>} [layers] Layers to read features from. If not provided, features will be read from all\n * @property {string} [idProperty] Optional property that will be assigned as the feature id and removed from the properties.\n * layers.\n */\n\n/**\n * @classdesc\n * Feature format for reading data in the Mapbox MVT format.\n *\n * @template {import('../Feature.js').FeatureLike} [FeatureType=RenderFeature]\n * @extends {FeatureFormat<FeatureType>}\n * @api\n */\nclass MVT extends FeatureFormat {\n  /**\n   * @param {Options<FeatureType>} [options] Options.\n   */\n  constructor(options) {\n    super();\n\n    options = options ? options : {};\n\n    /**\n     * @type {Projection}\n     */\n    this.dataProjection = new Projection({\n      code: '',\n      units: 'tile-pixels',\n    });\n\n    this.featureClass = options.featureClass\n      ? options.featureClass\n      : /** @type {import('./Feature.js').FeatureToFeatureClass<FeatureType>} */ (\n          RenderFeature\n        );\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.geometryName_ = options.geometryName;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.layerName_ = options.layerName ? options.layerName : 'layer';\n\n    /**\n     * @private\n     * @type {Array<string>|null}\n     */\n    this.layers_ = options.layers ? options.layers : null;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.idProperty_ = options.idProperty;\n\n    this.supportedMediaTypes = [\n      'application/vnd.mapbox-vector-tile',\n      'application/x-protobuf',\n    ];\n  }\n\n  /**\n   * Read the raw geometry from the pbf offset stored in a raw feature's geometry\n   * property.\n   * @param {PBF} pbf PBF.\n   * @param {Object} feature Raw feature.\n   * @param {Array<number>} flatCoordinates Array to store flat coordinates in.\n   * @param {Array<number>} ends Array to store ends in.\n   * @private\n   */\n  readRawGeometry_(pbf, feature, flatCoordinates, ends) {\n    pbf.pos = feature.geometry;\n\n    const end = pbf.readVarint() + pbf.pos;\n    let cmd = 1;\n    let length = 0;\n    let x = 0;\n    let y = 0;\n    let coordsLen = 0;\n    let currentEnd = 0;\n\n    while (pbf.pos < end) {\n      if (!length) {\n        const cmdLen = pbf.readVarint();\n        cmd = cmdLen & 0x7;\n        length = cmdLen >> 3;\n      }\n\n      length--;\n\n      if (cmd === 1 || cmd === 2) {\n        x += pbf.readSVarint();\n        y += pbf.readSVarint();\n\n        if (cmd === 1) {\n          // moveTo\n          if (coordsLen > currentEnd) {\n            ends.push(coordsLen);\n            currentEnd = coordsLen;\n          }\n        }\n\n        flatCoordinates.push(x, y);\n        coordsLen += 2;\n      } else if (cmd === 7) {\n        if (coordsLen > currentEnd) {\n          // close polygon\n          flatCoordinates.push(\n            flatCoordinates[currentEnd],\n            flatCoordinates[currentEnd + 1],\n          );\n          coordsLen += 2;\n        }\n      } else {\n        throw new Error('Invalid command found in the PBF');\n      }\n    }\n\n    if (coordsLen > currentEnd) {\n      ends.push(coordsLen);\n      currentEnd = coordsLen;\n    }\n  }\n\n  /**\n   * @private\n   * @param {PBF} pbf PBF\n   * @param {Object} rawFeature Raw Mapbox feature.\n   * @param {import(\"./Feature.js\").ReadOptions} options Read options.\n   * @return {FeatureType|null} Feature.\n   */\n  createFeature_(pbf, rawFeature, options) {\n    const type = rawFeature.type;\n    if (type === 0) {\n      return null;\n    }\n\n    let feature;\n    const values = rawFeature.properties;\n\n    let id;\n    if (!this.idProperty_) {\n      id = rawFeature.id;\n    } else {\n      id = values[this.idProperty_];\n      delete values[this.idProperty_];\n    }\n\n    values[this.layerName_] = rawFeature.layer.name;\n\n    const flatCoordinates = /** @type {Array<number>} */ ([]);\n    const ends = /** @type {Array<number>} */ ([]);\n    this.readRawGeometry_(pbf, rawFeature, flatCoordinates, ends);\n\n    const geometryType = getGeometryType(type, ends.length);\n\n    if (this.featureClass === RenderFeature) {\n      feature =\n        new /** @type {import('./Feature.js').FeatureToFeatureClass<RenderFeature>} */ (\n          this.featureClass\n        )(geometryType, flatCoordinates, ends, 2, values, id);\n      feature.transform(options.dataProjection);\n    } else {\n      let geom;\n      if (geometryType == 'Polygon') {\n        const endss = inflateEnds(flatCoordinates, ends);\n        geom =\n          endss.length > 1\n            ? new MultiPolygon(flatCoordinates, 'XY', endss)\n            : new Polygon(flatCoordinates, 'XY', ends);\n      } else {\n        geom =\n          geometryType === 'Point'\n            ? new Point(flatCoordinates, 'XY')\n            : geometryType === 'LineString'\n              ? new LineString(flatCoordinates, 'XY')\n              : geometryType === 'MultiPoint'\n                ? new MultiPoint(flatCoordinates, 'XY')\n                : geometryType === 'MultiLineString'\n                  ? new MultiLineString(flatCoordinates, 'XY', ends)\n                  : null;\n      }\n      const ctor = /** @type {typeof import(\"../Feature.js\").default} */ (\n        this.featureClass\n      );\n      feature = new ctor();\n      if (this.geometryName_) {\n        feature.setGeometryName(this.geometryName_);\n      }\n      const geometry = transformGeometryWithOptions(geom, false, options);\n      feature.setGeometry(geometry);\n      if (id !== undefined) {\n        feature.setId(id);\n      }\n      feature.setProperties(values, true);\n    }\n\n    return /** @type {FeatureType} */ (feature);\n  }\n\n  /**\n   * @return {import(\"./Feature.js\").Type} Format.\n   * @override\n   */\n  getType() {\n    return 'arraybuffer';\n  }\n\n  /**\n   * Read all features.\n   *\n   * @param {ArrayBuffer} source Source.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @return {Array<FeatureType>} Features.\n   * @api\n   * @override\n   */\n  readFeatures(source, options) {\n    const layers = this.layers_;\n    options = this.adaptOptions(options);\n    const dataProjection = get(options.dataProjection);\n    dataProjection.setWorldExtent(options.extent);\n    options.dataProjection = dataProjection;\n\n    const pbf = new PBF(/** @type {ArrayBuffer} */ (source));\n    const pbfLayers = pbf.readFields(layersPBFReader, {});\n    const features = [];\n    for (const name in pbfLayers) {\n      if (layers && !layers.includes(name)) {\n        continue;\n      }\n      const pbfLayer = pbfLayers[name];\n\n      const extent = pbfLayer ? [0, 0, pbfLayer.extent, pbfLayer.extent] : null;\n      dataProjection.setExtent(extent);\n\n      for (let i = 0, ii = pbfLayer.length; i < ii; ++i) {\n        const rawFeature = readRawFeature(pbf, pbfLayer, i);\n        const feature = this.createFeature_(pbf, rawFeature, options);\n        if (feature !== null) {\n          features.push(feature);\n        }\n      }\n    }\n\n    return /** @type {Array<FeatureType>} */ (features);\n  }\n\n  /**\n   * Read the projection from the source.\n   *\n   * @param {Document|Element|Object|string} source Source.\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   * @api\n   * @override\n   */\n  readProjection(source) {\n    return this.dataProjection;\n  }\n\n  /**\n   * Sets the layers that features will be read from.\n   * @param {Array<string>} layers Layers.\n   * @api\n   */\n  setLayers(layers) {\n    this.layers_ = layers;\n  }\n}\n\n/**\n * Reader callback for parsing layers.\n * @param {number} tag The tag.\n * @param {Object} layers The layers object.\n * @param {PBF} pbf The PBF.\n */\nfunction layersPBFReader(tag, layers, pbf) {\n  if (tag === 3) {\n    const layer = {\n      keys: [],\n      values: [],\n      features: [],\n    };\n    const end = pbf.readVarint() + pbf.pos;\n    pbf.readFields(layerPBFReader, layer, end);\n    layer.length = layer.features.length;\n    if (layer.length) {\n      layers[layer.name] = layer;\n    }\n  }\n}\n\n/**\n * Reader callback for parsing layer.\n * @param {number} tag The tag.\n * @param {Object} layer The layer object.\n * @param {PBF} pbf The PBF.\n */\nfunction layerPBFReader(tag, layer, pbf) {\n  if (tag === 15) {\n    layer.version = pbf.readVarint();\n  } else if (tag === 1) {\n    layer.name = pbf.readString();\n  } else if (tag === 5) {\n    layer.extent = pbf.readVarint();\n  } else if (tag === 2) {\n    layer.features.push(pbf.pos);\n  } else if (tag === 3) {\n    layer.keys.push(pbf.readString());\n  } else if (tag === 4) {\n    let value = null;\n    const end = pbf.readVarint() + pbf.pos;\n    while (pbf.pos < end) {\n      tag = pbf.readVarint() >> 3;\n      value =\n        tag === 1\n          ? pbf.readString()\n          : tag === 2\n            ? pbf.readFloat()\n            : tag === 3\n              ? pbf.readDouble()\n              : tag === 4\n                ? pbf.readVarint64()\n                : tag === 5\n                  ? pbf.readVarint()\n                  : tag === 6\n                    ? pbf.readSVarint()\n                    : tag === 7\n                      ? pbf.readBoolean()\n                      : null;\n    }\n    layer.values.push(value);\n  }\n}\n\n/**\n * Reader callback for parsing feature.\n * @param {number} tag The tag.\n * @param {Object} feature The feature object.\n * @param {PBF} pbf The PBF.\n */\nfunction featurePBFReader(tag, feature, pbf) {\n  if (tag == 1) {\n    feature.id = pbf.readVarint();\n  } else if (tag == 2) {\n    const end = pbf.readVarint() + pbf.pos;\n    while (pbf.pos < end) {\n      const key = feature.layer.keys[pbf.readVarint()];\n      const value = feature.layer.values[pbf.readVarint()];\n      feature.properties[key] = value;\n    }\n  } else if (tag == 3) {\n    feature.type = pbf.readVarint();\n  } else if (tag == 4) {\n    feature.geometry = pbf.pos;\n  }\n}\n\n/**\n * Read a raw feature from the pbf offset stored at index `i` in the raw layer.\n * @param {PBF} pbf PBF.\n * @param {Object} layer Raw layer.\n * @param {number} i Index of the feature in the raw layer's `features` array.\n * @return {Object} Raw feature.\n */\nfunction readRawFeature(pbf, layer, i) {\n  pbf.pos = layer.features[i];\n  const end = pbf.readVarint() + pbf.pos;\n\n  const feature = {\n    layer: layer,\n    type: 0,\n    properties: {},\n  };\n  pbf.readFields(featurePBFReader, feature, end);\n  return feature;\n}\n\n/**\n * @param {number} type The raw feature's geometry type\n * @param {number} numEnds Number of ends of the flat coordinates of the\n * geometry.\n * @return {import(\"../render/Feature.js\").Type} The geometry type.\n */\nfunction getGeometryType(type, numEnds) {\n  /** @type {import(\"../render/Feature.js\").Type} */\n  let geometryType;\n  if (type === 1) {\n    geometryType = numEnds === 1 ? 'Point' : 'MultiPoint';\n  } else if (type === 2) {\n    geometryType = numEnds === 1 ? 'LineString' : 'MultiLineString';\n  } else if (type === 3) {\n    geometryType = 'Polygon';\n    // MultiPolygon not relevant for rendering - winding order determines\n    // outer rings of polygons.\n  }\n  return geometryType;\n}\n\nexport default MVT;\n", "/**\n * @module ol/renderer/canvas/VectorTileLayer\n */\nimport TileState from '../../TileState.js';\nimport ViewHint from '../../ViewHint.js';\nimport {ascending} from '../../array.js';\nimport {wrapX} from '../../coordinate.js';\nimport {\n  boundingExtent,\n  buffer,\n  containsExtent,\n  equals,\n  getIntersection,\n  getTopLeft,\n  intersects,\n} from '../../extent.js';\nimport CanvasBuilderGroup from '../../render/canvas/BuilderGroup.js';\nimport CanvasExecutorGroup, {\n  DECLUTTER,\n} from '../../render/canvas/ExecutorGroup.js';\nimport ZIndexContext from '../../render/canvas/ZIndexContext.js';\nimport {\n  HIT_DETECT_RESOLUTION,\n  createHitDetectionImageData,\n  hitDetect,\n} from '../../render/canvas/hitdetect.js';\nimport {toSize} from '../../size.js';\nimport {\n  apply as applyTransform,\n  create as createTransform,\n  multiply,\n  reset as resetTransform,\n  scale,\n  scale as scaleTransform,\n  translate as translateTransform,\n} from '../../transform.js';\nimport {getUid} from '../../util.js';\nimport {\n  getSquaredTolerance as getSquaredRenderTolerance,\n  renderFeature,\n} from '../vector.js';\nimport CanvasTileLayerRenderer from './TileLayer.js';\n\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas.js\").BuilderType>>}\n */\nconst IMAGE_REPLAYS = {\n  'image': ['Polygon', 'Circle', 'LineString', 'Image', 'Text'],\n  'hybrid': ['Polygon', 'LineString'],\n  'vector': [],\n};\n\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas.js\").BuilderType>>}\n */\nconst VECTOR_REPLAYS = {\n  'hybrid': ['Image', 'Text', 'Default'],\n  'vector': ['Polygon', 'Circle', 'LineString', 'Image', 'Text', 'Default'],\n};\n\n/**\n * @classdesc\n * Canvas renderer for vector tile layers.\n * @api\n * @extends {CanvasTileLayerRenderer<import(\"../../layer/VectorTile.js\").default<import('../../source/VectorTile.js').default<import('../../Feature.js').FeatureLike>>>}\n */\nclass CanvasVectorTileLayerRenderer extends CanvasTileLayerRenderer {\n  /**\n   * @param {import(\"../../layer/VectorTile.js\").default} layer VectorTile layer.\n   * @param {import(\"./TileLayer.js\").Options} options Options.\n   */\n  constructor(layer, options) {\n    super(layer, options);\n\n    /** @private */\n    this.boundHandleStyleImageChange_ = this.handleStyleImageChange_.bind(this);\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedLayerRevision_;\n\n    /**\n     * @private\n     * @type {import(\"../../transform\").Transform}\n     */\n    this.renderedPixelToCoordinateTransform_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRotation_;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedOpacity_ = 1;\n\n    /**\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.tmpTransform_ = createTransform();\n\n    /**\n     * @private\n     * @type {Array<ZIndexContext>}\n     */\n    this.tileClipContexts_ = null;\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {number} x Left of the tile.\n   * @param {number} y Top of the tile.\n   * @param {number} w Width of the tile.\n   * @param {number} h Height of the tile.\n   * @param {number} gutter Tile gutter.\n   * @param {boolean} transition Apply an alpha transition.\n   * @override\n   */\n  drawTile(tile, frameState, x, y, w, h, gutter, transition) {\n    this.updateExecutorGroup_(\n      tile,\n      frameState.pixelRatio,\n      frameState.viewState.projection,\n    );\n    if (this.tileImageNeedsRender_(tile)) {\n      this.renderTileImage_(tile, frameState);\n    }\n    super.drawTile(tile, frameState, x, y, w, h, gutter, transition);\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {import(\"../../Tile.js\").default|null} Tile (or null if outside source extent).\n   * @override\n   */\n  getTile(z, x, y, frameState) {\n    const tile = /** @type {import(\"../../VectorRenderTile.js\").default} */ (\n      this.getOrCreateTile(z, x, y, frameState)\n    );\n    if (!tile) {\n      return null;\n    }\n\n    const viewState = frameState.viewState;\n    const resolution = viewState.resolution;\n    const viewHints = frameState.viewHints;\n    const hifi = !(\n      viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]\n    );\n    if (hifi || !tile.wantedResolution) {\n      tile.wantedResolution = resolution;\n    }\n    return tile;\n  }\n\n  /**\n   * Determine whether render should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   * @override\n   */\n  prepareFrame(frameState) {\n    const layerRevision = this.getLayer().getRevision();\n    if (this.renderedLayerRevision_ !== layerRevision) {\n      this.renderedLayerRevision_ = layerRevision;\n      this.renderedTiles.length = 0;\n    }\n    return super.prepareFrame(frameState);\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../../proj/Projection.js\").default} projection Projection.\n   * @private\n   */\n  updateExecutorGroup_(tile, pixelRatio, projection) {\n    const layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (\n      this.getLayer()\n    );\n    const revision = layer.getRevision();\n    const renderOrder = layer.getRenderOrder() || null;\n\n    const resolution = tile.wantedResolution;\n    const builderState = tile.getReplayState(layer);\n    if (\n      !builderState.dirty &&\n      builderState.renderedResolution === resolution &&\n      builderState.renderedRevision == revision &&\n      builderState.renderedRenderOrder == renderOrder\n    ) {\n      return;\n    }\n\n    const source = layer.getSource();\n    const declutter = !!layer.getDeclutter();\n    const sourceTileGrid = source.getTileGrid();\n    const tileGrid = source.getTileGridForProjection(projection);\n    const tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n\n    const sourceTiles = source.getSourceTiles(pixelRatio, projection, tile);\n    const layerUid = getUid(layer);\n    delete tile.hitDetectionImageData[layerUid];\n    tile.executorGroups[layerUid] = [];\n    builderState.dirty = false;\n    for (let t = 0, tt = sourceTiles.length; t < tt; ++t) {\n      const sourceTile = sourceTiles[t];\n      if (sourceTile.getState() != TileState.LOADED) {\n        continue;\n      }\n      const sourceTileCoord = sourceTile.tileCoord;\n      const sourceTileExtent =\n        sourceTileGrid.getTileCoordExtent(sourceTileCoord);\n      const sharedExtent = getIntersection(tileExtent, sourceTileExtent);\n      const builderExtent = buffer(\n        sharedExtent,\n        layer.getRenderBuffer() * resolution,\n        this.tempExtent,\n      );\n      const bufferedExtent = equals(sourceTileExtent, sharedExtent)\n        ? null\n        : builderExtent;\n      const builderGroup = new CanvasBuilderGroup(\n        0,\n        sharedExtent,\n        resolution,\n        pixelRatio,\n      );\n      const squaredTolerance = getSquaredRenderTolerance(\n        resolution,\n        pixelRatio,\n      );\n\n      /**\n       * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n       * @param {number} [index] Render order index.\n       * @this {CanvasVectorTileLayerRenderer}\n       */\n      const render = function (feature, index) {\n        let styles;\n        const styleFunction =\n          feature.getStyleFunction() || layer.getStyleFunction();\n        if (styleFunction) {\n          styles = styleFunction(feature, resolution);\n        }\n        if (styles) {\n          const dirty = this.renderFeature(\n            feature,\n            squaredTolerance,\n            styles,\n            builderGroup,\n            declutter,\n            index,\n          );\n          builderState.dirty = builderState.dirty || dirty;\n        }\n      };\n\n      const features = sourceTile.getFeatures();\n      if (renderOrder && renderOrder !== builderState.renderedRenderOrder) {\n        features.sort(renderOrder);\n      }\n      for (let i = 0, ii = features.length; i < ii; ++i) {\n        const feature = features[i];\n        if (\n          !bufferedExtent ||\n          intersects(bufferedExtent, feature.getGeometry().getExtent())\n        ) {\n          render.call(this, feature, i);\n        }\n      }\n      const executorGroupInstructions = builderGroup.finish();\n      // no need to clip when the render tile is covered by a single source tile\n      const replayExtent =\n        layer.getRenderMode() !== 'vector' &&\n        declutter &&\n        sourceTiles.length === 1\n          ? null\n          : sharedExtent;\n      const renderingReplayGroup = new CanvasExecutorGroup(\n        replayExtent,\n        resolution,\n        pixelRatio,\n        source.getOverlaps(),\n        executorGroupInstructions,\n        layer.getRenderBuffer(),\n        true,\n      );\n      tile.executorGroups[layerUid].push(renderingReplayGroup);\n    }\n    builderState.renderedRevision = revision;\n    builderState.renderedRenderOrder = renderOrder;\n    builderState.renderedResolution = resolution;\n  }\n\n  /**\n   * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n   * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n   * @return {T|undefined} Callback result.\n   * @template T\n   * @override\n   */\n  forEachFeatureAtCoordinate(\n    coordinate,\n    frameState,\n    hitTolerance,\n    callback,\n    matches,\n  ) {\n    const resolution = frameState.viewState.resolution;\n    const rotation = frameState.viewState.rotation;\n    hitTolerance = hitTolerance == undefined ? 0 : hitTolerance;\n    const layer = this.getLayer();\n    const source = layer.getSource();\n    const tileGrid = source.getTileGridForProjection(\n      frameState.viewState.projection,\n    );\n\n    const hitExtent = boundingExtent([coordinate]);\n    buffer(hitExtent, resolution * hitTolerance, hitExtent);\n\n    /** @type {!Object<string, import(\"../Map.js\").HitMatch<T>|true>} */\n    const features = {};\n\n    /**\n     * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n     * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n     * @param {number} distanceSq The squared distance to the click position.\n     * @return {T|undefined} Callback result.\n     */\n    const featureCallback = function (feature, geometry, distanceSq) {\n      let key = feature.getId();\n      if (key === undefined) {\n        key = getUid(feature);\n      }\n      const match = features[key];\n      if (!match) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          return callback(feature, layer, geometry);\n        }\n        matches.push(\n          (features[key] = {\n            feature: feature,\n            layer: layer,\n            geometry: geometry,\n            distanceSq: distanceSq,\n            callback: callback,\n          }),\n        );\n      } else if (match !== true && distanceSq < match.distanceSq) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          matches.splice(matches.lastIndexOf(match), 1);\n          return callback(feature, layer, geometry);\n        }\n        match.geometry = geometry;\n        match.distanceSq = distanceSq;\n      }\n      return undefined;\n    };\n\n    const renderedTiles =\n      /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (\n        this.renderedTiles\n      );\n    const layerUid = getUid(layer);\n    const declutter = layer.getDeclutter();\n    const declutteredFeatures = declutter\n      ? frameState.declutter?.[declutter]?.all().map((item) => item.value)\n      : null;\n    let found;\n    foundFeature: for (let i = 0, ii = renderedTiles.length; i < ii; ++i) {\n      const tile = renderedTiles[i];\n      const tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n      if (!intersects(tileExtent, hitExtent)) {\n        continue;\n      }\n\n      const executorGroups = tile.executorGroups[layerUid];\n      for (let t = 0, tt = executorGroups.length; t < tt; ++t) {\n        found = executorGroups[t].forEachFeatureAtCoordinate(\n          coordinate,\n          resolution,\n          rotation,\n          hitTolerance,\n          featureCallback,\n          declutteredFeatures,\n        );\n        if (found) {\n          break foundFeature;\n        }\n      }\n    }\n    return found;\n  }\n\n  /**\n   * Asynchronous layer level hit detection.\n   * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n   * @return {Promise<Array<import(\"../../Feature.js\").FeatureLike>>} Promise that resolves with an array of features.\n   * @override\n   */\n  getFeatures(pixel) {\n    if (this.renderedTiles.length === 0) {\n      return Promise.resolve([]);\n    }\n    return new Promise((resolve, reject) => {\n      const layer = this.getLayer();\n      const source = layer.getSource();\n      const projection = this.renderedProjection;\n      const projectionExtent = projection.getExtent();\n      const resolution = this.renderedResolution;\n      const tileGrid = source.getTileGridForProjection(projection);\n      const coordinate = applyTransform(\n        this.renderedPixelToCoordinateTransform_,\n        pixel.slice(),\n      );\n      const tileCoordString = tileGrid\n        .getTileCoordForCoordAndResolution(coordinate, resolution)\n        .toString();\n      const tile =\n        /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (\n          this.renderedTiles\n        ).find(\n          (tile) =>\n            tile.tileCoord.toString() === tileCoordString &&\n            tile.getState() === TileState.LOADED,\n        );\n      if (!tile || tile.loadingSourceTiles > 0) {\n        resolve([]);\n        return;\n      }\n      if (\n        source.getWrapX() &&\n        projection.canWrapX() &&\n        !containsExtent(\n          projectionExtent,\n          tileGrid.getTileCoordExtent(tile.tileCoord),\n        )\n      ) {\n        wrapX(coordinate, projection);\n      }\n      const layerUid = getUid(layer);\n      const extent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n      const corner = getTopLeft(extent);\n      const tilePixel = [\n        (coordinate[0] - corner[0]) / resolution,\n        (corner[1] - coordinate[1]) / resolution,\n      ];\n      const features = tile\n        .getSourceTiles()\n        .reduce(\n          (accumulator, sourceTile) =>\n            accumulator.concat(sourceTile.getFeatures()),\n          /** @type {Array<import(\"../../Feature.js\").FeatureLike>} */ ([]),\n        );\n      let hitDetectionImageData = tile.hitDetectionImageData[layerUid];\n      if (!hitDetectionImageData) {\n        const tileSize = toSize(\n          tileGrid.getTileSize(\n            tileGrid.getZForResolution(resolution, source.zDirection),\n          ),\n        );\n        const rotation = this.renderedRotation_;\n        const transforms = [\n          this.getRenderTransform(\n            tileGrid.getTileCoordCenter(tile.wrappedTileCoord),\n            resolution,\n            0,\n            HIT_DETECT_RESOLUTION,\n            tileSize[0] * HIT_DETECT_RESOLUTION,\n            tileSize[1] * HIT_DETECT_RESOLUTION,\n            0,\n          ),\n        ];\n        hitDetectionImageData = createHitDetectionImageData(\n          tileSize,\n          transforms,\n          features,\n          layer.getStyleFunction(),\n          tileGrid.getTileCoordExtent(tile.wrappedTileCoord),\n          tile.getReplayState(layer).renderedResolution,\n          rotation,\n        );\n        tile.hitDetectionImageData[layerUid] = hitDetectionImageData;\n      }\n      resolve(hitDetect(tilePixel, features, hitDetectionImageData));\n    });\n  }\n\n  /**\n   * @param {import(\"../../extent.js\").Extent} extent Extent.\n   * @return {Array<import('../../Feature.js').FeatureLike>} Features.\n   */\n  getFeaturesInExtent(extent) {\n    /** @type {Array<import('../../Feature.js').FeatureLike>} */\n    const features = [];\n    const tileCache = this.getTileCache();\n    if (tileCache.getCount() === 0) {\n      return features;\n    }\n    const source = this.getLayer().getSource();\n    const tileGrid = source.getTileGridForProjection(\n      this.frameState.viewState.projection,\n    );\n    const z = tileGrid.getZForResolution(this.renderedResolution);\n    /** @type {Object<string, true>} */\n    const visitedSourceTiles = {};\n    tileCache.forEach((tile) => {\n      if (tile.tileCoord[0] !== z || tile.getState() !== TileState.LOADED) {\n        return;\n      }\n      const sourceTiles = tile.getSourceTiles();\n      for (let i = 0, ii = sourceTiles.length; i < ii; ++i) {\n        const sourceTile = sourceTiles[i];\n        const key = sourceTile.getKey();\n        if (key in visitedSourceTiles) {\n          continue;\n        }\n        visitedSourceTiles[key] = true;\n        const tileCoord = sourceTile.tileCoord;\n        if (intersects(extent, tileGrid.getTileCoordExtent(tileCoord))) {\n          const tileFeatures = sourceTile.getFeatures();\n          if (tileFeatures) {\n            for (let j = 0, jj = tileFeatures.length; j < jj; ++j) {\n              const candidate = tileFeatures[j];\n              const geometry = candidate.getGeometry();\n              if (intersects(extent, geometry.getExtent())) {\n                features.push(candidate);\n              }\n            }\n          }\n        }\n      }\n    });\n    return features;\n  }\n\n  /**\n   * Perform action necessary to get the layer rendered after new fonts have loaded\n   * @override\n   */\n  handleFontsChanged() {\n    const layer = this.getLayer();\n    if (layer.getVisible() && this.renderedLayerRevision_ !== undefined) {\n      layer.changed();\n    }\n  }\n\n  /**\n   * Handle changes in image style state.\n   * @param {import(\"../../events/Event.js\").default} event Image style change event.\n   * @private\n   */\n  handleStyleImageChange_(event) {\n    this.renderIfReadyAndVisible();\n  }\n\n  /**\n   * Render declutter items for this layer\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {import(\"../../layer/Layer.js\").State} layerState Layer state.\n   */\n  renderDeclutter(frameState, layerState) {\n    const context = this.context;\n    const alpha = context.globalAlpha;\n    context.globalAlpha = layerState.opacity;\n    const viewHints = frameState.viewHints;\n    const hifi = !(\n      viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]\n    );\n    const scaledCanvasSize = [\n      this.context.canvas.width,\n      this.context.canvas.height,\n    ];\n    const declutter = this.getLayer().getDeclutter();\n    const declutterTree = declutter\n      ? frameState.declutter?.[declutter]\n      : undefined;\n    const layerUid = getUid(this.getLayer());\n    const tiles =\n      /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (\n        this.renderedTiles\n      );\n    for (let i = 0, ii = tiles.length; i < ii; ++i) {\n      const tile = tiles[i];\n      const executorGroups = tile.executorGroups[layerUid];\n      if (executorGroups) {\n        for (let j = executorGroups.length - 1; j >= 0; --j) {\n          executorGroups[j].execute(\n            this.context,\n            scaledCanvasSize,\n            this.getTileRenderTransform(tile, frameState),\n            frameState.viewState.rotation,\n            hifi,\n            DECLUTTER,\n            declutterTree,\n          );\n        }\n      }\n    }\n    context.globalAlpha = alpha;\n  }\n\n  /**\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @override\n   */\n  renderDeferredInternal(frameState) {\n    const tiles =\n      /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (\n        this.renderedTiles\n      );\n    const layerUid = getUid(this.getLayer());\n    const executorGroups = tiles.reduce((acc, tile, index) => {\n      tile.executorGroups[layerUid].forEach((executorGroup) =>\n        acc.push({\n          executorGroup,\n          index,\n        }),\n      );\n      return acc;\n    }, /** @type {Array<{executorGroup: CanvasExecutorGroup, index: number}>} */ ([]));\n\n    const executorGroupZIndexContexts = executorGroups.map(({executorGroup}) =>\n      executorGroup.getDeferredZIndexContexts(),\n    );\n    /** @type {Object<number, true>} */\n    const usedZIndices = {};\n    for (let i = 0, ii = executorGroups.length; i < ii; ++i) {\n      const executorGroupZindexContext =\n        executorGroups[i].executorGroup.getDeferredZIndexContexts();\n      for (const key in executorGroupZindexContext) {\n        usedZIndices[key] = true;\n      }\n    }\n    const zIndexKeys = Object.keys(usedZIndices).map(Number).sort(ascending);\n    zIndexKeys.forEach((zIndex) => {\n      executorGroupZIndexContexts.forEach((zIndexContexts, i) => {\n        if (!zIndexContexts[zIndex]) {\n          return;\n        }\n        zIndexContexts[zIndex].forEach((zIndexContext) => {\n          const {executorGroup, index} = executorGroups[i];\n          const context = executorGroup.getRenderedContext();\n          const alpha = context.globalAlpha;\n          context.globalAlpha = this.renderedOpacity_;\n          const tileClipContext = this.tileClipContexts_[index];\n          if (tileClipContext) {\n            tileClipContext.draw(context);\n          }\n          zIndexContext.draw(context);\n          if (tileClipContext) {\n            context.restore();\n          }\n          context.globalAlpha = alpha;\n          zIndexContext.clear();\n        });\n        zIndexContexts[zIndex].length = 0;\n      });\n    });\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile The tile\n   * @param {import('../../Map.js').FrameState} frameState Current frame state\n   * @return {import('../../transform.js').Transform} Transform to use to render this tile\n   */\n  getTileRenderTransform(tile, frameState) {\n    const pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const center = viewState.center;\n    const resolution = viewState.resolution;\n    const rotation = viewState.rotation;\n    const size = frameState.size;\n    const width = Math.round(size[0] * pixelRatio);\n    const height = Math.round(size[1] * pixelRatio);\n\n    const source = this.getLayer().getSource();\n    const tileGrid = source.getTileGridForProjection(\n      frameState.viewState.projection,\n    );\n    const tileCoord = tile.tileCoord;\n    const tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n    const worldOffset =\n      tileGrid.getTileCoordExtent(tileCoord, this.tempExtent)[0] -\n      tileExtent[0];\n    const transform = multiply(\n      scale(this.inversePixelTransform.slice(), 1 / pixelRatio, 1 / pixelRatio),\n      this.getRenderTransform(\n        center,\n        resolution,\n        rotation,\n        pixelRatio,\n        width,\n        height,\n        worldOffset,\n      ),\n    );\n    return transform;\n  }\n\n  /**\n   * Render the vectors for this layer.\n   * @param {CanvasRenderingContext2D} context Target context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @override\n   */\n  postRender(context, frameState) {\n    const viewHints = frameState.viewHints;\n    const hifi = !(\n      viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]\n    );\n\n    this.renderedPixelToCoordinateTransform_ =\n      frameState.pixelToCoordinateTransform.slice();\n    this.renderedRotation_ = frameState.viewState.rotation;\n    this.renderedOpacity_ =\n      frameState.layerStatesArray[frameState.layerIndex].opacity;\n\n    const layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (\n      this.getLayer()\n    );\n    const renderMode = layer.getRenderMode();\n    const alpha = context.globalAlpha;\n    context.globalAlpha = this.renderedOpacity_;\n    const declutter = layer.getDeclutter();\n    const replayTypes = declutter\n      ? VECTOR_REPLAYS[renderMode].filter((type) => !DECLUTTER.includes(type))\n      : VECTOR_REPLAYS[renderMode];\n    const viewState = frameState.viewState;\n    const rotation = viewState.rotation;\n    const tileSource = layer.getSource();\n    const tileGrid = tileSource.getTileGridForProjection(viewState.projection);\n    const z = tileGrid.getZForResolution(\n      viewState.resolution,\n      tileSource.zDirection,\n    );\n\n    const tiles =\n      /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (\n        this.renderedTiles\n      );\n    const clips = [];\n    const clipZs = [];\n    const tileClipContexts = [];\n    const layerUid = getUid(layer);\n    let ready = true;\n    for (let i = tiles.length - 1; i >= 0; --i) {\n      const tile = tiles[i];\n      ready = ready && !tile.getReplayState(layer).dirty;\n      const executorGroups = tile.executorGroups[layerUid].filter((group) =>\n        group.hasExecutors(replayTypes),\n      );\n      if (executorGroups.length === 0) {\n        continue;\n      }\n      const transform = this.getTileRenderTransform(tile, frameState);\n      const currentZ = tile.tileCoord[0];\n      let contextSaved = false;\n      // Clip mask for regions in this tile that already filled by a higher z tile\n      const currentClip = executorGroups[0].getClipCoords(transform);\n      let clipContext = context;\n      let tileClipContext;\n      if (currentClip) {\n        tileClipContext = new ZIndexContext();\n        clipContext = tileClipContext.getContext();\n        for (let j = 0, jj = clips.length; j < jj; ++j) {\n          if (z !== currentZ && currentZ < clipZs[j]) {\n            const clip = clips[j];\n            if (\n              intersects(\n                [\n                  currentClip[0],\n                  currentClip[3],\n                  currentClip[4],\n                  currentClip[7],\n                ],\n                [clip[0], clip[3], clip[4], clip[7]],\n              )\n            ) {\n              if (!contextSaved) {\n                clipContext.save();\n                contextSaved = true;\n              }\n              clipContext.beginPath();\n              // counter-clockwise (outer ring) for current tile\n              clipContext.moveTo(currentClip[0], currentClip[1]);\n              clipContext.lineTo(currentClip[2], currentClip[3]);\n              clipContext.lineTo(currentClip[4], currentClip[5]);\n              clipContext.lineTo(currentClip[6], currentClip[7]);\n              // clockwise (inner ring) for higher z tile\n              clipContext.moveTo(clip[6], clip[7]);\n              clipContext.lineTo(clip[4], clip[5]);\n              clipContext.lineTo(clip[2], clip[3]);\n              clipContext.lineTo(clip[0], clip[1]);\n              clipContext.clip();\n            }\n          }\n        }\n        clips.push(currentClip);\n        clipZs.push(currentZ);\n      }\n      for (let t = 0, tt = executorGroups.length; t < tt; ++t) {\n        const executorGroup = executorGroups[t];\n        executorGroup.execute(\n          context,\n          [context.canvas.width, context.canvas.height],\n          transform,\n          rotation,\n          hifi,\n          replayTypes,\n          frameState.declutter?.[declutter],\n        );\n      }\n      if (contextSaved) {\n        if (clipContext === context) {\n          clipContext.restore();\n        } else {\n          tileClipContexts[i] = tileClipContext;\n        }\n      }\n    }\n    context.globalAlpha = alpha;\n    this.ready = ready;\n    this.tileClipContexts_ = tileClipContexts;\n    if (!frameState.declutter) {\n      this.renderDeferredInternal(frameState);\n    }\n\n    super.postRender(context, frameState);\n  }\n\n  /**\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   * @param {number} squaredTolerance Squared tolerance.\n   * @param {import(\"../../style/Style.js\").default|Array<import(\"../../style/Style.js\").default>} styles The style or array of styles.\n   * @param {import(\"../../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n   * @param {boolean} [declutter] Enable decluttering.\n   * @param {number} [index] Render order index.\n   * @return {boolean} `true` if an image is loading.\n   */\n  renderFeature(\n    feature,\n    squaredTolerance,\n    styles,\n    builderGroup,\n    declutter,\n    index,\n  ) {\n    if (!styles) {\n      return false;\n    }\n    let loading = false;\n    if (Array.isArray(styles)) {\n      for (let i = 0, ii = styles.length; i < ii; ++i) {\n        loading =\n          renderFeature(\n            builderGroup,\n            feature,\n            styles[i],\n            squaredTolerance,\n            this.boundHandleStyleImageChange_,\n            undefined,\n            declutter,\n            index,\n          ) || loading;\n      }\n    } else {\n      loading = renderFeature(\n        builderGroup,\n        feature,\n        styles,\n        squaredTolerance,\n        this.boundHandleStyleImageChange_,\n        undefined,\n        declutter,\n        index,\n      );\n    }\n    return loading;\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @return {boolean} A new tile image was rendered.\n   * @private\n   */\n  tileImageNeedsRender_(tile) {\n    const layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (\n      this.getLayer()\n    );\n    if (layer.getRenderMode() === 'vector') {\n      return false;\n    }\n    const replayState = tile.getReplayState(layer);\n    const revision = layer.getRevision();\n    const resolution = tile.wantedResolution;\n    return (\n      replayState.renderedTileResolution !== resolution ||\n      replayState.renderedTileRevision !== revision\n    );\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @param {import(\"../../Map\").FrameState} frameState Frame state.\n   * @private\n   */\n  renderTileImage_(tile, frameState) {\n    const layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (\n      this.getLayer()\n    );\n    const replayState = tile.getReplayState(layer);\n    const revision = layer.getRevision();\n    const executorGroups = tile.executorGroups[getUid(layer)];\n    replayState.renderedTileRevision = revision;\n\n    const tileCoord = tile.wrappedTileCoord;\n    const z = tileCoord[0];\n    const source = layer.getSource();\n    let pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const projection = viewState.projection;\n    const tileGrid = source.getTileGridForProjection(projection);\n    const tileResolution = tileGrid.getResolution(tile.tileCoord[0]);\n    const renderPixelRatio =\n      (frameState.pixelRatio / tile.wantedResolution) * tileResolution;\n    const resolution = tileGrid.getResolution(z);\n    const context = tile.getContext();\n\n    // Increase tile size when overzooming for low pixel ratio, to avoid blurry tiles\n    pixelRatio = Math.round(\n      Math.max(pixelRatio, renderPixelRatio / pixelRatio),\n    );\n    const size = source.getTilePixelSize(z, pixelRatio, projection);\n    context.canvas.width = size[0];\n    context.canvas.height = size[1];\n    const renderScale = pixelRatio / renderPixelRatio;\n    if (renderScale !== 1) {\n      const canvasTransform = resetTransform(this.tmpTransform_);\n      scaleTransform(canvasTransform, renderScale, renderScale);\n      context.setTransform.apply(context, canvasTransform);\n    }\n    const tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tempExtent);\n    const pixelScale = renderPixelRatio / resolution;\n    const transform = resetTransform(this.tmpTransform_);\n    scaleTransform(transform, pixelScale, -pixelScale);\n    translateTransform(transform, -tileExtent[0], -tileExtent[3]);\n    for (let i = 0, ii = executorGroups.length; i < ii; ++i) {\n      const executorGroup = executorGroups[i];\n      executorGroup.execute(\n        context,\n        [\n          context.canvas.width * renderScale,\n          context.canvas.height * renderScale,\n        ],\n        transform,\n        0,\n        true,\n        IMAGE_REPLAYS[layer.getRenderMode()],\n        null,\n      );\n    }\n    replayState.renderedTileResolution = tile.wantedResolution;\n  }\n}\n\nexport default CanvasVectorTileLayerRenderer;\n", "/**\n * @module ol/layer/VectorTile\n */\nimport {assert} from '../asserts.js';\nimport CanvasVectorTileLayerRenderer from '../renderer/canvas/VectorTileLayer.js';\nimport BaseVectorLayer from './BaseVector.js';\nimport TileProperty from './TileProperty.js';\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"./Base\").BaseLayerObjectEventTypes|\n *     import(\"./Layer.js\").LayerEventType|'change:preload'|'change:useInterimTilesOnError', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../render/EventType\").LayerRenderEventTypes, import(\"../render/Event\").default, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"./Base\").BaseLayerObjectEventTypes|\n *     import(\"./Layer.js\").LayerEventType|'change:preload'|'change:useInterimTilesOnError'|import(\"../render/EventType\").LayerRenderEventTypes, Return>} VectorTileLayerOnSignature\n */\n\n/**\n * @typedef {'hybrid' | 'vector'} VectorTileRenderType\n */\n\n/***\n * @template T\n * @typedef {T extends import(\"../source/VectorTile.js\").default<infer U extends import(\"../Feature.js\").FeatureLike> ? U : never} ExtractedFeatureType\n */\n\n/**\n * @template {import(\"../source/VectorTile.js\").default<FeatureType>} [VectorTileSourceType=import(\"../source/VectorTile.js\").default<*>]\n * @template {import(\"../Feature\").FeatureLike} [FeatureType=ExtractedFeatureType<VectorTileSourceType>]\n * @typedef {Object} Options\n * @property {string} [className='ol-layer'] A CSS class name to set to the layer element.\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {import(\"../extent.js\").Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position. When `undefined`, a `zIndex` of 0 is assumed\n * for layers that are added to the map's `layers` collection, or `Infinity` when the layer's `setMap()`\n * method was used.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [minZoom] The minimum view zoom level (exclusive) above which this layer will be\n * visible.\n * @property {number} [maxZoom] The maximum view zoom level (inclusive) at which this layer will\n * be visible.\n * @property {import(\"../render.js\").OrderFunction} [renderOrder] Render order. Function to be used when sorting\n * features before rendering. By default features are drawn in the order that they are created. Use\n * `null` to avoid the sort, but get an undefined draw order.\n * @property {number} [renderBuffer=100] The buffer in pixels around the tile extent used by the\n * renderer when getting features from the vector tile for the rendering or hit-detection.\n * Recommended value: Vector tiles are usually generated with a buffer, so this value should match\n * the largest possible buffer of the used tiles. It should be at least the size of the largest\n * point symbol or line width.\n * @property {VectorTileRenderType} [renderMode='hybrid'] Render mode for vector tiles:\n *  `'hybrid'`: Polygon and line elements are rendered as images, so pixels are scaled during zoom\n *    animations. Point symbols and texts are accurately rendered as vectors and can stay upright on\n *    rotated views, but get lifted above all polygon and line elements.\n *  `'vector'`: Everything is rendered as vectors and the original render order is maintained. Use\n *    this mode for improved performance and visual epxerience on vector tile layers with not too many\n *    rendered features (e.g. for highlighting a subset of features of another layer with the same\n *    source).\n * @property {VectorTileSourceType} [source] Source.\n * @property {import(\"../Map.js\").default} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use [map.addLayer()]{@link import(\"../Map.js\").default#addLayer}.\n * @property {boolean|string|number} [declutter=false] Declutter images and text. Any truthy value will enable\n * decluttering. Within a layer, a feature rendered before another has higher priority. All layers with the\n * same `declutter` value will be decluttered together. The priority is determined by the drawing order of the\n * layers with the same `declutter` value. Higher in the layer stack means higher priority. To declutter distinct\n * layers or groups of layers separately, use different truthy values for `declutter`.\n * @property {import(\"../style/Style.js\").StyleLike|import(\"../style/flat.js\").FlatStyleLike|null} [style] Layer\n * style. When set to `null`, only\n * features that have their own style will be rendered. See {@link module:ol/style/Style~Style} for the default style\n * which will be used if this is not set.\n * @property {import(\"./Base.js\").BackgroundColor} [background] Background color for the layer. If not specified, no\n * background will be rendered.\n * @property {boolean} [updateWhileAnimating=false] When set to `true`, feature batches will be\n * recreated during animations. This means that no vectors will be shown clipped, but the setting\n * will have a performance impact for large amounts of vector data. When set to `false`, batches\n * will be recreated when no animation is active.\n * @property {boolean} [updateWhileInteracting=false] When set to `true`, feature batches will be\n * recreated during interactions. See also `updateWhileAnimating`.\n * @property {number} [preload=0] Preload. Load low-resolution tiles up to `preload` levels. `0`\n * means no preloading.\n * @property {boolean} [useInterimTilesOnError=true] Deprecated.  Use interim tiles on error.\n * @property {Object<string, *>} [properties] Arbitrary observable properties. Can be accessed with `#get()` and `#set()`.\n * @property {number} [cacheSize=0] The internal tile cache size.  If too small, this will auto-grow to hold\n * two zoom levels worth of tiles.\n */\n\n/**\n * @classdesc\n * Layer for vector tile data that is rendered client-side.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/VectorTile.js\").default<FeatureType>} [VectorTileSourceType=import(\"../source/VectorTile.js\").default<*>]\n * @template {import(\"../Feature.js\").FeatureLike} [FeatureType=ExtractedFeatureType<VectorTileSourceType>]\n * @extends {BaseVectorLayer<FeatureType, VectorTileSourceType, CanvasVectorTileLayerRenderer>}\n * @api\n */\nclass VectorTileLayer extends BaseVectorLayer {\n  /**\n   * @param {Options<VectorTileSourceType, FeatureType>} [options] Options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    const baseOptions = Object.assign({}, options);\n    delete baseOptions.preload;\n    const cacheSize = options.cacheSize === undefined ? 0 : options.cacheSize;\n    delete options.cacheSize;\n    delete baseOptions.useInterimTilesOnError;\n\n    super(baseOptions);\n\n    /***\n     * @type {VectorTileLayerOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {VectorTileLayerOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {VectorTileLayerOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @type {number|undefined}\n     * @private\n     */\n    this.cacheSize_ = cacheSize;\n\n    const renderMode = options.renderMode || 'hybrid';\n    assert(\n      renderMode == 'hybrid' || renderMode == 'vector',\n      \"`renderMode` must be `'hybrid'` or `'vector'`\",\n    );\n\n    /**\n     * @private\n     * @type {VectorTileRenderType}\n     */\n    this.renderMode_ = renderMode;\n\n    this.setPreload(options.preload ? options.preload : 0);\n    this.setUseInterimTilesOnError(\n      options.useInterimTilesOnError !== undefined\n        ? options.useInterimTilesOnError\n        : true,\n    );\n\n    /**\n     * @return {import(\"./Base.js\").BackgroundColor} Background color.\n     * @function\n     * @api\n     */\n    this.getBackground;\n\n    /**\n     * @param {import(\"./Base.js\").BackgroundColor} background Background color.\n     * @function\n     * @api\n     */\n    this.setBackground;\n  }\n\n  /**\n   * @override\n   */\n  createRenderer() {\n    return new CanvasVectorTileLayerRenderer(this, {\n      cacheSize: this.cacheSize_,\n    });\n  }\n\n  /**\n   * Get the topmost feature that intersects the given pixel on the viewport. Returns a promise\n   * that resolves with an array of features. The array will either contain the topmost feature\n   * when a hit was detected, or it will be empty.\n   *\n   * The hit detection algorithm used for this method is optimized for performance, but is less\n   * accurate than the one used in [map.getFeaturesAtPixel()]{@link import(\"../Map.js\").default#getFeaturesAtPixel}.\n   * Text is not considered, and icons are only represented by their bounding box instead of the exact\n   * image.\n   *\n   * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n   * @return {Promise<Array<import(\"../Feature\").FeatureLike>>} Promise that resolves with an array of features.\n   * @api\n   * @override\n   */\n  getFeatures(pixel) {\n    return super.getFeatures(pixel);\n  }\n\n  /**\n   * Get features whose bounding box intersects the provided extent. Only features for cached\n   * tiles for the last rendered zoom level are available in the source. So this method is only\n   * suitable for requesting tiles for extents that are currently rendered.\n   *\n   * Features are returned in random tile order and as they are included in the tiles. This means\n   * they can be clipped, duplicated across tiles, and simplified to the render resolution.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {Array<FeatureType>} Features.\n   * @api\n   */\n  getFeaturesInExtent(extent) {\n    return /** @type {Array<FeatureType>} */ (\n      /** @type {*} */ (this.getRenderer().getFeaturesInExtent(extent))\n    );\n  }\n\n  /**\n   * @return {VectorTileRenderType} The render mode.\n   */\n  getRenderMode() {\n    return this.renderMode_;\n  }\n\n  /**\n   * Return the level as number to which we will preload tiles up to.\n   * @return {number} The level to preload tiles up to.\n   * @observable\n   * @api\n   */\n  getPreload() {\n    return /** @type {number} */ (this.get(TileProperty.PRELOAD));\n  }\n\n  /**\n   * Deprecated.  Whether we use interim tiles on error.\n   * @return {boolean} Use interim tiles on error.\n   * @observable\n   * @api\n   */\n  getUseInterimTilesOnError() {\n    return /** @type {boolean} */ (\n      this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)\n    );\n  }\n\n  /**\n   * Set the level as number to which we will preload tiles up to.\n   * @param {number} preload The level to preload tiles up to.\n   * @observable\n   * @api\n   */\n  setPreload(preload) {\n    this.set(TileProperty.PRELOAD, preload);\n  }\n\n  /**\n   * Deprecated.  Set whether we use interim tiles on error.\n   * @param {boolean} useInterimTilesOnError Use interim tiles on error.\n   * @observable\n   * @api\n   */\n  setUseInterimTilesOnError(useInterimTilesOnError) {\n    this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR, useInterimTilesOnError);\n  }\n}\n\nexport default VectorTileLayer;\n", "(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"ol/geom/Point.js\"), require(\"ol/easing.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Image.js\"), require(\"ol/proj.js\"), require(\"ol/source/ImageStatic.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/VectorTile.js\"), require(\"ol/source/Image.js\"), require(\"ol/source.js\"), require(\"ol/format/MVT.js\"), require(\"ol/style/Style.js\"), require(\"ol/style/Stroke.js\"), require(\"ol/render.js\"), require(\"ol/util.js\"), require(\"ol/structs/LRUCache.js\"), require(\"ol/tilegrid.js\"), require(\"ol/tileurlfunction.js\"), require(\"ol/render/Feature.js\"), require(\"ol/layer/VectorTile.js\"), require(\"ol/extent.js\"), require(\"ol/Observable.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/BaseVector.js\"), require(\"ol/source/Vector.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/style/Icon.js\"), require(\"ol/geom/Polygon.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/geom.js\"), require(\"ol/Overlay.js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"ol/geom/Point.js\", \"ol/easing.js\", \"ol/layer/Tile.js\", \"ol/layer/Image.js\", \"ol/proj.js\", \"ol/source/ImageStatic.js\", \"ol/source/ImageWMS.js\", \"ol/source/TileImage.js\", \"ol/source/TileWMS.js\", \"ol/source/VectorTile.js\", \"ol/source/Image.js\", \"ol/source.js\", \"ol/format/MVT.js\", \"ol/style/Style.js\", \"ol/style/Stroke.js\", \"ol/render.js\", \"ol/util.js\", \"ol/structs/LRUCache.js\", \"ol/tilegrid.js\", \"ol/tileurlfunction.js\", \"ol/render/Feature.js\", \"ol/layer/VectorTile.js\", \"ol/extent.js\", \"ol/Observable.js\", \"ol/layer/Group.js\", \"ol/layer/BaseVector.js\", \"ol/source/Vector.js\", \"ol/layer/Layer.js\", \"ol/source/Cluster.js\", \"ol/layer/Vector.js\", \"ol/style/Icon.js\", \"ol/geom/Polygon.js\", \"ol/geom/SimpleGeometry.js\", \"ol/geom.js\", \"ol/Overlay.js\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"olcs\"] = factory(require(\"ol/geom/Point.js\"), require(\"ol/easing.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Image.js\"), require(\"ol/proj.js\"), require(\"ol/source/ImageStatic.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/VectorTile.js\"), require(\"ol/source/Image.js\"), require(\"ol/source.js\"), require(\"ol/format/MVT.js\"), require(\"ol/style/Style.js\"), require(\"ol/style/Stroke.js\"), require(\"ol/render.js\"), require(\"ol/util.js\"), require(\"ol/structs/LRUCache.js\"), require(\"ol/tilegrid.js\"), require(\"ol/tileurlfunction.js\"), require(\"ol/render/Feature.js\"), require(\"ol/layer/VectorTile.js\"), require(\"ol/extent.js\"), require(\"ol/Observable.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/BaseVector.js\"), require(\"ol/source/Vector.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/style/Icon.js\"), require(\"ol/geom/Polygon.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/geom.js\"), require(\"ol/Overlay.js\"));\n\telse\n\t\troot[\"olcs\"] = factory(root[\"ol/geom/Point.js\"], root[\"ol/easing.js\"], root[\"ol/layer/Tile.js\"], root[\"ol/layer/Image.js\"], root[\"ol/proj.js\"], root[\"ol/source/ImageStatic.js\"], root[\"ol/source/ImageWMS.js\"], root[\"ol/source/TileImage.js\"], root[\"ol/source/TileWMS.js\"], root[\"ol/source/VectorTile.js\"], root[\"ol/source/Image.js\"], root[\"ol/source.js\"], root[\"ol/format/MVT.js\"], root[\"ol/style/Style.js\"], root[\"ol/style/Stroke.js\"], root[\"ol/render.js\"], root[\"ol/util.js\"], root[\"ol/structs/LRUCache.js\"], root[\"ol/tilegrid.js\"], root[\"ol/tileurlfunction.js\"], root[\"ol/render/Feature.js\"], root[\"ol/layer/VectorTile.js\"], root[\"ol/extent.js\"], root[\"ol/Observable.js\"], root[\"ol/layer/Group.js\"], root[\"ol/layer/BaseVector.js\"], root[\"ol/source/Vector.js\"], root[\"ol/layer/Layer.js\"], root[\"ol/source/Cluster.js\"], root[\"ol/layer/Vector.js\"], root[\"ol/style/Icon.js\"], root[\"ol/geom/Polygon.js\"], root[\"ol/geom/SimpleGeometry.js\"], root[\"ol/geom.js\"], root[\"ol/Overlay.js\"]);\n})(self, (__WEBPACK_EXTERNAL_MODULE__206__, __WEBPACK_EXTERNAL_MODULE__177__, __WEBPACK_EXTERNAL_MODULE__164__, __WEBPACK_EXTERNAL_MODULE__330__, __WEBPACK_EXTERNAL_MODULE__24__, __WEBPACK_EXTERNAL_MODULE__606__, __WEBPACK_EXTERNAL_MODULE__469__, __WEBPACK_EXTERNAL_MODULE__623__, __WEBPACK_EXTERNAL_MODULE__886__, __WEBPACK_EXTERNAL_MODULE__622__, __WEBPACK_EXTERNAL_MODULE__673__, __WEBPACK_EXTERNAL_MODULE__432__, __WEBPACK_EXTERNAL_MODULE__401__, __WEBPACK_EXTERNAL_MODULE__193__, __WEBPACK_EXTERNAL_MODULE__51__, __WEBPACK_EXTERNAL_MODULE__817__, __WEBPACK_EXTERNAL_MODULE__280__, __WEBPACK_EXTERNAL_MODULE__750__, __WEBPACK_EXTERNAL_MODULE__628__, __WEBPACK_EXTERNAL_MODULE__423__, __WEBPACK_EXTERNAL_MODULE__115__, __WEBPACK_EXTERNAL_MODULE__996__, __WEBPACK_EXTERNAL_MODULE__235__, __WEBPACK_EXTERNAL_MODULE__911__, __WEBPACK_EXTERNAL_MODULE__604__, __WEBPACK_EXTERNAL_MODULE__515__, __WEBPACK_EXTERNAL_MODULE__830__, __WEBPACK_EXTERNAL_MODULE__582__, __WEBPACK_EXTERNAL_MODULE__63__, __WEBPACK_EXTERNAL_MODULE__425__, __WEBPACK_EXTERNAL_MODULE__962__, __WEBPACK_EXTERNAL_MODULE__253__, __WEBPACK_EXTERNAL_MODULE__988__, __WEBPACK_EXTERNAL_MODULE__524__, __WEBPACK_EXTERNAL_MODULE__312__) => {\nreturn ", "module.exports = __WEBPACK_EXTERNAL_MODULE__911__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__312__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__177__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__235__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__401__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__524__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__206__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__253__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__988__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__515__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__604__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__330__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__582__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__164__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__425__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__996__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__24__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__817__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__115__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__432__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__63__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__673__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__606__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__469__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__623__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__886__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__830__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__622__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__750__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__962__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__51__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__193__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__628__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__423__;", "module.exports = __WEBPACK_EXTERNAL_MODULE__280__;", "// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n", "// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};", "// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};", "__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))", "// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};", "import type {Projection} from 'ol/proj';\nimport type {Source} from 'ol/source';\n\nlet _imageRenderingPixelatedSupported: boolean = undefined;\nlet _imageRenderingValue: string = undefined;\n\n\n/**\n * https://caniuse.com/mdn-css_properties_image-rendering_pixelated\n * @return whether the browser supports\n */\nexport function supportsImageRenderingPixelated(): boolean {\n  if (_imageRenderingPixelatedSupported === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const imageRenderingValue = canvas.style.imageRendering;\n    _imageRenderingPixelatedSupported = !!imageRenderingValue;\n    if (_imageRenderingPixelatedSupported) {\n      _imageRenderingValue = imageRenderingValue;\n    }\n  }\n  return _imageRenderingPixelatedSupported;\n}\n\n\n/**\n * The value supported by thie browser for the CSS property \"image-rendering\"\n * @return {string}\n */\nexport function imageRenderingValue() {\n  supportsImageRenderingPixelated();\n  return _imageRenderingValue || '';\n}\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param source Source.\n * @return The projection of the source.\n */\nexport function getSourceProjection(source: Source): Projection {\n  return source.get('olcs.projection') as Projection || source.getProjection();\n}\n\n\n/**\n * Counter for getUid.\n * @type {number}\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid. Similar to OL getUid.\n *\n * @param obj The object to get the unique ID for.\n * @return The unique ID for the object.\n */\nexport function getUid(obj: any): number {\n  return obj.olcs_uid || (obj.olcs_uid = ++uidCounter_);\n}\n\nexport function waitReady<Type>(object: Type): Promise<Type> {\n  const o = object as any;\n  const p = o.readyPromise;\n  if (p) {\n    return p;\n  }\n  if (o.ready !== undefined) {\n    if (o.ready) {\n      return Promise.resolve(object);\n    }\n    return new Promise((resolve, _) => {\n      // FIXME: this is crazy\n      // alternative: intercept _ready = true\n      // altnerative: pass a timeout\n      const stopper = setInterval(() => {\n        if (o.ready) {\n          clearInterval(stopper);\n          resolve(object);\n        }\n      }, 20);\n    });\n  }\n  return Promise.reject('Not a readyable object');\n}\n", "import {getSourceProjection} from '../util';\nimport {Tile as TileSource, type TileImage} from 'ol/source.js';\nimport {attributionsFunctionToCredits} from '../core';\nimport type {Map} from 'ol';\nimport type {Projection} from 'ol/proj.js';\nimport type {Credit, Event, ImageryLayerFeatureInfo, ImageryProvider, ImageryTypes, Proxy, Rectangle, Request, TileDiscardPolicy, TilingScheme} from 'cesium';\n\n\nexport function createEmptyCanvas(): HTMLCanvasElement {\n  const canvas = document.createElement('canvas');\n  canvas.width = 1;\n  canvas.height = 1;\n  return canvas;\n}\n\nconst olUseNewCoordinates = (function() {\n  const tileSource = new TileSource({\n    projection: 'EPSG:3857',\n    wrapX: true\n  });\n  const tileCoord = tileSource.getTileCoordForTileUrlFunction([6, -31, 22]);\n  return tileCoord && tileCoord[1] === 33 && tileCoord[2] === 22;\n  // See b/test/spec/ol/source/tile.test.js\n  // of e9a30c5cb7e3721d9370025fbe5472c322847b35 in OpenLayers repository\n})();\n\n\nexport default class OLImageryProvider implements ImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  private source_: TileImage;\n  private projection_: Projection | undefined;\n  private fallbackProj_: Projection | undefined;\n  private map_: Map;\n  private shouldRequestNextLevel: boolean;\n  private emptyCanvas_: HTMLCanvasElement = createEmptyCanvas();\n  private emptyCanvasPromise_: Promise<HTMLCanvasElement> = Promise.resolve(this.emptyCanvas_);\n  private tilingScheme_: TilingScheme;\n  private ready_: boolean;\n  private rectangle_: Rectangle;\n\n  /**\n * When <code>true</code>, this model is ready to render, i.e., the external binary, image,\n * and shader files were downloaded and the WebGL resources were created.\n */\n  get ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n * Gets the rectangle, in radians, of the imagery provided by the instance.\n */\n  get rectangle() {\n    return this.rectangle_;\n  }\n\n  /**\n   * Gets the tiling scheme used by the provider.\n   */\n  get tilingScheme(): TilingScheme {\n    return this.tilingScheme_;\n  }\n\n  /**\n   * Gets an event that is raised when the imagery provider encounters an asynchronous error.  By subscribing\n   * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n   * are passed an instance of {@link Cesium.TileProviderError}.\n   */\n  readonly errorEvent: Event = new Cesium.Event();\n\n  /**\n   * Gets the credit to display when this imagery provider is active.  Typically this is used to credit\n   * the source of the imagery.\n   */\n  readonly credit: Credit;\n\n  /**\n   * Gets the proxy used by this provider.\n   */\n  readonly proxy: Proxy;\n\n  get _ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n   * Gets the width of each tile, in pixels.\n   */\n  get tileWidth(): number {\n    const tileGrid = this.source_.getTileGrid();\n    if (tileGrid) {\n      const tileSizeAtZoom0 = tileGrid.getTileSize(0);\n      if (Array.isArray(tileSizeAtZoom0)) {\n        return tileSizeAtZoom0[0];\n      } else {\n        return tileSizeAtZoom0; // same width and height\n      }\n    }\n    return 256;\n  }\n\n  /**\n   * Gets the height of each tile, in pixels.\n   */\n  get tileHeight(): number {\n    const tileGrid = this.source_.getTileGrid();\n    if (tileGrid) {\n      const tileSizeAtZoom0 = tileGrid.getTileSize(0);\n      if (Array.isArray(tileSizeAtZoom0)) {\n        return tileSizeAtZoom0[1];\n      } else {\n        return tileSizeAtZoom0; // same width and height\n      }\n    }\n    return 256;\n  }\n\n  /**\n   * Gets the maximum level-of-detail that can be requested.\n   */\n  get maximumLevel(): number {\n    const tileGrid = this.source_.getTileGrid();\n    if (tileGrid) {\n      return tileGrid.getMaxZoom();\n    } else {\n      return 18; // some arbitrary value\n    }\n  }\n\n  // FIXME: to implement, we could check the number of tiles at minzoom (for this rectangle) and return 0 if too big\n  /**\n   * Gets the minimum level-of-detail that can be requested.  Generally,\n   * a minimum level should only be used when the rectangle of the imagery is small\n   * enough that the number of tiles at the minimum level is small.  An imagery\n   * provider with more than a few tiles at the minimum level will lead to\n   * rendering problems.\n   */\n  get minimumLevel() {\n    // WARNING: Do not use the minimum level (at least until the extent is\n    // properly set). Cesium assumes the minimumLevel to contain only\n    // a few tiles and tries to load them all at once -- this can\n    // freeze and/or crash the browser !\n    return 0;\n    //var tg = this.source_.getTileGrid();\n    //return tg ? tg.getMinZoom() : 0;\n  }\n\n  /**\n   * Gets the tile discard policy.  If not undefined, the discard policy is responsible\n   * for filtering out \"missing\" tiles via its shouldDiscardImage function.  If this function\n   * returns undefined, no tiles are filtered.\n   */\n  get tileDiscardPolicy(): TileDiscardPolicy {\n    return undefined;\n  }\n\n  // FIXME: this might be exposed\n  /**\n   * Gets a value indicating whether or not the images provided by this imagery provider\n   * include an alpha channel.  If this property is false, an alpha channel, if present, will\n   * be ignored.  If this property is true, any images without an alpha channel will be treated\n   * as if their alpha is 1.0 everywhere.  When this property is false, memory usage\n   * and texture upload time are reduced.\n   */\n  get hasAlphaChannel() {\n    return true;\n  }\n\n  // FIXME: this could be implemented by proxying to OL\n  /**\n   * Asynchronously determines what features, if any, are located at a given longitude and latitude within\n   * a tile.\n   * This function is optional, so it may not exist on all ImageryProviders.\n   * @param x - The tile X coordinate.\n   * @param y - The tile Y coordinate.\n   * @param level - The tile level.\n   * @param longitude - The longitude at which to pick features.\n   * @param latitude - The latitude at which to pick features.\n   * @return A promise for the picked features that will resolve when the asynchronous\n   *                   picking completes.  The resolved value is an array of {@link ImageryLayerFeatureInfo}\n   *                   instances.  The array may be empty if no features are found at the given location.\n   *                   It may also be undefined if picking is not supported.\n   */\n  pickFeatures(x: number, y: number, level: number, longitude: number, latitude: number): Promise<ImageryLayerFeatureInfo[]> | undefined {\n    return undefined;\n  }\n\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param olMap OL map\n   * @param source Tile image source\n   * @param [opt_fallbackProj] Projection to assume if source has no projection\n   */\n  constructor(olMap: Map, source: TileImage, opt_fallbackProj: Projection) {\n    this.source_ = source;\n\n    this.projection_ = null;\n\n    this.ready_ = false;\n\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    // cesium v107+ don't wait for ready anymore so we put somehing here while it loads\n    this.tilingScheme_ = new Cesium.WebMercatorTilingScheme();\n\n    this.rectangle_ = null;\n\n    this.map_ = olMap;\n\n    this.shouldRequestNextLevel = false;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        // Duck typing a proxy\n        this.proxy = {\n          'getURL': proxy\n        } as Proxy;\n      } else if (typeof proxy === 'string') {\n        this.proxy = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   */\n  private handleSourceChanged_() {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = getSourceProjection(this.source_) || this.fallbackProj_;\n      const options = {numberOfLevelZeroTilesX: 1, numberOfLevelZeroTilesY: 1};\n\n      if (this.source_.tileGrid !== null) {\n        // Get the number of tiles at level 0 if it is defined\n        this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(), 0, ([zoom, xIndex, yIndex]) => {\n          options.numberOfLevelZeroTilesX = xIndex + 1;\n          options.numberOfLevelZeroTilesY = yIndex + 1;\n        });\n      }\n\n      if (this.projection_.getCode() === 'EPSG:4326') {\n        // Cesium zoom level 0 is OpenLayers zoom level 1 for layer in EPSG:4326 with a single tile on level 0\n        this.shouldRequestNextLevel = options.numberOfLevelZeroTilesX === 1 && options.numberOfLevelZeroTilesY === 1;\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme(options);\n      } else if (this.projection_.getCode() === 'EPSG:3857') {\n        this.shouldRequestNextLevel = false;\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(options);\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Generates the proper attributions for a given position and zoom\n   * level.\n   * @implements\n   */\n  getTileCredits(x: number, y: number, level: number): Credit[] {\n    const attributionsFunction = this.source_.getAttributions();\n    if (!attributionsFunction) {\n      return [];\n    }\n    const extent = this.map_.getView().calculateExtent(this.map_.getSize());\n    const center = this.map_.getView().getCenter();\n    const zoom = this.shouldRequestNextLevel ? level + 1 : level;\n    return attributionsFunctionToCredits(attributionsFunction, zoom, center, extent);\n  }\n\n  /**\n   * @implements\n   */\n  requestImage(x: number, y: number, level: number, request?: Request): Promise<ImageryTypes> | undefined {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n      const z_ = this.shouldRequestNextLevel ? level + 1 : level;\n\n      let y_ = y;\n      if (!olUseNewCoordinates) {\n        // LEGACY\n        // OpenLayers version 3 to 5 tile coordinates increase from bottom to top\n        y_ = -y - 1;\n      }\n      let url = tileUrlFunction.call(this.source_, [z_, x, y_], 1, this.projection_);\n      if (this.proxy) {\n        url = this.proxy.getURL(url);\n      }\n      if (url) {\n        // It is probably safe to cast here\n        return Cesium.ImageryProvider.loadImage(this, url) as Promise<ImageryTypes>;\n      }\n      return this.emptyCanvasPromise_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvasPromise_;\n    }\n  }\n}\n", "import MVT from 'ol/format/MVT.js';\nimport Style, {type StyleFunction} from 'ol/style/Style.js';\nimport Stroke from 'ol/style/Stroke.js';\nimport {toContext} from 'ol/render.js';\nimport {get as getProjection} from 'ol/proj.js';\nimport {VERSION as OL_VERSION} from 'ol/util.js';\nimport LRUCache from 'ol/structs/LRUCache.js';\nimport {getForProjection as getTilegridForProjection} from 'ol/tilegrid.js';\nimport {createFromTemplates as createTileUrlFunctions} from 'ol/tileurlfunction.js';\nimport type {Credit, Event, ImageryLayerFeatureInfo, ImageryProvider, ImageryTypes, Proxy, Rectangle, Request, TileDiscardPolicy, TilingScheme} from 'cesium';\nimport type {UrlFunction} from 'ol/Tile.js';\nimport RenderFeature from 'ol/render/Feature.js';\nimport {createEmptyCanvas} from './core/OLImageryProvider';\n\n\nexport interface MVTOptions {\n  urls: string[],\n  rectangle: Rectangle,\n  credit: Credit,\n  styleFunction: StyleFunction,\n  cacheSize?: number,\n  featureCache?: LRUCache<Promise<RenderFeature[]>>\n  minimumLevel: number\n}\n\nconst format = new MVT({\n  featureClass: RenderFeature\n});\n\nconst styles = [new Style({\n  stroke: new Stroke({\n    color: 'blue',\n    width: 2\n  })\n})];\n\n\nexport default class MVTImageryProvider implements ImageryProvider {\n  private urls: string[];\n  private emptyCanvas_: HTMLCanvasElement = createEmptyCanvas();\n  private emptyCanvasPromise_: Promise<HTMLCanvasElement> = Promise.resolve(this.emptyCanvas_);\n  private tilingScheme_ = new Cesium.WebMercatorTilingScheme;\n  private ready_ = true;\n  private rectangle_: Rectangle;\n  private tileRectangle_: Rectangle;\n  readonly tileWidth = 256;\n  readonly tileHeight = 256;\n  readonly maximumLevel = 20;\n  private minimumLevel_ = 0;\n  get minimumLevel(): number {\n    return this.minimumLevel_;\n  }\n  private featureCache: LRUCache<Promise<RenderFeature[]>>;\n  private tileCache: LRUCache<Promise<HTMLCanvasElement>>;\n  private tileFunction_: UrlFunction;\n  private styleFunction_: StyleFunction;\n  private projection_ = getProjection('EPSG:3857');\n\n  /**\n * When <code>true</code>, this model is ready to render, i.e., the external binary, image,\n * and shader files were downloaded and the WebGL resources were created.\n */\n  get ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n * Gets the rectangle, in radians, of the imagery provided by the instance.\n */\n  get rectangle() {\n    return this.rectangle_;\n  }\n\n  /**\n   * Gets the tiling scheme used by the provider.\n   */\n  get tilingScheme(): TilingScheme {\n    return this.tilingScheme_;\n  }\n\n  /**\n   * Gets an event that is raised when the imagery provider encounters an asynchronous error.  By subscribing\n   * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n   * are passed an instance of {@link Cesium.TileProviderError}.\n   */\n  readonly errorEvent: Event = new Cesium.Event();\n\n  /**\n   * Gets the credit to display when this imagery provider is active.  Typically this is used to credit\n   * the source of the imagery.\n   */\n  readonly credit: Credit;\n\n  getTileCredits(x: number, y: number, level: number): Credit[] {\n    return [];\n  }\n\n  /**\n   * Gets the proxy used by this provider.\n   */\n  readonly proxy: Proxy;\n\n  get _ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n   * Gets the tile discard policy.  If not undefined, the discard policy is responsible\n   * for filtering out \"missing\" tiles via its shouldDiscardImage function.  If this function\n   * returns undefined, no tiles are filtered.\n   */\n  get tileDiscardPolicy(): TileDiscardPolicy {\n    return undefined;\n  }\n\n  // FIXME: this might be exposed\n  /**\n   * Gets a value indicating whether or not the images provided by this imagery provider\n   * include an alpha channel.  If this property is false, an alpha channel, if present, will\n   * be ignored.  If this property is true, any images without an alpha channel will be treated\n   * as if their alpha is 1.0 everywhere.  When this property is false, memory usage\n   * and texture upload time are reduced.\n   */\n  get hasAlphaChannel() {\n    return true;\n  }\n\n  // FIXME: this could be implemented by proxying to OL\n  /**\n   * Asynchronously determines what features, if any, are located at a given longitude and latitude within\n   * a tile.\n   * This function is optional, so it may not exist on all ImageryProviders.\n   * @param x - The tile X coordinate.\n   * @param y - The tile Y coordinate.\n   * @param level - The tile level.\n   * @param longitude - The longitude at which to pick features.\n   * @param latitude - The latitude at which to pick features.\n   * @return A promise for the picked features that will resolve when the asynchronous\n   *                   picking completes.  The resolved value is an array of {@link ImageryLayerFeatureInfo}\n   *                   instances.  The array may be empty if no features are found at the given location.\n   *                   It may also be undefined if picking is not supported.\n   */\n  pickFeatures(x: number, y: number, level: number, longitude: number, latitude: number): Promise<ImageryLayerFeatureInfo[]> | undefined {\n    return undefined;\n  }\n\n  constructor(options: MVTOptions) {\n    this.urls = options.urls;\n    this.rectangle_ = options.rectangle || this.tilingScheme.rectangle;\n    this.credit = options.credit;\n    this.styleFunction_ = options.styleFunction || (() => styles);\n    this.tileRectangle_ = new Cesium.Rectangle();\n    // to avoid too frequent cache grooming we allow x2 capacity\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 50;\n    this.tileCache = new LRUCache(cacheSize);\n    this.featureCache = options.featureCache || new LRUCache(cacheSize);\n    this.minimumLevel_ = options.minimumLevel || 0;\n    const tileGrid = getTilegridForProjection(this.projection_);\n    this.tileFunction_ = createTileUrlFunctions(this.urls, tileGrid);\n  }\n\n  private getTileFeatures(z: number, x: number, y: number): Promise<RenderFeature[]> {\n    const cacheKey = this.getCacheKey_(z, x, y);\n    let promise;\n    if (this.featureCache.containsKey(cacheKey)) {\n      promise = this.featureCache.get(cacheKey);\n    }\n    if (!promise) {\n      const url = this.getUrl_(z, x, y);\n      promise = fetch(url)\n          .then(r => (r.ok ? r : Promise.reject(r)))\n          .then(r => r.arrayBuffer())\n          .then(buffer => this.readFeaturesFromBuffer(buffer));\n      this.featureCache.set(cacheKey, promise);\n      if (this.featureCache.getCount() > 2 * this.featureCache.highWaterMark) {\n        while (this.featureCache.canExpireCache()) {\n          this.featureCache.pop();\n        }\n      }\n    }\n    return promise;\n  }\n\n  readFeaturesFromBuffer(buffer: ArrayBuffer): RenderFeature[] {\n    let options;\n    if (OL_VERSION <= '6.4.4') {\n      // See https://github.com/openlayers/openlayers/pull/11540\n      options = {\n        extent: [0, 0, 4096, 4096],\n        dataProjection: this.projection_,\n        featureProjection: this.projection_\n      };\n    }\n    const features = format.readFeatures(buffer, options) as RenderFeature[];\n    const scaleFactor = this.tileWidth / 4096;\n    features.forEach((f) => {\n      const flatCoordinates = f.getFlatCoordinates();\n      let flip = false;\n      for (let i = 0; i < flatCoordinates.length; ++i) {\n        flatCoordinates[i] *= scaleFactor;\n        if (flip) {\n          // FIXME: why do we need this now?\n          flatCoordinates[i] = this.tileWidth - flatCoordinates[i];\n        }\n        if (OL_VERSION <= '6.4.4') {\n          // LEGACY\n          flip = !flip;\n        }\n      }\n    });\n\n    return features;\n  }\n\n  private getUrl_(z: number, x: number, y: number): string {\n    // FIXME: probably we should not pass 1 as pixelRatio\n    const url = this.tileFunction_([z, x, y], 1, this.projection_);\n    return url;\n  }\n\n  private getCacheKey_(z: number, x: number, y: number) {\n    return `${z}_${x}_${y}`;\n  }\n\n  requestImage(x: number, y: number, z: number, request?: Request): Promise<ImageryTypes> | undefined {\n    if (z < this.minimumLevel_) {\n      return this.emptyCanvasPromise_;\n    }\n\n    try {\n      const cacheKey = this.getCacheKey_(z, x, y);\n      let promise;\n      if (this.tileCache.containsKey(cacheKey)) {\n        promise = this.tileCache.get(cacheKey);\n      }\n      if (!promise) {\n        promise = this.getTileFeatures(z, x, y)\n            .then((features) => {\n            // FIXME: here we suppose the 2D projection is in meters\n              this.tilingScheme.tileXYToNativeRectangle(x, y, z, this.tileRectangle_);\n              const resolution = (this.tileRectangle_.east - this.tileRectangle_.west) / this.tileWidth;\n              return this.rasterizeFeatures(features, this.styleFunction_, resolution);\n            });\n        this.tileCache.set(cacheKey, promise);\n        if (this.tileCache.getCount() > 2 * this.tileCache.highWaterMark) {\n          while (this.tileCache.canExpireCache()) {\n            this.tileCache.pop();\n          }\n        }\n      }\n      return promise;\n    } catch (e) {\n      console.trace(e);\n      // FIXME: open PR on Cesium to fix incorrect typing\n      // @ts-ignore\n      this.errorEvent.raiseEvent('could not render pbf to tile', e);\n    }\n  }\n\n  rasterizeFeatures(features: RenderFeature[], styleFunction: StyleFunction, resolution: number): HTMLCanvasElement {\n    const canvas = document.createElement('canvas');\n    const vectorContext = toContext(canvas.getContext('2d'), {size: [this.tileWidth, this.tileHeight]});\n    features.forEach((f) => {\n      const styles = styleFunction(f, resolution);\n      if (styles) {\n        if (Array.isArray(styles)) {\n          styles.forEach((style) => {\n            vectorContext.setStyle(style);\n            vectorContext.drawGeometry(f);\n          });\n        } else {\n          vectorContext.setStyle(styles);\n          vectorContext.drawGeometry(f);\n        }\n      }\n    });\n    return canvas;\n  }\n}\n", "import {linear as linearEasing} from 'ol/easing.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {get as getProjection, type ProjectionLike, transformExtent} from 'ol/proj.js';\nimport olSourceImageStatic from 'ol/source/ImageStatic.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceVectorTile from 'ol/source/VectorTile.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider';\nimport {getSourceProjection} from './util';\nimport MVTImageryProvider from './MVTImageryProvider';\nimport VectorTileLayer from 'ol/layer/VectorTile.js';\nimport {type Extent, getCenter as getExtentCenter} from 'ol/extent.js';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type LayerGroup from 'ol/layer/Group.js';\nimport type {\n  BoundingSphere,\n  Camera,\n  Cartesian2,\n  Cartesian3,\n  Cartographic,\n  Color, ImageMaterialProperty,\n  ImageryLayer,\n  Matrix4,\n  Ray,\n  Rectangle,\n  Scene,\n  SingleTileImageryProvider\n} from 'cesium';\nimport type Geometry from 'ol/geom/Geometry.js';\nimport type {Coordinate} from 'ol/coordinate.js';\nimport type Source from 'ol/source/Source.js';\n// eslint-disable-next-line no-duplicate-imports\nimport type {Attribution} from 'ol/source/Source.js';\n\nimport type Map from 'ol/Map.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport type {Color as OLColor} from 'ol/color.js';\nimport type View from 'ol/View.js';\n\ntype CesiumUrlDefinition = {\n    url: string,\n    subdomains: string\n}\n\n\n/**\n * Options for rotate around axis core function.\n */\ntype RotateAroundAxisOption = {\n  duration?: number,\n  easing?: (value: number) => number,\n  callback: () => void\n}\n\n\nexport type LayerWithParents = {\n  layer: BaseLayer,\n  parents: LayerGroup[] | BaseLayer[]\n}\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n */\nexport function computePixelSizeAtCoordinate(scene: Scene, target: Cartesian3): Cartesian2 {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  // @ts-ignore TS2341\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight, distance, scene.pixelRatio, new Cesium.Cartesian2());\n}\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexport function computeBoundingBoxAtTarget(scene: Scene, target: Cartesian3, amount: number): Cartographic[] {\n  const pixelSize = computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n}\n\nexport function applyHeightOffsetToGeometry(geometry: Geometry, height: number) {\n  geometry.applyTransform((input, output, stride) => {\n    console.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n}\n\nexport function createMatrixAtCoordinates(\n    coordinates: Coordinate,\n    rotation = 0,\n    translation = Cesium.Cartesian3.ZERO,\n    scale = new Cesium.Cartesian3(1, 1, 1)\n): Matrix4 {\n  const position = ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n}\n\nexport function rotateAroundAxis(camera: Camera, angle: number, axis: Cartesian3, transform: Matrix4,\n    opt_options?: RotateAroundAxisOption) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options: RotateAroundAxisOption = opt_options;\n  const duration = defaultValue(options?.duration, 500); // ms\n  const easing = defaultValue(options?.easing, linearEasing);\n  const callback = options?.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    console.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n}\n\nexport function setHeadingUsingBottomCenter(\n    scene: Scene,\n    heading: number,\n    bottomCenter: Cartesian3,\n    options?: RotateAroundAxisOption\n) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  rotateAroundAxis(camera, heading, zenith, transform, options);\n}\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n */\nexport function pickOnTerrainOrEllipsoid(scene: Scene, pixel: Cartesian2): Cartesian3 {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n}\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n */\nexport function pickBottomPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return pickOnTerrainOrEllipsoid(scene, bottom);\n}\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n */\nexport function pickCenterPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return pickOnTerrainOrEllipsoid(scene, center);\n}\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n */\nexport function computeSignedTiltAngleOnGlobe(scene: Scene): number | undefined {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n}\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n */\nexport function bottomFovRay(scene: Scene): Ray {\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n}\n\n\n/**\n * Compute the angle between two Cartesian3.\n */\nexport function signedAngleBetween(first: Cartesian3, second: Cartesian3, normal: Cartesian3): number {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n}\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n */\nexport function computeAngleToZenith(scene: Scene, pivot: Cartesian3): number {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fy = camera.frustum.fovy / 2;\n  const ray = bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = signedAngleBetween(normal, direction, left);\n  return a + fy;\n}\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n */\nexport function extentToRectangle(extent: Extent, projection: ProjectionLike) {\n  if (extent && projection) {\n    const ext = transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n}\n\nexport function sourceToImageryProvider(\n    olMap: Map,\n    source: Source,\n    viewProj: Projection,\n    olLayer: BaseLayer\n): olcsCoreOLImageryProvider | MVTImageryProvider | SingleTileImageryProvider {\n  const skip = source.get('olcs_skip');\n  if (skip) {\n    return null;\n  }\n  let provider = null;\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n  source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n    // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (isCesiumProjection(projection)) {\n      provider = new olcsCoreOLImageryProvider(olMap, source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceImageStatic) {\n    let projection = getSourceProjection(source);\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (isCesiumProjection(projection)) {\n      const rectangle: Rectangle = Cesium.Rectangle.fromDegrees(\n          source.getImageExtent()[0],\n          source.getImageExtent()[1],\n          source.getImageExtent()[2],\n          source.getImageExtent()[3],\n          new Cesium.Rectangle()\n      );\n      provider = new Cesium.SingleTileImageryProvider({\n        url: source.getUrl(),\n        rectangle\n      });\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceVectorTile && olLayer instanceof VectorTileLayer) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (skip === false) {\n    // MVT is experimental, it should be whitelisted to be synchronized\n      const fromCode = projection.getCode().split(':')[1];\n      // @ts-ignore TS2341\n      const urls = source.urls.map(u => u.replace(fromCode, '3857'));\n      const extent = olLayer.getExtent();\n      const rectangle = extentToRectangle(extent, projection);\n      const minimumLevel = source.get('olcs_minimumLevel');\n      const attributionsFunction = source.getAttributions();\n      const styleFunction = olLayer.getStyleFunction();\n      let credit;\n      if (extent && attributionsFunction) {\n        const center = getExtentCenter(extent);\n        credit = attributionsFunctionToCredits(attributionsFunction, 0, center, extent)[0];\n      }\n\n      provider = new MVTImageryProvider({\n        credit,\n        rectangle,\n        minimumLevel,\n        styleFunction,\n        urls\n      });\n      return provider;\n    }\n    return null; // FIXME: it is disabled by default right now\n  } else {\n    // sources other than TileImage|Imageexport function are currently not supported\n    return null;\n  }\n  return provider;\n}\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers and export function images\n */\nexport function tileLayerToImageryLayer(olMap: Map, olLayer: BaseLayer, viewProj: Projection): ImageryLayer | null {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage) &&\n  !(olLayer instanceof VectorTileLayer)) {\n    return null;\n  }\n\n  const source = olLayer.getSource();\n  if (!source) {\n    return null;\n  }\n  let provider = source.get('olcs_provider');\n  if (!provider) {\n    provider = sourceToImageryProvider(olMap, source, viewProj, olLayer);\n  }\n  if (!provider) {\n    return null;\n  }\n\n  const layerOptions: {rectangle?: Rectangle} = {};\n\n  const forcedExtent = (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n}\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n */\nexport function updateCesiumLayerProperties(olLayerWithParents: LayerWithParents, csLayer: ImageryLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible = visible && layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n}\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n */\nexport function ol4326CoordinateToCesiumCartesian(coordinate: Coordinate): Cartesian3 {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n}\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n */\nexport function ol4326CoordinateArrayToCsCartesians(coordinates: Coordinate[]): Cartesian3[] {\n  console.assert(coordinates !== null);\n  const toCartesian = ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n}\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n */\nexport function olGeometryCloneTo4326<T extends Geometry>(geometry: T, projection: ProjectionLike): T {\n  console.assert(projection);\n\n  const proj4326 = getProjection('EPSG:4326');\n  const proj = getProjection(projection);\n  if (proj.getCode() !== proj4326.getCode()) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone() as T;\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n}\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n */\nexport function convertColorToCesium(olColor: OLColor | CanvasGradient | CanvasPattern | string): Color | ImageMaterialProperty {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  } else if (olColor instanceof CanvasPattern || olColor instanceof CanvasGradient) {\n    // Render the CanvasPattern/CanvasGradient into a canvas that will be sent to Cesium as material\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = canvas.height = 256;\n    ctx.fillStyle = olColor;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    return new Cesium.ImageMaterialProperty({\n      image: canvas\n    });\n  }\n  console.assert(false, 'impossible');\n}\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n */\nexport function convertUrlToCesium(url: string): CesiumUrlDefinition {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n}\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n */\nexport function resetToNorthZenith(map: Map, scene: Scene): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options: RotateAroundAxisOption = {\n      callback: () => {\n        const view = map.getView();\n        normalizeView(view);\n        resolve(undefined);\n      }\n    };\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexport function rotateAroundBottomCenter(scene: Scene, angle: number): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options: RotateAroundAxisOption = {callback: () => resolve(undefined)};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n */\nexport function normalizeView(view: View, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n\n  // @ts-ignore TS2341\n  if (view.constrainResolution) {\n    // @ts-ignore TS2341\n    view.setResolution(view.constrainResolution(resolution));\n  } else {\n    view.setResolution(view.getConstrainedResolution(resolution));\n  }\n}\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n */\nexport function isCesiumProjection(projection: Projection): boolean {\n  const is3857 = projection.getCode() === 'EPSG:3857';\n  const is4326 = projection.getCode() === 'EPSG:4326';\n  return is3857 || is4326;\n}\n\nexport function attributionsFunctionToCredits(\n    attributionsFunction: Attribution | null,\n    zoom: number,\n    center: Coordinate,\n    extent: Extent\n) {\n\n  if (!attributionsFunction) {\n    return [];\n  }\n  let attributions = attributionsFunction({\n    viewState: {zoom, center, projection: undefined, resolution: undefined, rotation: undefined},\n    extent,\n  });\n  if (!Array.isArray(attributions)) {\n    attributions = [attributions];\n  }\n\n  return attributions.map(html => new Cesium.Credit(html, true));\n}\n\n/**\n * calculate the distance between camera and centerpoint based on the resolution and latitude value\n */\nexport function calcDistanceForResolution(\n    resolution: number,\n    latitude: number,\n    scene: Scene,\n    projection: Projection\n): number {\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  // number of \"map units\" visible in 2D (vertically)\n  const visibleMapUnits = resolution * canvas.clientHeight;\n\n  // The metersPerUnit does not take latitude into account, but it should\n  // be lower with increasing latitude -- we have to compensate.\n  // In 3D it is not possible to maintain the resolution at more than one point,\n  // so it only makes sense to use the latitude of the \"target\" point.\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n\n  // how many meters should be visible in 3D\n  const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n  // distance required to view the calculated length in meters\n  //\n  //  fovy/2\n  //    |\\\n  //  x | \\\n  //    |--\\\n  // visibleMeters/2\n  const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n  // NOTE: This calculation is not absolutely precise, because metersPerUnit\n  // is a great simplification. It does not take ellipsoid/terrain into account.\n\n  return requiredDistance;\n}\n\n/**\n * calculate the resolution based on a distance(camera to position) and latitude value\n */\nexport function calcResolutionForDistance(distance: number, latitude: number, scene: Scene, projection: Projection): number {\n  // See the reverse calculation (calcDistanceForResolution) for details\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n  const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n  const resolution = visibleMapUnits / canvas.clientHeight;\n\n  return resolution;\n}\n\n/**\n * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n * Near the ground the allowed distance is shorter.\n */\nexport function limitCameraToBoundingSphere(camera: Camera, boundingSphere: BoundingSphere, ratio: (height: number) => number): () => void {\n  let blockLimiter = false;\n  return function() {\n    if (!blockLimiter) {\n      const position = camera.position;\n      const carto = Cesium.Cartographic.fromCartesian(position);\n      if (Cesium.Cartesian3.distance(boundingSphere.center, position) > boundingSphere.radius * ratio(carto.height)) {\n        // @ts-ignore TS2339: FIXME, there is no flying property in Camera\n        const currentlyFlying = camera.flying;\n        if (currentlyFlying === true) {\n          // There is a flying property and its value is true\n          return;\n        } else {\n          blockLimiter = true;\n          const unblockLimiter = () => (blockLimiter = false);\n          camera.flyToBoundingSphere(boundingSphere, {\n            complete: unblockLimiter,\n            cancel: unblockLimiter,\n          });\n        }\n      }\n    }\n  };\n}\n", "import type {Scene} from 'cesium';\nimport type OLCesium from './OLCesium';\n\n/**\n * By default Cesium (used to?) renders as often as possible.\n * This is a waste of resources (CPU/GPU/battery).\n * An alternative mechanism in Cesium is on-demand rendering.\n * This class makes use of this alternative method and add some additionnal render points.\n */\nexport default class AutoRenderLoop {\n  ol3d: OLCesium;\n  private scene_: Scene;\n  private canvas_: HTMLCanvasElement;\n  private _boundNotifyRepaintRequired: typeof this.notifyRepaintRequired;\n  private repaintEventNames_ = [\n    'mousemove', 'mousedown', 'mouseup',\n    'touchstart', 'touchend', 'touchmove',\n    'pointerdown', 'pointerup', 'pointermove',\n    'wheel'\n  ] as const;\n\n  /**\n   * @param ol3d\n   */\n  constructor(ol3d: OLCesium) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n", "/**\n * Converts radians to to degrees.\n *\n * @param angleInRadians Angle in radians.\n * @return Angle in degrees.\n */\nexport function toDegrees(angleInRadians: number): number {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param angleInDegrees Angle in degrees.\n * @return Angle in radians.\n */\nexport function toRadians(angleInDegrees: number): number {\n  return angleInDegrees * Math.PI / 180;\n}\n", "import {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math';\nimport {getTransform} from 'ol/proj.js';\nimport {pickCenterPoint, calcDistanceForResolution, calcResolutionForDistance} from './core';\nimport type {Map, View} from 'ol';\nimport type {Scene, Camera as CesiumCamera, Matrix4, HeadingPitchRollValues} from 'cesium';\nimport type {EventsKey} from 'ol/events.js';\n\n/**\n * @param input Input coordinate array.\n * @param opt_output Output array of coordinate values.\n * @param opt_dimension Dimension.\n * @return Input coordinate array (same array as input).\n */\nexport function identityProjection(input: number[], opt_output?: number[], opt_dimension?: number): number[] {\n  const dim = opt_dimension || input.length;\n  if (opt_output) {\n    for (let i = 0; i < dim; ++i) {\n      opt_output[i] = input[i];\n    }\n  }\n  return input;\n}\n\nexport default class Camera {\n  private scene_: Scene;\n  private cam_: CesiumCamera;\n  private map_: Map;\n  private view_: View;\n\n  private viewListenKey_: EventsKey = null;\n\n  private toLonLat_ = identityProjection;\n  private fromLonLat_ = identityProjection;\n\n  /**\n   * 0 -- topdown, PI/2 -- the horizon\n   */\n  private tilt_: number = 0;\n  private distance_ = 0;\n  private lastCameraViewMatrix_: Matrix4 = null;\n\n  /**\n   * This is used to discard change events on view caused by updateView method.\n   */\n  private viewUpdateInProgress_ = false;\n\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   */\n  constructor(scene: Scene, map: Map) {\n    this.scene_ = scene;\n    this.cam_ = scene.camera;\n    this.map_ = map;\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  destroy() {\n    olObservableUnByKey(this.viewListenKey_);\n    this.viewListenKey_ = null;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view: View | undefined) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewChangedEvent_());\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = identityProjection;\n      this.fromLonLat_ = identityProjection;\n    }\n  }\n\n  private handleViewChangedEvent_() {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @deprecated\n   * @param heading In radians.\n   */\n  setHeading(heading: number) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @deprecated\n   * @return Heading in radians.\n   */\n  getHeading(): number|undefined {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param tilt In radians.\n   */\n  setTilt(tilt: number) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return Tilt in radians.\n   */\n  getTilt(): number {\n    return this.tilt_;\n  }\n\n  /**\n   * @param distance In meters.\n   */\n  setDistance(distance: number) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return Distance in meters.\n   */\n  getDistance(): number {\n    return this.distance_;\n  }\n\n  /**\n   * @deprecated\n   * Shortcut for ol.View.setCenter().\n   * @param center Same projection as the ol.View.\n   */\n  setCenter(center: number[]) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * @deprecated\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param position Same projection as the ol.View.\n   */\n  setPosition(position: number[]) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return Coordinates in same projection as the ol.View.\n   * @api\n   */\n  getPosition(): number[] | undefined {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param altitude In meters.\n   */\n  setAltitude(altitude: number) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return Altitude in meters.\n   */\n  getAltitude(): number {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   */\n  private updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    const orientation: HeadingPitchRollValues = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync?: boolean) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-7)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param resolution Number of map units per pixel.\n   * @param latitude Latitude in radians.\n   * @return The calculated distance.\n   */\n  calcDistanceForResolution(resolution: number, latitude: number): number {\n    return calcDistanceForResolution(resolution, latitude, this.scene_, this.view_.getProjection());\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param distance\n   * @param latitude\n   * @return} The calculated resolution.\n   */\n  calcResolutionForDistance(distance: number, latitude: number): number {\n    return calcResolutionForDistance(distance, latitude, this.scene_, this.view_.getProjection());\n  }\n}\n", "import {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport LayerGroup from 'ol/layer/Group.js';\nimport {getUid} from './util';\nimport type Map from 'ol/Map.js';\nimport type {Scene, ImageryLayer} from 'cesium';\nimport type View from 'ol/View.js';\nimport type Collection from 'ol/Collection.js';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type {EventsKey} from 'ol/events.js';\nimport type {LayerWithParents} from './core';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n\nexport default abstract class AbstractSynchronizer<T extends ImageryLayer | VectorLayerCounterpart> {\n  protected map: Map;\n  protected view: View;\n  protected scene: Scene;\n  protected olLayers: Collection<BaseLayer>;\n  mapLayerGroup: LayerGroup;\n  /**\n   * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n   * Null value means, that we are unable to create equivalent layers.\n   */\n  protected layerMap: Record<string, Array<T>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer layers ids (from getUid).\n   */\n  protected olLayerListenKeys: Record<string, Array<EventsKey>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer groups ids (from getUid).\n   */\n  private olGroupListenKeys_: Record<string, Array<EventsKey>> = {};\n\n  protected constructor(map: Map, scene: Scene) {\n    this.map = map;\n    this.view = map.getView();\n    this.scene = scene;\n    this.olLayers = map.getLayerGroup().getLayers();\n    this.mapLayerGroup = map.getLayerGroup();\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   */\n  protected orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   */\n  private addLayers_(root: BaseLayer) {\n    const fifo: LayerWithParents[] = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof LayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents: LayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = () => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(layerWithParents.layer.on('change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   */\n  private addCesiumObjects_(cesiumObjects: Array<T>, layerId: string, layer: BaseLayer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(layer.on('change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   */\n  private removeAndDestroySingleLayer_(layer: BaseLayer): boolean {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   */\n  private unlistenSingleGroup_(group: LayerGroup) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   */\n  private removeLayer_(root: BaseLayer) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof LayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   */\n  private listenForGroupChanges_(group: LayerGroup) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray: EventsKey[] = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys: EventsKey[] = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   */\n  public destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   */\n  protected abstract addCesiumObject(object: T): void;\n\n  protected abstract destroyCesiumObject(object: T): void;\n\n  /**\n   * Remove single Cesium object from the collection.\n   */\n  protected abstract removeSingleCesiumObject(object: T, destroy: boolean): void;\n\n  protected abstract removeAllCesiumObjects(destroy: boolean): void;\n\n  protected abstract createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): Array<T>;\n}\n", "import type Map from 'ol/Map.js';\nimport {getUid} from './util';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport {type LayerWithParents, tileLayerToImageryLayer, updateCesiumLayerProperties} from './core';\nimport type {Scene, ImageryLayer, ImageryLayerCollection} from 'cesium';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport BaseVectorLayer from 'ol/layer/BaseVector.js';\nimport LayerGroup from 'ol/layer/Group.js';\n\nexport default class RasterSynchronizer extends olcsAbstractSynchronizer<ImageryLayer> {\n  private cesiumLayers_: ImageryLayerCollection;\n  private ourLayers_: ImageryLayerCollection;\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   */\n  constructor(map: Map, scene: Scene) {\n    super(map, scene);\n\n    this.cesiumLayers_ = scene.imageryLayers;\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  addCesiumObject(object: ImageryLayer): void {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  destroyCesiumObject(object: ImageryLayer): void {\n    object.destroy();\n  }\n\n  removeSingleCesiumObject(object: ImageryLayer, destroy: boolean): void {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  removeAllCesiumObjects(destroy: boolean): void {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   */\n  protected convertLayerToCesiumImageries(olLayer: BaseLayer, viewProj: Projection): ImageryLayer[] {\n    const result = tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): ImageryLayer[] {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      if (olLayer instanceof BaseVectorLayer) {\n        let previousStyleFunction = olLayer.getStyleFunction();\n        // there is no convenient way to detect a style function change in OL\n        listenKeyArray.push(olLayer.on('change', () => {\n          const currentStyleFunction = olLayer.getStyleFunction();\n          if (previousStyleFunction === currentStyleFunction) {\n            return;\n          }\n          previousStyleFunction = currentStyleFunction;\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            const csObj = cesiumObjects[i];\n            // clear cache and set new style\n            // @ts-ignore TS2341\n            if (csObj._imageryCache) {\n              // @ts-ignore TS2341\n              csObj._imageryCache = {};\n            }\n\n            const ip = csObj.imageryProvider;\n            if (ip) {\n              // @ts-ignore TS2341\n              ip.tileCache?.clear();\n              // @ts-ignore TS2341\n              ip.styleFunction_ = currentStyleFunction;\n            }\n          }\n          this.scene.requestRender();\n        }));\n      }\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices: Record<number, number> = {};\n    const queue: Array<BaseLayer | LayerGroup> = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex() || 0;\n\n      if (olLayer instanceof LayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    // We assume sort is stable (which has been in the spec since a long time already).\n    // See https://caniuse.com/mdn-javascript_builtins_array_sort_stable\n    layers.sort((layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  raiseToTop(counterpart: ImageryLayer) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n", "import {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport type {Billboard, BillboardCollection, Primitive, PrimitiveCollection, Scene} from 'cesium';\nimport type {EventsKey} from 'ol/events.js';\n\n\n/**\n * Context for feature conversion.\n */\nexport type OlFeatureToCesiumContext = {\n  projection: Projection | string,\n  billboards: BillboardCollection,\n  featureToCesiumMap: Record<number, Array<Primitive | Billboard>>,\n  primitives: PrimitiveCollection\n};\n\n\nexport default class VectorLayerCounterpart {\n  olListenKeys: EventsKey[] = [];\n  context: OlFeatureToCesiumContext;\n  private rootCollection_: PrimitiveCollection;\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  */\n  constructor(layerProjection: Projection | string, scene: Scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  getRootPrimitive(): PrimitiveCollection {\n    return this.rootCollection_;\n  }\n}\n\n\nexport type PrimitiveCollectionCounterpart = PrimitiveCollection & {counterpart: VectorLayerCounterpart};\n", "import OLStyleIcon from 'ol/style/Icon.js';\nimport VectorSource, {type VectorSourceEvent} from 'ol/source/Vector.js';\nimport OLClusterSource from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport {convertColorToCesium, olGeometryCloneTo4326, ol4326CoordinateToCesiumCartesian, ol4326CoordinateArrayToCsCartesians} from './core';\nimport VectorLayerCounterpart, {type OlFeatureToCesiumContext} from './core/VectorLayerCounterpart';\nimport {getUid, waitReady} from './util';\nimport type {CircleGeometry, CircleOutlineGeometry, Primitive, Billboard, Label, Matrix4, Scene, Geometry as CSGeometry, Color as CSColor, GroundPrimitive, PrimitiveCollection, ImageMaterialProperty, BillboardCollection, Cartesian3, GroundPolylinePrimitive, PolygonHierarchy, HeightReference, Model, LabelCollection, Material} from 'cesium';\nimport type VectorLayer from 'ol/layer/Vector.js';\nimport type ImageLayer from 'ol/layer/Image.js';\nimport type {Feature, View} from 'ol';\nimport type Text from 'ol/style/Text.js';\nimport {type default as Style, type StyleFunction} from 'ol/style/Style.js';\nimport type {ColorLike as OLColorLike} from 'ol/colorlike.js';\nimport type {Color as OLColor} from 'ol/color.js';\nimport type {ProjectionLike} from 'ol/proj.js';\nimport {Geometry as OLGeometry, type MultiLineString, type MultiPolygon, type MultiPoint, type GeometryCollection, type Circle, type LineString, type Point, type Polygon} from 'ol/geom.js';\nimport type ImageStyle from 'ol/style/Image.js';\n\n\ntype ModelFromGltfOptions = Parameters<typeof Model.fromGltfAsync>[0];\n\ntype PrimitiveLayer = VectorLayer<any> | ImageLayer<any>;\n\ndeclare module 'cesium' {\n  // eslint-disable-next-line no-unused-vars\n  interface Primitive {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface GroundPolylinePrimitive {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n    _primitive: Primitive; // Missing from types published by Cesium\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface GroundPrimitive {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface Label {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface Billboard {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n}\n\ninterface ModelStyle {\n  debugModelMatrix?: Matrix4;\n  cesiumOptions: ModelFromGltfOptions;\n}\n\ninterface MaterialAppearanceOptions {\n  flat: boolean;\n  renderState: {\n    depthTest: {\n      enabled: boolean;\n    },\n    lineWidth?: number;\n  }\n}\n\nexport default class FeatureConverter {\n\n  /**\n   * Bind once to have a unique function for using as a listener\n   */\n  private boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n  private defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param scene Cesium scene.\n   * @api\n   */\n  constructor(protected scene: Scene) {\n    this.scene = scene;\n  }\n\n  /**\n   * @param evt\n   */\n  private onRemoveOrClearFeature_(evt: VectorSourceEvent) {\n    const source = evt.target;\n    console.assert(source instanceof VectorSource);\n\n    const cancellers = source['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        source['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param layer\n   * @param feature OpenLayers feature.\n   * @param primitive\n   */\n  protected setReferenceForPicking(layer: PrimitiveLayer, feature: Feature, primitive: GroundPolylinePrimitive | GroundPrimitive | Primitive| Label|Billboard) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param layer\n   * @param feature OpenLayers feature.\n   * @param olGeometry OpenLayers geometry.\n   * @param geometry\n   * @param color\n   * @param opt_lineWidth\n   * @return primitive\n   */\n  protected createColoredPrimitive(layer: PrimitiveLayer, feature: Feature, olGeometry: OLGeometry, geometry: CSGeometry | CircleGeometry, color: CSColor| ImageMaterialProperty, opt_lineWidth?: number): Primitive | GroundPrimitive {\n    const createInstance = function(geometry: CSGeometry | CircleGeometry, color: CSColor | ImageMaterialProperty) {\n      const instance = new Cesium.GeometryInstance({\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options: MaterialAppearanceOptions = {\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive: GroundPrimitive | Primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      if (!('createShadowVolume' in instances.geometry.constructor)) {\n        // This is not a ground geometry\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      // FIXME: we created stylings which are not time related\n      // What should we pass here?\n      // @ts-ignore\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true,\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.MaterialAppearance({\n        ...options,\n        material: new Cesium.Material({\n          translucent: color.alpha !== 1,\n          fabric: {\n            type: 'Color',\n            uniforms: {\n              color,\n            }\n          }\n        })\n      });\n      if (primitive instanceof Cesium.Primitive && (feature.get('olcs_shadows') || layer.get('olcs_shadows'))) {\n        primitive.shadows = 1;\n      }\n    }\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param style\n   * @param outline\n   * @return {!CSColor}\n   */\n  protected extractColorFromOlStyle(style: Style | Text, outline: boolean) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor: OLColorLike | OLColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param style\n   * @return {number}\n   */\n  protected extractLineWidthFromOlStyle(style: Style | Text) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   */\n  protected wrapFillAndOutlineGeometries(layer: PrimitiveLayer, feature: Feature, olGeometry: OLGeometry, fillGeometry: CSGeometry | CircleGeometry, outlineGeometry: CSGeometry | CircleOutlineGeometry, olStyle: Style): PrimitiveCollection {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n\n  // FIXME: would make more sense to only accept primitive collection.\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   */\n  protected addTextStyle(layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry, style: Style, primitive: Primitive | PrimitiveCollection | GroundPolylinePrimitive): PrimitiveCollection {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param billboards\n   * @param bbOptions\n   * @param layer\n   * @param feature OpenLayers feature.\n   * @param geometry\n   * @param style\n   * @return newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards: BillboardCollection, bbOptions: Parameters<BillboardCollection['add']>[0], layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry, style: Style): Billboard {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @api\n   */\n  olCircleGeometryToCesium(layer: PrimitiveLayer, feature: Feature, olGeometry: Circle, projection: ProjectionLike, olStyle: Style): PrimitiveCollection {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    const olCenter = olGeometry.getCenter();\n    const height = olCenter.length == 3 ? olCenter[2] : 0.0;\n    const olPoint = olCenter.slice();\n    olPoint[0] += olGeometry.getRadius();\n\n    // Cesium\n    const center: Cartesian3 = ol4326CoordinateToCesiumCartesian(olCenter);\n    const point: Cartesian3 = ol4326CoordinateToCesiumCartesian(olPoint);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive: Primitive | GroundPrimitive | GroundPolylinePrimitive;\n    let outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        const op = outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n          geometryInstances: new Cesium.GeometryInstance({\n            geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n          }),\n          appearance: new Cesium.PolylineMaterialAppearance({\n            material: this.olStyleToCesium(feature, olStyle, true),\n          }),\n          classificationType: Cesium.ClassificationType.TERRAIN,\n        });\n        waitReady(outlinePrimitive).then(() => {\n          this.setReferenceForPicking(layer, feature, op._primitive);\n        });\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @api\n   */\n  olLineStringGeometryToCesium(layer: PrimitiveLayer, feature: Feature, olGeometry: LineString, projection: ProjectionLike, olStyle: Style): PrimitiveCollection {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive: Primitive | GroundPolylinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    const appearance = new Cesium.PolylineMaterialAppearance({\n      material: this.olStyleToCesium(feature, olStyle, true)\n    });\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const geometry = new Cesium.GroundPolylineGeometry({\n        positions,\n        width,\n      });\n      const op = outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n        appearance,\n        geometryInstances: new Cesium.GeometryInstance({\n          geometry\n        })\n      });\n      waitReady(outlinePrimitive).then(() => {\n        this.setReferenceForPicking(layer, feature, op._primitive);\n      });\n    } else {\n      const geometry = new Cesium.PolylineGeometry({\n        positions,\n        width,\n        vertexFormat: appearance.vertexFormat\n      });\n      outlinePrimitive = new Cesium.Primitive({\n        appearance,\n        geometryInstances: new Cesium.GeometryInstance({\n          geometry\n        }),\n      });\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @api\n   */\n  olPolygonGeometryToCesium(layer: PrimitiveLayer, feature: Feature, olGeometry: Polygon, projection: ProjectionLike, olStyle: Style): PrimitiveCollection {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry;\n    let outlinePrimitive: GroundPolylinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      const featureExtrudedHeight = feature.get('olcs_extruded_height');\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      const hierarchy: PolygonHierarchy = {\n        positions: [],\n        holes: [],\n      };\n      const polygonHierarchy: PolygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i === 0) {\n          hierarchy.positions = positions;\n        } else {\n          hierarchy.holes.push({\n            positions,\n            holes: [],\n          });\n        }\n      }\n\n      const featureExtrudedHeight = feature.get('olcs_extruded_height');\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        polygonHierarchy,\n        perPositionHeight: true,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions: Cartesian3[][] = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          const appearance = new Cesium.PolylineMaterialAppearance({\n            material: this.olStyleToCesium(feature, olStyle, true)\n          });\n          const geometryInstances = [];\n          for (const linePositions of positions) {\n            const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n            geometryInstances.push(new Cesium.GeometryInstance({\n              geometry: polylineGeometry\n            }));\n          }\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            appearance,\n            geometryInstances\n          });\n          waitReady(outlinePrimitive).then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true,\n          extrudedHeight: featureExtrudedHeight,\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @api\n   */\n  getHeightReference(layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry): HeightReference {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer: PrimitiveLayer,\n      feature: Feature,\n      olGeometry: Point,\n      projection: ProjectionLike,\n      style: Style,\n      imageStyle: ImageStyle,\n      billboards: BillboardCollection,\n      opt_newBillboardCallback: (bb: Billboard) => void,\n  ) {\n    if (imageStyle instanceof OLStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image: HTMLImageElement) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const scale = imageStyle.getScale();\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions: Parameters<BillboardCollection['add']>[0] = {\n        image,\n        color,\n        scale,\n        heightReference,\n        position\n      };\n\n      // merge in cesium options from openlayers feature\n      Object.assign(bbOptions, feature.get('cesiumOptions'));\n\n      if (imageStyle instanceof OLStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          const xScale = (Array.isArray(scale) ? scale[0] : scale);\n          const yScale = (Array.isArray(scale) ? scale[1] : scale);\n          bbOptions.pixelOffset = new Cesium.Cartesian2(\n              (image.width / 2 - anchor[0]) * xScale,\n              (image.height / 2 - anchor[1]) * yScale\n          );\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = source['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = source['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param layer\n   * @param feature OpenLayers feature..\n   * @param olGeometry OpenLayers point geometry.\n   * @param projection\n   * @param style\n   * @param billboards\n   * @param opt_newBillboardCallback Called when the new billboard is added.\n   * @return primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer: PrimitiveLayer,\n      feature: Feature,\n      olGeometry: Point,\n      projection: ProjectionLike,\n      style: Style,\n      billboards: BillboardCollection,\n      opt_newBillboardCallback?: (bb: Billboard) => void\n  ): PrimitiveCollection {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive: PrimitiveCollection = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction: () => ModelStyle = olGeometry.get('olcs_model') || feature.get('olcs_model');\n      if (olcsModelFunction) {\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        const olcsModel = olcsModelFunction();\n        const options: ModelFromGltfOptions = Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions);\n        if ('fromGltf' in Cesium.Model) {\n          // pre Cesium v107\n          // @ts-ignore\n          const model = Cesium.Model.fromGltf(options);\n          modelPrimitive.add(model);\n        } else {\n          Cesium.Model.fromGltfAsync(options).then((model) => {\n            modelPrimitive.add(model);\n          });\n        }\n\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer: PrimitiveLayer,\n      feature: Feature,\n      geometry: OLGeometry,\n      projection: ProjectionLike,\n      olStyle: Style,\n      billboards: BillboardCollection,\n      opt_newBillboardCallback: (bb: Billboard) => void\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    switch (geometry.getType()) {\n      case 'MultiPoint': {\n        const points = (geometry as MultiPoint).getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          points.forEach((geom) => {\n            console.assert(geom);\n            const result = this.olPointGeometryToCesium(layer, feature, geom,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          points.forEach((geom) => {\n            console.assert(geom);\n            this.olPointGeometryToCesium(layer, feature, geom, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      }\n      case 'MultiLineString': {\n        const lineStrings = (geometry as MultiLineString).getLineStrings();\n        // FIXME: would be better to combine all child geometries in one primitive\n        // instead we create n primitives for simplicity.\n        const primitives = new Cesium.PrimitiveCollection();\n        lineStrings.forEach((geom) => {\n          const p = this.olLineStringGeometryToCesium(layer, feature, geom, projection, olStyle);\n          primitives.add(p);\n        });\n        return primitives;\n      }\n      case 'MultiPolygon': {\n        const polygons = (geometry as MultiPolygon).getPolygons();\n        // FIXME: would be better to combine all child geometries in one primitive\n        // instead we create n primitives for simplicity.\n        const primitives = new Cesium.PrimitiveCollection();\n        polygons.forEach((geom) => {\n          const p = this.olPolygonGeometryToCesium(layer, feature, geom, projection, olStyle);\n          primitives.add(p);\n        });\n        return primitives;\n      }\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry, style: Text): LabelCollection {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options: Parameters<LabelCollection['add']>[0] = {};\n\n    options.position = ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 || offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @api\n   */\n  olStyleToCesium(feature: Feature, style: Style, outline: boolean): Material {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    const olColor = outline ? stroke.getColor() : fill.getColor();\n    const color = convertColorToCesium(olColor);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @api\n   */\n  computePlainStyle(layer: PrimitiveLayer, feature: Feature, fallbackStyleFunction: StyleFunction, resolution: number): Style[] {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   */\n  protected getGeometryFromFeature(feature: Feature, style: Style, opt_geom?: OLGeometry): OLGeometry | undefined {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d: OLGeometry = feature.get('olcs.3d_geometry');\n    if (geom3d && geom3d instanceof OLGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof OLGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @api\n   */\n  olFeatureToCesium(layer: PrimitiveLayer, feature: Feature, style: Style, context: OlFeatureToCesiumContext, opt_geom?: OLGeometry): PrimitiveCollection {\n    const geom: OLGeometry = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb: Billboard) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        (geom as GeometryCollection).getGeometriesArray().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom as Point, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        return this.olCircleGeometryToCesium(layer, feature, geom as Circle, proj,\n            style);\n      case 'LineString':\n        return this.olLineStringGeometryToCesium(layer, feature, geom as LineString, proj,\n            style);\n      case 'Polygon':\n        return this.olPolygonGeometryToCesium(layer, feature, geom as Polygon, proj,\n            style);\n      case 'MultiPoint':\n        return this.olMultiGeometryToCesium(layer, feature, geom as MultiPoint, proj,\n            style, context.billboards, newBillboardAddedCallback) || null;\n      case 'MultiLineString':\n        return this.olMultiGeometryToCesium(layer, feature, geom as MultiLineString, proj,\n            style, context.billboards, newBillboardAddedCallback) || null;\n      case 'MultiPolygon':\n        return this.olMultiGeometryToCesium(layer, feature, geom as MultiPolygon, proj,\n            style, context.billboards, newBillboardAddedCallback) || null;\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @api\n   */\n  olVectorLayerToCesium(olLayer: VectorLayer<VectorSource>, olView: View, featurePrimitiveMap: Record<number, PrimitiveCollection>): VectorLayerCounterpart {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof OLClusterSource) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof VectorSource);\n    const features = source.getFeatures();\n    const counterpart = new VectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      const layerStyle: StyleFunction | undefined = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      let primitives: PrimitiveCollection = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @api\n   */\n  convert(layer: VectorLayer<VectorSource>, view: View, feature: Feature, context: OlFeatureToCesiumContext): PrimitiveCollection {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n", "import olSourceVector, {type VectorSourceEvent} from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {getUid} from './util';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerVectorTile from 'ol/layer/VectorTile.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport olcsFeatureConverter from './FeatureConverter';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n// eslint-disable-next-line no-duplicate-imports\nimport {\n  type OlFeatureToCesiumContext,\n  type PrimitiveCollectionCounterpart\n} from './core/VectorLayerCounterpart';\nimport type Map from 'ol/Map.js';\nimport {type LayerWithParents} from './core';\nimport type Feature from 'ol/Feature.js';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type {PrimitiveCollection, Scene} from 'cesium';\n\nexport default class VectorSynchronizer extends olcsAbstractSynchronizer<VectorLayerCounterpart> {\n  protected converter: olcsFeatureConverter;\n  private csAllPrimitives_: PrimitiveCollection;\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   */\n  constructor(map: Map, scene: Scene, opt_converter?: olcsFeatureConverter) {\n    super(map, scene);\n\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  addCesiumObject(counterpart: VectorLayerCounterpart) {\n    console.assert(counterpart);\n    const collection = <PrimitiveCollectionCounterpart>counterpart.getRootPrimitive();\n    collection.counterpart = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  destroyCesiumObject(object: VectorLayerCounterpart) {\n    object.getRootPrimitive().destroy();\n  }\n\n  removeSingleCesiumObject(object: VectorLayerCounterpart, destroy: boolean) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  removeAllCesiumObjects(destroy: boolean) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   */\n  updateLayerVisibility(olLayerWithParents: LayerWithParents, csPrimitive: PrimitiveCollection) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible = visible && layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): VectorLayerCounterpart[] {\n    const olLayer: BaseLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector) || olLayer instanceof olLayerVectorTile) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap: Record<number, PrimitiveCollection> = {};\n    const counterpart: VectorLayerCounterpart = this.converter.olVectorLayerToCesium(olLayer, view, featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olLayerItem.on('change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (feature: Feature) => {\n      const context = counterpart.context;\n      const prim: PrimitiveCollection = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    };\n\n    const onRemoveFeature = (feature: Feature) => {\n      const id = getUid(feature);\n      const context: OlFeatureToCesiumContext = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    };\n\n    olListenKeys.push(source.on('addfeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }));\n\n    olListenKeys.push(source.on('removefeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }));\n\n    olListenKeys.push(source.on('changefeature', (e: VectorSourceEvent) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n", "import OLOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport type {Scene} from 'cesium';\nimport type OverlaySynchronizer from './OverlaySynchronizer';\nimport type {EventsKey} from 'ol/events';\nimport type {ObjectEvent} from 'ol/Object';\n\n\n/**\n * @param node The node to remove.\n * @return The node that was removed or null.\n */\nfunction removeNode(node: Node): Node {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nfunction removeChildren(node: Node) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\nfunction cloneNode<T extends Node, U extends Node>(node: T, parent: U): T {\n  const clone = node.cloneNode() as T;\n  if (node.nodeName === 'CANVAS') {\n    const ctx = (clone as unknown as HTMLCanvasElement).getContext('2d');\n    ctx.drawImage(node as unknown as HTMLCanvasElement, 0, 0);\n  }\n  if (parent) {\n    parent.appendChild(clone);\n  }\n  if (node.nodeType !== Node.TEXT_NODE) {\n    clone.addEventListener('click', (event) => {\n      node.dispatchEvent(new MouseEvent('click', event));\n      event.stopPropagation();\n    });\n  }\n  const nodes = node.childNodes;\n  for (let i = 0; i < nodes.length; i++) {\n    if (!nodes[i]) {\n      continue;\n    }\n    cloneNode(nodes[i], clone);\n  }\n  return clone;\n}\n\n\ninterface SynchronizedOverlayOptions {\n  scene: Scene;\n  parent: OLOverlay;\n  synchronizer: OverlaySynchronizer;\n}\n\n\nexport default class SynchronizedOverlay extends OLOverlay {\n\n  private scenePostRenderListenerRemover_?: Function = null;\n  private scene_: Scene;\n  private synchronizer_: OverlaySynchronizer;\n  private parent_: OLOverlay;\n  private positionWGS84_: number[];\n  private observer_: MutationObserver;\n  private attributeObserver_: MutationObserver[] = [];\n  private listenerKeys_: EventsKey[];\n\n\n  /**\n   * @param options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options: SynchronizedOverlayOptions) {\n    const parent = options.parent;\n    super(parent.getOptions());\n    this.scene_ = options.scene;\n    this.synchronizer_ = options.synchronizer;\n    this.parent_ = parent;\n    this.positionWGS84_ = undefined;\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n    this.attributeObserver_ = [];\n    this.listenerKeys_ = [];\n\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = (event: ObjectEvent) => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param target\n   */\n  private observeTarget_(target: Node) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param event\n   */\n  private setPropertyFromEvent_(event: ObjectEvent) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return The scene that the overlay is part of.\n   * @api\n   */\n  getScene(): Scene {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of Array.from(element.parentNode.childNodes)) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if ('removeNode' in this.element) {\n      // @ts-ignore\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n", "import type {Collection, Map as OLMap, Overlay} from 'ol';\nimport SynchronizedOverlay from './SynchronizedOverlay';\nimport {getUid} from './util';\nimport type {Scene} from 'cesium';\nimport type {CollectionEvent} from 'ol/Collection.js';\n\nexport default class OverlaySynchronizer {\n  private overlayCollection_: Collection<Overlay>;\n  private overlayContainerStopEvent_: HTMLDivElement;\n  private overlayContainer_: HTMLDivElement;\n  private overlayMap_: Map<number, SynchronizedOverlay> = new Map();\n  private overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n\n  /**\n  * @param map\n  * @param scene\n  * @constructor\n  * @api\n  */\n  constructor(protected map: OLMap, protected scene: Scene) {\n    this.map = map;\n    this.overlayCollection_ = this.map.getOverlays();\n    this.scene = scene;\n    this.overlayContainerStopEvent_ = document.createElement('div');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    this.overlayEvents.forEach((name) => {\n      this.overlayContainerStopEvent_.addEventListener(name, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    this.overlayContainer_ = document.createElement('div');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent(): Element {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return The map's overlay container.\n  */\n  getOverlayContainer(): Element {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.overlayCollection_.forEach((overlay) => { this.addOverlay(overlay); });\n    this.overlayCollection_.on('add', (evt: CollectionEvent<Overlay>) => this.addOverlay(evt.element));\n    this.overlayCollection_.on('remove', (evt: CollectionEvent<Overlay>) => this.removeOverlay(evt.element));\n  }\n\n\n  /**\n  * @api\n  */\n  addOverlay(overlay: Overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new SynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    this.overlayMap_.set(getUid(overlay), cesiumOverlay);\n  }\n\n\n  /**\n  * Removes an overlay from the scene\n  * @api\n  */\n  removeOverlay(overlay: Overlay) {\n    const overlayId = getUid(overlay);\n    const csOverlay = this.overlayMap_.get(overlayId);\n    if (csOverlay) {\n      csOverlay.destroy();\n      this.overlayMap_.delete(overlayId);\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  */\n  protected destroyAll() {\n    this.overlayMap_.forEach((overlay: SynchronizedOverlay) => {\n      overlay.destroy();\n    });\n    this.overlayMap_.clear();\n  }\n}\n", "import olGeomPoint from 'ol/geom/Point.js';\nimport {supportsImageRenderingPixelated, imageRenderingValue} from './util';\nimport {ol4326CoordinateToCesiumCartesian} from './core';\nimport {getTransform, type TransformFunction} from 'ol/proj.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop';\nimport olcsCamera from './Camera';\nimport olcsRasterSynchronizer from './RasterSynchronizer';\nimport olcsVectorSynchronizer from './VectorSynchronizer';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer';\nimport type Map from 'ol/Map.js';\nimport type Interaction from 'ol/interaction/Interaction.js';\nimport type {Group} from 'ol/layer.js';\nimport type Feature from 'ol/Feature.js';\nimport type View from 'ol/View.js';\nimport type {\n  BoundingSphere, ContextOptions,\n  DataSourceCollection,\n  DataSourceDisplay,\n  Entity,\n  EntityView,\n  Globe,\n  JulianDate, MapMode2D, MapProjection, PerspectiveFrustum,\n  Scene,\n  ImageryLayer\n} from 'cesium';\nimport type AbstractSynchronizer from './AbstractSynchronizer';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n/**\n * Moved from Cesium\n * The state of a BoundingSphere computation being performed by a {@link Visualizer}.\n */\nconst BoundingSphereState: Record<string, number> = {\n  /**\n   * The BoundingSphere has been computed.\n   */\n  DONE: 0,\n  /**\n   * The BoundingSphere is still being computed.\n   */\n  PENDING: 1,\n  /**\n   * The BoundingSphere does not exist.\n   */\n  FAILED: 2,\n};\n\ntype SceneOptions = {\n  canvas: HTMLCanvasElement;\n  contextOptions?: ContextOptions;\n  creditContainer?: Element;\n  creditViewport?: Element;\n  mapProjection?: MapProjection;\n  orderIndependentTranslucency?: boolean;\n  scene3DOnly?: boolean;\n  shadows?: boolean;\n  mapMode2D?: MapMode2D;\n  requestRenderMode?: boolean;\n  maximumRenderTimeChange?: number;\n  depthPlaneEllipsoidOffset?: number;\n  msaaSamples?: number;\n}\n\ntype OLCesiumOptions = {\n  map: Map,\n  time?: () => JulianDate,\n  target?: Element | string,\n  createSynchronizers?: (map: Map, scene: Scene, dataSourceCollection: DataSourceCollection) => AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>[],\n  stopOpenLayersEventsPropagation?: boolean,\n  sceneOptions?: SceneOptions\n}\n\n// FIXME: remove this when all the synchronizers are migrated to typescript.\ntype SynchronizerType = AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>;\n\n/**\n * @typedef {Object} OLCesiumOptions\n * @property {import('ol/Map.js').default} map The OpenLayers map we want to show on a Cesium scene.\n * @property {Element|string} [target] Target element for the Cesium scene.\n * @property {function(!import('ol/Map.js').default, !Cesium.Scene, !Cesium.DataSourceCollection): Array<import('olcs/AbstractSynchronizer.js').default>}\n *      [createSynchronizers] Callback function which will be called by the {@link olcs.OLCesium}\n *      constructor to create custom synchronizers. Receives an `ol.Map` and a `Cesium.Scene` as arguments,\n *      and needs to return an array of {@link import('olcs/AbstractSynchronizer.js').default}.\n * @property {function(): Cesium.JulianDate} [time] Control the current time used by Cesium.\n * @property {boolean} [stopOpenLayersEventsPropagation] Prevent propagation of mouse/touch events to\n *      OpenLayers when Cesium is active.\n * @property {Cesium.SceneOptions} [sceneOptions] Allows the passing of property value to the\n *      `Cesium.Scene`.\n */\nexport default class OLCesium {\n  private autoRenderLoop_: olcsAutoRenderLoop | null = null;\n  private map_: Map;\n  private time_: () => JulianDate;\n  private to4326Transform_: TransformFunction;\n  private resolutionScale_ = 1.0;\n  private canvasClientWidth_ = 0.0;\n  private canvasClientHeight_ = 0.0;\n  private resolutionScaleChanged_ = true; // force resize\n  private container_: HTMLElement;\n  private isOverMap_: boolean;\n  private canvas_: HTMLCanvasElement;\n  private enabled_ = false;\n  private pausedInteractions_: Interaction[] = [];\n  private hiddenRootGroup_: Group | null = null;\n  private scene_: Scene;\n  private camera_: olcsCamera;\n  private globe_: Globe;\n  private dataSourceCollection_: DataSourceCollection;\n  private dataSourceDisplay_: DataSourceDisplay;\n  /** Time of the last rendered frame, as returned by `performance.now()`. */\n  private lastFrameTime_ = 0;\n  /** The identifier returned by `requestAnimationFrame`. */\n  private renderId_: number | undefined;\n  /** Target frame rate for the render loop.  */\n  private targetFrameRate_ = Number.POSITIVE_INFINITY;\n  /** If the Cesium render loop is being blocked. */\n  private blockCesiumRendering_ = false;\n  /** If the warmup routine is active. */\n  private warmingUp_ = false;\n  private trackedFeature_: Feature | null = null;\n  private trackedEntity_: Entity | null = null;\n  private entityView_: EntityView | null = null;\n  private needTrackedEntityUpdate_ = false;\n  private boundingSphereScratch_: BoundingSphere = new Cesium.BoundingSphere();\n  private synchronizers_: SynchronizerType[];\n\n  constructor(options: OLCesiumOptions) {\n    this.map_ = options.map;\n\n    this.time_ = options.time || function() {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none;';\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || this.map_.getViewport();\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * a target => side by side mode\n     * no target => over map mode\n     */\n    this.isOverMap_ = !options.target;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n    this.canvas_ = document.createElement<'canvas'>('canvas');\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function() {\n      return false;\n    };\n    this.canvas_.onselectstart = function() {\n      return false;\n    };\n\n    this.container_.appendChild(this.canvas_);\n\n    const sceneOptions: SceneOptions = options.sceneOptions !== undefined ?\n      {...options.sceneOptions, canvas: this.canvas_, scene3DOnly: true} :\n      {canvas: this.canvas_, scene3DOnly: true};\n\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    if (!Array.isArray(sscc.tiltEventTypes)) {\n      console.log('sscc is not an array');\n    } else {\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.SHIFT\n      });\n\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.ALT\n      });\n    }\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      tileHeight: 1,\n      tileWidth: 1,\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    this.synchronizers_ = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ] as unknown as SynchronizerType[];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = this.synchronizers_.length - 1; i >= 0; --i) {\n      this.synchronizers_[i].synchronize();\n    }\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n  }\n\n  /**\n   * Destroys the Cesium resources held by this object.\n   */\n  destroy() {\n    cancelAnimationFrame(this.renderId_);\n    this.renderId_ = undefined;\n    this.synchronizers_.forEach(synchronizer => synchronizer.destroyAll());\n    this.camera_.destroy();\n    this.scene_.destroy();\n    // @ts-ignore TS2341\n    this.scene_._postRender = null;\n    this.container_.remove();\n  }\n\n  /**\n   * Render the Cesium scene.\n   */\n  private render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   */\n  private onAnimationFrame_(frameTime: number) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    // initializeFrame private property\n    // @ts-ignore TS2341\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      // getBoundingSphere private property\n      // @ts-ignore TS2341\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  private updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    // getBoundingSphere private property\n    // @ts-ignore TS2341\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  private handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 || height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    (<PerspectiveFrustum> this.scene_.camera.frustum).aspectRatio = width / height;\n  }\n\n  getCamera(): olcsCamera {\n    return this.camera_;\n  }\n\n  getOlMap(): Map {\n    return this.map_;\n  }\n\n  getOlView(): View {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  getCesiumScene(): Scene {\n    return this.scene_;\n  }\n\n  getDataSources(): DataSourceCollection {\n    return this.dataSourceCollection_;\n  }\n\n  getDataSourceDisplay(): DataSourceDisplay {\n    return this.dataSourceDisplay_;\n  }\n\n  getEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   */\n  setEnabled(enable: boolean) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        this.map_.addInteraction = interaction => this.pausedInteractions_.push(interaction);\n        this.map_.removeInteraction = (interaction) => {\n          let interactionRemoved = false;\n          this.pausedInteractions_ = this.pausedInteractions_.filter((i) => {\n            const removed = i !== interaction;\n            if (!interactionRemoved) {interactionRemoved = removed;}\n            return removed;\n          });\n          return interactionRemoved ? interaction : undefined;\n        };\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n\n        this.map_.addInteraction = interaction => this.map_.getInteractions().push(interaction);\n        this.map_.removeInteraction = interaction => this.map_.getInteractions().remove(interaction);\n\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n  */\n  warmUp(height: number, timeout: number) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n  */\n  setBlockCesiumRendering(block: boolean) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n  */\n  getAutoRenderLoop(): olcsAutoRenderLoop {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   */\n  setResolutionScale(value: number) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   */\n  setTargetFrameRate(value: number) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   */\n  private throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n\n  get trackedFeature(): Feature {\n    return this.trackedFeature_;\n  }\n\n  set trackedFeature(feature: Feature) {\n    if (this.trackedFeature_ !== feature) {\n\n      const scene = this.scene_;\n\n      //Stop tracking\n      if (!feature || !feature.getGeometry()) {\n        this.needTrackedEntityUpdate_ = false;\n        scene.screenSpaceCameraController.enableTilt = true;\n\n        if (this.trackedEntity_) {\n          this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n        }\n        this.trackedEntity_ = null;\n        this.trackedFeature_ = null;\n        this.entityView_ = null;\n        scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n        return;\n      }\n\n      this.trackedFeature_ = feature;\n\n      //We can't start tracking immediately, so we set a flag and start tracking\n      //when the bounding sphere is ready (most likely next frame).\n      this.needTrackedEntityUpdate_ = true;\n\n      const to4326Transform = this.to4326Transform_;\n      const toCesiumPosition = function() {\n        const geometry = feature.getGeometry();\n        console.assert(geometry instanceof olGeomPoint);\n        const coo = geometry instanceof olGeomPoint ? geometry.getCoordinates() : [];\n        const coo4326 = to4326Transform(coo, undefined, coo.length);\n        return ol4326CoordinateToCesiumCartesian(coo4326);\n      };\n\n      // Create an invisible point entity for tracking.\n      // It is independent of the primitive/geometry created by the vector synchronizer.\n      const options: Entity.ConstructorOptions = {\n        // @ts-ignore according to Cesium types, not possible to pass CallbackProperty\n        position: new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n        point: {\n          pixelSize: 1,\n          color: Cesium.Color.TRANSPARENT\n        }\n      };\n\n      this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n    }\n  }\n}\n", "export interface RectangleOutput {\n  scaling: [number, number];\n  offsetX: number;\n  offsetY: number;\n  width: number;\n  height: number;\n}\n\nexport function computeRectangle(canvas: HTMLCanvasElement, tw: number, th: number): RectangleOutput {\n\n  const maskAspectRatio = tw / th;\n  let maskSize;\n\n  if (maskAspectRatio > 1) {\n    // landscape\n    maskSize = [canvas.width, canvas.width / maskAspectRatio];\n    if (maskSize[1] > canvas.height) {\n      maskSize = [canvas.height * maskAspectRatio, canvas.height];\n    }\n  }\n  else {\n    // portrait\n    maskSize = [canvas.height * maskAspectRatio, canvas.height];\n    if (maskSize[0] > canvas.width) {\n      maskSize = [canvas.width, canvas.width / maskAspectRatio];\n    }\n  }\n\n  return {\n    scaling: [maskSize[0] / canvas.width, maskSize[1] / canvas.height],\n    width: maskSize[0],\n    height: maskSize[1],\n    offsetX: (canvas.width - maskSize[0]) / 2,\n    offsetY: (canvas.height - maskSize[1]) / 2,\n  };\n}\n", "import type {Scene} from 'cesium';\n\nlet postUnlistener: Function = null;\n\ninterface ProgramInfo {\n  program: WebGLProgram,\n  attribLocations: {\n    vertexPosition: number\n  },\n  uniformLocations: {\n    uScaling: WebGLUniformLocation\n  }\n}\n\n\n// CC0 from https://github.com/mdn/dom-examples/tree/main/webgl-examples/tutorial/sample2\n\n\nexport class MaskDrawer {\n  private programInfo: ProgramInfo;\n  private positionBuffer: WebGLBuffer;\n\n  constructor(private gl: WebGL2RenderingContext | WebGLRenderingContext) {\n    const shaderProgram = this.initShaderProgram();\n\n    this.programInfo = {\n      program: shaderProgram,\n      attribLocations: {\n        vertexPosition: gl.getAttribLocation(shaderProgram, 'aVertexPosition')\n      },\n      uniformLocations: {\n        uScaling: gl.getUniformLocation(\n            shaderProgram,\n            'uScaling'\n        )\n      }\n    };\n\n    this.positionBuffer = gl.createBuffer();\n    const positions = [1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, -1.0];\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\n  }\n\n  getVertexShaderSource() {\n    return `\n      attribute vec4 aVertexPosition;\n      uniform vec2 uScaling;\n      void main() {\n        gl_Position = vec4(aVertexPosition[0] * uScaling[0], aVertexPosition[1] * uScaling[1], -1.0, 1.0);\n      }\n    `;\n  }\n\n  getFragmentShaderSource() {\n    return `\n      precision highp float;\n      void main() {\n        gl_FragColor = vec4(.5, .5, .5, .6);\n      }\n  `;\n  }\n\n  /**\n   *\n   */\n  private initShaderProgram(): WebGLProgram {\n    const gl = this.gl;\n    const vsSource = this.getVertexShaderSource();\n    const fsSource = this.getFragmentShaderSource();\n    const vertexShader = MaskDrawer.loadShader(gl, gl.VERTEX_SHADER, vsSource),\n        fragmentShader = MaskDrawer.loadShader(gl, gl.FRAGMENT_SHADER, fsSource),\n        shaderProgram = gl.createProgram();\n\n    gl.attachShader(shaderProgram, vertexShader);\n    gl.attachShader(shaderProgram, fragmentShader);\n    gl.linkProgram(shaderProgram);\n\n    // If creating the shader program failed, alert\n\n    if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n      throw new Error(\n          `Unable to initialize the shader program: ${gl.getProgramInfoLog(\n              shaderProgram\n          )}`\n      );\n    }\n\n    return shaderProgram;\n  }\n\n\n  /**\n   *\n   * @param {number[]} scaling scaling\n   */\n  drawMask(scaling: number[]) {\n    const gl = this.gl;\n    const programInfo = this.programInfo;\n    // Blend\n    gl.enable(gl.BLEND);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.vertexAttribPointer(\n        programInfo.attribLocations.vertexPosition,\n        2,\n        gl.FLOAT,\n        false,\n        0,\n        0\n    );\n    gl.enableVertexAttribArray(programInfo.attribLocations.vertexPosition);\n    gl.useProgram(programInfo.program);\n\n\n    // Draw a first time to fill the stencil area while keeping the destination color\n    gl.enable(gl.STENCIL_TEST);\n    gl.stencilFunc(\n        gl.ALWAYS,\n        1,\n        0xFF\n    );\n    gl.stencilOp(\n        gl.KEEP,\n        gl.KEEP,\n        gl.REPLACE\n    );\n    gl.uniform2fv(\n        programInfo.uniformLocations.uScaling,\n        scaling\n    );\n    gl.blendFunc(gl.ZERO, gl.ONE);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n\n    // Now draw again the whole viewport and darken the pixels that are not on the stencil\n    gl.stencilFunc(\n        gl.EQUAL,\n        0,\n        0xFF\n    );\n    gl.stencilOp(\n        gl.KEEP,\n        gl.KEEP,\n        gl.KEEP\n    );\n    gl.uniform2fv(\n        programInfo.uniformLocations.uScaling,\n        [1, 1]\n    );\n    gl.blendFunc(gl.ZERO, gl.SRC_ALPHA);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  }\n\n\n\n  /**\n   */\n  private static loadShader(gl: WebGL2RenderingContext | WebGLRenderingContext, type: number, source: string): WebGLShader {\n    const shader = gl.createShader(type);\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      throw new Error(\n          `An error occurred compiling the shaders: ${gl.getShaderInfoLog(shader)}`\n      );\n      // gl.deleteShader(shader);\n    }\n\n    return shader;\n  }\n}\n\n/**\n *\n */\nexport function autoDrawMask(scene: Scene, getScalings: () => number[]) {\n  const canvas = scene.canvas;\n  const ctx = canvas.getContext('webgl2') || canvas.getContext('webgl');\n\n  if (getScalings) {\n    if (!postUnlistener) {\n      const drawer = new MaskDrawer(ctx);\n      postUnlistener = scene.postRender.addEventListener(() => {\n        drawer.drawMask(getScalings());\n      });\n    }\n  }\n  else if (postUnlistener) {\n    postUnlistener();\n    // FIXME: destroy program\n    postUnlistener = null;\n  }\n  scene.requestRender();\n}\n", "import type {Scene} from 'cesium';\n\ninterface ScreenshotOptions {\n  offsetX: number;\n  offsetY: number;\n  width: number;\n  height: number;\n}\n\n/**\n */\nexport function takeScreenshot(scene: Scene, options: ScreenshotOptions): Promise<string> {\n  return new Promise((resolve, reject) => {\n  // preserveDrawingBuffers is false so we render on demand and immediately read the buffer\n    const remover = scene.postRender.addEventListener(() => {\n      remover();\n      try {\n        let url;\n\n        if (options) {\n          const smallerCanvas = document.createElement('canvas');\n\n          smallerCanvas.width = options.width;\n          smallerCanvas.height = options.height;\n          smallerCanvas.getContext('2d').drawImage(\n              scene.canvas,\n              options.offsetX, options.offsetY, options.width, options.height,\n              0, 0, options.width, options.height);\n          url = smallerCanvas.toDataURL();\n        }\n        else {\n          url = scene.canvas.toDataURL();\n        }\n        resolve(url);\n      }\n      catch (e) {\n        reject(e);\n      }\n    });\n\n    scene.requestRender();\n  });\n}\n", "export default class LazyLoader {\n  private promise: Promise<void> | undefined;\n  private url_: string;\n\n  /**\n   * @param url\n   * @api\n   */\n  constructor(url: string) {\n    this.url_ = url;\n  }\n\n  /**\n   * Load Cesium by injecting a script tag.\n   * @api\n   */\n  load(): Promise<void> {\n    if (!this.promise) {\n      // not yet loading\n      this.promise = new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        script.onload = () => resolve();\n        script.onerror = () => reject();\n        document.head.appendChild(script);\n        script.src = this.url_;\n      });\n    }\n    return this.promise;\n  }\n}\n", "import olcsContribLazyLoader from './LazyLoader';\nimport OLCesium from '../OLCesium';\nimport {resetToNorthZenith, rotateAroundBottomCenter, computeSignedTiltAngleOnGlobe, pickBottomPoint, setHeadingUsingBottomCenter, limitCameraToBoundingSphere} from '../core';\nimport {toRadians} from '../math';\nimport Observable from 'ol/Observable.js';\nimport type OLMap from 'ol/Map.js';\nimport type {Extent} from 'ol/extent.js';\nimport type {BoundingSphere, Matrix4, Rectangle, Scene} from 'cesium';\n\n\n/**\n * @typedef {Object} ManagerOptions\n * @property {import('ol/Map.js').default} map\n * @property {import('ol/extent.js').Extent} [cameraExtentInRadians]\n * @property {string} [cesiumIonDefaultAccessToken]\n */\n\n\nexport default class Manager extends Observable {\n  private cesiumUrl_: string;\n  private boundingSphere_: BoundingSphere;\n  private promise_: Promise<OLCesium>;\n  private cesiumIonDefaultAccessToken_: string;\n  protected map: OLMap;\n  protected cameraExtentInRadians: Extent;\n  protected ol3d: OLCesium;\n  private cesiumInitialTilt_ = toRadians(50);\n\n  protected fogDensity = 0.0001;\n\n  protected fogSSEFactor = 25;\n\n  protected minimumZoomDistance = 2;\n\n  /**\n   * Limit the maximum distance to the earth to 10'000km.\n   */\n  protected maximumZoomDistance: number = 10000000;\n\n  // when closer to 3000m, restrict the available positions harder\n  protected limitCameraToBoundingSphereRatio = (height: number) => (height > 3000 ? 9 : 3);\n\n  /**\n   * @param {string} cesiumUrl\n   * @param {olcsx.contrib.ManagerOptions} options\n   * @api\n   */\n  constructor(cesiumUrl: string, {map, cameraExtentInRadians, cesiumIonDefaultAccessToken}: {map: OLMap, cameraExtentInRadians?: Extent, cesiumIonDefaultAccessToken?: string}) {\n    super();\n    this.cesiumUrl_ = cesiumUrl;\n    console.assert(map);\n    this.map = map;\n    this.cameraExtentInRadians = cameraExtentInRadians || null;\n    this.cesiumIonDefaultAccessToken_ = cesiumIonDefaultAccessToken;\n  }\n\n\n  /**\n   * Lazy load Cesium.\n   */\n  load(): Promise<OLCesium> {\n    if (!this.promise_) {\n      const cesiumLazyLoader = new olcsContribLazyLoader(this.cesiumUrl_);\n      this.promise_ = cesiumLazyLoader.load().then(() => this.onCesiumLoaded());\n    }\n    return this.promise_;\n  }\n\n\n  /**\n   * Hook called when Cesium has been lazy loaded.\n   */\n  protected onCesiumLoaded(): OLCesium {\n    if (this.cameraExtentInRadians) {\n      const rect = new Cesium.Rectangle(...this.cameraExtentInRadians);\n      // Set the fly home rectangle\n      Cesium.Camera.DEFAULT_VIEW_RECTANGLE = rect;\n      this.boundingSphere_ = Cesium.BoundingSphere.fromRectangle3D(rect, Cesium.Ellipsoid.WGS84, 300); // lux mean height is 300m\n    }\n\n    if (this.cesiumIonDefaultAccessToken_) {\n      Cesium.Ion.defaultAccessToken = this.cesiumIonDefaultAccessToken_;\n    }\n\n    this.ol3d = this.instantiateOLCesium();\n    const scene = this.ol3d.getCesiumScene();\n    this.configureForUsability(scene);\n    this.configureForPerformance(scene);\n    this.dispatchEvent('load');\n    return this.ol3d;\n  }\n\n\n  /**\n   * Application code should override this method.\n   */\n  instantiateOLCesium(): OLCesium {\n    const ol3d = new OLCesium({map: this.map});\n    const scene = ol3d.getCesiumScene();\n    // LEGACY\n    if ('createWorldTerrain' in Cesium) {\n      // @ts-ignore\n      const terrainProvider = Cesium.createWorldTerrain();\n      scene.terrainProvider = terrainProvider;\n    } else {\n      // v107+\n      Cesium.createWorldTerrainAsync().then(tp => scene.terrainProvider = tp);\n    }\n\n    return ol3d;\n  }\n\n\n  /**\n   * Override with custom performance optimization logics, if needed.\n   */\n  protected configureForPerformance(scene: Scene) {\n    const fog = scene.fog;\n    fog.enabled = true;\n    fog.density = this.fogDensity;\n    fog.screenSpaceErrorFactor = this.fogSSEFactor;\n  }\n\n\n  /**\n   * Override with custom usabliity logics, id needed.\n   */\n  configureForUsability(scene: Scene) {\n    const sscController = scene.screenSpaceCameraController;\n    sscController.minimumZoomDistance = this.minimumZoomDistance;\n    sscController.maximumZoomDistance = this.maximumZoomDistance;\n\n    // Do not see through the terrain. Seeing through the terrain does not make\n    // sense anyway, except for debugging\n    scene.globe.depthTestAgainstTerrain = true;\n\n    // Use white instead of the black default colour for the globe when tiles are missing\n    scene.globe.baseColor = Cesium.Color.WHITE;\n    scene.backgroundColor = Cesium.Color.WHITE;\n\n    if (this.boundingSphere_) {\n      scene.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this));\n    }\n    // Stop rendering Cesium when there is nothing to do. This drastically reduces CPU/GPU consumption.\n    this.ol3d.enableAutoRenderLoop();\n  }\n\n  /**\n   * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n   * Near the ground the allowed distance is shorter.\n   */\n  protected limitCameraToBoundingSphere() {\n    const scene = this.ol3d.getCesiumScene();\n    limitCameraToBoundingSphere(scene.camera, this.boundingSphere_, this.limitCameraToBoundingSphereRatio);\n  }\n\n  /**\n   * Enable or disable ol3d with a default animation.\n   */\n  toggle3d(): Promise<void> {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      if (is3DCurrentlyEnabled) {\n        // Disable 3D\n        console.assert(this.map);\n        return resetToNorthZenith(this.map, scene).then(() => {\n          ol3d.setEnabled(false);\n          this.dispatchEvent('toggle');\n        });\n      } else {\n        // Enable 3D\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n        return rotateAroundBottomCenter(scene, this.cesiumInitialTilt_);\n      }\n    });\n  }\n\n\n  /**\n   * Enable ol3d with a view built from parameters.\n   */\n  set3dWithView(lon: number, lat: number, elevation: number, headingDeg: number, pitchDeg: number): Promise<void> {\n    return this.load().then((ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const destination = Cesium.Cartesian3.fromDegrees(lon, lat, elevation);\n      const heading = Cesium.Math.toRadians(headingDeg);\n      const pitch = Cesium.Math.toRadians(pitchDeg);\n      const roll = 0;\n      const orientation = {heading, pitch, roll};\n\n      if (!is3DCurrentlyEnabled) {\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n      }\n\n      camera.setView({\n        destination,\n        orientation\n      });\n    });\n  }\n\n\n  /**\n   * Whether OL-Cesium has been loaded and 3D mode is enabled.\n   */\n  is3dEnabled(): boolean {\n    return !!this.ol3d && this.ol3d.getEnabled();\n  }\n\n\n  /**\n   * @return {number}\n   */\n  getHeading(): number {\n    return this.map ? this.map.getView().getRotation() || 0 : 0;\n  }\n\n\n  /**\n   * @return {number|undefined}\n   */\n  getTiltOnGlobe() {\n    const scene = this.ol3d.getCesiumScene();\n    const tiltOnGlobe = computeSignedTiltAngleOnGlobe(scene);\n    return -tiltOnGlobe;\n  }\n\n\n  /**\n   * Set heading.\n   * This assumes ol3d has been loaded.\n   */\n  setHeading(angle: number) {\n    const scene = this.ol3d.getCesiumScene();\n    const bottom = pickBottomPoint(scene);\n    if (bottom) {\n      setHeadingUsingBottomCenter(scene, angle, bottom);\n    }\n  }\n\n  getOl3d(): OLCesium {\n    return this.ol3d;\n  }\n\n  getCesiumViewMatrix(): Matrix4 {\n    return this.ol3d.getCesiumScene().camera.viewMatrix;\n  }\n\n  getCesiumScene(): Scene {\n    return this.ol3d.getCesiumScene();\n  }\n\n  /**\n   * Fly to some rectangle.\n   * This assumes ol3d has been loaded.\n   */\n  flyToRectangle(rectangle: Rectangle, offset = 0): Promise<void> {\n    const camera = this.getCesiumScene().camera;\n    const destination = camera.getRectangleCameraCoordinates(rectangle);\n\n    const mag = Cesium.Cartesian3.magnitude(destination) + offset;\n    Cesium.Cartesian3.normalize(destination, destination);\n    Cesium.Cartesian3.multiplyByScalar(destination, mag, destination);\n\n    return new Promise((resolve, reject) => {\n      if (!this.cameraExtentInRadians) {\n        reject();\n        return;\n      }\n\n      camera.flyTo({\n        destination,\n        complete: () => resolve(),\n        cancel: () => reject(),\n        endTransform: Cesium.Matrix4.IDENTITY\n      });\n    });\n  }\n}\n", "import OLCesium from './olcs/OLCesium';\nexport default OLCesium;\n\nexport {default as AbstractSynchronizer} from './olcs/AbstractSynchronizer';\nexport {default as RasterSynchronizer} from './olcs/RasterSynchronizer';\nexport {default as VectorSynchronizer} from './olcs/VectorSynchronizer';\n\nexport {default as FeatureConverter} from './olcs/FeatureConverter';\nexport {default as OLCSCamera} from './olcs/Camera';\n\n// Core api functions\nexport * from './olcs/core';\nexport {default as OLImageryProvider} from './olcs/core/OLImageryProvider';\nexport {default as VectorLayerCounterpart} from './olcs/core/VectorLayerCounterpart';\n\n// Print functions\nexport * from './olcs/print';\n\n// Contrib Manager\nexport {default as ContribManager} from './olcs/contrib/Manager';\nexport {default as ContribLazyLoader} from './olcs/contrib/LazyLoader';\n\n// Deprecated export of olcs on window\nconst olcs = window['olcs'] = {};\nolcs.OLCesium = OLCesium;\n\nimport {default as AbstractSynchronizer} from './olcs/AbstractSynchronizer';\nimport {default as RasterSynchronizer} from './olcs/RasterSynchronizer';\nimport {default as VectorSynchronizer} from './olcs/VectorSynchronizer';\nolcs.AbstractSynchronizer = AbstractSynchronizer;\nolcs.RasterSynchronizer = RasterSynchronizer;\nolcs.VectorSynchronizer = VectorSynchronizer;\n\nimport * as core from './olcs/core';\nimport {default as OLImageryProvider} from './olcs/core/OLImageryProvider';\nimport {default as VectorLayerCounterpart} from './olcs/core/VectorLayerCounterpart';\nolcs.core = core;\nolcs.core.OLImageryProvider = OLImageryProvider;\nolcs.core.VectorLayerCounterpart = VectorLayerCounterpart;\n\nolcs.contrib = {};\nimport {default as ContribManager} from './olcs/contrib/Manager';\nimport {default as ContribLazyLoader} from './olcs/contrib/LazyLoader';\nolcs.contrib.LazyLoader = ContribLazyLoader;\nolcs.contrib.Manager = ContribManager;\n"],
  "mappings": "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",
  "names": ["isEmpty", "render", "transform", "init_Layer", "Layer_default", "Image_default", "init_Image", "Image_default", "init_Image", "init_common", "isEmpty", "sourceState", "init_common", "Image_exports", "Image_default", "init_Image", "init_common", "extent", "resolution", "pixelRatio", "image", "init_Image", "Image_default", "createLoader", "image", "init_Image", "init_common", "init_Image", "Image_default", "createLoader", "VectorTile_default", "init_VectorTile", "tileUrl", "maxZoom", "scale", "transform", "tileGrid", "extent", "geometry", "create", "scale", "translate", "translate", "scale", "render", "xPos", "yPos", "width", "height", "lines", "DataTile_default", "init_DataTile", "init_common", "size", "bandCount", "width", "height", "data", "offset", "len", "render", "state", "DataTile_default", "init_DataTile", "init_Tile", "Tile_default", "z", "x", "y", "next", "buffer", "buffer", "buffer", "array", "isNaN", "getAttribute", "startIndex", "findTagsByName", "buffer", "window", "findTagsByName", "getAttribute", "createWorker", "create", "buffer", "urlMod", "http", "https", "values", "error", "init_DataTile", "DataTile_default", "self", "values", "url", "tileUrl", "maxZoom", "scale", "size", "getRequestUrl", "createLoader", "image", "resolution", "init_Image", "init_common", "init_Image", "Image_default", "createLoader", "ImageCanvas_default", "init_ImageCanvas", "init_Image", "Image_default", "scale", "createLoader", "image", "init_Image", "init_Image", "Image_default", "createLoader", "ImageTile_default", "init_ImageTile", "init_DataTile", "DataTile_default", "wrapX", "client", "projection", "error", "init_VectorTile", "VectorTile_default", "error", "output", "Tile_default", "Image_default", "init_Image", "init_Tile", "buffer", "getRequestUrl", "scale", "init_DataTile", "init_ImageTile", "ImageTile_default", "DataTile_default", "handler", "transform", "maxZoom", "CustomTile", "init_Tile", "jsonp", "Tile_default", "transform", "maxZoom", "tileUrl", "init_WMTS", "DataTile_default", "Image_default", "ImageCanvas_default", "ImageTile_default", "Tile_default", "VectorTile_default", "createLoader", "init_DataTile", "init_Image", "init_ImageCanvas", "init_ImageTile", "init_Tile", "init_VectorTile", "init_WMTS", "buffer", "transform", "Feature_default", "init_Feature", "init_Feature", "Feature_default", "values", "render", "tile", "transform", "scale", "VectorTile_exports", "VectorTile_default", "init_VectorTile", "root", "factory", "exports", "module", "require", "define", "amd", "self", "__WEBPACK_EXTERNAL_MODULE__206__", "__WEBPACK_EXTERNAL_MODULE__177__", "__WEBPACK_EXTERNAL_MODULE__164__", "__WEBPACK_EXTERNAL_MODULE__330__", "__WEBPACK_EXTERNAL_MODULE__24__", "__WEBPACK_EXTERNAL_MODULE__606__", "__WEBPACK_EXTERNAL_MODULE__469__", "__WEBPACK_EXTERNAL_MODULE__623__", "__WEBPACK_EXTERNAL_MODULE__886__", "__WEBPACK_EXTERNAL_MODULE__622__", "__WEBPACK_EXTERNAL_MODULE__673__", "__WEBPACK_EXTERNAL_MODULE__432__", "__WEBPACK_EXTERNAL_MODULE__401__", "__WEBPACK_EXTERNAL_MODULE__193__", "__WEBPACK_EXTERNAL_MODULE__51__", "__WEBPACK_EXTERNAL_MODULE__817__", "__WEBPACK_EXTERNAL_MODULE__280__", "__WEBPACK_EXTERNAL_MODULE__750__", "__WEBPACK_EXTERNAL_MODULE__628__", "__WEBPACK_EXTERNAL_MODULE__423__", "__WEBPACK_EXTERNAL_MODULE__115__", "__WEBPACK_EXTERNAL_MODULE__996__", "__WEBPACK_EXTERNAL_MODULE__235__", "__WEBPACK_EXTERNAL_MODULE__911__", "__WEBPACK_EXTERNAL_MODULE__604__", "__WEBPACK_EXTERNAL_MODULE__515__", "__WEBPACK_EXTERNAL_MODULE__830__", "__WEBPACK_EXTERNAL_MODULE__582__", "__WEBPACK_EXTERNAL_MODULE__63__", "__WEBPACK_EXTERNAL_MODULE__425__", "__WEBPACK_EXTERNAL_MODULE__962__", "__WEBPACK_EXTERNAL_MODULE__253__", "__WEBPACK_EXTERNAL_MODULE__988__", "__WEBPACK_EXTERNAL_MODULE__524__", "__WEBPACK_EXTERNAL_MODULE__312__", "__webpack_module_cache__", "__webpack_require__", "moduleId", "cachedModule", "__webpack_modules__", "n", "getter", "__esModule", "e", "d", "a", "definition", "key", "o", "Object", "defineProperty", "enumerable", "get", "obj", "prop", "prototype", "hasOwnProperty", "call", "r", "Symbol", "toStringTag", "value", "j", "t", "i", "_imageRenderingPixelatedSupported", "_imageRenderingValue", "supportsImageRenderingPixelated", "canvas", "document", "createElement", "setAttribute", "imageRenderingValue", "style", "imageRendering", "getSourceProjection", "source", "getProjection", "uidCounter_", "getUid", "olcs_uid", "waitReady", "object", "p", "readyPromise", "ready", "Promise", "resolve", "_", "stopper", "setInterval", "clearInterval", "reject", "u", "h", "m", "g", "C", "y", "f", "v", "w", "S", "L", "T", "b", "P", "E", "createEmptyCanvas", "width", "height", "olUseNewCoordinates", "tileCoord", "TileSource", "projection", "wrapX", "getTileCoordForTileUrlFunction", "OLImageryProvider", "this", "ready_", "rectangle", "rectangle_", "tilingScheme", "tilingScheme_", "_ready", "tileWidth", "tileGrid", "source_", "getTileGrid", "tileSizeAtZoom0", "getTileSize", "Array", "isArray", "tileHeight", "maximumLevel", "getMaxZoom", "minimumLevel", "tileDiscardPolicy", "hasAlphaChannel", "pickFeatures", "x", "level", "longitude", "latitude", "constructor", "olMap", "opt_fallbackProj", "emptyCanvas_", "emptyCanvasPromise_", "errorEvent", "Cesium", "Event", "projection_", "fallbackProj_", "WebMercatorTilingScheme", "map_", "shouldRequestNextLevel", "proxy", "DefaultProxy", "on", "handleSourceChanged_", "getState", "options", "numberOfLevelZeroTilesX", "numberOfLevelZeroTilesY", "forEachTileCoord", "getExtent", "_ref", "zoom", "xIndex", "yIndex", "getCode", "GeographicTilingScheme", "getTileCredits", "attributionsFunction", "getAttributions", "extent", "getView", "calculateExtent", "getSize", "center", "getCenter", "attributionsFunctionToCredits", "requestImage", "request", "tileUrlFunction", "getTileUrlFunction", "z_", "y_", "url", "getURL", "ImageryProvider", "loadImage", "A", "O", "F", "I", "G", "M", "format", "MVT", "featureClass", "RenderFeature", "styles", "Style", "stroke", "Stroke", "color", "MVTImageryProvider", "minimumLevel_", "urls", "credit", "styleFunction_", "styleFunction", "tileRectangle_", "Rectangle", "cacheSize", "tileCache", "LRUCache", "featureCache", "getTilegridForProjection", "tileFunction_", "createTileUrlFunctions", "getTileFeatures", "z", "cacheKey", "getCacheKey_", "promise", "containsKey", "getUrl_", "fetch", "then", "ok", "arrayBuffer", "buffer", "readFeaturesFromBuffer", "set", "getCount", "highWaterMark", "canExpireCache", "pop", "OL_VERSION", "dataProjection", "featureProjection", "features", "readFeatures", "scaleFactor", "forEach", "flatCoordinates", "getFlatCoordinates", "flip", "length", "tileXYToNativeRectangle", "resolution", "east", "west", "rasterizeFeatures", "raiseEvent", "vectorContext", "toContext", "getContext", "size", "setStyle", "drawGeometry", "computePixelSizeAtCoordinate", "scene", "target", "camera", "frustum", "distance", "Cartesian3", "magnitude", "subtract", "position", "getPixelDimensions", "clientWidth", "clientHeight", "pixelRatio", "Cartesian2", "computeBoundingBoxAtTarget", "amount", "pixelSize", "transform", "Transforms", "eastNorthUpToFixedFrame", "bottomLeft", "Matrix4", "multiplyByPoint", "topRight", "Ellipsoid", "WGS84", "cartesianArrayToCartographicArray", "applyHeightOffsetToGeometry", "geometry", "applyTransform", "input", "output", "stride", "createMatrixAtCoordinates", "coordinates", "rotation", "translation", "scale", "ZERO", "ol4326CoordinateToCesiumCartesian", "rawMatrix", "quaternion", "Quaternion", "fromAxisAngle", "UNIT_Z", "rotationMatrix", "fromTranslationQuaternionRotationScale", "multiply", "rotateAroundAxis", "angle", "axis", "opt_options", "clamp", "Math", "defaultValue", "duration", "easing", "linearEasing", "callback", "lastProgress", "oldTransform", "start", "Date", "now", "step", "timestamp", "progress", "clone", "stepAngle", "lookAtTransform", "rotate", "window", "requestAnimationFrame", "setHeadingUsingBottomCenter", "heading", "bottomCenter", "angleToZenith", "computeAngleToZenith", "right", "Matrix3", "fromQuaternion", "vector", "zenith", "multiplyByVector", "add", "fromTranslation", "pickOnTerrainOrEllipsoid", "pixel", "ray", "getPickRay", "globe", "pick", "pickEllipsoid", "pickBottomPoint", "pickCenterPoint", "computeSignedTiltAngleOnGlobe", "Ray", "direction", "ellipsoid", "IntersectionTests", "rayEllipsoid", "getPoint", "normal", "geocentricSurfaceNormal", "signedAngleBetween", "PI", "convertLongitudeRange", "bottomFovRay", "fovy2", "fovy", "matrix", "first", "second", "c", "normalize", "cross", "cosine", "dot", "sine", "sign", "atan2", "pivot", "fy", "negate", "left", "extentToRectangle", "ext", "transformExtent", "fromDegrees", "sourceToImageryProvider", "viewProj", "olLayer", "skip", "provider", "olSourceImageWMS", "getUrl", "getImageLoadFunction", "defaultImageLoadFunction", "sourceProps", "olSourceTileWMS", "attributions", "params", "getParams", "setProperties", "olSourceTileImage", "isCesiumProjection", "olcsCoreOLImageryProvider", "olSourceImageStatic", "olSourceVectorTile", "VectorTileLayer", "fromCode", "split", "map", "replace", "getStyleFunction", "getExtentCenter", "getImageExtent", "SingleTileImageryProvider", "tileLayerToImageryLayer", "olLayerTile", "olLayerImage", "getSource", "layerOptions", "ImageryLayer", "updateCesiumLayerProperties", "olLayerWithParents", "csLayer", "opacity", "visible", "layer", "concat", "parents", "layerOpacity", "getOpacity", "layerVisible", "getVisible", "alpha", "show", "coordinate", "coo", "ol4326CoordinateArrayToCsCartesians", "toCartesian", "cartesians", "push", "olGeometryCloneTo4326", "proj4326", "proj", "properties", "getProperties", "convertColorToCesium", "olColor", "Color", "byteToFloat", "fromCssColorString", "CanvasPattern", "CanvasGradient", "ctx", "fillStyle", "fillRect", "ImageMaterialProperty", "image", "convertUrlToCesium", "subdomains", "re", "match", "exec", "startCharCode", "charCodeAt", "stopCharCode", "charCode", "String", "fromCharCode", "resetToNorthZenith", "currentHeading", "getRotation", "normalizeView", "undefined", "rotateAroundBottomCenter", "view", "getResolution", "setRotation", "constrainResolution", "setResolution", "getConstrainedResolution", "is3857", "is4326", "viewState", "html", "Credit", "calcDistanceForResolution", "metersPerUnit", "getMetersPerUnit", "cos", "abs", "tan", "calcResolutionForDistance", "limitCameraToBoundingSphere", "boundingSphere", "ratio", "blockLimiter", "carto", "Cartographic", "fromCartesian", "radius", "flying", "unblockLimiter", "flyToBoundingSphere", "complete", "cancel", "AutoRenderLoop", "ol3d", "repaintEventNames_", "scene_", "getCesiumScene", "canvas_", "_boundNotifyRepaintRequired", "notifyRepaintRequired", "bind", "enable", "requestRenderMode", "maximumRenderTimeChange", "repaintKey", "addEventListener", "getOlMap", "getLayerGroup", "disable", "removeEventListener", "un", "restartRenderLoop", "requestRender", "toDegrees", "angleInRadians", "toRadians", "angleInDegrees", "identityProjection", "opt_output", "opt_dimension", "dim", "Camera", "viewListenKey_", "toLonLat_", "fromLonLat_", "tilt_", "distance_", "lastCameraViewMatrix_", "viewUpdateInProgress_", "cam_", "setView_", "destroy", "olObservableUnByKey", "view_", "toLonLat", "getTransform", "fromLonLat", "handleViewChangedEvent_", "readFromView", "setHeading", "getHeading", "setTilt", "tilt", "updateCamera_", "getTilt", "setDistance", "updateView", "getDistance", "setCenter", "setPosition", "ll", "getAltitude", "setView", "destination", "cartographicToCartesian", "getPosition", "cartesianToCartographic", "setAltitude", "altitude", "getHeight", "orientation", "pitch", "PI_OVER_TWO", "roll", "moveBackward", "checkCameraChange", "bestTarget", "positionCartographic", "bestTargetCartographic", "pos", "targetNormal", "targetToCamera", "up", "angleBetween", "tiltAngle", "acos", "isNaN", "opt_dontSync", "old", "current", "viewMatrix", "equalsEpsilon", "AbstractSynchronizer", "layerMap", "olLayerListenKeys", "olGroupListenKeys_", "olLayers", "getLayers", "mapLayerGroup", "synchronize", "destroyAll", "addLayers_", "orderLayers", "fifo", "splice", "olLayerId", "toString", "cesiumObjects", "LayerGroup", "listenForGroupChanges_", "createSingleLayerCounterparts", "l", "newOlLayerWithParents", "layerId", "layerWithParents", "onLayerChange", "cesiumObjs", "addCesiumObjects_", "cesiumObject", "addCesiumObject", "removeAndDestroySingleLayer_", "uid", "counterparts", "counterpart", "removeSingleCesiumObject", "destroyCesiumObject", "unlistenSingleGroup_", "group", "removeLayer_", "done", "uuid", "listenKeyArray", "contentKeys", "listenAddRemove", "collection", "event", "element", "el", "indexOf", "objKey", "removeAllCesiumObjects", "RasterSynchronizer", "olcsAbstractSynchronizer", "super", "cesiumLayers_", "imageryLayers", "ourLayers_", "ImageryLayerCollection", "remove", "removeAll", "convertLayerToCesiumImageries", "result", "olLayerItem", "BaseVectorLayer", "previousStyleFunction", "currentStyleFunction", "csObj", "_imageryCache", "ip", "imageryProvider", "_ip$tileCache", "clear", "layers", "zIndices", "queue", "getZIndex", "sublayers", "unshift", "getArray", "sort", "layer1", "layer2", "raiseToTop", "VectorLayerCounterpart", "layerProjection", "olListenKeys", "billboards", "BillboardCollection", "primitives", "PrimitiveCollection", "rootCollection_", "context", "featureToCesiumMap", "getRootPrimitive", "FeatureConverter", "boundOnRemoveOrClearFeatureListener_", "onRemoveOrClearFeature_", "defaultBillboardEyeOffset_", "evt", "cancellers", "feature", "id", "canceller", "setReferenceForPicking", "primitive", "olFeature", "createColoredPrimitive", "olGeometry", "opt_lineWidth", "flat", "renderState", "depthTest", "enabled", "lineWidth", "instances", "instance", "GeometryInstance", "attributes", "ColorGeometryInstanceAttribute", "fromColor", "getHeightReference", "HeightReference", "CLAMP_TO_GROUND", "GroundPrimitive", "geometryInstances", "Primitive", "dataUri", "getValue", "toDataURL", "appearance", "MaterialAppearance", "material", "Material", "fabric", "type", "uniforms", "translucent", "shadows", "extractColorFromOlStyle", "outline", "fillColor", "getFill", "getColor", "strokeColor", "getStroke", "extractLineWidthFromOlStyle", "getWidth", "wrapFillAndOutlineGeometries", "fillGeometry", "outlineGeometry", "olStyle", "outlineColor", "p1", "p2", "addTextStyle", "getText", "text", "label", "olGeometry4326TextPartToCesium", "csAddBillboard", "bbOptions", "eyeOffset", "bb", "olCircleGeometryToCesium", "olCenter", "olPoint", "slice", "getRadius", "point", "CircleGeometry", "outlinePrimitive", "positions", "olCreateCircularPolygon", "getLinearRing", "getCoordinates", "op", "GroundPolylinePrimitive", "GroundPolylineGeometry", "PolylineMaterialAppearance", "olStyleToCesium", "classificationType", "ClassificationType", "TERRAIN", "_primitive", "CircleOutlineGeometry", "extrudedHeight", "olLineStringGeometryToCesium", "heightReference", "PolylineGeometry", "vertexFormat", "olPolygonGeometryToCesium", "boundingExtent", "maxHeight", "max", "featureExtrudedHeight", "RectangleGeometry", "RectangleOutlineGeometry", "rings", "getLinearRings", "hierarchy", "holes", "polygonHierarchy", "PolygonGeometry", "perPositionHeight", "linePositions", "polylineGeometry", "PolygonOutlineGeometry", "altitudeMode", "NONE", "RELATIVE_TO_GROUND", "createBillboardFromImage", "imageStyle", "opt_newBillboardCallback", "OLStyleIcon", "load", "getImage", "reallyCreateBillboard", "HTMLCanvasElement", "Image", "HTMLImageElement", "getScale", "assign", "anchor", "getAnchor", "xScale", "yScale", "pixelOffset", "src", "naturalHeight", "naturalWidth", "cancelled", "fuid", "listener", "isDestroyed", "olPointGeometryToCesium", "modelPrimitive", "olcsModelFunction", "olcsModel", "cesiumOptions", "Model", "model", "fromGltf", "fromGltfAsync", "debugModelMatrix", "DebugModelMatrixPrimitive", "modelMatrix", "olMultiGeometryToCesium", "getType", "points", "getPoints", "geom", "lineStrings", "getLineStrings", "polygons", "getPolygons", "labels", "LabelCollection", "extentCenter", "olGeomSimpleGeometry", "getFirstCoordinate", "offsetX", "getOffsetX", "offsetY", "getOffsetY", "offset", "labelStyle", "horizontalOrigin", "font", "getFont", "LabelStyle", "FILL", "outlineWidth", "OUTLINE", "FILL_AND_OUTLINE", "getTextAlign", "HorizontalOrigin", "LEFT", "RIGHT", "CENTER", "getTextBaseline", "verticalOrigin", "VerticalOrigin", "TOP", "BOTTOM", "fill", "getLineDash", "fromType", "horizontal", "repeat", "evenColor", "oddColor", "computePlainStyle", "fallbackStyleFunction", "featureStyleFunction", "getGeometryFromFeature", "opt_geom", "geom3d", "OLGeometry", "geomFuncRes", "getGeometryFunction", "getGeometry", "olFeatureToCesium", "newBillboardAddedCallback", "featureBb", "getGeometriesArray", "prims", "bbs", "Error", "olVectorLayerToCesium", "olView", "featurePrimitiveMap", "OLClusterSource", "getFeatures", "layerStyle", "prim", "convert", "VectorSynchronizer", "opt_converter", "converter", "olcsFeatureConverter", "csAllPrimitives_", "destroyPrimitives", "updateLayerVisibility", "csPrimitive", "olLayerVector", "olLayerVectorTile", "olSourceCluster", "csPrimitives", "onAddFeature", "onRemoveFeature", "Billboard", "cloneNode", "node", "parent", "nodeName", "drawImage", "appendChild", "nodeType", "Node", "TEXT_NODE", "dispatchEvent", "MouseEvent", "stopPropagation", "nodes", "childNodes", "SynchronizedOverlay", "OLOverlay", "getOptions", "scenePostRenderListenerRemover_", "attributeObserver_", "synchronizer_", "synchronizer", "parent_", "positionWGS84_", "observer_", "MutationObserver", "handleElementChanged", "listenerKeys_", "setPropertyFromEvent", "setPropertyFromEvent_", "handleMapChanged", "observeTarget_", "disconnect", "observe", "childList", "characterData", "subtree", "observer", "getScene", "parentNode", "removeChild", "postRender", "updatePixelPosition", "container", "stopEvent", "getOverlayContainerStopEvent", "getOverlayContainer", "insertFirst", "insertBefore", "handlePositionChanged", "sourceProjection", "getMap", "lastChild", "getElement", "from", "clonedNode", "setVisible", "globeHeight", "tilesLoaded", "cartesian", "ellipsoidBoundingSphere", "BoundingSphere", "Occluder", "isPointVisible", "computeCullingVolume", "computeVisibility", "pixelCartesian", "cartesianToCanvasCoordinates", "mapSize", "updateRenderedPosition", "removeNode", "OverlaySynchronizer", "overlayMap_", "Map", "overlayEvents", "overlayCollection_", "getOverlays", "overlayContainerStopEvent_", "className", "name", "parentElement", "overlayContainer_", "overlay", "addOverlay", "removeOverlay", "cesiumOverlay", "overlayId", "csOverlay", "delete", "BoundingSphereState", "OLCesium", "autoRenderLoop_", "resolutionScale_", "canvasClientWidth_", "canvasClientHeight_", "resolutionScaleChanged_", "enabled_", "pausedInteractions_", "hiddenRootGroup_", "lastFrameTime_", "targetFrameRate_", "Number", "POSITIVE_INFINITY", "blockCesiumRendering_", "warmingUp_", "trackedFeature_", "trackedEntity_", "entityView_", "needTrackedEntityUpdate_", "boundingSphereScratch_", "time_", "time", "JulianDate", "to4326Transform_", "fillArea", "container_", "containerAttribute", "createAttribute", "setAttributeNode", "targetElement", "getViewport", "getElementById", "isOverMap_", "stopOpenLayersEventsPropagation", "ii", "canvasAttribute", "oncontextmenu", "onselectstart", "sceneOptions", "scene3DOnly", "Scene", "sscc", "screenSpaceCameraController", "tiltEventTypes", "CameraEventType", "LEFT_DRAG", "KeyboardEventModifier", "SHIFT", "ALT", "enableLook", "constrainedAxis", "camera_", "olcsCamera", "globe_", "Globe", "baseColor", "WHITE", "skyAtmosphere", "SkyAtmosphere", "firstImageryProvider", "addImageryProvider", "dataSourceCollection_", "DataSourceCollection", "dataSourceDisplay_", "DataSourceDisplay", "dataSourceCollection", "synchronizers_", "createSynchronizers", "olcsRasterSynchronizer", "olcsVectorSynchronizer", "olcsOverlaySynchronizer", "handleResize_", "EventHelper", "updateTrackedEntity_", "cancelAnimationFrame", "renderId_", "_postRender", "render_", "onAnimationFrame_", "frameTime", "interval", "julianDate", "initializeFrame", "update", "trackedEntity", "getBoundingSphere", "render", "state", "enableTilt", "bs", "EntityView", "mapProjection", "resolutionScale", "devicePixelRatio", "aspectRatio", "getCamera", "getOlView", "getDataSources", "getDataSourceDisplay", "getEnabled", "setEnabled", "interactions", "visibility", "throwOnUnitializedMap_", "getInteractions", "arr", "addInteraction", "interaction", "removeInteraction", "interactionRemoved", "filter", "removed", "rootGroup", "classList", "warmUp", "timeout", "csCamera", "setTimeout", "setBlockCesiumRendering", "block", "enableAutoRenderLoop", "olcsAutoRenderLoop", "getAutoRenderLoop", "setResolutionScale", "setTargetFrameRate", "isDef", "trackedFeature", "defaultDataSource", "entities", "IDENTITY", "to4326Transform", "toCesiumPosition", "olGeomPoint", "CallbackProperty", "TRANSPARENT", "computeRectangle", "tw", "th", "maskAspectRatio", "maskSize", "scaling", "postUnlistener", "MaskDrawer", "gl", "shaderProgram", "initShaderProgram", "programInfo", "program", "attribLocations", "vertexPosition", "getAttribLocation", "uniformLocations", "uScaling", "getUniformLocation", "positionBuffer", "createBuffer", "bindBuffer", "ARRAY_BUFFER", "bufferData", "Float32Array", "STATIC_DRAW", "getVertexShaderSource", "getFragmentShaderSource", "vsSource", "fsSource", "vertexShader", "loadShader", "VERTEX_SHADER", "fragmentShader", "FRAGMENT_SHADER", "createProgram", "attachShader", "linkProgram", "getProgramParameter", "LINK_STATUS", "getProgramInfoLog", "drawMask", "BLEND", "vertexAttribPointer", "FLOAT", "enableVertexAttribArray", "useProgram", "STENCIL_TEST", "stencilFunc", "ALWAYS", "stencilOp", "KEEP", "REPLACE", "uniform2fv", "blendFunc", "ONE", "drawArrays", "TRIANGLE_STRIP", "EQUAL", "SRC_ALPHA", "shader", "createShader", "shaderSource", "compileShader", "getShaderParameter", "COMPILE_STATUS", "getShaderInfoLog", "autoDrawMask", "getScalings", "drawer", "takeScreenshot", "remover", "smallerCanvas", "LazyLoader", "url_", "script", "onload", "onerror", "head", "Manager", "Observable", "cesiumUrl", "cameraExtentInRadians", "cesiumIonDefaultAccessToken", "cesiumInitialTilt_", "fogDensity", "fogSSEFactor", "minimumZoomDistance", "maximumZoomDistance", "limitCameraToBoundingSphereRatio", "cesiumUrl_", "cesiumIonDefaultAccessToken_", "promise_", "cesiumLazyLoader", "olcsContribLazyLoader", "onCesiumLoaded", "rect", "DEFAULT_VIEW_RECTANGLE", "boundingSphere_", "fromRectangle3D", "Ion", "defaultAccessToken", "instantiateOLCesium", "configureForUsability", "configureForPerformance", "terrainProvider", "createWorldTerrain", "createWorldTerrainAsync", "tp", "fog", "density", "screenSpaceErrorFactor", "sscController", "depthTestAgainstTerrain", "backgroundColor", "toggle3d", "is3DCurrentlyEnabled", "set3dWithView", "lon", "lat", "elevation", "headingDeg", "pitchDeg", "is3dEnabled", "getTiltOnGlobe", "bottom", "getOl3d", "getCesiumViewMatrix", "flyToRectangle", "getRectangleCameraCoordinates", "mag", "multiplyByScalar", "flyTo", "endTransform", "olcs", "core", "contrib", "ContribLazyLoader", "ContribManager"]
}
