{"version":3,"file":"olcesium.umd.js","mappings":"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","sources":["webpack://olcs/webpack/universalModuleDefinition","webpack://olcs/external umd \"ol/Observable.js\"","webpack://olcs/external umd \"ol/Overlay.js\"","webpack://olcs/external umd \"ol/easing.js\"","webpack://olcs/external umd \"ol/extent.js\"","webpack://olcs/external umd \"ol/format/MVT.js\"","webpack://olcs/external umd \"ol/geom.js\"","webpack://olcs/external umd \"ol/geom/Point.js\"","webpack://olcs/external umd \"ol/geom/Polygon.js\"","webpack://olcs/external umd \"ol/geom/SimpleGeometry.js\"","webpack://olcs/external umd \"ol/layer/BaseVector.js\"","webpack://olcs/external umd \"ol/layer/Group.js\"","webpack://olcs/external umd \"ol/layer/Image.js\"","webpack://olcs/external umd \"ol/layer/Layer.js\"","webpack://olcs/external umd \"ol/layer/Tile.js\"","webpack://olcs/external umd \"ol/layer/Vector.js\"","webpack://olcs/external umd \"ol/layer/VectorTile.js\"","webpack://olcs/external umd \"ol/proj.js\"","webpack://olcs/external umd \"ol/render.js\"","webpack://olcs/external umd \"ol/render/Feature.js\"","webpack://olcs/external umd \"ol/source.js\"","webpack://olcs/external umd \"ol/source/Cluster.js\"","webpack://olcs/external umd \"ol/source/Image.js\"","webpack://olcs/external umd \"ol/source/ImageStatic.js\"","webpack://olcs/external umd \"ol/source/ImageWMS.js\"","webpack://olcs/external umd \"ol/source/TileImage.js\"","webpack://olcs/external umd \"ol/source/TileWMS.js\"","webpack://olcs/external umd \"ol/source/Vector.js\"","webpack://olcs/external umd \"ol/source/VectorTile.js\"","webpack://olcs/external umd \"ol/structs/LRUCache.js\"","webpack://olcs/external umd \"ol/style/Icon.js\"","webpack://olcs/external umd \"ol/style/Stroke.js\"","webpack://olcs/external umd \"ol/style/Style.js\"","webpack://olcs/external umd \"ol/tilegrid.js\"","webpack://olcs/external umd \"ol/tileurlfunction.js\"","webpack://olcs/external umd \"ol/util.js\"","webpack://olcs/webpack/bootstrap","webpack://olcs/webpack/runtime/compat get default export","webpack://olcs/webpack/runtime/define property getters","webpack://olcs/webpack/runtime/hasOwnProperty shorthand","webpack://olcs/webpack/runtime/make namespace object","webpack://olcs/./src/olcs/util.ts","webpack://olcs/./src/olcs/core/OLImageryProvider.ts","webpack://olcs/./src/olcs/MVTImageryProvider.ts","webpack://olcs/./src/olcs/core.ts","webpack://olcs/./src/olcs/AutoRenderLoop.ts","webpack://olcs/./src/olcs/math.ts","webpack://olcs/./src/olcs/Camera.ts","webpack://olcs/./src/olcs/AbstractSynchronizer.ts","webpack://olcs/./src/olcs/RasterSynchronizer.ts","webpack://olcs/./src/olcs/core/VectorLayerCounterpart.ts","webpack://olcs/./src/olcs/FeatureConverter.ts","webpack://olcs/./src/olcs/VectorSynchronizer.ts","webpack://olcs/./src/olcs/SynchronizedOverlay.ts","webpack://olcs/./src/olcs/OverlaySynchronizer.ts","webpack://olcs/./src/olcs/OLCesium.ts","webpack://olcs/./src/olcs/print/computeRectangle.ts","webpack://olcs/./src/olcs/print/drawCesiumMask.ts","webpack://olcs/./src/olcs/print/takeCesiumScreenshot.ts","webpack://olcs/./src/olcs/contrib/LazyLoader.ts","webpack://olcs/./src/olcs/contrib/Manager.ts","webpack://olcs/./src/olcs.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"ol/geom/Point.js\"), require(\"ol/easing.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Image.js\"), require(\"ol/proj.js\"), require(\"ol/source/ImageStatic.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/VectorTile.js\"), require(\"ol/source/Image.js\"), require(\"ol/source.js\"), require(\"ol/format/MVT.js\"), require(\"ol/style/Style.js\"), require(\"ol/style/Stroke.js\"), require(\"ol/render.js\"), require(\"ol/util.js\"), require(\"ol/structs/LRUCache.js\"), require(\"ol/tilegrid.js\"), require(\"ol/tileurlfunction.js\"), require(\"ol/render/Feature.js\"), require(\"ol/layer/VectorTile.js\"), require(\"ol/extent.js\"), require(\"ol/Observable.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/BaseVector.js\"), require(\"ol/source/Vector.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/style/Icon.js\"), require(\"ol/geom/Polygon.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/geom.js\"), require(\"ol/Overlay.js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"ol/geom/Point.js\", \"ol/easing.js\", \"ol/layer/Tile.js\", \"ol/layer/Image.js\", \"ol/proj.js\", \"ol/source/ImageStatic.js\", \"ol/source/ImageWMS.js\", \"ol/source/TileImage.js\", \"ol/source/TileWMS.js\", \"ol/source/VectorTile.js\", \"ol/source/Image.js\", \"ol/source.js\", \"ol/format/MVT.js\", \"ol/style/Style.js\", \"ol/style/Stroke.js\", \"ol/render.js\", \"ol/util.js\", \"ol/structs/LRUCache.js\", \"ol/tilegrid.js\", \"ol/tileurlfunction.js\", \"ol/render/Feature.js\", \"ol/layer/VectorTile.js\", \"ol/extent.js\", \"ol/Observable.js\", \"ol/layer/Group.js\", \"ol/layer/BaseVector.js\", \"ol/source/Vector.js\", \"ol/layer/Layer.js\", \"ol/source/Cluster.js\", \"ol/layer/Vector.js\", \"ol/style/Icon.js\", \"ol/geom/Polygon.js\", \"ol/geom/SimpleGeometry.js\", \"ol/geom.js\", \"ol/Overlay.js\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"olcs\"] = factory(require(\"ol/geom/Point.js\"), require(\"ol/easing.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Image.js\"), require(\"ol/proj.js\"), require(\"ol/source/ImageStatic.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/VectorTile.js\"), require(\"ol/source/Image.js\"), require(\"ol/source.js\"), require(\"ol/format/MVT.js\"), require(\"ol/style/Style.js\"), require(\"ol/style/Stroke.js\"), require(\"ol/render.js\"), require(\"ol/util.js\"), require(\"ol/structs/LRUCache.js\"), require(\"ol/tilegrid.js\"), require(\"ol/tileurlfunction.js\"), require(\"ol/render/Feature.js\"), require(\"ol/layer/VectorTile.js\"), require(\"ol/extent.js\"), require(\"ol/Observable.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/BaseVector.js\"), require(\"ol/source/Vector.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/style/Icon.js\"), require(\"ol/geom/Polygon.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/geom.js\"), require(\"ol/Overlay.js\"));\n\telse\n\t\troot[\"olcs\"] = factory(root[\"ol/geom/Point.js\"], root[\"ol/easing.js\"], root[\"ol/layer/Tile.js\"], root[\"ol/layer/Image.js\"], root[\"ol/proj.js\"], root[\"ol/source/ImageStatic.js\"], root[\"ol/source/ImageWMS.js\"], root[\"ol/source/TileImage.js\"], root[\"ol/source/TileWMS.js\"], root[\"ol/source/VectorTile.js\"], root[\"ol/source/Image.js\"], root[\"ol/source.js\"], root[\"ol/format/MVT.js\"], root[\"ol/style/Style.js\"], root[\"ol/style/Stroke.js\"], root[\"ol/render.js\"], root[\"ol/util.js\"], root[\"ol/structs/LRUCache.js\"], root[\"ol/tilegrid.js\"], root[\"ol/tileurlfunction.js\"], root[\"ol/render/Feature.js\"], root[\"ol/layer/VectorTile.js\"], root[\"ol/extent.js\"], root[\"ol/Observable.js\"], root[\"ol/layer/Group.js\"], root[\"ol/layer/BaseVector.js\"], root[\"ol/source/Vector.js\"], root[\"ol/layer/Layer.js\"], root[\"ol/source/Cluster.js\"], root[\"ol/layer/Vector.js\"], root[\"ol/style/Icon.js\"], root[\"ol/geom/Polygon.js\"], root[\"ol/geom/SimpleGeometry.js\"], root[\"ol/geom.js\"], root[\"ol/Overlay.js\"]);\n})(self, (__WEBPACK_EXTERNAL_MODULE__206__, __WEBPACK_EXTERNAL_MODULE__177__, __WEBPACK_EXTERNAL_MODULE__164__, __WEBPACK_EXTERNAL_MODULE__330__, __WEBPACK_EXTERNAL_MODULE__24__, __WEBPACK_EXTERNAL_MODULE__606__, __WEBPACK_EXTERNAL_MODULE__469__, __WEBPACK_EXTERNAL_MODULE__623__, __WEBPACK_EXTERNAL_MODULE__886__, __WEBPACK_EXTERNAL_MODULE__622__, __WEBPACK_EXTERNAL_MODULE__673__, __WEBPACK_EXTERNAL_MODULE__432__, __WEBPACK_EXTERNAL_MODULE__401__, __WEBPACK_EXTERNAL_MODULE__193__, __WEBPACK_EXTERNAL_MODULE__51__, __WEBPACK_EXTERNAL_MODULE__817__, __WEBPACK_EXTERNAL_MODULE__280__, __WEBPACK_EXTERNAL_MODULE__750__, __WEBPACK_EXTERNAL_MODULE__628__, __WEBPACK_EXTERNAL_MODULE__423__, __WEBPACK_EXTERNAL_MODULE__115__, __WEBPACK_EXTERNAL_MODULE__996__, __WEBPACK_EXTERNAL_MODULE__235__, __WEBPACK_EXTERNAL_MODULE__911__, __WEBPACK_EXTERNAL_MODULE__604__, __WEBPACK_EXTERNAL_MODULE__515__, __WEBPACK_EXTERNAL_MODULE__830__, __WEBPACK_EXTERNAL_MODULE__582__, __WEBPACK_EXTERNAL_MODULE__63__, __WEBPACK_EXTERNAL_MODULE__425__, __WEBPACK_EXTERNAL_MODULE__962__, __WEBPACK_EXTERNAL_MODULE__253__, __WEBPACK_EXTERNAL_MODULE__988__, __WEBPACK_EXTERNAL_MODULE__524__, __WEBPACK_EXTERNAL_MODULE__312__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__911__;","module.exports = __WEBPACK_EXTERNAL_MODULE__312__;","module.exports = __WEBPACK_EXTERNAL_MODULE__177__;","module.exports = __WEBPACK_EXTERNAL_MODULE__235__;","module.exports = __WEBPACK_EXTERNAL_MODULE__401__;","module.exports = __WEBPACK_EXTERNAL_MODULE__524__;","module.exports = __WEBPACK_EXTERNAL_MODULE__206__;","module.exports = __WEBPACK_EXTERNAL_MODULE__253__;","module.exports = __WEBPACK_EXTERNAL_MODULE__988__;","module.exports = __WEBPACK_EXTERNAL_MODULE__515__;","module.exports = __WEBPACK_EXTERNAL_MODULE__604__;","module.exports = __WEBPACK_EXTERNAL_MODULE__330__;","module.exports = __WEBPACK_EXTERNAL_MODULE__582__;","module.exports = __WEBPACK_EXTERNAL_MODULE__164__;","module.exports = __WEBPACK_EXTERNAL_MODULE__425__;","module.exports = __WEBPACK_EXTERNAL_MODULE__996__;","module.exports = __WEBPACK_EXTERNAL_MODULE__24__;","module.exports = __WEBPACK_EXTERNAL_MODULE__817__;","module.exports = __WEBPACK_EXTERNAL_MODULE__115__;","module.exports = __WEBPACK_EXTERNAL_MODULE__432__;","module.exports = __WEBPACK_EXTERNAL_MODULE__63__;","module.exports = __WEBPACK_EXTERNAL_MODULE__673__;","module.exports = __WEBPACK_EXTERNAL_MODULE__606__;","module.exports = __WEBPACK_EXTERNAL_MODULE__469__;","module.exports = __WEBPACK_EXTERNAL_MODULE__623__;","module.exports = __WEBPACK_EXTERNAL_MODULE__886__;","module.exports = __WEBPACK_EXTERNAL_MODULE__830__;","module.exports = __WEBPACK_EXTERNAL_MODULE__622__;","module.exports = __WEBPACK_EXTERNAL_MODULE__750__;","module.exports = __WEBPACK_EXTERNAL_MODULE__962__;","module.exports = __WEBPACK_EXTERNAL_MODULE__51__;","module.exports = __WEBPACK_EXTERNAL_MODULE__193__;","module.exports = __WEBPACK_EXTERNAL_MODULE__628__;","module.exports = __WEBPACK_EXTERNAL_MODULE__423__;","module.exports = __WEBPACK_EXTERNAL_MODULE__280__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import type {Projection} from 'ol/proj';\nimport type {Source} from 'ol/source';\n\nlet _imageRenderingPixelatedSupported: boolean = undefined;\nlet _imageRenderingValue: string = undefined;\n\n\n/**\n * https://caniuse.com/mdn-css_properties_image-rendering_pixelated\n * @return whether the browser supports\n */\nexport function supportsImageRenderingPixelated(): boolean {\n  if (_imageRenderingPixelatedSupported === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const imageRenderingValue = canvas.style.imageRendering;\n    _imageRenderingPixelatedSupported = !!imageRenderingValue;\n    if (_imageRenderingPixelatedSupported) {\n      _imageRenderingValue = imageRenderingValue;\n    }\n  }\n  return _imageRenderingPixelatedSupported;\n}\n\n\n/**\n * The value supported by thie browser for the CSS property \"image-rendering\"\n * @return {string}\n */\nexport function imageRenderingValue() {\n  supportsImageRenderingPixelated();\n  return _imageRenderingValue || '';\n}\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param source Source.\n * @return The projection of the source.\n */\nexport function getSourceProjection(source: Source): Projection {\n  return source.get('olcs.projection') as Projection || source.getProjection();\n}\n\n\n/**\n * Counter for getUid.\n * @type {number}\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid. Similar to OL getUid.\n *\n * @param obj The object to get the unique ID for.\n * @return The unique ID for the object.\n */\nexport function getUid(obj: any): number {\n  return obj.olcs_uid || (obj.olcs_uid = ++uidCounter_);\n}\n\nexport function waitReady<Type>(object: Type): Promise<Type> {\n  const o = object as any;\n  const p = o.readyPromise;\n  if (p) {\n    return p;\n  }\n  if (o.ready !== undefined) {\n    if (o.ready) {\n      return Promise.resolve(object);\n    }\n    return new Promise((resolve, _) => {\n      // FIXME: this is crazy\n      // alternative: intercept _ready = true\n      // altnerative: pass a timeout\n      const stopper = setInterval(() => {\n        if (o.ready) {\n          clearInterval(stopper);\n          resolve(object);\n        }\n      }, 20);\n    });\n  }\n  return Promise.reject('Not a readyable object');\n}\n","import {getSourceProjection} from '../util';\nimport {Tile as TileSource, type TileImage} from 'ol/source.js';\nimport {attributionsFunctionToCredits} from '../core';\nimport type {Map} from 'ol';\nimport type {Projection} from 'ol/proj.js';\nimport type {Credit, Event, ImageryLayerFeatureInfo, ImageryProvider, ImageryTypes, Proxy, Rectangle, Request, TileDiscardPolicy, TilingScheme} from 'cesium';\n\n\nexport function createEmptyCanvas(): HTMLCanvasElement {\n  const canvas = document.createElement('canvas');\n  canvas.width = 1;\n  canvas.height = 1;\n  return canvas;\n}\n\nconst olUseNewCoordinates = (function() {\n  const tileSource = new TileSource({\n    projection: 'EPSG:3857',\n    wrapX: true\n  });\n  const tileCoord = tileSource.getTileCoordForTileUrlFunction([6, -31, 22]);\n  return tileCoord && tileCoord[1] === 33 && tileCoord[2] === 22;\n  // See b/test/spec/ol/source/tile.test.js\n  // of e9a30c5cb7e3721d9370025fbe5472c322847b35 in OpenLayers repository\n})();\n\n\nexport default class OLImageryProvider implements ImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  private source_: TileImage;\n  private projection_: Projection | undefined;\n  private fallbackProj_: Projection | undefined;\n  private map_: Map;\n  private shouldRequestNextLevel: boolean;\n  private emptyCanvas_: HTMLCanvasElement = createEmptyCanvas();\n  private emptyCanvasPromise_: Promise<HTMLCanvasElement> = Promise.resolve(this.emptyCanvas_);\n  private tilingScheme_: TilingScheme;\n  private ready_: boolean;\n  private rectangle_: Rectangle;\n\n  /**\n * When <code>true</code>, this model is ready to render, i.e., the external binary, image,\n * and shader files were downloaded and the WebGL resources were created.\n */\n  get ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n * Gets the rectangle, in radians, of the imagery provided by the instance.\n */\n  get rectangle() {\n    return this.rectangle_;\n  }\n\n  /**\n   * Gets the tiling scheme used by the provider.\n   */\n  get tilingScheme(): TilingScheme {\n    return this.tilingScheme_;\n  }\n\n  /**\n   * Gets an event that is raised when the imagery provider encounters an asynchronous error.  By subscribing\n   * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n   * are passed an instance of {@link Cesium.TileProviderError}.\n   */\n  readonly errorEvent: Event = new Cesium.Event();\n\n  /**\n   * Gets the credit to display when this imagery provider is active.  Typically this is used to credit\n   * the source of the imagery.\n   */\n  readonly credit: Credit;\n\n  /**\n   * Gets the proxy used by this provider.\n   */\n  readonly proxy: Proxy;\n\n  get _ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n   * Gets the width of each tile, in pixels.\n   */\n  get tileWidth(): number {\n    const tileGrid = this.source_.getTileGrid();\n    if (tileGrid) {\n      const tileSizeAtZoom0 = tileGrid.getTileSize(0);\n      if (Array.isArray(tileSizeAtZoom0)) {\n        return tileSizeAtZoom0[0];\n      } else {\n        return tileSizeAtZoom0; // same width and height\n      }\n    }\n    return 256;\n  }\n\n  /**\n   * Gets the height of each tile, in pixels.\n   */\n  get tileHeight(): number {\n    const tileGrid = this.source_.getTileGrid();\n    if (tileGrid) {\n      const tileSizeAtZoom0 = tileGrid.getTileSize(0);\n      if (Array.isArray(tileSizeAtZoom0)) {\n        return tileSizeAtZoom0[1];\n      } else {\n        return tileSizeAtZoom0; // same width and height\n      }\n    }\n    return 256;\n  }\n\n  /**\n   * Gets the maximum level-of-detail that can be requested.\n   */\n  get maximumLevel(): number {\n    const tileGrid = this.source_.getTileGrid();\n    if (tileGrid) {\n      return tileGrid.getMaxZoom();\n    } else {\n      return 18; // some arbitrary value\n    }\n  }\n\n  // FIXME: to implement, we could check the number of tiles at minzoom (for this rectangle) and return 0 if too big\n  /**\n   * Gets the minimum level-of-detail that can be requested.  Generally,\n   * a minimum level should only be used when the rectangle of the imagery is small\n   * enough that the number of tiles at the minimum level is small.  An imagery\n   * provider with more than a few tiles at the minimum level will lead to\n   * rendering problems.\n   */\n  get minimumLevel() {\n    // WARNING: Do not use the minimum level (at least until the extent is\n    // properly set). Cesium assumes the minimumLevel to contain only\n    // a few tiles and tries to load them all at once -- this can\n    // freeze and/or crash the browser !\n    return 0;\n    //var tg = this.source_.getTileGrid();\n    //return tg ? tg.getMinZoom() : 0;\n  }\n\n  /**\n   * Gets the tile discard policy.  If not undefined, the discard policy is responsible\n   * for filtering out \"missing\" tiles via its shouldDiscardImage function.  If this function\n   * returns undefined, no tiles are filtered.\n   */\n  get tileDiscardPolicy(): TileDiscardPolicy {\n    return undefined;\n  }\n\n  // FIXME: this might be exposed\n  /**\n   * Gets a value indicating whether or not the images provided by this imagery provider\n   * include an alpha channel.  If this property is false, an alpha channel, if present, will\n   * be ignored.  If this property is true, any images without an alpha channel will be treated\n   * as if their alpha is 1.0 everywhere.  When this property is false, memory usage\n   * and texture upload time are reduced.\n   */\n  get hasAlphaChannel() {\n    return true;\n  }\n\n  // FIXME: this could be implemented by proxying to OL\n  /**\n   * Asynchronously determines what features, if any, are located at a given longitude and latitude within\n   * a tile.\n   * This function is optional, so it may not exist on all ImageryProviders.\n   * @param x - The tile X coordinate.\n   * @param y - The tile Y coordinate.\n   * @param level - The tile level.\n   * @param longitude - The longitude at which to pick features.\n   * @param latitude - The latitude at which to pick features.\n   * @return A promise for the picked features that will resolve when the asynchronous\n   *                   picking completes.  The resolved value is an array of {@link ImageryLayerFeatureInfo}\n   *                   instances.  The array may be empty if no features are found at the given location.\n   *                   It may also be undefined if picking is not supported.\n   */\n  pickFeatures(x: number, y: number, level: number, longitude: number, latitude: number): Promise<ImageryLayerFeatureInfo[]> | undefined {\n    return undefined;\n  }\n\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param olMap OL map\n   * @param source Tile image source\n   * @param [opt_fallbackProj] Projection to assume if source has no projection\n   */\n  constructor(olMap: Map, source: TileImage, opt_fallbackProj: Projection) {\n    this.source_ = source;\n\n    this.projection_ = null;\n\n    this.ready_ = false;\n\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    // cesium v107+ don't wait for ready anymore so we put somehing here while it loads\n    this.tilingScheme_ = new Cesium.WebMercatorTilingScheme();\n\n    this.rectangle_ = null;\n\n    this.map_ = olMap;\n\n    this.shouldRequestNextLevel = false;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        // Duck typing a proxy\n        this.proxy = {\n          'getURL': proxy\n        } as Proxy;\n      } else if (typeof proxy === 'string') {\n        this.proxy = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   */\n  private handleSourceChanged_() {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = getSourceProjection(this.source_) || this.fallbackProj_;\n      const options = {numberOfLevelZeroTilesX: 1, numberOfLevelZeroTilesY: 1};\n\n      if (this.source_.tileGrid !== null) {\n        // Get the number of tiles at level 0 if it is defined\n        this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(), 0, ([zoom, xIndex, yIndex]) => {\n          options.numberOfLevelZeroTilesX = xIndex + 1;\n          options.numberOfLevelZeroTilesY = yIndex + 1;\n        });\n      }\n\n      if (this.projection_.getCode() === 'EPSG:4326') {\n        // Cesium zoom level 0 is OpenLayers zoom level 1 for layer in EPSG:4326 with a single tile on level 0\n        this.shouldRequestNextLevel = options.numberOfLevelZeroTilesX === 1 && options.numberOfLevelZeroTilesY === 1;\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme(options);\n      } else if (this.projection_.getCode() === 'EPSG:3857') {\n        this.shouldRequestNextLevel = false;\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(options);\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Generates the proper attributions for a given position and zoom\n   * level.\n   * @implements\n   */\n  getTileCredits(x: number, y: number, level: number): Credit[] {\n    const attributionsFunction = this.source_.getAttributions();\n    if (!attributionsFunction) {\n      return [];\n    }\n    const extent = this.map_.getView().calculateExtent(this.map_.getSize());\n    const center = this.map_.getView().getCenter();\n    const zoom = this.shouldRequestNextLevel ? level + 1 : level;\n    return attributionsFunctionToCredits(attributionsFunction, zoom, center, extent);\n  }\n\n  /**\n   * @implements\n   */\n  requestImage(x: number, y: number, level: number, request?: Request): Promise<ImageryTypes> | undefined {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n      const z_ = this.shouldRequestNextLevel ? level + 1 : level;\n\n      let y_ = y;\n      if (!olUseNewCoordinates) {\n        // LEGACY\n        // OpenLayers version 3 to 5 tile coordinates increase from bottom to top\n        y_ = -y - 1;\n      }\n      let url = tileUrlFunction.call(this.source_, [z_, x, y_], 1, this.projection_);\n      if (this.proxy) {\n        url = this.proxy.getURL(url);\n      }\n      if (url) {\n        // It is probably safe to cast here\n        return Cesium.ImageryProvider.loadImage(this, url) as Promise<ImageryTypes>;\n      }\n      return this.emptyCanvasPromise_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvasPromise_;\n    }\n  }\n}\n","import MVT from 'ol/format/MVT.js';\nimport Style, {type StyleFunction} from 'ol/style/Style.js';\nimport Stroke from 'ol/style/Stroke.js';\nimport {toContext} from 'ol/render.js';\nimport {get as getProjection} from 'ol/proj.js';\nimport {VERSION as OL_VERSION} from 'ol/util.js';\nimport LRUCache from 'ol/structs/LRUCache.js';\nimport {getForProjection as getTilegridForProjection} from 'ol/tilegrid.js';\nimport {createFromTemplates as createTileUrlFunctions} from 'ol/tileurlfunction.js';\nimport type {Credit, Event, ImageryLayerFeatureInfo, ImageryProvider, ImageryTypes, Proxy, Rectangle, Request, TileDiscardPolicy, TilingScheme} from 'cesium';\nimport type {UrlFunction} from 'ol/Tile.js';\nimport RenderFeature from 'ol/render/Feature.js';\nimport {createEmptyCanvas} from './core/OLImageryProvider';\n\n\nexport interface MVTOptions {\n  urls: string[],\n  rectangle: Rectangle,\n  credit: Credit,\n  styleFunction: StyleFunction,\n  cacheSize?: number,\n  featureCache?: LRUCache<Promise<RenderFeature[]>>\n  minimumLevel: number\n}\n\nconst format = new MVT({\n  featureClass: RenderFeature\n});\n\nconst styles = [new Style({\n  stroke: new Stroke({\n    color: 'blue',\n    width: 2\n  })\n})];\n\n\nexport default class MVTImageryProvider implements ImageryProvider {\n  private urls: string[];\n  private emptyCanvas_: HTMLCanvasElement = createEmptyCanvas();\n  private emptyCanvasPromise_: Promise<HTMLCanvasElement> = Promise.resolve(this.emptyCanvas_);\n  private tilingScheme_ = new Cesium.WebMercatorTilingScheme;\n  private ready_ = true;\n  private rectangle_: Rectangle;\n  private tileRectangle_: Rectangle;\n  readonly tileWidth = 256;\n  readonly tileHeight = 256;\n  readonly maximumLevel = 20;\n  private minimumLevel_ = 0;\n  get minimumLevel(): number {\n    return this.minimumLevel_;\n  }\n  private featureCache: LRUCache<Promise<RenderFeature[]>>;\n  private tileCache: LRUCache<Promise<HTMLCanvasElement>>;\n  private tileFunction_: UrlFunction;\n  private styleFunction_: StyleFunction;\n  private projection_ = getProjection('EPSG:3857');\n\n  /**\n * When <code>true</code>, this model is ready to render, i.e., the external binary, image,\n * and shader files were downloaded and the WebGL resources were created.\n */\n  get ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n * Gets the rectangle, in radians, of the imagery provided by the instance.\n */\n  get rectangle() {\n    return this.rectangle_;\n  }\n\n  /**\n   * Gets the tiling scheme used by the provider.\n   */\n  get tilingScheme(): TilingScheme {\n    return this.tilingScheme_;\n  }\n\n  /**\n   * Gets an event that is raised when the imagery provider encounters an asynchronous error.  By subscribing\n   * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n   * are passed an instance of {@link Cesium.TileProviderError}.\n   */\n  readonly errorEvent: Event = new Cesium.Event();\n\n  /**\n   * Gets the credit to display when this imagery provider is active.  Typically this is used to credit\n   * the source of the imagery.\n   */\n  readonly credit: Credit;\n\n  getTileCredits(x: number, y: number, level: number): Credit[] {\n    return [];\n  }\n\n  /**\n   * Gets the proxy used by this provider.\n   */\n  readonly proxy: Proxy;\n\n  get _ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n   * Gets the tile discard policy.  If not undefined, the discard policy is responsible\n   * for filtering out \"missing\" tiles via its shouldDiscardImage function.  If this function\n   * returns undefined, no tiles are filtered.\n   */\n  get tileDiscardPolicy(): TileDiscardPolicy {\n    return undefined;\n  }\n\n  // FIXME: this might be exposed\n  /**\n   * Gets a value indicating whether or not the images provided by this imagery provider\n   * include an alpha channel.  If this property is false, an alpha channel, if present, will\n   * be ignored.  If this property is true, any images without an alpha channel will be treated\n   * as if their alpha is 1.0 everywhere.  When this property is false, memory usage\n   * and texture upload time are reduced.\n   */\n  get hasAlphaChannel() {\n    return true;\n  }\n\n  // FIXME: this could be implemented by proxying to OL\n  /**\n   * Asynchronously determines what features, if any, are located at a given longitude and latitude within\n   * a tile.\n   * This function is optional, so it may not exist on all ImageryProviders.\n   * @param x - The tile X coordinate.\n   * @param y - The tile Y coordinate.\n   * @param level - The tile level.\n   * @param longitude - The longitude at which to pick features.\n   * @param latitude - The latitude at which to pick features.\n   * @return A promise for the picked features that will resolve when the asynchronous\n   *                   picking completes.  The resolved value is an array of {@link ImageryLayerFeatureInfo}\n   *                   instances.  The array may be empty if no features are found at the given location.\n   *                   It may also be undefined if picking is not supported.\n   */\n  pickFeatures(x: number, y: number, level: number, longitude: number, latitude: number): Promise<ImageryLayerFeatureInfo[]> | undefined {\n    return undefined;\n  }\n\n  constructor(options: MVTOptions) {\n    this.urls = options.urls;\n    this.rectangle_ = options.rectangle || this.tilingScheme.rectangle;\n    this.credit = options.credit;\n    this.styleFunction_ = options.styleFunction || (() => styles);\n    this.tileRectangle_ = new Cesium.Rectangle();\n    // to avoid too frequent cache grooming we allow x2 capacity\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 50;\n    this.tileCache = new LRUCache(cacheSize);\n    this.featureCache = options.featureCache || new LRUCache(cacheSize);\n    this.minimumLevel_ = options.minimumLevel || 0;\n    const tileGrid = getTilegridForProjection(this.projection_);\n    this.tileFunction_ = createTileUrlFunctions(this.urls, tileGrid);\n  }\n\n  private getTileFeatures(z: number, x: number, y: number): Promise<RenderFeature[]> {\n    const cacheKey = this.getCacheKey_(z, x, y);\n    let promise;\n    if (this.featureCache.containsKey(cacheKey)) {\n      promise = this.featureCache.get(cacheKey);\n    }\n    if (!promise) {\n      const url = this.getUrl_(z, x, y);\n      promise = fetch(url)\n          .then(r => (r.ok ? r : Promise.reject(r)))\n          .then(r => r.arrayBuffer())\n          .then(buffer => this.readFeaturesFromBuffer(buffer));\n      this.featureCache.set(cacheKey, promise);\n      if (this.featureCache.getCount() > 2 * this.featureCache.highWaterMark) {\n        while (this.featureCache.canExpireCache()) {\n          this.featureCache.pop();\n        }\n      }\n    }\n    return promise;\n  }\n\n  readFeaturesFromBuffer(buffer: ArrayBuffer): RenderFeature[] {\n    let options;\n    if (OL_VERSION <= '6.4.4') {\n      // See https://github.com/openlayers/openlayers/pull/11540\n      options = {\n        extent: [0, 0, 4096, 4096],\n        dataProjection: this.projection_,\n        featureProjection: this.projection_\n      };\n    }\n    const features = format.readFeatures(buffer, options) as RenderFeature[];\n    const scaleFactor = this.tileWidth / 4096;\n    features.forEach((f) => {\n      const flatCoordinates = f.getFlatCoordinates();\n      let flip = false;\n      for (let i = 0; i < flatCoordinates.length; ++i) {\n        flatCoordinates[i] *= scaleFactor;\n        if (flip) {\n          // FIXME: why do we need this now?\n          flatCoordinates[i] = this.tileWidth - flatCoordinates[i];\n        }\n        if (OL_VERSION <= '6.4.4') {\n          // LEGACY\n          flip = !flip;\n        }\n      }\n    });\n\n    return features;\n  }\n\n  private getUrl_(z: number, x: number, y: number): string {\n    // FIXME: probably we should not pass 1 as pixelRatio\n    const url = this.tileFunction_([z, x, y], 1, this.projection_);\n    return url;\n  }\n\n  private getCacheKey_(z: number, x: number, y: number) {\n    return `${z}_${x}_${y}`;\n  }\n\n  requestImage(x: number, y: number, z: number, request?: Request): Promise<ImageryTypes> | undefined {\n    if (z < this.minimumLevel_) {\n      return this.emptyCanvasPromise_;\n    }\n\n    try {\n      const cacheKey = this.getCacheKey_(z, x, y);\n      let promise;\n      if (this.tileCache.containsKey(cacheKey)) {\n        promise = this.tileCache.get(cacheKey);\n      }\n      if (!promise) {\n        promise = this.getTileFeatures(z, x, y)\n            .then((features) => {\n            // FIXME: here we suppose the 2D projection is in meters\n              this.tilingScheme.tileXYToNativeRectangle(x, y, z, this.tileRectangle_);\n              const resolution = (this.tileRectangle_.east - this.tileRectangle_.west) / this.tileWidth;\n              return this.rasterizeFeatures(features, this.styleFunction_, resolution);\n            });\n        this.tileCache.set(cacheKey, promise);\n        if (this.tileCache.getCount() > 2 * this.tileCache.highWaterMark) {\n          while (this.tileCache.canExpireCache()) {\n            this.tileCache.pop();\n          }\n        }\n      }\n      return promise;\n    } catch (e) {\n      console.trace(e);\n      // FIXME: open PR on Cesium to fix incorrect typing\n      // @ts-ignore\n      this.errorEvent.raiseEvent('could not render pbf to tile', e);\n    }\n  }\n\n  rasterizeFeatures(features: RenderFeature[], styleFunction: StyleFunction, resolution: number): HTMLCanvasElement {\n    const canvas = document.createElement('canvas');\n    const vectorContext = toContext(canvas.getContext('2d'), {size: [this.tileWidth, this.tileHeight]});\n    features.forEach((f) => {\n      const styles = styleFunction(f, resolution);\n      if (styles) {\n        if (Array.isArray(styles)) {\n          styles.forEach((style) => {\n            vectorContext.setStyle(style);\n            vectorContext.drawGeometry(f);\n          });\n        } else {\n          vectorContext.setStyle(styles);\n          vectorContext.drawGeometry(f);\n        }\n      }\n    });\n    return canvas;\n  }\n}\n","import {linear as linearEasing} from 'ol/easing.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {get as getProjection, type ProjectionLike, transformExtent} from 'ol/proj.js';\nimport olSourceImageStatic from 'ol/source/ImageStatic.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceVectorTile from 'ol/source/VectorTile.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider';\nimport {getSourceProjection} from './util';\nimport MVTImageryProvider from './MVTImageryProvider';\nimport VectorTileLayer from 'ol/layer/VectorTile.js';\nimport {type Extent, getCenter as getExtentCenter} from 'ol/extent.js';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type LayerGroup from 'ol/layer/Group.js';\nimport type {\n  BoundingSphere,\n  Camera,\n  Cartesian2,\n  Cartesian3,\n  Cartographic,\n  Color, ImageMaterialProperty,\n  ImageryLayer,\n  Matrix4,\n  Ray,\n  Rectangle,\n  Scene,\n  SingleTileImageryProvider\n} from 'cesium';\nimport type Geometry from 'ol/geom/Geometry.js';\nimport type {Coordinate} from 'ol/coordinate.js';\nimport type Source from 'ol/source/Source.js';\n// eslint-disable-next-line no-duplicate-imports\nimport type {Attribution} from 'ol/source/Source.js';\n\nimport type Map from 'ol/Map.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport type {Color as OLColor} from 'ol/color.js';\nimport type View from 'ol/View.js';\n\ntype CesiumUrlDefinition = {\n    url: string,\n    subdomains: string\n}\n\n\n/**\n * Options for rotate around axis core function.\n */\ntype RotateAroundAxisOption = {\n  duration?: number,\n  easing?: (value: number) => number,\n  callback: () => void\n}\n\n\nexport type LayerWithParents = {\n  layer: BaseLayer,\n  parents: LayerGroup[] | BaseLayer[]\n}\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n */\nexport function computePixelSizeAtCoordinate(scene: Scene, target: Cartesian3): Cartesian2 {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  // @ts-ignore TS2341\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight, distance, scene.pixelRatio, new Cesium.Cartesian2());\n}\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexport function computeBoundingBoxAtTarget(scene: Scene, target: Cartesian3, amount: number): Cartographic[] {\n  const pixelSize = computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n}\n\nexport function applyHeightOffsetToGeometry(geometry: Geometry, height: number) {\n  geometry.applyTransform((input, output, stride) => {\n    console.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n}\n\nexport function createMatrixAtCoordinates(\n    coordinates: Coordinate,\n    rotation = 0,\n    translation = Cesium.Cartesian3.ZERO,\n    scale = new Cesium.Cartesian3(1, 1, 1)\n): Matrix4 {\n  const position = ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n}\n\nexport function rotateAroundAxis(camera: Camera, angle: number, axis: Cartesian3, transform: Matrix4,\n    opt_options?: RotateAroundAxisOption) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options: RotateAroundAxisOption = opt_options;\n  const duration = defaultValue(options?.duration, 500); // ms\n  const easing = defaultValue(options?.easing, linearEasing);\n  const callback = options?.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    console.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n}\n\nexport function setHeadingUsingBottomCenter(\n    scene: Scene,\n    heading: number,\n    bottomCenter: Cartesian3,\n    options?: RotateAroundAxisOption\n) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  rotateAroundAxis(camera, heading, zenith, transform, options);\n}\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n */\nexport function pickOnTerrainOrEllipsoid(scene: Scene, pixel: Cartesian2): Cartesian3 {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n}\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n */\nexport function pickBottomPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return pickOnTerrainOrEllipsoid(scene, bottom);\n}\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n */\nexport function pickCenterPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return pickOnTerrainOrEllipsoid(scene, center);\n}\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n */\nexport function computeSignedTiltAngleOnGlobe(scene: Scene): number | undefined {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n}\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n */\nexport function bottomFovRay(scene: Scene): Ray {\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n}\n\n\n/**\n * Compute the angle between two Cartesian3.\n */\nexport function signedAngleBetween(first: Cartesian3, second: Cartesian3, normal: Cartesian3): number {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n}\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n */\nexport function computeAngleToZenith(scene: Scene, pivot: Cartesian3): number {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fy = camera.frustum.fovy / 2;\n  const ray = bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = signedAngleBetween(normal, direction, left);\n  return a + fy;\n}\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n */\nexport function extentToRectangle(extent: Extent, projection: ProjectionLike) {\n  if (extent && projection) {\n    const ext = transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n}\n\nexport function sourceToImageryProvider(\n    olMap: Map,\n    source: Source,\n    viewProj: Projection,\n    olLayer: BaseLayer\n): olcsCoreOLImageryProvider | MVTImageryProvider | SingleTileImageryProvider {\n  const skip = source.get('olcs_skip');\n  if (skip) {\n    return null;\n  }\n  let provider = null;\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n  source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n    // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (isCesiumProjection(projection)) {\n      provider = new olcsCoreOLImageryProvider(olMap, source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceImageStatic) {\n    let projection = getSourceProjection(source);\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (isCesiumProjection(projection)) {\n      const rectangle: Rectangle = Cesium.Rectangle.fromDegrees(\n          source.getImageExtent()[0],\n          source.getImageExtent()[1],\n          source.getImageExtent()[2],\n          source.getImageExtent()[3],\n          new Cesium.Rectangle()\n      );\n      provider = new Cesium.SingleTileImageryProvider({\n        url: source.getUrl(),\n        rectangle\n      });\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceVectorTile && olLayer instanceof VectorTileLayer) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (skip === false) {\n    // MVT is experimental, it should be whitelisted to be synchronized\n      const fromCode = projection.getCode().split(':')[1];\n      // @ts-ignore TS2341\n      const urls = source.urls.map(u => u.replace(fromCode, '3857'));\n      const extent = olLayer.getExtent();\n      const rectangle = extentToRectangle(extent, projection);\n      const minimumLevel = source.get('olcs_minimumLevel');\n      const attributionsFunction = source.getAttributions();\n      const styleFunction = olLayer.getStyleFunction();\n      let credit;\n      if (extent && attributionsFunction) {\n        const center = getExtentCenter(extent);\n        credit = attributionsFunctionToCredits(attributionsFunction, 0, center, extent)[0];\n      }\n\n      provider = new MVTImageryProvider({\n        credit,\n        rectangle,\n        minimumLevel,\n        styleFunction,\n        urls\n      });\n      return provider;\n    }\n    return null; // FIXME: it is disabled by default right now\n  } else {\n    // sources other than TileImage|Imageexport function are currently not supported\n    return null;\n  }\n  return provider;\n}\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers and export function images\n */\nexport function tileLayerToImageryLayer(olMap: Map, olLayer: BaseLayer, viewProj: Projection): ImageryLayer | null {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage) &&\n  !(olLayer instanceof VectorTileLayer)) {\n    return null;\n  }\n\n  const source = olLayer.getSource();\n  if (!source) {\n    return null;\n  }\n  let provider = source.get('olcs_provider');\n  if (!provider) {\n    provider = sourceToImageryProvider(olMap, source, viewProj, olLayer);\n  }\n  if (!provider) {\n    return null;\n  }\n\n  const layerOptions: {rectangle?: Rectangle} = {};\n\n  const forcedExtent = (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n}\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n */\nexport function updateCesiumLayerProperties(olLayerWithParents: LayerWithParents, csLayer: ImageryLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible = visible && layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n}\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n */\nexport function ol4326CoordinateToCesiumCartesian(coordinate: Coordinate): Cartesian3 {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n}\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n */\nexport function ol4326CoordinateArrayToCsCartesians(coordinates: Coordinate[]): Cartesian3[] {\n  console.assert(coordinates !== null);\n  const toCartesian = ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n}\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n */\nexport function olGeometryCloneTo4326<T extends Geometry>(geometry: T, projection: ProjectionLike): T {\n  console.assert(projection);\n\n  const proj4326 = getProjection('EPSG:4326');\n  const proj = getProjection(projection);\n  if (proj.getCode() !== proj4326.getCode()) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone() as T;\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n}\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n */\nexport function convertColorToCesium(olColor: OLColor | CanvasGradient | CanvasPattern | string): Color | ImageMaterialProperty {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  } else if (olColor instanceof CanvasPattern || olColor instanceof CanvasGradient) {\n    // Render the CanvasPattern/CanvasGradient into a canvas that will be sent to Cesium as material\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = canvas.height = 256;\n    ctx.fillStyle = olColor;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    return new Cesium.ImageMaterialProperty({\n      image: canvas\n    });\n  }\n  console.assert(false, 'impossible');\n}\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n */\nexport function convertUrlToCesium(url: string): CesiumUrlDefinition {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n}\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n */\nexport function resetToNorthZenith(map: Map, scene: Scene): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options: RotateAroundAxisOption = {\n      callback: () => {\n        const view = map.getView();\n        normalizeView(view);\n        resolve(undefined);\n      }\n    };\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexport function rotateAroundBottomCenter(scene: Scene, angle: number): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options: RotateAroundAxisOption = {callback: () => resolve(undefined)};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n */\nexport function normalizeView(view: View, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n\n  // @ts-ignore TS2341\n  if (view.constrainResolution) {\n    // @ts-ignore TS2341\n    view.setResolution(view.constrainResolution(resolution));\n  } else {\n    view.setResolution(view.getConstrainedResolution(resolution));\n  }\n}\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n */\nexport function isCesiumProjection(projection: Projection): boolean {\n  const is3857 = projection.getCode() === 'EPSG:3857';\n  const is4326 = projection.getCode() === 'EPSG:4326';\n  return is3857 || is4326;\n}\n\nexport function attributionsFunctionToCredits(\n    attributionsFunction: Attribution | null,\n    zoom: number,\n    center: Coordinate,\n    extent: Extent\n) {\n\n  if (!attributionsFunction) {\n    return [];\n  }\n  let attributions = attributionsFunction({\n    viewState: {zoom, center, projection: undefined, resolution: undefined, rotation: undefined},\n    extent,\n  });\n  if (!Array.isArray(attributions)) {\n    attributions = [attributions];\n  }\n\n  return attributions.map(html => new Cesium.Credit(html, true));\n}\n\n/**\n * calculate the distance between camera and centerpoint based on the resolution and latitude value\n */\nexport function calcDistanceForResolution(\n    resolution: number,\n    latitude: number,\n    scene: Scene,\n    projection: Projection\n): number {\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  // number of \"map units\" visible in 2D (vertically)\n  const visibleMapUnits = resolution * canvas.clientHeight;\n\n  // The metersPerUnit does not take latitude into account, but it should\n  // be lower with increasing latitude -- we have to compensate.\n  // In 3D it is not possible to maintain the resolution at more than one point,\n  // so it only makes sense to use the latitude of the \"target\" point.\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n\n  // how many meters should be visible in 3D\n  const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n  // distance required to view the calculated length in meters\n  //\n  //  fovy/2\n  //    |\\\n  //  x | \\\n  //    |--\\\n  // visibleMeters/2\n  const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n  // NOTE: This calculation is not absolutely precise, because metersPerUnit\n  // is a great simplification. It does not take ellipsoid/terrain into account.\n\n  return requiredDistance;\n}\n\n/**\n * calculate the resolution based on a distance(camera to position) and latitude value\n */\nexport function calcResolutionForDistance(distance: number, latitude: number, scene: Scene, projection: Projection): number {\n  // See the reverse calculation (calcDistanceForResolution) for details\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n  const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n  const resolution = visibleMapUnits / canvas.clientHeight;\n\n  return resolution;\n}\n\n/**\n * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n * Near the ground the allowed distance is shorter.\n */\nexport function limitCameraToBoundingSphere(camera: Camera, boundingSphere: BoundingSphere, ratio: (height: number) => number): () => void {\n  let blockLimiter = false;\n  return function() {\n    if (!blockLimiter) {\n      const position = camera.position;\n      const carto = Cesium.Cartographic.fromCartesian(position);\n      if (Cesium.Cartesian3.distance(boundingSphere.center, position) > boundingSphere.radius * ratio(carto.height)) {\n        // @ts-ignore TS2339: FIXME, there is no flying property in Camera\n        const currentlyFlying = camera.flying;\n        if (currentlyFlying === true) {\n          // There is a flying property and its value is true\n          return;\n        } else {\n          blockLimiter = true;\n          const unblockLimiter = () => (blockLimiter = false);\n          camera.flyToBoundingSphere(boundingSphere, {\n            complete: unblockLimiter,\n            cancel: unblockLimiter,\n          });\n        }\n      }\n    }\n  };\n}\n","import type {Scene} from 'cesium';\nimport type OLCesium from './OLCesium';\n\n/**\n * By default Cesium (used to?) renders as often as possible.\n * This is a waste of resources (CPU/GPU/battery).\n * An alternative mechanism in Cesium is on-demand rendering.\n * This class makes use of this alternative method and add some additionnal render points.\n */\nexport default class AutoRenderLoop {\n  ol3d: OLCesium;\n  private scene_: Scene;\n  private canvas_: HTMLCanvasElement;\n  private _boundNotifyRepaintRequired: typeof this.notifyRepaintRequired;\n  private repaintEventNames_ = [\n    'mousemove', 'mousedown', 'mouseup',\n    'touchstart', 'touchend', 'touchmove',\n    'pointerdown', 'pointerup', 'pointermove',\n    'wheel'\n  ] as const;\n\n  /**\n   * @param ol3d\n   */\n  constructor(ol3d: OLCesium) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n","/**\n * Converts radians to to degrees.\n *\n * @param angleInRadians Angle in radians.\n * @return Angle in degrees.\n */\nexport function toDegrees(angleInRadians: number): number {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param angleInDegrees Angle in degrees.\n * @return Angle in radians.\n */\nexport function toRadians(angleInDegrees: number): number {\n  return angleInDegrees * Math.PI / 180;\n}\n","import {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math';\nimport {getTransform} from 'ol/proj.js';\nimport {pickCenterPoint, calcDistanceForResolution, calcResolutionForDistance} from './core';\nimport type {Map, View} from 'ol';\nimport type {Scene, Camera as CesiumCamera, Matrix4, HeadingPitchRollValues} from 'cesium';\nimport type {EventsKey} from 'ol/events.js';\n\n/**\n * @param input Input coordinate array.\n * @param opt_output Output array of coordinate values.\n * @param opt_dimension Dimension.\n * @return Input coordinate array (same array as input).\n */\nexport function identityProjection(input: number[], opt_output?: number[], opt_dimension?: number): number[] {\n  const dim = opt_dimension || input.length;\n  if (opt_output) {\n    for (let i = 0; i < dim; ++i) {\n      opt_output[i] = input[i];\n    }\n  }\n  return input;\n}\n\nexport default class Camera {\n  private scene_: Scene;\n  private cam_: CesiumCamera;\n  private map_: Map;\n  private view_: View;\n\n  private viewListenKey_: EventsKey = null;\n\n  private toLonLat_ = identityProjection;\n  private fromLonLat_ = identityProjection;\n\n  /**\n   * 0 -- topdown, PI/2 -- the horizon\n   */\n  private tilt_: number = 0;\n  private distance_ = 0;\n  private lastCameraViewMatrix_: Matrix4 = null;\n\n  /**\n   * This is used to discard change events on view caused by updateView method.\n   */\n  private viewUpdateInProgress_ = false;\n\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   */\n  constructor(scene: Scene, map: Map) {\n    this.scene_ = scene;\n    this.cam_ = scene.camera;\n    this.map_ = map;\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  destroy() {\n    olObservableUnByKey(this.viewListenKey_);\n    this.viewListenKey_ = null;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view: View | undefined) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewChangedEvent_());\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = identityProjection;\n      this.fromLonLat_ = identityProjection;\n    }\n  }\n\n  private handleViewChangedEvent_() {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @deprecated\n   * @param heading In radians.\n   */\n  setHeading(heading: number) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @deprecated\n   * @return Heading in radians.\n   */\n  getHeading(): number|undefined {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param tilt In radians.\n   */\n  setTilt(tilt: number) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return Tilt in radians.\n   */\n  getTilt(): number {\n    return this.tilt_;\n  }\n\n  /**\n   * @param distance In meters.\n   */\n  setDistance(distance: number) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return Distance in meters.\n   */\n  getDistance(): number {\n    return this.distance_;\n  }\n\n  /**\n   * @deprecated\n   * Shortcut for ol.View.setCenter().\n   * @param center Same projection as the ol.View.\n   */\n  setCenter(center: number[]) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * @deprecated\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param position Same projection as the ol.View.\n   */\n  setPosition(position: number[]) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return Coordinates in same projection as the ol.View.\n   * @api\n   */\n  getPosition(): number[] | undefined {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param altitude In meters.\n   */\n  setAltitude(altitude: number) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return Altitude in meters.\n   */\n  getAltitude(): number {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   */\n  private updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    const orientation: HeadingPitchRollValues = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync?: boolean) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-7)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param resolution Number of map units per pixel.\n   * @param latitude Latitude in radians.\n   * @return The calculated distance.\n   */\n  calcDistanceForResolution(resolution: number, latitude: number): number {\n    return calcDistanceForResolution(resolution, latitude, this.scene_, this.view_.getProjection());\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param distance\n   * @param latitude\n   * @return} The calculated resolution.\n   */\n  calcResolutionForDistance(distance: number, latitude: number): number {\n    return calcResolutionForDistance(distance, latitude, this.scene_, this.view_.getProjection());\n  }\n}\n","import {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport LayerGroup from 'ol/layer/Group.js';\nimport {getUid} from './util';\nimport type Map from 'ol/Map.js';\nimport type {Scene, ImageryLayer} from 'cesium';\nimport type View from 'ol/View.js';\nimport type Collection from 'ol/Collection.js';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type {EventsKey} from 'ol/events.js';\nimport type {LayerWithParents} from './core';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n\nexport default abstract class AbstractSynchronizer<T extends ImageryLayer | VectorLayerCounterpart> {\n  protected map: Map;\n  protected view: View;\n  protected scene: Scene;\n  protected olLayers: Collection<BaseLayer>;\n  mapLayerGroup: LayerGroup;\n  /**\n   * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n   * Null value means, that we are unable to create equivalent layers.\n   */\n  protected layerMap: Record<string, Array<T>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer layers ids (from getUid).\n   */\n  protected olLayerListenKeys: Record<string, Array<EventsKey>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer groups ids (from getUid).\n   */\n  private olGroupListenKeys_: Record<string, Array<EventsKey>> = {};\n\n  protected constructor(map: Map, scene: Scene) {\n    this.map = map;\n    this.view = map.getView();\n    this.scene = scene;\n    this.olLayers = map.getLayerGroup().getLayers();\n    this.mapLayerGroup = map.getLayerGroup();\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   */\n  protected orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   */\n  private addLayers_(root: BaseLayer) {\n    const fifo: LayerWithParents[] = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof LayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents: LayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = () => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(layerWithParents.layer.on('change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   */\n  private addCesiumObjects_(cesiumObjects: Array<T>, layerId: string, layer: BaseLayer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(layer.on('change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   */\n  private removeAndDestroySingleLayer_(layer: BaseLayer): boolean {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   */\n  private unlistenSingleGroup_(group: LayerGroup) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   */\n  private removeLayer_(root: BaseLayer) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof LayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   */\n  private listenForGroupChanges_(group: LayerGroup) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray: EventsKey[] = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys: EventsKey[] = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   */\n  public destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   */\n  protected abstract addCesiumObject(object: T): void;\n\n  protected abstract destroyCesiumObject(object: T): void;\n\n  /**\n   * Remove single Cesium object from the collection.\n   */\n  protected abstract removeSingleCesiumObject(object: T, destroy: boolean): void;\n\n  protected abstract removeAllCesiumObjects(destroy: boolean): void;\n\n  protected abstract createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): Array<T>;\n}\n","import type Map from 'ol/Map.js';\nimport {getUid} from './util';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport {type LayerWithParents, tileLayerToImageryLayer, updateCesiumLayerProperties} from './core';\nimport type {Scene, ImageryLayer, ImageryLayerCollection} from 'cesium';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport BaseVectorLayer from 'ol/layer/BaseVector.js';\nimport LayerGroup from 'ol/layer/Group.js';\n\nexport default class RasterSynchronizer extends olcsAbstractSynchronizer<ImageryLayer> {\n  private cesiumLayers_: ImageryLayerCollection;\n  private ourLayers_: ImageryLayerCollection;\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   */\n  constructor(map: Map, scene: Scene) {\n    super(map, scene);\n\n    this.cesiumLayers_ = scene.imageryLayers;\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  addCesiumObject(object: ImageryLayer): void {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  destroyCesiumObject(object: ImageryLayer): void {\n    object.destroy();\n  }\n\n  removeSingleCesiumObject(object: ImageryLayer, destroy: boolean): void {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  removeAllCesiumObjects(destroy: boolean): void {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   */\n  protected convertLayerToCesiumImageries(olLayer: BaseLayer, viewProj: Projection): ImageryLayer[] {\n    const result = tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): ImageryLayer[] {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      if (olLayer instanceof BaseVectorLayer) {\n        let previousStyleFunction = olLayer.getStyleFunction();\n        // there is no convenient way to detect a style function change in OL\n        listenKeyArray.push(olLayer.on('change', () => {\n          const currentStyleFunction = olLayer.getStyleFunction();\n          if (previousStyleFunction === currentStyleFunction) {\n            return;\n          }\n          previousStyleFunction = currentStyleFunction;\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            const csObj = cesiumObjects[i];\n            // clear cache and set new style\n            // @ts-ignore TS2341\n            if (csObj._imageryCache) {\n              // @ts-ignore TS2341\n              csObj._imageryCache = {};\n            }\n\n            const ip = csObj.imageryProvider;\n            if (ip) {\n              // @ts-ignore TS2341\n              ip.tileCache?.clear();\n              // @ts-ignore TS2341\n              ip.styleFunction_ = currentStyleFunction;\n            }\n          }\n          this.scene.requestRender();\n        }));\n      }\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices: Record<number, number> = {};\n    const queue: Array<BaseLayer | LayerGroup> = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex() || 0;\n\n      if (olLayer instanceof LayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    // We assume sort is stable (which has been in the spec since a long time already).\n    // See https://caniuse.com/mdn-javascript_builtins_array_sort_stable\n    layers.sort((layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  raiseToTop(counterpart: ImageryLayer) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n","import {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport type {Billboard, BillboardCollection, Primitive, PrimitiveCollection, Scene} from 'cesium';\nimport type {EventsKey} from 'ol/events.js';\n\n\n/**\n * Context for feature conversion.\n */\nexport type OlFeatureToCesiumContext = {\n  projection: Projection | string,\n  billboards: BillboardCollection,\n  featureToCesiumMap: Record<number, Array<Primitive | Billboard>>,\n  primitives: PrimitiveCollection\n};\n\n\nexport default class VectorLayerCounterpart {\n  olListenKeys: EventsKey[] = [];\n  context: OlFeatureToCesiumContext;\n  private rootCollection_: PrimitiveCollection;\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  */\n  constructor(layerProjection: Projection | string, scene: Scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  getRootPrimitive(): PrimitiveCollection {\n    return this.rootCollection_;\n  }\n}\n\n\nexport type PrimitiveCollectionCounterpart = PrimitiveCollection & {counterpart: VectorLayerCounterpart};\n","import OLStyleIcon from 'ol/style/Icon.js';\nimport VectorSource, {type VectorSourceEvent} from 'ol/source/Vector.js';\nimport OLClusterSource from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport {convertColorToCesium, olGeometryCloneTo4326, ol4326CoordinateToCesiumCartesian, ol4326CoordinateArrayToCsCartesians} from './core';\nimport VectorLayerCounterpart, {type OlFeatureToCesiumContext} from './core/VectorLayerCounterpart';\nimport {getUid, waitReady} from './util';\nimport type {CircleGeometry, CircleOutlineGeometry, Primitive, Billboard, Label, Matrix4, Scene, Geometry as CSGeometry, Color as CSColor, GroundPrimitive, PrimitiveCollection, ImageMaterialProperty, BillboardCollection, Cartesian3, GroundPolylinePrimitive, PolygonHierarchy, HeightReference, Model, LabelCollection, Material} from 'cesium';\nimport type VectorLayer from 'ol/layer/Vector.js';\nimport type ImageLayer from 'ol/layer/Image.js';\nimport type {Feature, View} from 'ol';\nimport type Text from 'ol/style/Text.js';\nimport {type default as Style, type StyleFunction} from 'ol/style/Style.js';\nimport type {ColorLike as OLColorLike} from 'ol/colorlike.js';\nimport type {Color as OLColor} from 'ol/color.js';\nimport type {ProjectionLike} from 'ol/proj.js';\nimport {Geometry as OLGeometry, type MultiLineString, type MultiPolygon, type MultiPoint, type GeometryCollection, type Circle, type LineString, type Point, type Polygon} from 'ol/geom.js';\nimport type ImageStyle from 'ol/style/Image.js';\n\n\ntype ModelFromGltfOptions = Parameters<typeof Model.fromGltfAsync>[0];\n\ntype PrimitiveLayer = VectorLayer<any> | ImageLayer<any>;\n\ndeclare module 'cesium' {\n  // eslint-disable-next-line no-unused-vars\n  interface Primitive {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface GroundPolylinePrimitive {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n    _primitive: Primitive; // Missing from types published by Cesium\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface GroundPrimitive {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface Label {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface Billboard {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n}\n\ninterface ModelStyle {\n  debugModelMatrix?: Matrix4;\n  cesiumOptions: ModelFromGltfOptions;\n}\n\ninterface MaterialAppearanceOptions {\n  flat: boolean;\n  renderState: {\n    depthTest: {\n      enabled: boolean;\n    },\n    lineWidth?: number;\n  }\n}\n\nexport default class FeatureConverter {\n\n  /**\n   * Bind once to have a unique function for using as a listener\n   */\n  private boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n  private defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param scene Cesium scene.\n   * @api\n   */\n  constructor(protected scene: Scene) {\n    this.scene = scene;\n  }\n\n  /**\n   * @param evt\n   */\n  private onRemoveOrClearFeature_(evt: VectorSourceEvent) {\n    const source = evt.target;\n    console.assert(source instanceof VectorSource);\n\n    const cancellers = source['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        source['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param layer\n   * @param feature OpenLayers feature.\n   * @param primitive\n   */\n  protected setReferenceForPicking(layer: PrimitiveLayer, feature: Feature, primitive: GroundPolylinePrimitive | GroundPrimitive | Primitive| Label|Billboard) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param layer\n   * @param feature OpenLayers feature.\n   * @param olGeometry OpenLayers geometry.\n   * @param geometry\n   * @param color\n   * @param opt_lineWidth\n   * @return primitive\n   */\n  protected createColoredPrimitive(layer: PrimitiveLayer, feature: Feature, olGeometry: OLGeometry, geometry: CSGeometry | CircleGeometry, color: CSColor| ImageMaterialProperty, opt_lineWidth?: number): Primitive | GroundPrimitive {\n    const createInstance = function(geometry: CSGeometry | CircleGeometry, color: CSColor | ImageMaterialProperty) {\n      const instance = new Cesium.GeometryInstance({\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options: MaterialAppearanceOptions = {\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive: GroundPrimitive | Primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      if (!('createShadowVolume' in instances.geometry.constructor)) {\n        // This is not a ground geometry\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      // FIXME: we created stylings which are not time related\n      // What should we pass here?\n      // @ts-ignore\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true,\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.MaterialAppearance({\n        ...options,\n        material: new Cesium.Material({\n          translucent: color.alpha !== 1,\n          fabric: {\n            type: 'Color',\n            uniforms: {\n              color,\n            }\n          }\n        })\n      });\n      if (primitive instanceof Cesium.Primitive && (feature.get('olcs_shadows') || layer.get('olcs_shadows'))) {\n        primitive.shadows = 1;\n      }\n    }\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param style\n   * @param outline\n   * @return {!CSColor}\n   */\n  protected extractColorFromOlStyle(style: Style | Text, outline: boolean) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor: OLColorLike | OLColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param style\n   * @return {number}\n   */\n  protected extractLineWidthFromOlStyle(style: Style | Text) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   */\n  protected wrapFillAndOutlineGeometries(layer: PrimitiveLayer, feature: Feature, olGeometry: OLGeometry, fillGeometry: CSGeometry | CircleGeometry, outlineGeometry: CSGeometry | CircleOutlineGeometry, olStyle: Style): PrimitiveCollection {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n\n  // FIXME: would make more sense to only accept primitive collection.\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   */\n  protected addTextStyle(layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry, style: Style, primitive: Primitive | PrimitiveCollection | GroundPolylinePrimitive): PrimitiveCollection {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param billboards\n   * @param bbOptions\n   * @param layer\n   * @param feature OpenLayers feature.\n   * @param geometry\n   * @param style\n   * @return newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards: BillboardCollection, bbOptions: Parameters<BillboardCollection['add']>[0], layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry, style: Style): Billboard {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @api\n   */\n  olCircleGeometryToCesium(layer: PrimitiveLayer, feature: Feature, olGeometry: Circle, projection: ProjectionLike, olStyle: Style): PrimitiveCollection {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    const olCenter = olGeometry.getCenter();\n    const height = olCenter.length == 3 ? olCenter[2] : 0.0;\n    const olPoint = olCenter.slice();\n    olPoint[0] += olGeometry.getRadius();\n\n    // Cesium\n    const center: Cartesian3 = ol4326CoordinateToCesiumCartesian(olCenter);\n    const point: Cartesian3 = ol4326CoordinateToCesiumCartesian(olPoint);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive: Primitive | GroundPrimitive | GroundPolylinePrimitive;\n    let outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        const op = outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n          geometryInstances: new Cesium.GeometryInstance({\n            geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n          }),\n          appearance: new Cesium.PolylineMaterialAppearance({\n            material: this.olStyleToCesium(feature, olStyle, true),\n          }),\n          classificationType: Cesium.ClassificationType.TERRAIN,\n        });\n        waitReady(outlinePrimitive).then(() => {\n          this.setReferenceForPicking(layer, feature, op._primitive);\n        });\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @api\n   */\n  olLineStringGeometryToCesium(layer: PrimitiveLayer, feature: Feature, olGeometry: LineString, projection: ProjectionLike, olStyle: Style): PrimitiveCollection {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive: Primitive | GroundPolylinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    const appearance = new Cesium.PolylineMaterialAppearance({\n      material: this.olStyleToCesium(feature, olStyle, true)\n    });\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const geometry = new Cesium.GroundPolylineGeometry({\n        positions,\n        width,\n      });\n      const op = outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n        appearance,\n        geometryInstances: new Cesium.GeometryInstance({\n          geometry\n        })\n      });\n      waitReady(outlinePrimitive).then(() => {\n        this.setReferenceForPicking(layer, feature, op._primitive);\n      });\n    } else {\n      const geometry = new Cesium.PolylineGeometry({\n        positions,\n        width,\n        vertexFormat: appearance.vertexFormat\n      });\n      outlinePrimitive = new Cesium.Primitive({\n        appearance,\n        geometryInstances: new Cesium.GeometryInstance({\n          geometry\n        }),\n      });\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @api\n   */\n  olPolygonGeometryToCesium(layer: PrimitiveLayer, feature: Feature, olGeometry: Polygon, projection: ProjectionLike, olStyle: Style): PrimitiveCollection {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry;\n    let outlinePrimitive: GroundPolylinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      const featureExtrudedHeight = feature.get('olcs_extruded_height');\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      const hierarchy: PolygonHierarchy = {\n        positions: [],\n        holes: [],\n      };\n      const polygonHierarchy: PolygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i === 0) {\n          hierarchy.positions = positions;\n        } else {\n          hierarchy.holes.push({\n            positions,\n            holes: [],\n          });\n        }\n      }\n\n      const featureExtrudedHeight = feature.get('olcs_extruded_height');\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        polygonHierarchy,\n        perPositionHeight: true,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions: Cartesian3[][] = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          const appearance = new Cesium.PolylineMaterialAppearance({\n            material: this.olStyleToCesium(feature, olStyle, true)\n          });\n          const geometryInstances = [];\n          for (const linePositions of positions) {\n            const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n            geometryInstances.push(new Cesium.GeometryInstance({\n              geometry: polylineGeometry\n            }));\n          }\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            appearance,\n            geometryInstances\n          });\n          waitReady(outlinePrimitive).then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true,\n          extrudedHeight: featureExtrudedHeight,\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @api\n   */\n  getHeightReference(layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry): HeightReference {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer: PrimitiveLayer,\n      feature: Feature,\n      olGeometry: Point,\n      projection: ProjectionLike,\n      style: Style,\n      imageStyle: ImageStyle,\n      billboards: BillboardCollection,\n      opt_newBillboardCallback: (bb: Billboard) => void,\n  ) {\n    if (imageStyle instanceof OLStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image: HTMLImageElement) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const scale = imageStyle.getScale();\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions: Parameters<BillboardCollection['add']>[0] = {\n        image,\n        color,\n        scale,\n        heightReference,\n        position\n      };\n\n      // merge in cesium options from openlayers feature\n      Object.assign(bbOptions, feature.get('cesiumOptions'));\n\n      if (imageStyle instanceof OLStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          const xScale = (Array.isArray(scale) ? scale[0] : scale);\n          const yScale = (Array.isArray(scale) ? scale[1] : scale);\n          bbOptions.pixelOffset = new Cesium.Cartesian2(\n              (image.width / 2 - anchor[0]) * xScale,\n              (image.height / 2 - anchor[1]) * yScale\n          );\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = source['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = source['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param layer\n   * @param feature OpenLayers feature..\n   * @param olGeometry OpenLayers point geometry.\n   * @param projection\n   * @param style\n   * @param billboards\n   * @param opt_newBillboardCallback Called when the new billboard is added.\n   * @return primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer: PrimitiveLayer,\n      feature: Feature,\n      olGeometry: Point,\n      projection: ProjectionLike,\n      style: Style,\n      billboards: BillboardCollection,\n      opt_newBillboardCallback?: (bb: Billboard) => void\n  ): PrimitiveCollection {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive: PrimitiveCollection = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction: () => ModelStyle = olGeometry.get('olcs_model') || feature.get('olcs_model');\n      if (olcsModelFunction) {\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        const olcsModel = olcsModelFunction();\n        const options: ModelFromGltfOptions = Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions);\n        if ('fromGltf' in Cesium.Model) {\n          // pre Cesium v107\n          // @ts-ignore\n          const model = Cesium.Model.fromGltf(options);\n          modelPrimitive.add(model);\n        } else {\n          Cesium.Model.fromGltfAsync(options).then((model) => {\n            modelPrimitive.add(model);\n          });\n        }\n\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer: PrimitiveLayer,\n      feature: Feature,\n      geometry: OLGeometry,\n      projection: ProjectionLike,\n      olStyle: Style,\n      billboards: BillboardCollection,\n      opt_newBillboardCallback: (bb: Billboard) => void\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    switch (geometry.getType()) {\n      case 'MultiPoint': {\n        const points = (geometry as MultiPoint).getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          points.forEach((geom) => {\n            console.assert(geom);\n            const result = this.olPointGeometryToCesium(layer, feature, geom,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          points.forEach((geom) => {\n            console.assert(geom);\n            this.olPointGeometryToCesium(layer, feature, geom, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      }\n      case 'MultiLineString': {\n        const lineStrings = (geometry as MultiLineString).getLineStrings();\n        // FIXME: would be better to combine all child geometries in one primitive\n        // instead we create n primitives for simplicity.\n        const primitives = new Cesium.PrimitiveCollection();\n        lineStrings.forEach((geom) => {\n          const p = this.olLineStringGeometryToCesium(layer, feature, geom, projection, olStyle);\n          primitives.add(p);\n        });\n        return primitives;\n      }\n      case 'MultiPolygon': {\n        const polygons = (geometry as MultiPolygon).getPolygons();\n        // FIXME: would be better to combine all child geometries in one primitive\n        // instead we create n primitives for simplicity.\n        const primitives = new Cesium.PrimitiveCollection();\n        polygons.forEach((geom) => {\n          const p = this.olPolygonGeometryToCesium(layer, feature, geom, projection, olStyle);\n          primitives.add(p);\n        });\n        return primitives;\n      }\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry, style: Text): LabelCollection {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options: Parameters<LabelCollection['add']>[0] = {};\n\n    options.position = ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 || offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @api\n   */\n  olStyleToCesium(feature: Feature, style: Style, outline: boolean): Material {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    const olColor = outline ? stroke.getColor() : fill.getColor();\n    const color = convertColorToCesium(olColor);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @api\n   */\n  computePlainStyle(layer: PrimitiveLayer, feature: Feature, fallbackStyleFunction: StyleFunction, resolution: number): Style[] {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   */\n  protected getGeometryFromFeature(feature: Feature, style: Style, opt_geom?: OLGeometry): OLGeometry | undefined {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d: OLGeometry = feature.get('olcs.3d_geometry');\n    if (geom3d && geom3d instanceof OLGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof OLGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @api\n   */\n  olFeatureToCesium(layer: PrimitiveLayer, feature: Feature, style: Style, context: OlFeatureToCesiumContext, opt_geom?: OLGeometry): PrimitiveCollection {\n    const geom: OLGeometry = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb: Billboard) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        (geom as GeometryCollection).getGeometriesArray().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom as Point, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        return this.olCircleGeometryToCesium(layer, feature, geom as Circle, proj,\n            style);\n      case 'LineString':\n        return this.olLineStringGeometryToCesium(layer, feature, geom as LineString, proj,\n            style);\n      case 'Polygon':\n        return this.olPolygonGeometryToCesium(layer, feature, geom as Polygon, proj,\n            style);\n      case 'MultiPoint':\n        return this.olMultiGeometryToCesium(layer, feature, geom as MultiPoint, proj,\n            style, context.billboards, newBillboardAddedCallback) || null;\n      case 'MultiLineString':\n        return this.olMultiGeometryToCesium(layer, feature, geom as MultiLineString, proj,\n            style, context.billboards, newBillboardAddedCallback) || null;\n      case 'MultiPolygon':\n        return this.olMultiGeometryToCesium(layer, feature, geom as MultiPolygon, proj,\n            style, context.billboards, newBillboardAddedCallback) || null;\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @api\n   */\n  olVectorLayerToCesium(olLayer: VectorLayer<VectorSource>, olView: View, featurePrimitiveMap: Record<number, PrimitiveCollection>): VectorLayerCounterpart {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof OLClusterSource) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof VectorSource);\n    const features = source.getFeatures();\n    const counterpart = new VectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      const layerStyle: StyleFunction | undefined = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      let primitives: PrimitiveCollection = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @api\n   */\n  convert(layer: VectorLayer<VectorSource>, view: View, feature: Feature, context: OlFeatureToCesiumContext): PrimitiveCollection {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n","import olSourceVector, {type VectorSourceEvent} from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {getUid} from './util';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerVectorTile from 'ol/layer/VectorTile.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport olcsFeatureConverter from './FeatureConverter';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n// eslint-disable-next-line no-duplicate-imports\nimport {\n  type OlFeatureToCesiumContext,\n  type PrimitiveCollectionCounterpart\n} from './core/VectorLayerCounterpart';\nimport type Map from 'ol/Map.js';\nimport {type LayerWithParents} from './core';\nimport type Feature from 'ol/Feature.js';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type {PrimitiveCollection, Scene} from 'cesium';\n\nexport default class VectorSynchronizer extends olcsAbstractSynchronizer<VectorLayerCounterpart> {\n  protected converter: olcsFeatureConverter;\n  private csAllPrimitives_: PrimitiveCollection;\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   */\n  constructor(map: Map, scene: Scene, opt_converter?: olcsFeatureConverter) {\n    super(map, scene);\n\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  addCesiumObject(counterpart: VectorLayerCounterpart) {\n    console.assert(counterpart);\n    const collection = <PrimitiveCollectionCounterpart>counterpart.getRootPrimitive();\n    collection.counterpart = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  destroyCesiumObject(object: VectorLayerCounterpart) {\n    object.getRootPrimitive().destroy();\n  }\n\n  removeSingleCesiumObject(object: VectorLayerCounterpart, destroy: boolean) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  removeAllCesiumObjects(destroy: boolean) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   */\n  updateLayerVisibility(olLayerWithParents: LayerWithParents, csPrimitive: PrimitiveCollection) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible = visible && layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): VectorLayerCounterpart[] {\n    const olLayer: BaseLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector) || olLayer instanceof olLayerVectorTile) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap: Record<number, PrimitiveCollection> = {};\n    const counterpart: VectorLayerCounterpart = this.converter.olVectorLayerToCesium(olLayer, view, featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olLayerItem.on('change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (feature: Feature) => {\n      const context = counterpart.context;\n      const prim: PrimitiveCollection = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    };\n\n    const onRemoveFeature = (feature: Feature) => {\n      const id = getUid(feature);\n      const context: OlFeatureToCesiumContext = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    };\n\n    olListenKeys.push(source.on('addfeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }));\n\n    olListenKeys.push(source.on('removefeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }));\n\n    olListenKeys.push(source.on('changefeature', (e: VectorSourceEvent) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n","import OLOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport type {Scene} from 'cesium';\nimport type OverlaySynchronizer from './OverlaySynchronizer';\nimport type {EventsKey} from 'ol/events';\nimport type {ObjectEvent} from 'ol/Object';\n\n\n/**\n * @param node The node to remove.\n * @return The node that was removed or null.\n */\nfunction removeNode(node: Node): Node {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nfunction removeChildren(node: Node) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\nfunction cloneNode<T extends Node, U extends Node>(node: T, parent: U): T {\n  const clone = node.cloneNode() as T;\n  if (node.nodeName === 'CANVAS') {\n    const ctx = (clone as unknown as HTMLCanvasElement).getContext('2d');\n    ctx.drawImage(node as unknown as HTMLCanvasElement, 0, 0);\n  }\n  if (parent) {\n    parent.appendChild(clone);\n  }\n  if (node.nodeType !== Node.TEXT_NODE) {\n    clone.addEventListener('click', (event) => {\n      node.dispatchEvent(new MouseEvent('click', event));\n      event.stopPropagation();\n    });\n  }\n  const nodes = node.childNodes;\n  for (let i = 0; i < nodes.length; i++) {\n    if (!nodes[i]) {\n      continue;\n    }\n    cloneNode(nodes[i], clone);\n  }\n  return clone;\n}\n\n\ninterface SynchronizedOverlayOptions {\n  scene: Scene;\n  parent: OLOverlay;\n  synchronizer: OverlaySynchronizer;\n}\n\n\nexport default class SynchronizedOverlay extends OLOverlay {\n\n  private scenePostRenderListenerRemover_?: Function = null;\n  private scene_: Scene;\n  private synchronizer_: OverlaySynchronizer;\n  private parent_: OLOverlay;\n  private positionWGS84_: number[];\n  private observer_: MutationObserver;\n  private attributeObserver_: MutationObserver[] = [];\n  private listenerKeys_: EventsKey[];\n\n\n  /**\n   * @param options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options: SynchronizedOverlayOptions) {\n    const parent = options.parent;\n    super(parent.getOptions());\n    this.scene_ = options.scene;\n    this.synchronizer_ = options.synchronizer;\n    this.parent_ = parent;\n    this.positionWGS84_ = undefined;\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n    this.attributeObserver_ = [];\n    this.listenerKeys_ = [];\n\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = (event: ObjectEvent) => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param target\n   */\n  private observeTarget_(target: Node) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param event\n   */\n  private setPropertyFromEvent_(event: ObjectEvent) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return The scene that the overlay is part of.\n   * @api\n   */\n  getScene(): Scene {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of Array.from(element.parentNode.childNodes)) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if ('removeNode' in this.element) {\n      // @ts-ignore\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n","import type {Collection, Map as OLMap, Overlay} from 'ol';\nimport SynchronizedOverlay from './SynchronizedOverlay';\nimport {getUid} from './util';\nimport type {Scene} from 'cesium';\nimport type {CollectionEvent} from 'ol/Collection.js';\n\nexport default class OverlaySynchronizer {\n  private overlayCollection_: Collection<Overlay>;\n  private overlayContainerStopEvent_: HTMLDivElement;\n  private overlayContainer_: HTMLDivElement;\n  private overlayMap_: Map<number, SynchronizedOverlay> = new Map();\n  private overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n\n  /**\n  * @param map\n  * @param scene\n  * @constructor\n  * @api\n  */\n  constructor(protected map: OLMap, protected scene: Scene) {\n    this.map = map;\n    this.overlayCollection_ = this.map.getOverlays();\n    this.scene = scene;\n    this.overlayContainerStopEvent_ = document.createElement('div');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    this.overlayEvents.forEach((name) => {\n      this.overlayContainerStopEvent_.addEventListener(name, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    this.overlayContainer_ = document.createElement('div');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent(): Element {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return The map's overlay container.\n  */\n  getOverlayContainer(): Element {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.overlayCollection_.forEach((overlay) => { this.addOverlay(overlay); });\n    this.overlayCollection_.on('add', (evt: CollectionEvent<Overlay>) => this.addOverlay(evt.element));\n    this.overlayCollection_.on('remove', (evt: CollectionEvent<Overlay>) => this.removeOverlay(evt.element));\n  }\n\n\n  /**\n  * @api\n  */\n  addOverlay(overlay: Overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new SynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    this.overlayMap_.set(getUid(overlay), cesiumOverlay);\n  }\n\n\n  /**\n  * Removes an overlay from the scene\n  * @api\n  */\n  removeOverlay(overlay: Overlay) {\n    const overlayId = getUid(overlay);\n    const csOverlay = this.overlayMap_.get(overlayId);\n    if (csOverlay) {\n      csOverlay.destroy();\n      this.overlayMap_.delete(overlayId);\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  */\n  protected destroyAll() {\n    this.overlayMap_.forEach((overlay: SynchronizedOverlay) => {\n      overlay.destroy();\n    });\n    this.overlayMap_.clear();\n  }\n}\n","import olGeomPoint from 'ol/geom/Point.js';\nimport {supportsImageRenderingPixelated, imageRenderingValue} from './util';\nimport {ol4326CoordinateToCesiumCartesian} from './core';\nimport {getTransform, type TransformFunction} from 'ol/proj.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop';\nimport olcsCamera from './Camera';\nimport olcsRasterSynchronizer from './RasterSynchronizer';\nimport olcsVectorSynchronizer from './VectorSynchronizer';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer';\nimport type Map from 'ol/Map.js';\nimport type Interaction from 'ol/interaction/Interaction.js';\nimport type {Group} from 'ol/layer.js';\nimport type Feature from 'ol/Feature.js';\nimport type View from 'ol/View.js';\nimport type {\n  BoundingSphere, ContextOptions,\n  DataSourceCollection,\n  DataSourceDisplay,\n  Entity,\n  EntityView,\n  Globe,\n  JulianDate, MapMode2D, MapProjection, PerspectiveFrustum,\n  Scene,\n  ImageryLayer\n} from 'cesium';\nimport type AbstractSynchronizer from './AbstractSynchronizer';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n/**\n * Moved from Cesium\n * The state of a BoundingSphere computation being performed by a {@link Visualizer}.\n */\nconst BoundingSphereState: Record<string, number> = {\n  /**\n   * The BoundingSphere has been computed.\n   */\n  DONE: 0,\n  /**\n   * The BoundingSphere is still being computed.\n   */\n  PENDING: 1,\n  /**\n   * The BoundingSphere does not exist.\n   */\n  FAILED: 2,\n};\n\ntype SceneOptions = {\n  canvas: HTMLCanvasElement;\n  contextOptions?: ContextOptions;\n  creditContainer?: Element;\n  creditViewport?: Element;\n  mapProjection?: MapProjection;\n  orderIndependentTranslucency?: boolean;\n  scene3DOnly?: boolean;\n  shadows?: boolean;\n  mapMode2D?: MapMode2D;\n  requestRenderMode?: boolean;\n  maximumRenderTimeChange?: number;\n  depthPlaneEllipsoidOffset?: number;\n  msaaSamples?: number;\n}\n\ntype OLCesiumOptions = {\n  map: Map,\n  time?: () => JulianDate,\n  target?: Element | string,\n  createSynchronizers?: (map: Map, scene: Scene, dataSourceCollection: DataSourceCollection) => AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>[],\n  stopOpenLayersEventsPropagation?: boolean,\n  sceneOptions?: SceneOptions\n}\n\n// FIXME: remove this when all the synchronizers are migrated to typescript.\ntype SynchronizerType = AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>;\n\n/**\n * @typedef {Object} OLCesiumOptions\n * @property {import('ol/Map.js').default} map The OpenLayers map we want to show on a Cesium scene.\n * @property {Element|string} [target] Target element for the Cesium scene.\n * @property {function(!import('ol/Map.js').default, !Cesium.Scene, !Cesium.DataSourceCollection): Array<import('olcs/AbstractSynchronizer.js').default>}\n *      [createSynchronizers] Callback function which will be called by the {@link olcs.OLCesium}\n *      constructor to create custom synchronizers. Receives an `ol.Map` and a `Cesium.Scene` as arguments,\n *      and needs to return an array of {@link import('olcs/AbstractSynchronizer.js').default}.\n * @property {function(): Cesium.JulianDate} [time] Control the current time used by Cesium.\n * @property {boolean} [stopOpenLayersEventsPropagation] Prevent propagation of mouse/touch events to\n *      OpenLayers when Cesium is active.\n * @property {Cesium.SceneOptions} [sceneOptions] Allows the passing of property value to the\n *      `Cesium.Scene`.\n */\nexport default class OLCesium {\n  private autoRenderLoop_: olcsAutoRenderLoop | null = null;\n  private map_: Map;\n  private time_: () => JulianDate;\n  private to4326Transform_: TransformFunction;\n  private resolutionScale_ = 1.0;\n  private canvasClientWidth_ = 0.0;\n  private canvasClientHeight_ = 0.0;\n  private resolutionScaleChanged_ = true; // force resize\n  private container_: HTMLElement;\n  private isOverMap_: boolean;\n  private canvas_: HTMLCanvasElement;\n  private enabled_ = false;\n  private pausedInteractions_: Interaction[] = [];\n  private hiddenRootGroup_: Group | null = null;\n  private scene_: Scene;\n  private camera_: olcsCamera;\n  private globe_: Globe;\n  private dataSourceCollection_: DataSourceCollection;\n  private dataSourceDisplay_: DataSourceDisplay;\n  /** Time of the last rendered frame, as returned by `performance.now()`. */\n  private lastFrameTime_ = 0;\n  /** The identifier returned by `requestAnimationFrame`. */\n  private renderId_: number | undefined;\n  /** Target frame rate for the render loop.  */\n  private targetFrameRate_ = Number.POSITIVE_INFINITY;\n  /** If the Cesium render loop is being blocked. */\n  private blockCesiumRendering_ = false;\n  /** If the warmup routine is active. */\n  private warmingUp_ = false;\n  private trackedFeature_: Feature | null = null;\n  private trackedEntity_: Entity | null = null;\n  private entityView_: EntityView | null = null;\n  private needTrackedEntityUpdate_ = false;\n  private boundingSphereScratch_: BoundingSphere = new Cesium.BoundingSphere();\n  private synchronizers_: SynchronizerType[];\n\n  constructor(options: OLCesiumOptions) {\n    this.map_ = options.map;\n\n    this.time_ = options.time || function() {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none;';\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || this.map_.getViewport();\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * a target => side by side mode\n     * no target => over map mode\n     */\n    this.isOverMap_ = !options.target;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n    this.canvas_ = document.createElement<'canvas'>('canvas');\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function() {\n      return false;\n    };\n    this.canvas_.onselectstart = function() {\n      return false;\n    };\n\n    this.container_.appendChild(this.canvas_);\n\n    const sceneOptions: SceneOptions = options.sceneOptions !== undefined ?\n      {...options.sceneOptions, canvas: this.canvas_, scene3DOnly: true} :\n      {canvas: this.canvas_, scene3DOnly: true};\n\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    if (!Array.isArray(sscc.tiltEventTypes)) {\n      console.log('sscc is not an array');\n    } else {\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.SHIFT\n      });\n\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.ALT\n      });\n    }\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      tileHeight: 1,\n      tileWidth: 1,\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    this.synchronizers_ = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ] as unknown as SynchronizerType[];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = this.synchronizers_.length - 1; i >= 0; --i) {\n      this.synchronizers_[i].synchronize();\n    }\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n  }\n\n  /**\n   * Destroys the Cesium resources held by this object.\n   */\n  destroy() {\n    cancelAnimationFrame(this.renderId_);\n    this.renderId_ = undefined;\n    this.synchronizers_.forEach(synchronizer => synchronizer.destroyAll());\n    this.camera_.destroy();\n    this.scene_.destroy();\n    // @ts-ignore TS2341\n    this.scene_._postRender = null;\n    this.container_.remove();\n  }\n\n  /**\n   * Render the Cesium scene.\n   */\n  private render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   */\n  private onAnimationFrame_(frameTime: number) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    // initializeFrame private property\n    // @ts-ignore TS2341\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      // getBoundingSphere private property\n      // @ts-ignore TS2341\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  private updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    // getBoundingSphere private property\n    // @ts-ignore TS2341\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  private handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 || height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    (<PerspectiveFrustum> this.scene_.camera.frustum).aspectRatio = width / height;\n  }\n\n  getCamera(): olcsCamera {\n    return this.camera_;\n  }\n\n  getOlMap(): Map {\n    return this.map_;\n  }\n\n  getOlView(): View {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  getCesiumScene(): Scene {\n    return this.scene_;\n  }\n\n  getDataSources(): DataSourceCollection {\n    return this.dataSourceCollection_;\n  }\n\n  getDataSourceDisplay(): DataSourceDisplay {\n    return this.dataSourceDisplay_;\n  }\n\n  getEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   */\n  setEnabled(enable: boolean) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        this.map_.addInteraction = interaction => this.pausedInteractions_.push(interaction);\n        this.map_.removeInteraction = (interaction) => {\n          let interactionRemoved = false;\n          this.pausedInteractions_ = this.pausedInteractions_.filter((i) => {\n            const removed = i !== interaction;\n            if (!interactionRemoved) {interactionRemoved = removed;}\n            return removed;\n          });\n          return interactionRemoved ? interaction : undefined;\n        };\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n\n        this.map_.addInteraction = interaction => this.map_.getInteractions().push(interaction);\n        this.map_.removeInteraction = interaction => this.map_.getInteractions().remove(interaction);\n\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n  */\n  warmUp(height: number, timeout: number) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n  */\n  setBlockCesiumRendering(block: boolean) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n  */\n  getAutoRenderLoop(): olcsAutoRenderLoop {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   */\n  setResolutionScale(value: number) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   */\n  setTargetFrameRate(value: number) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   */\n  private throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n\n  get trackedFeature(): Feature {\n    return this.trackedFeature_;\n  }\n\n  set trackedFeature(feature: Feature) {\n    if (this.trackedFeature_ !== feature) {\n\n      const scene = this.scene_;\n\n      //Stop tracking\n      if (!feature || !feature.getGeometry()) {\n        this.needTrackedEntityUpdate_ = false;\n        scene.screenSpaceCameraController.enableTilt = true;\n\n        if (this.trackedEntity_) {\n          this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n        }\n        this.trackedEntity_ = null;\n        this.trackedFeature_ = null;\n        this.entityView_ = null;\n        scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n        return;\n      }\n\n      this.trackedFeature_ = feature;\n\n      //We can't start tracking immediately, so we set a flag and start tracking\n      //when the bounding sphere is ready (most likely next frame).\n      this.needTrackedEntityUpdate_ = true;\n\n      const to4326Transform = this.to4326Transform_;\n      const toCesiumPosition = function() {\n        const geometry = feature.getGeometry();\n        console.assert(geometry instanceof olGeomPoint);\n        const coo = geometry instanceof olGeomPoint ? geometry.getCoordinates() : [];\n        const coo4326 = to4326Transform(coo, undefined, coo.length);\n        return ol4326CoordinateToCesiumCartesian(coo4326);\n      };\n\n      // Create an invisible point entity for tracking.\n      // It is independent of the primitive/geometry created by the vector synchronizer.\n      const options: Entity.ConstructorOptions = {\n        // @ts-ignore according to Cesium types, not possible to pass CallbackProperty\n        position: new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n        point: {\n          pixelSize: 1,\n          color: Cesium.Color.TRANSPARENT\n        }\n      };\n\n      this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n    }\n  }\n}\n","export interface RectangleOutput {\n  scaling: [number, number];\n  offsetX: number;\n  offsetY: number;\n  width: number;\n  height: number;\n}\n\nexport function computeRectangle(canvas: HTMLCanvasElement, tw: number, th: number): RectangleOutput {\n\n  const maskAspectRatio = tw / th;\n  let maskSize;\n\n  if (maskAspectRatio > 1) {\n    // landscape\n    maskSize = [canvas.width, canvas.width / maskAspectRatio];\n    if (maskSize[1] > canvas.height) {\n      maskSize = [canvas.height * maskAspectRatio, canvas.height];\n    }\n  }\n  else {\n    // portrait\n    maskSize = [canvas.height * maskAspectRatio, canvas.height];\n    if (maskSize[0] > canvas.width) {\n      maskSize = [canvas.width, canvas.width / maskAspectRatio];\n    }\n  }\n\n  return {\n    scaling: [maskSize[0] / canvas.width, maskSize[1] / canvas.height],\n    width: maskSize[0],\n    height: maskSize[1],\n    offsetX: (canvas.width - maskSize[0]) / 2,\n    offsetY: (canvas.height - maskSize[1]) / 2,\n  };\n}\n","import type {Scene} from 'cesium';\n\nlet postUnlistener: Function = null;\n\ninterface ProgramInfo {\n  program: WebGLProgram,\n  attribLocations: {\n    vertexPosition: number\n  },\n  uniformLocations: {\n    uScaling: WebGLUniformLocation\n  }\n}\n\n\n// CC0 from https://github.com/mdn/dom-examples/tree/main/webgl-examples/tutorial/sample2\n\n\nexport class MaskDrawer {\n  private programInfo: ProgramInfo;\n  private positionBuffer: WebGLBuffer;\n\n  constructor(private gl: WebGL2RenderingContext | WebGLRenderingContext) {\n    const shaderProgram = this.initShaderProgram();\n\n    this.programInfo = {\n      program: shaderProgram,\n      attribLocations: {\n        vertexPosition: gl.getAttribLocation(shaderProgram, 'aVertexPosition')\n      },\n      uniformLocations: {\n        uScaling: gl.getUniformLocation(\n            shaderProgram,\n            'uScaling'\n        )\n      }\n    };\n\n    this.positionBuffer = gl.createBuffer();\n    const positions = [1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, -1.0];\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\n  }\n\n  getVertexShaderSource() {\n    return `\n      attribute vec4 aVertexPosition;\n      uniform vec2 uScaling;\n      void main() {\n        gl_Position = vec4(aVertexPosition[0] * uScaling[0], aVertexPosition[1] * uScaling[1], -1.0, 1.0);\n      }\n    `;\n  }\n\n  getFragmentShaderSource() {\n    return `\n      precision highp float;\n      void main() {\n        gl_FragColor = vec4(.5, .5, .5, .6);\n      }\n  `;\n  }\n\n  /**\n   *\n   */\n  private initShaderProgram(): WebGLProgram {\n    const gl = this.gl;\n    const vsSource = this.getVertexShaderSource();\n    const fsSource = this.getFragmentShaderSource();\n    const vertexShader = MaskDrawer.loadShader(gl, gl.VERTEX_SHADER, vsSource),\n        fragmentShader = MaskDrawer.loadShader(gl, gl.FRAGMENT_SHADER, fsSource),\n        shaderProgram = gl.createProgram();\n\n    gl.attachShader(shaderProgram, vertexShader);\n    gl.attachShader(shaderProgram, fragmentShader);\n    gl.linkProgram(shaderProgram);\n\n    // If creating the shader program failed, alert\n\n    if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n      throw new Error(\n          `Unable to initialize the shader program: ${gl.getProgramInfoLog(\n              shaderProgram\n          )}`\n      );\n    }\n\n    return shaderProgram;\n  }\n\n\n  /**\n   *\n   * @param {number[]} scaling scaling\n   */\n  drawMask(scaling: number[]) {\n    const gl = this.gl;\n    const programInfo = this.programInfo;\n    // Blend\n    gl.enable(gl.BLEND);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.vertexAttribPointer(\n        programInfo.attribLocations.vertexPosition,\n        2,\n        gl.FLOAT,\n        false,\n        0,\n        0\n    );\n    gl.enableVertexAttribArray(programInfo.attribLocations.vertexPosition);\n    gl.useProgram(programInfo.program);\n\n\n    // Draw a first time to fill the stencil area while keeping the destination color\n    gl.enable(gl.STENCIL_TEST);\n    gl.stencilFunc(\n        gl.ALWAYS,\n        1,\n        0xFF\n    );\n    gl.stencilOp(\n        gl.KEEP,\n        gl.KEEP,\n        gl.REPLACE\n    );\n    gl.uniform2fv(\n        programInfo.uniformLocations.uScaling,\n        scaling\n    );\n    gl.blendFunc(gl.ZERO, gl.ONE);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n\n    // Now draw again the whole viewport and darken the pixels that are not on the stencil\n    gl.stencilFunc(\n        gl.EQUAL,\n        0,\n        0xFF\n    );\n    gl.stencilOp(\n        gl.KEEP,\n        gl.KEEP,\n        gl.KEEP\n    );\n    gl.uniform2fv(\n        programInfo.uniformLocations.uScaling,\n        [1, 1]\n    );\n    gl.blendFunc(gl.ZERO, gl.SRC_ALPHA);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  }\n\n\n\n  /**\n   */\n  private static loadShader(gl: WebGL2RenderingContext | WebGLRenderingContext, type: number, source: string): WebGLShader {\n    const shader = gl.createShader(type);\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      throw new Error(\n          `An error occurred compiling the shaders: ${gl.getShaderInfoLog(shader)}`\n      );\n      // gl.deleteShader(shader);\n    }\n\n    return shader;\n  }\n}\n\n/**\n *\n */\nexport function autoDrawMask(scene: Scene, getScalings: () => number[]) {\n  const canvas = scene.canvas;\n  const ctx = canvas.getContext('webgl2') || canvas.getContext('webgl');\n\n  if (getScalings) {\n    if (!postUnlistener) {\n      const drawer = new MaskDrawer(ctx);\n      postUnlistener = scene.postRender.addEventListener(() => {\n        drawer.drawMask(getScalings());\n      });\n    }\n  }\n  else if (postUnlistener) {\n    postUnlistener();\n    // FIXME: destroy program\n    postUnlistener = null;\n  }\n  scene.requestRender();\n}\n","import type {Scene} from 'cesium';\n\ninterface ScreenshotOptions {\n  offsetX: number;\n  offsetY: number;\n  width: number;\n  height: number;\n}\n\n/**\n */\nexport function takeScreenshot(scene: Scene, options: ScreenshotOptions): Promise<string> {\n  return new Promise((resolve, reject) => {\n  // preserveDrawingBuffers is false so we render on demand and immediately read the buffer\n    const remover = scene.postRender.addEventListener(() => {\n      remover();\n      try {\n        let url;\n\n        if (options) {\n          const smallerCanvas = document.createElement('canvas');\n\n          smallerCanvas.width = options.width;\n          smallerCanvas.height = options.height;\n          smallerCanvas.getContext('2d').drawImage(\n              scene.canvas,\n              options.offsetX, options.offsetY, options.width, options.height,\n              0, 0, options.width, options.height);\n          url = smallerCanvas.toDataURL();\n        }\n        else {\n          url = scene.canvas.toDataURL();\n        }\n        resolve(url);\n      }\n      catch (e) {\n        reject(e);\n      }\n    });\n\n    scene.requestRender();\n  });\n}\n","export default class LazyLoader {\n  private promise: Promise<void> | undefined;\n  private url_: string;\n\n  /**\n   * @param url\n   * @api\n   */\n  constructor(url: string) {\n    this.url_ = url;\n  }\n\n  /**\n   * Load Cesium by injecting a script tag.\n   * @api\n   */\n  load(): Promise<void> {\n    if (!this.promise) {\n      // not yet loading\n      this.promise = new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        script.onload = () => resolve();\n        script.onerror = () => reject();\n        document.head.appendChild(script);\n        script.src = this.url_;\n      });\n    }\n    return this.promise;\n  }\n}\n","import olcsContribLazyLoader from './LazyLoader';\nimport OLCesium from '../OLCesium';\nimport {resetToNorthZenith, rotateAroundBottomCenter, computeSignedTiltAngleOnGlobe, pickBottomPoint, setHeadingUsingBottomCenter, limitCameraToBoundingSphere} from '../core';\nimport {toRadians} from '../math';\nimport Observable from 'ol/Observable.js';\nimport type OLMap from 'ol/Map.js';\nimport type {Extent} from 'ol/extent.js';\nimport type {BoundingSphere, Matrix4, Rectangle, Scene} from 'cesium';\n\n\n/**\n * @typedef {Object} ManagerOptions\n * @property {import('ol/Map.js').default} map\n * @property {import('ol/extent.js').Extent} [cameraExtentInRadians]\n * @property {string} [cesiumIonDefaultAccessToken]\n */\n\n\nexport default class Manager extends Observable {\n  private cesiumUrl_: string;\n  private boundingSphere_: BoundingSphere;\n  private promise_: Promise<OLCesium>;\n  private cesiumIonDefaultAccessToken_: string;\n  protected map: OLMap;\n  protected cameraExtentInRadians: Extent;\n  protected ol3d: OLCesium;\n  private cesiumInitialTilt_ = toRadians(50);\n\n  protected fogDensity = 0.0001;\n\n  protected fogSSEFactor = 25;\n\n  protected minimumZoomDistance = 2;\n\n  /**\n   * Limit the maximum distance to the earth to 10'000km.\n   */\n  protected maximumZoomDistance: number = 10000000;\n\n  // when closer to 3000m, restrict the available positions harder\n  protected limitCameraToBoundingSphereRatio = (height: number) => (height > 3000 ? 9 : 3);\n\n  /**\n   * @param {string} cesiumUrl\n   * @param {olcsx.contrib.ManagerOptions} options\n   * @api\n   */\n  constructor(cesiumUrl: string, {map, cameraExtentInRadians, cesiumIonDefaultAccessToken}: {map: OLMap, cameraExtentInRadians?: Extent, cesiumIonDefaultAccessToken?: string}) {\n    super();\n    this.cesiumUrl_ = cesiumUrl;\n    console.assert(map);\n    this.map = map;\n    this.cameraExtentInRadians = cameraExtentInRadians || null;\n    this.cesiumIonDefaultAccessToken_ = cesiumIonDefaultAccessToken;\n  }\n\n\n  /**\n   * Lazy load Cesium.\n   */\n  load(): Promise<OLCesium> {\n    if (!this.promise_) {\n      const cesiumLazyLoader = new olcsContribLazyLoader(this.cesiumUrl_);\n      this.promise_ = cesiumLazyLoader.load().then(() => this.onCesiumLoaded());\n    }\n    return this.promise_;\n  }\n\n\n  /**\n   * Hook called when Cesium has been lazy loaded.\n   */\n  protected onCesiumLoaded(): OLCesium {\n    if (this.cameraExtentInRadians) {\n      const rect = new Cesium.Rectangle(...this.cameraExtentInRadians);\n      // Set the fly home rectangle\n      Cesium.Camera.DEFAULT_VIEW_RECTANGLE = rect;\n      this.boundingSphere_ = Cesium.BoundingSphere.fromRectangle3D(rect, Cesium.Ellipsoid.WGS84, 300); // lux mean height is 300m\n    }\n\n    if (this.cesiumIonDefaultAccessToken_) {\n      Cesium.Ion.defaultAccessToken = this.cesiumIonDefaultAccessToken_;\n    }\n\n    this.ol3d = this.instantiateOLCesium();\n    const scene = this.ol3d.getCesiumScene();\n    this.configureForUsability(scene);\n    this.configureForPerformance(scene);\n    this.dispatchEvent('load');\n    return this.ol3d;\n  }\n\n\n  /**\n   * Application code should override this method.\n   */\n  instantiateOLCesium(): OLCesium {\n    const ol3d = new OLCesium({map: this.map});\n    const scene = ol3d.getCesiumScene();\n    // LEGACY\n    if ('createWorldTerrain' in Cesium) {\n      // @ts-ignore\n      const terrainProvider = Cesium.createWorldTerrain();\n      scene.terrainProvider = terrainProvider;\n    } else {\n      // v107+\n      Cesium.createWorldTerrainAsync().then(tp => scene.terrainProvider = tp);\n    }\n\n    return ol3d;\n  }\n\n\n  /**\n   * Override with custom performance optimization logics, if needed.\n   */\n  protected configureForPerformance(scene: Scene) {\n    const fog = scene.fog;\n    fog.enabled = true;\n    fog.density = this.fogDensity;\n    fog.screenSpaceErrorFactor = this.fogSSEFactor;\n  }\n\n\n  /**\n   * Override with custom usabliity logics, id needed.\n   */\n  configureForUsability(scene: Scene) {\n    const sscController = scene.screenSpaceCameraController;\n    sscController.minimumZoomDistance = this.minimumZoomDistance;\n    sscController.maximumZoomDistance = this.maximumZoomDistance;\n\n    // Do not see through the terrain. Seeing through the terrain does not make\n    // sense anyway, except for debugging\n    scene.globe.depthTestAgainstTerrain = true;\n\n    // Use white instead of the black default colour for the globe when tiles are missing\n    scene.globe.baseColor = Cesium.Color.WHITE;\n    scene.backgroundColor = Cesium.Color.WHITE;\n\n    if (this.boundingSphere_) {\n      scene.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this));\n    }\n    // Stop rendering Cesium when there is nothing to do. This drastically reduces CPU/GPU consumption.\n    this.ol3d.enableAutoRenderLoop();\n  }\n\n  /**\n   * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n   * Near the ground the allowed distance is shorter.\n   */\n  protected limitCameraToBoundingSphere() {\n    const scene = this.ol3d.getCesiumScene();\n    limitCameraToBoundingSphere(scene.camera, this.boundingSphere_, this.limitCameraToBoundingSphereRatio);\n  }\n\n  /**\n   * Enable or disable ol3d with a default animation.\n   */\n  toggle3d(): Promise<void> {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      if (is3DCurrentlyEnabled) {\n        // Disable 3D\n        console.assert(this.map);\n        return resetToNorthZenith(this.map, scene).then(() => {\n          ol3d.setEnabled(false);\n          this.dispatchEvent('toggle');\n        });\n      } else {\n        // Enable 3D\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n        return rotateAroundBottomCenter(scene, this.cesiumInitialTilt_);\n      }\n    });\n  }\n\n\n  /**\n   * Enable ol3d with a view built from parameters.\n   */\n  set3dWithView(lon: number, lat: number, elevation: number, headingDeg: number, pitchDeg: number): Promise<void> {\n    return this.load().then((ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const destination = Cesium.Cartesian3.fromDegrees(lon, lat, elevation);\n      const heading = Cesium.Math.toRadians(headingDeg);\n      const pitch = Cesium.Math.toRadians(pitchDeg);\n      const roll = 0;\n      const orientation = {heading, pitch, roll};\n\n      if (!is3DCurrentlyEnabled) {\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n      }\n\n      camera.setView({\n        destination,\n        orientation\n      });\n    });\n  }\n\n\n  /**\n   * Whether OL-Cesium has been loaded and 3D mode is enabled.\n   */\n  is3dEnabled(): boolean {\n    return !!this.ol3d && this.ol3d.getEnabled();\n  }\n\n\n  /**\n   * @return {number}\n   */\n  getHeading(): number {\n    return this.map ? this.map.getView().getRotation() || 0 : 0;\n  }\n\n\n  /**\n   * @return {number|undefined}\n   */\n  getTiltOnGlobe() {\n    const scene = this.ol3d.getCesiumScene();\n    const tiltOnGlobe = computeSignedTiltAngleOnGlobe(scene);\n    return -tiltOnGlobe;\n  }\n\n\n  /**\n   * Set heading.\n   * This assumes ol3d has been loaded.\n   */\n  setHeading(angle: number) {\n    const scene = this.ol3d.getCesiumScene();\n    const bottom = pickBottomPoint(scene);\n    if (bottom) {\n      setHeadingUsingBottomCenter(scene, angle, bottom);\n    }\n  }\n\n  getOl3d(): OLCesium {\n    return this.ol3d;\n  }\n\n  getCesiumViewMatrix(): Matrix4 {\n    return this.ol3d.getCesiumScene().camera.viewMatrix;\n  }\n\n  getCesiumScene(): Scene {\n    return this.ol3d.getCesiumScene();\n  }\n\n  /**\n   * Fly to some rectangle.\n   * This assumes ol3d has been loaded.\n   */\n  flyToRectangle(rectangle: Rectangle, offset = 0): Promise<void> {\n    const camera = this.getCesiumScene().camera;\n    const destination = camera.getRectangleCameraCoordinates(rectangle);\n\n    const mag = Cesium.Cartesian3.magnitude(destination) + offset;\n    Cesium.Cartesian3.normalize(destination, destination);\n    Cesium.Cartesian3.multiplyByScalar(destination, mag, destination);\n\n    return new Promise((resolve, reject) => {\n      if (!this.cameraExtentInRadians) {\n        reject();\n        return;\n      }\n\n      camera.flyTo({\n        destination,\n        complete: () => resolve(),\n        cancel: () => reject(),\n        endTransform: Cesium.Matrix4.IDENTITY\n      });\n    });\n  }\n}\n","import OLCesium from './olcs/OLCesium';\nexport default OLCesium;\n\nexport {default as AbstractSynchronizer} from './olcs/AbstractSynchronizer';\nexport {default as RasterSynchronizer} from './olcs/RasterSynchronizer';\nexport {default as VectorSynchronizer} from './olcs/VectorSynchronizer';\n\nexport {default as FeatureConverter} from './olcs/FeatureConverter';\nexport {default as OLCSCamera} from './olcs/Camera';\n\n// Core api functions\nexport * from './olcs/core';\nexport {default as OLImageryProvider} from './olcs/core/OLImageryProvider';\nexport {default as VectorLayerCounterpart} from './olcs/core/VectorLayerCounterpart';\n\n// Print functions\nexport * from './olcs/print';\n\n// Contrib Manager\nexport {default as ContribManager} from './olcs/contrib/Manager';\nexport {default as ContribLazyLoader} from './olcs/contrib/LazyLoader';\n\n// Deprecated export of olcs on window\nconst olcs = window['olcs'] = {};\nolcs.OLCesium = OLCesium;\n\nimport {default as AbstractSynchronizer} from './olcs/AbstractSynchronizer';\nimport {default as RasterSynchronizer} from './olcs/RasterSynchronizer';\nimport {default as VectorSynchronizer} from './olcs/VectorSynchronizer';\nolcs.AbstractSynchronizer = AbstractSynchronizer;\nolcs.RasterSynchronizer = RasterSynchronizer;\nolcs.VectorSynchronizer = VectorSynchronizer;\n\nimport * as core from './olcs/core';\nimport {default as OLImageryProvider} from './olcs/core/OLImageryProvider';\nimport {default as VectorLayerCounterpart} from './olcs/core/VectorLayerCounterpart';\nolcs.core = core;\nolcs.core.OLImageryProvider = OLImageryProvider;\nolcs.core.VectorLayerCounterpart = VectorLayerCounterpart;\n\nolcs.contrib = {};\nimport {default as ContribManager} from './olcs/contrib/Manager';\nimport {default as ContribLazyLoader} from './olcs/contrib/LazyLoader';\nolcs.contrib.LazyLoader = ContribLazyLoader;\nolcs.contrib.Manager = ContribManager;\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__206__","__WEBPACK_EXTERNAL_MODULE__177__","__WEBPACK_EXTERNAL_MODULE__164__","__WEBPACK_EXTERNAL_MODULE__330__","__WEBPACK_EXTERNAL_MODULE__24__","__WEBPACK_EXTERNAL_MODULE__606__","__WEBPACK_EXTERNAL_MODULE__469__","__WEBPACK_EXTERNAL_MODULE__623__","__WEBPACK_EXTERNAL_MODULE__886__","__WEBPACK_EXTERNAL_MODULE__622__","__WEBPACK_EXTERNAL_MODULE__673__","__WEBPACK_EXTERNAL_MODULE__432__","__WEBPACK_EXTERNAL_MODULE__401__","__WEBPACK_EXTERNAL_MODULE__193__","__WEBPACK_EXTERNAL_MODULE__51__","__WEBPACK_EXTERNAL_MODULE__817__","__WEBPACK_EXTERNAL_MODULE__280__","__WEBPACK_EXTERNAL_MODULE__750__","__WEBPACK_EXTERNAL_MODULE__628__","__WEBPACK_EXTERNAL_MODULE__423__","__WEBPACK_EXTERNAL_MODULE__115__","__WEBPACK_EXTERNAL_MODULE__996__","__WEBPACK_EXTERNAL_MODULE__235__","__WEBPACK_EXTERNAL_MODULE__911__","__WEBPACK_EXTERNAL_MODULE__604__","__WEBPACK_EXTERNAL_MODULE__515__","__WEBPACK_EXTERNAL_MODULE__830__","__WEBPACK_EXTERNAL_MODULE__582__","__WEBPACK_EXTERNAL_MODULE__63__","__WEBPACK_EXTERNAL_MODULE__425__","__WEBPACK_EXTERNAL_MODULE__962__","__WEBPACK_EXTERNAL_MODULE__253__","__WEBPACK_EXTERNAL_MODULE__988__","__WEBPACK_EXTERNAL_MODULE__524__","__WEBPACK_EXTERNAL_MODULE__312__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","_imageRenderingPixelatedSupported","_imageRenderingValue","supportsImageRenderingPixelated","canvas","document","createElement","setAttribute","imageRenderingValue","style","imageRendering","getSourceProjection","source","getProjection","uidCounter_","getUid","olcs_uid","waitReady","object","p","readyPromise","ready","Promise","resolve","_","stopper","setInterval","clearInterval","reject","createEmptyCanvas","width","height","olUseNewCoordinates","tileCoord","TileSource","projection","wrapX","getTileCoordForTileUrlFunction","OLImageryProvider","this","ready_","rectangle","rectangle_","tilingScheme","tilingScheme_","_ready","tileWidth","tileGrid","source_","getTileGrid","tileSizeAtZoom0","getTileSize","Array","isArray","tileHeight","maximumLevel","getMaxZoom","minimumLevel","tileDiscardPolicy","hasAlphaChannel","pickFeatures","x","y","level","longitude","latitude","constructor","olMap","opt_fallbackProj","emptyCanvas_","emptyCanvasPromise_","errorEvent","Cesium","Event","projection_","fallbackProj_","WebMercatorTilingScheme","map_","shouldRequestNextLevel","proxy","DefaultProxy","on","e","handleSourceChanged_","getState","options","numberOfLevelZeroTilesX","numberOfLevelZeroTilesY","forEachTileCoord","getExtent","_ref","zoom","xIndex","yIndex","getCode","GeographicTilingScheme","getTileCredits","attributionsFunction","getAttributions","extent","getView","calculateExtent","getSize","center","getCenter","attributionsFunctionToCredits","requestImage","request","tileUrlFunction","getTileUrlFunction","z_","y_","url","getURL","ImageryProvider","loadImage","format","MVT","featureClass","RenderFeature","styles","Style","stroke","Stroke","color","MVTImageryProvider","minimumLevel_","urls","credit","styleFunction_","styleFunction","tileRectangle_","Rectangle","cacheSize","tileCache","LRUCache","featureCache","getTilegridForProjection","tileFunction_","createTileUrlFunctions","getTileFeatures","z","cacheKey","getCacheKey_","promise","containsKey","getUrl_","fetch","then","ok","arrayBuffer","buffer","readFeaturesFromBuffer","set","getCount","highWaterMark","canExpireCache","pop","OL_VERSION","dataProjection","featureProjection","features","readFeatures","scaleFactor","forEach","f","flatCoordinates","getFlatCoordinates","flip","i","length","tileXYToNativeRectangle","resolution","east","west","rasterizeFeatures","raiseEvent","vectorContext","toContext","getContext","size","setStyle","drawGeometry","computePixelSizeAtCoordinate","scene","target","camera","frustum","distance","Cartesian3","magnitude","subtract","position","getPixelDimensions","clientWidth","clientHeight","pixelRatio","Cartesian2","computeBoundingBoxAtTarget","amount","pixelSize","transform","Transforms","eastNorthUpToFixedFrame","bottomLeft","Matrix4","multiplyByPoint","topRight","Ellipsoid","WGS84","cartesianArrayToCartographicArray","applyHeightOffsetToGeometry","geometry","applyTransform","input","output","stride","createMatrixAtCoordinates","coordinates","rotation","translation","scale","ZERO","ol4326CoordinateToCesiumCartesian","rawMatrix","quaternion","Quaternion","fromAxisAngle","UNIT_Z","rotationMatrix","fromTranslationQuaternionRotationScale","multiply","rotateAroundAxis","angle","axis","opt_options","clamp","Math","defaultValue","duration","easing","linearEasing","callback","lastProgress","oldTransform","start","Date","now","step","timestamp","progress","clone","stepAngle","lookAtTransform","rotate","window","requestAnimationFrame","setHeadingUsingBottomCenter","heading","bottomCenter","angleToZenith","computeAngleToZenith","right","Matrix3","fromQuaternion","vector","zenith","multiplyByVector","add","fromTranslation","pickOnTerrainOrEllipsoid","pixel","ray","getPickRay","globe","pick","pickEllipsoid","pickBottomPoint","pickCenterPoint","computeSignedTiltAngleOnGlobe","Ray","direction","ellipsoid","IntersectionTests","rayEllipsoid","getPoint","normal","geocentricSurfaceNormal","signedAngleBetween","PI","convertLongitudeRange","bottomFovRay","fovy2","fovy","matrix","first","second","b","c","normalize","cross","cosine","dot","sine","sign","atan2","pivot","fy","negate","left","extentToRectangle","ext","transformExtent","fromDegrees","sourceToImageryProvider","viewProj","olLayer","skip","provider","olSourceImageWMS","getUrl","getImageLoadFunction","defaultImageLoadFunction","sourceProps","olSourceTileWMS","attributions","params","getParams","setProperties","olSourceTileImage","isCesiumProjection","olcsCoreOLImageryProvider","olSourceImageStatic","olSourceVectorTile","VectorTileLayer","fromCode","split","map","u","replace","getStyleFunction","getExtentCenter","getImageExtent","SingleTileImageryProvider","tileLayerToImageryLayer","olLayerTile","olLayerImage","getSource","layerOptions","ImageryLayer","updateCesiumLayerProperties","olLayerWithParents","csLayer","opacity","visible","layer","concat","parents","layerOpacity","getOpacity","layerVisible","getVisible","alpha","show","coordinate","coo","ol4326CoordinateArrayToCsCartesians","toCartesian","cartesians","push","olGeometryCloneTo4326","proj4326","proj","properties","getProperties","convertColorToCesium","olColor","Color","byteToFloat","fromCssColorString","CanvasPattern","CanvasGradient","ctx","fillStyle","fillRect","ImageMaterialProperty","image","convertUrlToCesium","subdomains","re","match","exec","startCharCode","charCodeAt","stopCharCode","charCode","String","fromCharCode","resetToNorthZenith","currentHeading","getRotation","normalizeView","rotateAroundBottomCenter","view","getResolution","setRotation","constrainResolution","setResolution","getConstrainedResolution","is3857","is4326","viewState","html","Credit","calcDistanceForResolution","metersPerUnit","getMetersPerUnit","cos","abs","tan","calcResolutionForDistance","limitCameraToBoundingSphere","boundingSphere","ratio","blockLimiter","carto","Cartographic","fromCartesian","radius","flying","unblockLimiter","flyToBoundingSphere","complete","cancel","AutoRenderLoop","ol3d","repaintEventNames_","scene_","getCesiumScene","canvas_","_boundNotifyRepaintRequired","notifyRepaintRequired","bind","enable","requestRenderMode","maximumRenderTimeChange","repaintKey","addEventListener","getOlMap","getLayerGroup","disable","removeEventListener","un","restartRenderLoop","requestRender","toDegrees","angleInRadians","toRadians","angleInDegrees","identityProjection","opt_output","opt_dimension","dim","Camera","viewListenKey_","toLonLat_","fromLonLat_","tilt_","distance_","lastCameraViewMatrix_","viewUpdateInProgress_","cam_","setView_","destroy","olObservableUnByKey","view_","toLonLat","getTransform","fromLonLat","handleViewChangedEvent_","readFromView","setHeading","getHeading","setTilt","tilt","updateCamera_","getTilt","setDistance","updateView","getDistance","setCenter","setPosition","ll","getAltitude","setView","destination","cartographicToCartesian","getPosition","cartesianToCartographic","setAltitude","altitude","getHeight","orientation","pitch","PI_OVER_TWO","roll","moveBackward","checkCameraChange","bestTarget","positionCartographic","bestTargetCartographic","pos","targetNormal","targetToCamera","up","angleBetween","tiltAngle","acos","isNaN","opt_dontSync","old","current","viewMatrix","equalsEpsilon","AbstractSynchronizer","layerMap","olLayerListenKeys","olGroupListenKeys_","olLayers","getLayers","mapLayerGroup","synchronize","destroyAll","addLayers_","orderLayers","fifo","splice","olLayerId","toString","cesiumObjects","LayerGroup","listenForGroupChanges_","createSingleLayerCounterparts","l","newOlLayerWithParents","layerId","layerWithParents","onLayerChange","cesiumObjs","addCesiumObjects_","cesiumObject","addCesiumObject","removeAndDestroySingleLayer_","uid","counterparts","counterpart","removeSingleCesiumObject","destroyCesiumObject","unlistenSingleGroup_","group","removeLayer_","done","uuid","listenKeyArray","contentKeys","listenAddRemove","collection","event","element","el","indexOf","objKey","removeAllCesiumObjects","RasterSynchronizer","olcsAbstractSynchronizer","super","cesiumLayers_","imageryLayers","ourLayers_","ImageryLayerCollection","remove","removeAll","convertLayerToCesiumImageries","result","olLayerItem","BaseVectorLayer","previousStyleFunction","currentStyleFunction","csObj","_imageryCache","ip","imageryProvider","_ip$tileCache","clear","layers","zIndices","queue","getZIndex","sublayers","unshift","getArray","sort","layer1","layer2","raiseToTop","VectorLayerCounterpart","layerProjection","olListenKeys","billboards","BillboardCollection","primitives","PrimitiveCollection","rootCollection_","context","featureToCesiumMap","getRootPrimitive","FeatureConverter","boundOnRemoveOrClearFeatureListener_","onRemoveOrClearFeature_","defaultBillboardEyeOffset_","evt","cancellers","feature","id","canceller","setReferenceForPicking","primitive","olFeature","createColoredPrimitive","olGeometry","opt_lineWidth","flat","renderState","depthTest","enabled","lineWidth","instances","instance","GeometryInstance","attributes","ColorGeometryInstanceAttribute","fromColor","createInstance","getHeightReference","HeightReference","CLAMP_TO_GROUND","GroundPrimitive","geometryInstances","Primitive","dataUri","getValue","toDataURL","appearance","MaterialAppearance","material","Material","fabric","type","uniforms","translucent","shadows","extractColorFromOlStyle","outline","fillColor","getFill","getColor","strokeColor","getStroke","extractLineWidthFromOlStyle","getWidth","wrapFillAndOutlineGeometries","fillGeometry","outlineGeometry","olStyle","outlineColor","p1","p2","addTextStyle","getText","text","label","olGeometry4326TextPartToCesium","csAddBillboard","bbOptions","eyeOffset","bb","olCircleGeometryToCesium","olCenter","olPoint","slice","getRadius","point","CircleGeometry","outlinePrimitive","positions","olCreateCircularPolygon","getLinearRing","getCoordinates","op","GroundPolylinePrimitive","GroundPolylineGeometry","PolylineMaterialAppearance","olStyleToCesium","classificationType","ClassificationType","TERRAIN","_primitive","CircleOutlineGeometry","extrudedHeight","olLineStringGeometryToCesium","heightReference","PolylineGeometry","vertexFormat","olPolygonGeometryToCesium","boundingExtent","maxHeight","max","featureExtrudedHeight","RectangleGeometry","RectangleOutlineGeometry","rings","getLinearRings","hierarchy","holes","polygonHierarchy","PolygonGeometry","perPositionHeight","linePositions","polylineGeometry","PolygonOutlineGeometry","altitudeMode","NONE","RELATIVE_TO_GROUND","createBillboardFromImage","imageStyle","opt_newBillboardCallback","OLStyleIcon","load","getImage","reallyCreateBillboard","HTMLCanvasElement","Image","HTMLImageElement","getScale","assign","anchor","getAnchor","xScale","yScale","pixelOffset","src","naturalHeight","naturalWidth","isImageLoaded","cancelled","fuid","listener","isDestroyed","olPointGeometryToCesium","modelPrimitive","olcsModelFunction","olcsModel","cesiumOptions","Model","model","fromGltf","fromGltfAsync","debugModelMatrix","DebugModelMatrixPrimitive","modelMatrix","olMultiGeometryToCesium","getType","points","getPoints","geom","lineStrings","getLineStrings","polygons","getPolygons","labels","LabelCollection","extentCenter","olGeomSimpleGeometry","getFirstCoordinate","offsetX","getOffsetX","offsetY","getOffsetY","offset","labelStyle","horizontalOrigin","font","getFont","LabelStyle","FILL","outlineWidth","OUTLINE","FILL_AND_OUTLINE","getTextAlign","HorizontalOrigin","LEFT","RIGHT","CENTER","getTextBaseline","verticalOrigin","VerticalOrigin","TOP","BOTTOM","fill","getLineDash","fromType","horizontal","repeat","evenColor","oddColor","computePlainStyle","fallbackStyleFunction","featureStyleFunction","getGeometryFromFeature","opt_geom","geom3d","OLGeometry","geomFuncRes","getGeometryFunction","getGeometry","olFeatureToCesium","newBillboardAddedCallback","featureBb","getGeometriesArray","prims","bbs","Error","olVectorLayerToCesium","olView","featurePrimitiveMap","OLClusterSource","getFeatures","layerStyle","prim","convert","VectorSynchronizer","opt_converter","converter","olcsFeatureConverter","csAllPrimitives_","destroyPrimitives","updateLayerVisibility","csPrimitive","olLayerVector","olLayerVectorTile","olSourceCluster","csPrimitives","onAddFeature","onRemoveFeature","Billboard","cloneNode","node","parent","nodeName","drawImage","appendChild","nodeType","Node","TEXT_NODE","dispatchEvent","MouseEvent","stopPropagation","nodes","childNodes","SynchronizedOverlay","OLOverlay","getOptions","scenePostRenderListenerRemover_","attributeObserver_","synchronizer_","synchronizer","parent_","positionWGS84_","observer_","MutationObserver","handleElementChanged","listenerKeys_","setPropertyFromEvent","setPropertyFromEvent_","handleMapChanged","observeTarget_","disconnect","observe","childList","characterData","subtree","observer","getScene","parentNode","removeChild","postRender","updatePixelPosition","container","stopEvent","getOverlayContainerStopEvent","getOverlayContainer","insertFirst","insertBefore","handlePositionChanged","sourceProjection","getMap","lastChild","removeChildren","getElement","from","clonedNode","setVisible","globeHeight","tilesLoaded","cartesian","ellipsoidBoundingSphere","BoundingSphere","Occluder","isPointVisible","computeCullingVolume","computeVisibility","pixelCartesian","cartesianToCanvasCoordinates","mapSize","updateRenderedPosition","removeNode","OverlaySynchronizer","overlayMap_","Map","overlayEvents","overlayCollection_","getOverlays","overlayContainerStopEvent_","className","name","parentElement","overlayContainer_","overlay","addOverlay","removeOverlay","cesiumOverlay","overlayId","csOverlay","delete","BoundingSphereState","OLCesium","autoRenderLoop_","resolutionScale_","canvasClientWidth_","canvasClientHeight_","resolutionScaleChanged_","enabled_","pausedInteractions_","hiddenRootGroup_","lastFrameTime_","targetFrameRate_","Number","POSITIVE_INFINITY","blockCesiumRendering_","warmingUp_","trackedFeature_","trackedEntity_","entityView_","needTrackedEntityUpdate_","boundingSphereScratch_","time_","time","JulianDate","to4326Transform_","fillArea","container_","containerAttribute","createAttribute","setAttributeNode","targetElement","getViewport","getElementById","isOverMap_","stopOpenLayersEventsPropagation","ii","canvasAttribute","oncontextmenu","onselectstart","sceneOptions","scene3DOnly","Scene","sscc","screenSpaceCameraController","tiltEventTypes","CameraEventType","LEFT_DRAG","KeyboardEventModifier","SHIFT","ALT","enableLook","constrainedAxis","camera_","olcsCamera","globe_","Globe","baseColor","WHITE","skyAtmosphere","SkyAtmosphere","firstImageryProvider","addImageryProvider","dataSourceCollection_","DataSourceCollection","dataSourceDisplay_","DataSourceDisplay","dataSourceCollection","synchronizers_","createSynchronizers","olcsRasterSynchronizer","olcsVectorSynchronizer","olcsOverlaySynchronizer","handleResize_","EventHelper","updateTrackedEntity_","cancelAnimationFrame","renderId_","_postRender","render_","onAnimationFrame_","frameTime","interval","julianDate","initializeFrame","update","trackedEntity","getBoundingSphere","render","state","enableTilt","bs","EntityView","mapProjection","resolutionScale","devicePixelRatio","aspectRatio","getCamera","getOlView","getDataSources","getDataSourceDisplay","getEnabled","setEnabled","interactions","visibility","throwOnUnitializedMap_","getInteractions","arr","addInteraction","interaction","removeInteraction","interactionRemoved","filter","removed","rootGroup","classList","warmUp","timeout","csCamera","setTimeout","setBlockCesiumRendering","block","enableAutoRenderLoop","olcsAutoRenderLoop","getAutoRenderLoop","setResolutionScale","setTargetFrameRate","isDef","trackedFeature","defaultDataSource","entities","IDENTITY","to4326Transform","toCesiumPosition","olGeomPoint","CallbackProperty","TRANSPARENT","computeRectangle","tw","th","maskAspectRatio","maskSize","scaling","postUnlistener","MaskDrawer","gl","shaderProgram","initShaderProgram","programInfo","program","attribLocations","vertexPosition","getAttribLocation","uniformLocations","uScaling","getUniformLocation","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","getVertexShaderSource","getFragmentShaderSource","vsSource","fsSource","vertexShader","loadShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","drawMask","BLEND","vertexAttribPointer","FLOAT","enableVertexAttribArray","useProgram","STENCIL_TEST","stencilFunc","ALWAYS","stencilOp","KEEP","REPLACE","uniform2fv","blendFunc","ONE","drawArrays","TRIANGLE_STRIP","EQUAL","SRC_ALPHA","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","autoDrawMask","getScalings","drawer","takeScreenshot","remover","smallerCanvas","LazyLoader","url_","script","onload","onerror","head","Manager","Observable","cesiumUrl","cameraExtentInRadians","cesiumIonDefaultAccessToken","cesiumInitialTilt_","fogDensity","fogSSEFactor","minimumZoomDistance","maximumZoomDistance","limitCameraToBoundingSphereRatio","cesiumUrl_","cesiumIonDefaultAccessToken_","promise_","cesiumLazyLoader","olcsContribLazyLoader","onCesiumLoaded","rect","DEFAULT_VIEW_RECTANGLE","boundingSphere_","fromRectangle3D","Ion","defaultAccessToken","instantiateOLCesium","configureForUsability","configureForPerformance","terrainProvider","createWorldTerrain","createWorldTerrainAsync","tp","fog","density","screenSpaceErrorFactor","sscController","depthTestAgainstTerrain","backgroundColor","toggle3d","is3DCurrentlyEnabled","set3dWithView","lon","lat","elevation","headingDeg","pitchDeg","is3dEnabled","getTiltOnGlobe","bottom","getOl3d","getCesiumViewMatrix","flyToRectangle","getRectangleCameraCoordinates","mag","multiplyByScalar","flyTo","endTransform","olcs","core","contrib","ContribLazyLoader","ContribManager"],"sourceRoot":""}